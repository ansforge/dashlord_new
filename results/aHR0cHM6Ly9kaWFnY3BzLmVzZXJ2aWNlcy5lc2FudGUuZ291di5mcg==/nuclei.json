[
  [
    {
      "template": "dns/caa-fingerprint.yaml",
      "template-url": "https://templates.nuclei.sh/public/caa-fingerprint",
      "template-id": "caa-fingerprint",
      "template-path": "/home/runner/nuclei-templates/dns/caa-fingerprint.yaml",
      "info": {
        "name": "CAA Record",
        "author": [
          "pdteam"
        ],
        "tags": [
          "dns",
          "caa"
        ],
        "description": "A CAA record was discovered. A CAA record is used to specify which certificate authorities (CAs) are allowed to issue certificates for a domain.",
        "reference": [
          "https://support.dnsimple.com/articles/caa-record/#whats-a-caa-record"
        ],
        "severity": "info",
        "metadata": {
          "max-request": 1
        },
        "classification": {
          "cve-id": null,
          "cwe-id": [
            "cwe-200"
          ]
        }
      },
      "type": "dns",
      "host": "diagcps.eservices.esante.gouv.fr.",
      "matched-at": "diagcps.eservices.esante.gouv.fr",
      "request": ";; opcode: QUERY, status: NOERROR, id: 7151\n;; flags: rd; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version 0; flags:; udp: 4096\n\n;; QUESTION SECTION:\n;diagcps.eservices.esante.gouv.fr.\tIN\t CAA\n",
      "response": ";; opcode: QUERY, status: NOERROR, id: 7151\n;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version 0; flags:; udp: 512\n\n;; QUESTION SECTION:\n;diagcps.eservices.esante.gouv.fr.\tIN\t CAA\n\n;; AUTHORITY SECTION:\nesante.gouv.fr.\t1800\tIN\tSOA\tns1.gandi.net. hostmaster.gandi.net. 1741960648 10800 3600 604800 10800\n",
      "timestamp": "2025-03-14T16:25:03.859999736Z",
      "matcher-status": true
    },
    {
      "template": "http/miscellaneous/addeventlistener-detect.yaml",
      "template-url": "https://templates.nuclei.sh/public/addeventlistener-detect",
      "template-id": "addeventlistener-detect",
      "template-path": "/home/runner/nuclei-templates/http/miscellaneous/addeventlistener-detect.yaml",
      "info": {
        "name": "DOM EventListener - Cross-Site Scripting",
        "author": [
          "yavolo",
          "dwisiswant0"
        ],
        "tags": [
          "miscellaneous",
          "xss",
          "misc"
        ],
        "description": "EventListener contains a cross-site scripting vulnerability via the document object model (DOM). An attacker can execute arbitrary script which can then allow theft of cookie-based authentication credentials and launch of  other attacks.",
        "reference": [
          "https://portswigger.net/web-security/dom-based/controlling-the-web-message-source"
        ],
        "severity": "info",
        "metadata": {
          "max-request": 1
        },
        "classification": {
          "cve-id": null,
          "cwe-id": [
            "cwe-79"
          ],
          "cvss-metrics": "CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:L/A:N",
          "cvss-score": 7.2
        }
      },
      "type": "http",
      "host": "https://diagcps.eservices.esante.gouv.fr",
      "matched-at": "https://diagcps.eservices.esante.gouv.fr",
      "request": "GET / HTTP/1.1\r\nHost: diagcps.eservices.esante.gouv.fr\r\nUser-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)\r\nConnection: close\r\nAccept: */*\r\nAccept-Language: en\r\nAccept-Encoding: gzip\r\n\r\n",
      "response": "HTTP/1.1 200 OK\r\nConnection: close\r\nTransfer-Encoding: chunked\r\nContent-Type: text/html; charset=UTF-8\r\nDate: Fri, 14 Mar 2025 16:25:23 GMT\r\nServer: Apache/2.4.37 (centos) OpenSSL/1.1.1g\r\nX-Powered-By: PHP/7.2.24\r\n\r\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n\t<title>DiagCPS, Outil de Diagnostic SSL</title>\r\n\t<meta http-equiv=\"Content-type\" content=\"text/html; charset=UTF-8\" />\r\n\t<meta name=\"description\" content=\"DiagCPS est un Outil de Diagnostic de l'authentification en ligne à l'aide d'une Carte de Professionnel de Santé, i.e. CPS. Il est fourni par l'ASIP Santé et remplace ODI.\" />\r\n\t<meta name=\"Publisher\" content=\"ASIP Santé\" />\r\n\t<meta name=\"copyright\" content=\"Tous droits réservés - ASIP Santé\" />\r\n\t<link rel=\"shortcut icon\" href=\"./images/favicon.ico\" type=\"image/x-icon\" />\r\n\t<link rel=\"stylesheet\" href=\"diagcps_css.php\" />\r\n\t<script src=\"./js/jquery-3.2.0.min.js\"></script>\r\n\t<script src=\"./js/ua-parser.min.js\"></script>\r\n</head>\r\n<body>\r\n<div id=\"header\" style=\"display:flex;flex-direction:row\">\r\n    <div style=\"margin:20px\">\r\n        <a href=\"https://solidarites-sante.gouv.fr/\" target=\"_blank\">\r\n            <img src=\"./images/logo-ministere.svg\" alt=\"Ministère des Solidarités et de la santé\" width=\"168\" height=\"104\">\r\n        </a>\r\n    </div>\r\n\t<div id=\"title\">esante.gouv.fr</div>\r\n</div>\r\n<div id=\"section\">\r\n<script type=\"text/javascript\">\n\n<!-- script : /js/wizarddiagcps.js Begin -->\n//==================================\r\n// Global variable used for state machine management \r\n// displayed on screen \r\n// or used by state machine\r\n//==================================\r\nvar wizardStateMachine = {\r\n\tstartState: 'notSupported',\r\n\tlastState: 'notSupported',\r\n\t\r\n\t//=================\r\n\t// Retry Management\r\n\t// Variables\r\n\tnbMaxRetry: 10,\r\n\tnbRetry: 0,\r\n\t\r\n\t// Management\r\n\tinitRetry: function() {this.nbRetry = this.nbMaxRetry;},\r\n\tisMaxRetry: function() {return (this.nbRetry >= this.nbMaxRetry);},\r\n\tisMinRetry: function() {return (this.nbRetry <= 0);},\r\n\tdecRetry: function() {this.nbRetry--;},\r\n\tdisplayRetry: function() {\r\n\t\t\t\t\t\t\t\t//console.log(\"displayRetry : nbRetry = \" + this.nbRetry);\r\n\t\t\t\t\t\t\t\tthis.decRetry();\r\n\t\t\t\t\t\t\t\tthis.stopTimers(); \r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.isMinRetry()\r\n\t\t\t\t\t\t\t\t\t&& \t(this.lastState != 'endDiagWithSuccess')) {\r\n\t\t\t\t\t\t\t\t\tthis.wizard('manualInstallClibCPS');\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tthis.displayWait(true);\r\n\t\t\t\t\t\t\t\t\tthis.startTimers();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\r\n\t//==================\r\n\t// Timers Management\r\n\ttimerTestSSL: null,\r\n\tretryTimeoutKO: 1000,\r\n\tinitTimer: function () {this.retryTimeoutKO = 1000;},\r\n\taccelerateTimer: function () {this.retryTimeoutKO = 250;},\r\n\tstopTimers: function() {\r\n\t\t\t\t\t\t\t\tif (this.timerTestSSL != null)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tclearTimeout(this.timerTestSSL);\r\n\t\t\t\t\t\t\t\t\tthis.timerTestSSL = null;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\tstartTimers: function() {this.timerTestSSL = setTimeout(function(){wizardStateMachine.displayRetry()}, this.retryTimeoutKO);},\r\n\t\r\n\t//=======\r\n\t// Wizard\r\n\tstartWizard: function() {this.wizard(this.startState);},\r\n\twizard: function(step, param) {\r\n\t\t\t\tconsole.log(\"wizard : step = \" + step + \", param = \" + param);\r\n\t\t\t\t\t\r\n\t\t\t\tswitch (step)\r\n\t\t\t\t{\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Pre treatment\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'notSupported':\r\n\t\t\t\t\tcase 'preAlert':\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'start');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif ((dataIHM.getUAInfos().configSupported) || (step == 'preAlert')) this.displayInstruction(true, 'preAlert');\r\n\t\t\t\t\t\telse this.displayInstruction(true, 'notSupported');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Manual Installation XPI\r\n\t\t\t\t\t// Suggestion of installation\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'manualInstallXPI':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'KO');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'manualInstallXPI');\r\n\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// XPI Installation\r\n\t\t\t\t\t// Installation process\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'XPI':\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'restartAlertXPI');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar params = {\r\n\t\t\t\t\t\t\t\t\"Installer l'Extension Cryptolib CPS\": \r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tURL: param.URL,\r\n\t\t\t\t\t\t\t\t\tIconURL: param.IconURL,\r\n\t\t\t\t\t\t\t\t\tHash: param.Hash,\r\n\t\t\t\t\t\t\t\t\ttoString: function () { return this.URL; }\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t};\r\nconsole.log(params);\r\n\t\t\t\t\t\tInstallTrigger.install(params);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// Diagnostic\r\n\t\t\t\t\t// Start\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'startDiag':\r\n\t\t\t\t\t\tthis.initRetry();\r\n\t\t\t\t\t\tthis.initTimer();\r\n\r\n\t\t\t\t\t\tthis.displayWait(true);\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'inProgress');\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tdataIHM.readClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.startTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// Diagnostic\r\n\t\t\t\t\t// Restart\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'restartDiag':\r\n\r\n\t\t\t\t\t\tdataIHM.resetClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\r\n\t\t\t\t\t//==========================\r\n\t\t\t\t\t// Progression\r\n\t\t\t\t\t//--------------------------\r\n\t\t\t\t\tcase 'inProgress':\r\n\t\t\t\t\t\t//dataIHM.readClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// this.displayDiagnosticState(true, 'inProgress');\r\n\t\t\t\t\t\t// this.displayInstruction(false);\r\n\t\t\t\t\t\t// this.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//===================\r\n\t\t\t\t\t// Ends\r\n\t\t\t\t\t//-------------------\r\n\t\t\t\t\tcase 'endDiagWithSuccess':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'OK');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tthis.displaySupport(false);\r\n\t\t\t\t\t\tthis.displayInfosCPS(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Manual Installation Cryptolib CPS\r\n\t\t\t\t\t// Suggestion of installation\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'manualInstallClibCPS':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'KO');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'manualInstallClibCPS');\r\n\t\t\t\t\t\tthis.displaySupport(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//=======================\r\n\t\t\t\t\t// Cryptolib CPS download\r\n\t\t\t\t\t// Installation process\r\n\t\t\t\t\t//-----------------------\r\n\t\t\t\t\tcase 'CryptolibCPS':\r\n\t\t\t\t\t\twindow.location = dataIHM.getServerComponentLink();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// Direct jump to Retry after installation\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'restartAlert');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\t\r\n\t\t\t\t\t//=========================\r\n\t\t\t\t\t// Other\r\n\t\t\t\t\t// Close Instruction screen\r\n\t\t\t\t\t//-------------------------\r\n\t\t\t\t\tcase 'exitInstruction':\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true);\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t// Open Support link\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'openSupport':\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tif (param !== undefined) window.open(param.URL,'_blank');\r\n\t\t\t\t\t\tbreak;\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.lastState = step;\r\n\t\t\t},\r\n\t\r\n\t//==========================\r\n\t// Screen Display Management\r\n\tdisplayElementById: function(id, display) {\r\n\t\t\t\t\t\t\tdocument.getElementById(id).style.display = display;\r\n\t\t\t\t\t\t},\r\n\thideElementById: function(id) {\r\n\t\t\t\t\t\t\tthis.displayElementById(id, \"none\");\r\n\t\t\t\t\t\t},\r\n\tdisplayInit: function(OSName) {\r\n\t\t\t\t\t\t// Events initialization\r\n\t\t\t\t\t\t//----------------------\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"cryptolib\", \t\t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"notSupported\", \t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"startDiag\", \t\t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"instructions-back\", \t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"infos_cps_caption\", \t\"click\", clickExpandCollapse);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// PreAlert initialization\r\n\t\t\t\t\t\t//------------------------\r\n\t\t\t\t\t\tthis.displayPreAlert(OSName);\r\n\t\t\t\t\t},\r\n\tdisplayInfosCPS: function (active) {\r\n\t\t\t\t\t\t\tvar infos_cps_tbody = '';\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar detailedInformations = dataIHM.getClientDetailedInfos();\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tfor (var item in detailedInformations) {\r\n\t\t\t\t\t\t\t\tinfos_cps_tbody += '<tr><td class=\"key\">' + item + '</td><td class=\"val\">' + detailedInformations[item] + '</td></tr>';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cps').className = dataIHM.getClientSSLInfos().div_cps_class;\r\n\r\n\t\t\t\t\t\t\t\tfor (var item in dataIHM.getClientSSLInfos().infos) {\r\n\t\t\t\t\t\t\t\t\tinfos_cps_tbody += '<tr><td class=\"key\">' + item + '</td><td class=\"val\">' + dataIHM.getClientSSLInfos().infos[item] + '</td></tr>';\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cps').className = \"cpsverso\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tdocument.getElementById('infos_cps_tbody').innerHTML = infos_cps_tbody;\r\n\t\t\t\t\t\t},\r\n\r\n\tdisplayWait:function (active) {\r\n\t\t\t\t\tif ( (active)\r\n\t\t\t\t\t\t&& (wizardStateMachine.nbRetry > 0) ) {\r\n\t\t\t\t\t\tthis.displayElementById('spin', \"flex\");\r\n\t\t\t\t\t\tdocument.getElementById('retry').innerHTML = wizardStateMachine.nbRetry;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.hideElementById('spin');\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\tdisplayDiagnosticState:function (active, state) {\r\n\t\t\t\t\t\t\t\tdiagStateContent = {\r\n\t\t\t\t\t\t\t\t\t'start':{content:'Cliquer sur la carte', style:'diagState diagStart'}\r\n\t\t\t\t\t\t\t\t\t, 'inProgress':{content:'Le diagnostic est en cours', style:'diagState diagInProgress'}\r\n\t\t\t\t\t\t\t\t\t, 'KO':{content:'Le diagnostic a &eacute;chou&eacute;', style:'diagState diagKO'}\r\n\t\t\t\t\t\t\t\t\t, 'OK':{content:'Le diagnostic a r&eacute;ussi', style:'diagState diagOK'}\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.hideElementById('diagState');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').style.display = \"block\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif (state !== undefined) {\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').className = diagStateContent[state].style;\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').innerHTML = diagStateContent[state].content;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\r\n\tdisplayInstruction: function (active, step) {\r\n\t\t\t\t\t\t\tthis.hideElementById('instructions-back');\r\n\t\t\t\t\t\t\tthis.hideElementById('instructions');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\tthis.displayElementById('instructions-back', \"flex\");\r\n\t\t\t\t\t\t\t\tthis.displayElementById('instructions', \"block\");\r\n\t\t\t\t\t\t\t\tthis.hideElementById('manualInstallClibCPS');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('manualInstallXPI');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('restartAlert');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('restartAlertXPI');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('preAlert');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('notSupported');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('contactSupport');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (step !== undefined) this.displayElementById(step, \"block\");\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar detailedInformations = dataIHM.getClientDetailedInfos();\r\n\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cryptolib').innerHTML = \"T&eacute;l&eacute;charger<br/>\" + dataIHM.getComponentInstallerName();\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (dataIHM.getUAInfos().os.name == 'Mac OS')\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('restartInstruction').innerHTML = \"Une fois l'installation de \" + dataIHM.getComponentInstallerName() + \" termin&eacute;e,<br/>veuillez red&eacute;marrer votre ordinateur.\";\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('restartInstruction').innerHTML = \"Une fois l'installation de \" + dataIHM.getComponentInstallerName() + \" termin&eacute;e,<br/>veuillez red&eacute;marrer votre navigateur.\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\r\n\tdisplaySupport: function (active) {\r\n\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\tthis.displayElementById('support-direction', \"flex\");\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.hideElementById('support-direction');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\r\n\tdisplayPreAlert: function(OSName) {\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-MacOS');\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-Windows');\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-Linux');\r\n\r\n\t\t\t\t\t\t\tif (OSName == 'Mac OS') this.displayElementById('alert1-MacOS', 'block');\r\n\t\t\t\t\t\t\tif (OSName == 'Windows') this.displayElementById('alert1-Windows', 'block');\r\n\t\t\t\t\t\t\tif (OSName == 'Linux') this.displayElementById('alert1-Linux', 'block');\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\r\n};\r\n\r\n//==================\r\n// Events Management\r\nfunction addEltEventListenerAllBrowser(elt, eventName, handle) {\r\n\tif (elt.addEventListener) { elt.addEventListener(eventName, handle, false);\r\n\t} else { elt.attachEvent(\"on\" + eventName, handle);\r\n\t}\r\n}\r\n\r\nfunction addIdEventListenerAllBrowser(id, eventName, handle) {\r\n\tif (document.getElementById(id)) addEltEventListenerAllBrowser(document.getElementById(id), eventName, handle);\r\n}\r\n\r\nfunction clickExpandCollapse(event) {\r\n\tif (document.getElementById('infos_cps_table').style.display != \"block\") {\r\n\t\tdocument.getElementById('infos_cps_caption_img').className = \"infos_cps_caption_img_collapse\";\r\n\t\tdocument.getElementById('infos_cps_table').style.display = \"block\";\r\n\t} else {\r\n\t\tdocument.getElementById('infos_cps_caption_img').className = \"infos_cps_caption_img_expand\";\r\n\t\tdocument.getElementById('infos_cps_table').style.display = \"none\";\r\n\t}\r\n\tevent.cancelBubble = true;\r\n\t\t\r\n\treturn false;\r\n}\r\n\r\nfunction clickActionNoPropagation(event) {\r\n\t//this.click();\r\n\r\n\tevent.cancelBubble = true;\r\n\r\n\treturn false;\r\n}\r\n\n<!-- script : /js/wizarddiagcps.js End -->\n<!-- script : /js/diagcps.js Begin -->\n//==================================\r\n// Global variable used for all data \r\n// displayed on screen \r\n// or used by state machine\r\n//==================================\r\nvar dataIHM = {\r\n\t//==========================\r\n\t// Root URL\r\n\tlocalURL: '',\r\n\tsetLocalURL: function(URL) {this.localURL = URL;},\r\n\tgetLocalURL: function() {return this.localURL;},\r\n\t\r\n\t//==========================\r\n\t// User Agent\r\n\tclientUAInfos: null,\r\n\ttimerUAInfos: null,\r\n\tinitUAInfos: function() {\r\n\t\t\t\t\t\tvar uaparser = new UAParser();\r\n\t\t\t\t\t\tthis.clientUAInfos = uaparser.getResult();\r\n\t\t\t\t\t\tthis.clientUAInfos.browser.xpi = true;\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tthis.timerUAInfos = setTimeout(function(){dataIHM.isUAInfosCPSWebEx()}, 1000);\r\n\t\t\t\t\t},\r\n\tgetUAInfos: function() {return this.clientUAInfos},\r\n\tisUAInfosCPSWebEx: function() {\r\n\t\t\t\t\tif (window.isCpsWebExAlive) {\r\n\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', window.isCpsWebExAlive());\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (this.getUAInfos().browser.name == 'Firefox') {\r\n\t\t\t\t\t\t\tif (this.getUAInfos().browser.major > 57) {\r\n\t\t\t\t\t\t\t\tthis.clientUAInfos.browser.xpi = false;\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'absente');\r\n\t\t\t\t\t\t\t\twizardStateMachine.wizard('manualInstallXPI');\r\n\t\t\t\t\t\t\t} else if (this.getUAInfos().browser.major == 57) {\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'sur cette version, l\\'installation du p&eacute;riph&eacute;rique de s&eacute;curit&eacute; doit &ecirc;tre <a href=\"http://integrateurs-cps.asipsante.fr/Installation-manuelle-PKCS11-Firefox\" target=\"_blanck\">r&eacute;alis&eacute;e manuellement</a>.');\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'd&eacute;tection impossible sur cette version');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.timerUAInfos = null;\r\n\t\t\t\t},\r\n\t\r\n\t//===============================\r\n\t// Installed Component management\r\n\tcomponentName: \"CryptolibCPS\", // By default\r\n\tsetComponentName: function(name) {this.componentName = name;},\r\n\tgetComponentName: function() {return this.componentName;},\r\n\tcomponentVersion: \"\", // By Default\r\n\tsetcomponentVersion: function(version) {this.componentVersion = version;},\r\n\tgetcomponentVersion: function() {return this.componentVersion;},\r\n\tcomponentInstallerName: \"\",\r\n\tsetComponentInstallerName: function(name) {this.componentInstallerName = name;},\r\n\tgetComponentInstallerName: function() {return this.componentInstallerName;},\r\n\tserverComponentURL: null,\r\n\tsetServerComponentURL: function(URL) {this.serverComponentURL = URL;},\r\n\tgetServerComponentLink: function(version) {\r\n\t\t\t\t\t\t\t\t\tvar componentLink = this.serverComponentURL + \"?\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"component=\" + this.getComponentName();\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&os=\" + this.getUAInfos().os.name;\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&arch=\" + this.getUAInfos().cpu.architecture;\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&version=\" + this.getcomponentVersion();\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\treturn componentLink;\r\n\t\t\t\t\t\t\t\t},\r\n\tserverComponentInfos: null,\r\n\treadServerComponentInfos: function() {\r\n\t\t\t\t\t\t\t\t// XPI 6.0.15 with Firefox < 57\r\n\t\t\t\t\t\t\t\t// ==> Use Cryptolib CPS 5.0.37 instead of last release\r\n\t\t\t\t\t\t\t\tif ((this.getUAInfos().browser.name == 'Firefox') \r\n\t\t\t\t\t\t\t\t\t&& (this.getUAInfos().browser.major < 57)) {\r\n\t\t\t\t\t\t\t\t\tswitch (this.getUAInfos().os.name) {\r\n\t\t\t\t\t\t\t\t\t\tcase 'Windows': this.setcomponentVersion('5.0.37');break;\r\n\t\t\t\t\t\t\t\t\t\tcase 'Mac OS': this.setcomponentVersion('5.0.34');break;\r\n\t\t\t\t\t\t\t\t\t\tcase 'Linux':\r\n\t\t\t\t\t\t\t\t\t\tcase 'CentOS':\r\n\t\t\t\t\t\t\t\t\t\tcase 'Ubuntu':\r\n\t\t\t\t\t\t\t\t\t\tcase 'RedHat':  this.setcomponentVersion('5.0.12');break;\r\n\t\t\t\t\t\t\t\t\t\tdefault:break;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// Use fetch if exist\r\n\t\t\t\t\t\t\t\tif (self.fetch) {\r\n\t\t\t\t\t\t\t\t\tfetch( this.getServerComponentLink() + '&filename=get' )\r\n\t\t\t\t\t\t\t\t\t.then(function(resp) {return resp.json();})\r\n\t\t\t\t\t\t\t\t\t.then(function(response) {\r\n\t\t\t\t\t\t\t\t\t\tfor (var k in response) {\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.setComponentInstallerName(response[k]);\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.addClientDetailedInfos('URL de t&eacute;l&eacute;chargement', '<a href=\"' + dataIHM.getServerComponentLink() + '\">' + dataIHM.getComponentInstallerName() + '</a>');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('readServerComponentInfos : Error with fetch (' + error.message + ')'); \r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t// Use JQuery\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$.ajax(\t{\r\n\t\t\t\t\t\t\t\t\t\turl: this.getServerComponentLink() + '&filename=get'\r\n\t\t\t\t\t\t\t\t\t\t, success: function( data) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar json;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (data === String)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson = jQuery.parseJSON(data);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson = data\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor (var k in json) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setComponentInstallerName(json[k]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.addClientDetailedInfos('URL de t&eacute;l&eacute;chargement', '<a href=\"' + dataIHM.getServerComponentLink() + '\">' + dataIHM.getComponentInstallerName() + '</a>');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t, error: function( data) { return null;}\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\r\n\t//========================================\r\n\t// Support contact informations management\r\n \tmailSupportMailbox: null,\r\n\tmailSupportDomain: null,\r\n\tsetMailSupport: function(mailbox, domain) {this.mailSupportMailbox = mailbox; this.mailSupportDomain = domain;},\r\n\tgetMailSupport: function() {return this.mailSupportMailbox + \"@\" + this.mailSupportDomain;},\r\n \t\t\r\n\t//==========================\r\n\t// Detailed informations\r\n\tclientDetailedInfos: {},\r\n\tinitClientDetailedInfos: function() {\r\n\t\t\t\t\t\t\t\tconfigSupported = true;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.getUAInfos().device.type === undefined) {\r\n\t\t\t\t\t\t\t\t\tconsole.log(\"Poste de travail\");\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tconfigSupported = false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().os.name) {\r\n\t\t\t\t\t\t\t\t\tcase 'Windows':\r\n\t\t\t\t\t\t\t\t\tcase 'Mac OS':\r\n\t\t\t\t\t\t\t\t\tcase 'Linux':\r\n\t\t\t\t\t\t\t\t\tcase 'CentOS':\r\n\t\t\t\t\t\t\t\t\tcase 'Ubuntu':\r\n\t\t\t\t\t\t\t\t\tcase 'RedHat':  configSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault: \t\tconfigSupported = configSupported & false;break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().browser.name) {\r\n\t\t\t\t\t\t\t\t\tcase 'IE':\r\n\t\t\t\t\t\t\t\t\tcase 'Safari':\r\n\t\t\t\t\t\t\t\t\tcase 'Edge':\r\n\t\t\t\t\t\t\t\t\tcase 'Chrome':\r\n\t\t\t\t\t\t\t\t\tcase 'Firefox':\tconfigSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault: \t\tconfigSupported = configSupported & false;break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().cpu.architecture) {\r\n\t\t\t\t\t\t\t\t\tcase 'ia32':\r\n\t\t\t\t\t\t\t\t\tcase 'i686':\r\n\t\t\t\t\t\t\t\t\tcase 'amd64': configSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\t\tif (this.getUAInfos().cpu.architecture === undefined)\r\n\t\t\t\t\t\t\t\t\t\t\tconfigSupported = configSupported & true;\r\n\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\tconfigSupported = configSupported & false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.getUAInfos().cpu.architecture == 'amd64')\r\n\t\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Syst&egrave;me d\\'exploitation', this.getUAInfos().os.name + \" \" + this.getUAInfos().os.version + \" (64b)\");\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Syst&egrave;me d\\'exploitation', this.getUAInfos().os.name + \" \" + this.getUAInfos().os.version);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Navigateur', this.getUAInfos().browser.name + \" \" + this.getUAInfos().browser.major);\r\n\t\t\t\t\t\t\t\t// this.addClientDetailedInfos('Compatibilit&eacute; ASIP', '<a href=\"http://integrateurs-cps.asipsante.fr/Lettre_d_information\" target=\"_blanck\">Lettre d\\'information<br/>POSTE DE TRAVAIL & Veille Technologique</a>');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.clientUAInfos.configSupported = configSupported;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\treturn configSupported;\r\n\t\t\t\t\t\t\t},\r\n\tgetClientDetailedInfos: function() {return this.clientDetailedInfos;},\r\n\taddClientDetailedInfos: function(key, value) { this.clientDetailedInfos[key] = value;},\r\n\tresetClientDetailedInfos: function() {this.clientDetailedInfos = {};},\r\n\t\t\r\n\t//==========================\r\n\t// Client SSL Informations\r\n\tclientSSLInfos: null,\r\n\tclientSSLFetchParameters: { mode:'cors', credentials: 'include', cache: 'no-cache'},\r\n\tclientSSLAjaxParameters: { cache: false, timeout: 8000, async: true},\r\n\tisDefineClientSSLInfos: function() {return (this.clientSSLInfos != undefined);},\r\n\tsetClientSSLInfos: function(data) {this.clientSSLInfos = data;},\r\n\tgetClientSSLInfos: function() {return this.clientSSLInfos;},\r\n\tinitClientSSLParameters: function() { $.ajaxSetup(this.clientSSLAjaxParameters);},\r\n\tresetClientSSLInfos: function () {\r\n\t\t\t\t\t\t\tconsole.log('resetClientSSLInfos : Erase SSL Connexion cache for ' + this.getUAInfos().browser.name);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tswitch (this.getUAInfos().browser.name) {\r\n\t\t\t\t\t\t\t\tcase 'Edge': // Works !\r\n\t\t\t\t\t\t\t\tcase 'IE': // Works !\r\n\t\t\t\t\t\t\t\t\tif (document.execCommand) document.execCommand( \"ClearAuthenticationCache\", \"false\");\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 'Firefox':\t// Works !\r\n\t\t\t\t\t\t\t\t\t//location.reload(); // Works !\r\n\t\t\t\t\t\t\t\t\tif (window.crypto) if (window.crypto.logout) window.crypto.logout(); // Works !\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 'Chrome': // Works !\r\n\t\t\t\t\t\t\t\tcase 'Safari': // Not working, restart Browser needed !\r\n\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag'); \r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\treadClientSSLInfos: function() {\r\n\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : SSL Connexion' );\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// Use fetch if exist\r\n\t\t\t\t\t\t\tif (self.fetch) {\r\n\t\t\t\t\t\t\t\t// Try to connect and get CPS informations\r\n\t\t\t\t\t\t\t\tfetch( '/visuel.php', this.clientSSLFetchParameters )\r\n\t\t\t\t\t\t\t\t.then(function(resp) {return resp.json();})\r\n\t\t\t\t\t\t\t\t.then(function(resp_json) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Success with Fetch');\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t// traitement du JSON\r\n\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(resp_json);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('endDiagWithSuccess');\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t// Case of SSL Error\r\n\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Probably SSL Error with fetch (' + error.message + ')');\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(null);\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.accelerateTimer();\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t// Use JQuery\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$.ajax(\t{\r\n\t\t\t\t\t\t\t\t\turl: 'visuel.php'\r\n\t\t\t\t\t\t\t\t\t, success: function(data, textStatus) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Success with Ajax (' + textStatus + ')');\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tif (data === String)\r\n\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(jQuery.parseJSON(data));\r\n\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(data);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('endDiagWithSuccess');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t, error: function(data, textStatus) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Probably SSL Error with Ajax (' + textStatus + ')');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(null);\r\n\t\t\t\t\t\t\t\t\t\t\twizardStateMachine.accelerateTimer();\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n}\r\n\r\n//=====\r\n// Main\r\n//=====\r\n$(function() {\r\n\t// Initialization\r\n\t//---------------\r\n\tdataIHM.initUAInfos(); // User Agent\r\n\t\r\n\tdataIHM.initClientSSLParameters();\r\n\t\r\n\t// Sp�cific parameter with no good solution @29/12/2017\r\n\tswitch (dataIHM.getUAInfos().browser.name) {\r\n\t\tcase 'IE':\r\n\t\t\tconsole.log('=========== Use Ajax =============');\r\n\t\t\tself.fetch = undefined;\r\n\t\t\tbreak;\r\n\t\tcase 'Edge':\r\n\t\tcase 'Firefox':\r\n\t\tcase 'Safari':\r\n\t\tdefault:\r\n\t\t\tconsole.log('=========== Try using fetch. If not available use Ajax =============');\r\n\t\t\tbreak;\r\n\t}\r\n\t\r\n\tdataIHM.initClientDetailedInfos(); // Informations in bottom\r\n\tdataIHM.readServerComponentInfos(); // Get from informations from Web Service\r\n\t\r\n\twizardStateMachine.startWizard(); // Start Wizard\r\n\t\t\r\n\twizardStateMachine.displayInit(dataIHM.getUAInfos().os.name);\r\n});\r\n\n<!-- script : /js/diagcps.js End -->\n\n</script>\n<script type=\"text/javascript\">\n\t// Initialization Javascript from PHP\n\tdataIHM.setComponentName('CryptolibCPS');\n\tdataIHM.setServerComponentURL('download.php');\n</script>\n<!--<div id=\"beta\"></div>-->\n<div id=\"instructions-back\" onclick=\"wizardStateMachine.wizard('exitInstruction');\">\n\t<div id=\"instructions\">\n\t\n\t\t<div class=\"screen\" id=\"preAlert\">\n\t\t\t<div class=\"instruction\"><br/>\n<h1>Assistance en cas de carte CPS non lue</h1>\n\n<h2>Pr&eacute;alablement</h2>\n<p>\nVeuillez v&eacute;rifier que votre carte est bien ins&eacute;r&eacute;e dans votre lecteur de carte ou votre terminal Vitale.<br/>\nPuis v&eacute;rifier que votre lecteur de carte ou votre terminal Vitale est correctement connect&eacute; &agrave; votre ordinateur.<br/>\n<br/>\nLa carte ins&eacute;r&eacute;e dans le lecteur doit &ecirc;tre la derni&egrave;re carte active.\n\n<table >\n\t<tr>\n\t\t<td style=\"border-top:none;\"><img src=\"images/informations32.png\" alt=\"Information :\"/></td>\n\t\t<td style=\"border-top:none;\"><i>La derni&egrave;re carte active pr&eacute;sente la date d'expiration la plus &eacute;loign&eacute;e.</i></td>\n\t</tr>\n</table>\n<br/>\nUne fois cette v&eacute;rification r&eacute;alis&eacute;e, v&eacute;rifiez que la carte est bien lue.<br/>\n</p>\n\n<div id=\"alert1-MacOS\">\n<h2>Votre ordinateur est sous Mac OS</h2>\n<p>\nSur votre syst&egrave;me d'exploitation, nous ne disposons pas de m&eacute;thode particuli&egrave;re pour v&eacute;rifier si votre carte est lue.<br/>\n<br/>\nVeuillez lancer un diagnostic de votre ordinateur et proc&eacute;der &agrave; l'installation des mises &agrave; jour sugg&eacute;r&eacute;es.<br/>\n</p>\n</div>\n\n<div id=\"alert1-Linux\">\n<h2>Votre ordinateur est sous Linux</h2>\n<p>\nSur votre syst&egrave;me d'exploitation, nous ne disposons pas de m&eacute;thode particuli&egrave;re pour v&eacute;rifier si votre carte est lue.<br/>\n<br/>\nVeuillez lancer un diagnostic de votre ordinateur et proc&eacute;der &agrave; l'installation des mises &agrave; jour sugg&eacute;r&eacute;es.<br/>\n</p>\n</div>\n\n<div id=\"alert1-Windows\">\n<h2>Votre ordinateur est sous Windows</h2>\n<b>Dans la barre des t&acirc;ches, une carte lue est signal&eacute;e par <img src=\"images/preHelper/iconeOK.png\" alt=\"Icone vert dans la barre des taches\" /> et une carte non lue par <img src=\"images/preHelper/iconeKO.png\" alt=\"Icone rouge dans la barre des taches\"/>.</b><br/>\n<h3>L'ic&ocirc;ne <img src=\"images/preHelper/iconeOK.png\" alt=\"Icone vert dans la barre des taches\"/> est introuvable</h3>\n<p>\nCliquez avec le clic droit de votre souris sur le bouton &laquo;Afficher les ic&ocirc;nes&raquo; (en bas &agrave; droite de votre &eacute;cran) ou sur la zone heure et date et selectionnez &laquo;Personnaliser les ic&ocirc;nes de notification&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/notificationsBar.png\" alt=\"Barre de notification\"/></div>\n<br/>\n<br/>\nCherchez l'ic&ocirc;ne &laquo;Gestionnaire de certificats CPS&raquo; et s&eacute;lectionnez &laquo;Afficher l'ic&ocirc;ne et les notifications&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/notificationsParameters.png\" alt=\"Parametres de notifications\"/></div>\n<br/>\nUne fois la manipulation r&eacute;alis&eacute;e vous devriez voir apparaitre l'ic&ocirc;ne (en bas &agrave; droite de votre &eacute;cran).<br/>\n<br/>\nSi l'ic&ocirc;ne n'apparait pas dans la liste, lancer le diagnostic de votre ordinateur et installez les mises &agrave; jour propos&eacute;es.<br/>\n<br/>\n</p>\n<h2>L'ic&ocirc;ne <img src=\"images/preHelper/iconeKO.png\" alt=\"Icone rouge dans la barre des taches\" /> est rouge</h2>\n<p>\nSi l'ic&ocirc;ne est encadr&eacute;e de rouge (carte non lue), assurez-vous que votre carte est bien ins&eacute;r&eacute;e dans votre lecteur, rafra&icirc;chissez le lecteur en cliquant sur l'ic&ocirc;ne avec le bouton droit de la souris. Et cliquez sur &laquo;Rafra&icirc;chir&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/rightClickCCM.png\" alt=\"Cliquer droit sur l'icone du CCM\" /></div>\n<br/>\nSi l'encadr&eacute; reste rouge apr&egrave;s la manipulation, red&eacute;marrez votre ordinateur en laissant le lecteur et la CPS connect&eacute;s.<br/>\n<br/>\nApr&egrave;s ces manipulations, si l'ic&ocirc;ne ne passe pas au vert, veuillez nous contacter.\n</p>\n<div align=\"center\"></div>\n</div>\n\n</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"startDiag\" onclick=\"wizardStateMachine.wizard('startDiag');\">Diagnostiquer mon poste</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"notSupported\">\n\t\t\t<div class=\"instruction\">Votre configuration mat&eacute;riel et/ou syst&egrave;me n'est pas support&eacute;e par nos composants logiciels. Nous ne garantissons pas le succès du diagnostic.</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"notSupported\" onclick=\"wizardStateMachine.wizard('preAlert');\">Continuer</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"manualInstallXPI\">\n\t\t\t<div class=\"instruction\" id=\"xpi_instruction\" >L'Extension Firefox n'a pas &eacute;t&eacute; d&eacute;tect&eacute;e. Elle est indispensable sous ce navigateur.<br/>Apr&egrave;s l'installation, veuillez red&eacute;marrer votre navigateur.</div>\n\t\t\t<div class=\"actions\">\n<!--\t\t\t\t<div class=\"action instruction\" id=\"xpi\" onclick=\"wizardStateMachine.wizard('XPI',{URL:'https://diagcps.eservices.esante.gouv.fr/ODI_PS/php/download_asip.php?installeur=url_interne_xpi_installation_pkcs11',IconURL:'https://diagcps.eservices.esante.gouv.fr/ODI_PS/images/asip_sante.png',Hash:'sha256:c23de3812aaf7c3a81d80e9bdf891c3e2b621e01e55e8d308226fd86ab6ef438'});\">Installer<br/>l'Extension Firefox</div>-->\n<div class=\"action instruction\" id=\"xpi\" onclick=\"wizardStateMachine.wizard('XPI',{URL:'/download.php?component=xpi',IconURL:'/images/asip_sante.png',Hash:'sha256:c23de3812aaf7c3a81d80e9bdf891c3e2b621e01e55e8d308226fd86ab6ef438'});\">Installer<br/>l'Extension Firefox</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"restartAlertXPI\">\n\t\t\t<div class=\"instruction\" id=\"restartInstructionXPI\" >Une fois l'installation de l'Extension Cryptolib CPS termin&eacute;e,<br/>veuillez red&eacute;marrer votre navigateur.</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"manualInstallClibCPS\">\n\t\t\t<div class=\"instruction\">Si vous avez ins&eacute;r&eacute; votre CPS dans votre lecteur sans succ&egrave;s, la version de Cryptolib CPS de votre poste de travail n'est peut-&ecirc;tre pas &agrave; jour.</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"cryptolib\" onclick=\"wizardStateMachine.wizard('CryptolibCPS');\">T&eacute;l&eacute;charger<br/>Cryptolib CPS</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"restartAlert\">\n\t\t\t<div class=\"instruction\" id=\"restartInstruction\" >Une fois l'installation de CryptolibCPS_vX.Y.Z termin&eacute;e, veuillez red&eacute;marrer votre navigateur.</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"contactSupport\">\n\t\t\t<div class=\"instruction\">Si vous avez installez le composant propos&eacute; sans succ&eacute;s,<br/> veuillez contacter le Support.</div>\n\t\t</div>\n\t\t\n\t</div>\n</div>\t\n<div id=\"service-direction\" class=\"column\"></div>\n<div id=\"article\">\n\t<div id=\"center\">\n\t\t<div class=\"diagState\" id=\"diagState\"></div>\n\t\t<div>\n\t\t\t<div id=\"cps\" class=\"cpsverso\" onclick=\"wizardStateMachine.wizard('restartDiag');\"><div id=\"spin\"><div id=\"retry\"></div></div></div>\n\t\t</div>\n<!--\t\t\n\t\t<div id=\"results\">\n\t\t\t<div>\n\t\t\t\t<div class=\"sign\" id=\"certificat\"></div>\n\t\t\t\t<div class=\"sign\" id=\"expired\" title=\"expire\"></div>\n\t\t\t\t<div class=\"sign\" id=\"revoc\" title=\"revoque\"></div>\n\t\t\t\t<div class=\"sign\" id=\"class\"></div>\n\t\t\t\t<div class=\"sign\" id=\"rootAC\"></div>\n\t\t\t\t<div class=\"sign\" id=\"cryptolib\" title=\"cryptolib\"></div>\n\t\t\t</div>\n\t\t</div>\n-->\n\t\t<div id=\"cps_infos\">\n\t\t\t<div id=\"infos_cps\">\n\t\t\t\t<div id=\"infos_cps_caption\"><div>Informations d&eacute;taill&eacute;es</div><div class=\"infos_cps_caption_img_expand\" id=\"infos_cps_caption_img\"></div></div>\n\t\t\t\t<table id=\"infos_cps_table\">\n\t\t\t\t\t<tbody id=\"infos_cps_tbody\"></tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n<div id=\"support-direction\" class=\"column\"></div>\n</div>\r\n<div id=\"footer\" style=\"display:flex;flex-direction:row\">\r\n    <div style=\"display:flex;flex-direction:row;width:30vw\">\r\n        <div style=\"margin:20px\">\r\n            <a href=\"https://solidarites-sante.gouv.fr/\" target=\"_blank\">\r\n                <img src=\"./images/logo-ministere.svg\" alt=\"Ministère des Solidarités et de la santé\" width=\"84\" height=\"62\">\r\n            </a>\r\n        </div>\r\n        <div style=\"margin:20px\">\r\n            <a href=\"https://esante.gouv.fr/\" target=\"_blank\">\r\n                <img src=\"./images/logo-ANS.svg\" alt=\"Agence du Numérique en Santé\" width=\"166\" height=\"50\">\r\n            </a>\r\n        </div>\r\n    </div>\r\n    <div style=\"width:60vw\">\r\n        <ul style=\"align-items:end\">\r\n            <li><a href=\"http://esante.gouv.fr/services/mentions-legales\" target=\"_blank\">Mentions l&eacute;gales</a></li>\r\n            <li><a href=\"./copyright.php\" target=\"_blank\" title=\"Copyright [nouvelle fen&ecirc;tre]\">Copyright</a></li>\r\n        </ul>\r\n    </div>\r\n</div>\r\n\r\n</body>\r\n</html>\r\n",
      "ip": "135.125.232.117",
      "timestamp": "2025-03-14T16:25:23.923806962Z",
      "curl-command": "curl -X 'GET' -H 'Accept: */*' -H 'Accept-Language: en' -H 'User-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)' 'https://diagcps.eservices.esante.gouv.fr'",
      "matcher-status": true
    },
    {
      "template": "http/technologies/apache/apache-detect.yaml",
      "template-url": "https://templates.nuclei.sh/public/apache-detect",
      "template-id": "apache-detect",
      "template-path": "/home/runner/nuclei-templates/http/technologies/apache/apache-detect.yaml",
      "info": {
        "name": "Apache Detection",
        "author": [
          "philippedelteil"
        ],
        "tags": [
          "tech",
          "apache"
        ],
        "description": "Some Apache servers have the version on the response header. The OpenSSL version can be also obtained",
        "severity": "info",
        "metadata": {
          "max-request": 1
        }
      },
      "type": "http",
      "host": "https://diagcps.eservices.esante.gouv.fr",
      "matched-at": "https://diagcps.eservices.esante.gouv.fr",
      "extracted-results": [
        "Apache/2.4.37 (centos) OpenSSL/1.1.1g"
      ],
      "request": "GET / HTTP/1.1\r\nHost: diagcps.eservices.esante.gouv.fr\r\nUser-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)\r\nConnection: close\r\nAccept: */*\r\nAccept-Language: en\r\nAccept-Encoding: gzip\r\n\r\n",
      "response": "HTTP/1.1 200 OK\r\nConnection: close\r\nTransfer-Encoding: chunked\r\nContent-Type: text/html; charset=UTF-8\r\nDate: Fri, 14 Mar 2025 16:25:23 GMT\r\nServer: Apache/2.4.37 (centos) OpenSSL/1.1.1g\r\nX-Powered-By: PHP/7.2.24\r\n\r\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n\t<title>DiagCPS, Outil de Diagnostic SSL</title>\r\n\t<meta http-equiv=\"Content-type\" content=\"text/html; charset=UTF-8\" />\r\n\t<meta name=\"description\" content=\"DiagCPS est un Outil de Diagnostic de l'authentification en ligne à l'aide d'une Carte de Professionnel de Santé, i.e. CPS. Il est fourni par l'ASIP Santé et remplace ODI.\" />\r\n\t<meta name=\"Publisher\" content=\"ASIP Santé\" />\r\n\t<meta name=\"copyright\" content=\"Tous droits réservés - ASIP Santé\" />\r\n\t<link rel=\"shortcut icon\" href=\"./images/favicon.ico\" type=\"image/x-icon\" />\r\n\t<link rel=\"stylesheet\" href=\"diagcps_css.php\" />\r\n\t<script src=\"./js/jquery-3.2.0.min.js\"></script>\r\n\t<script src=\"./js/ua-parser.min.js\"></script>\r\n</head>\r\n<body>\r\n<div id=\"header\" style=\"display:flex;flex-direction:row\">\r\n    <div style=\"margin:20px\">\r\n        <a href=\"https://solidarites-sante.gouv.fr/\" target=\"_blank\">\r\n            <img src=\"./images/logo-ministere.svg\" alt=\"Ministère des Solidarités et de la santé\" width=\"168\" height=\"104\">\r\n        </a>\r\n    </div>\r\n\t<div id=\"title\">esante.gouv.fr</div>\r\n</div>\r\n<div id=\"section\">\r\n<script type=\"text/javascript\">\n\n<!-- script : /js/wizarddiagcps.js Begin -->\n//==================================\r\n// Global variable used for state machine management \r\n// displayed on screen \r\n// or used by state machine\r\n//==================================\r\nvar wizardStateMachine = {\r\n\tstartState: 'notSupported',\r\n\tlastState: 'notSupported',\r\n\t\r\n\t//=================\r\n\t// Retry Management\r\n\t// Variables\r\n\tnbMaxRetry: 10,\r\n\tnbRetry: 0,\r\n\t\r\n\t// Management\r\n\tinitRetry: function() {this.nbRetry = this.nbMaxRetry;},\r\n\tisMaxRetry: function() {return (this.nbRetry >= this.nbMaxRetry);},\r\n\tisMinRetry: function() {return (this.nbRetry <= 0);},\r\n\tdecRetry: function() {this.nbRetry--;},\r\n\tdisplayRetry: function() {\r\n\t\t\t\t\t\t\t\t//console.log(\"displayRetry : nbRetry = \" + this.nbRetry);\r\n\t\t\t\t\t\t\t\tthis.decRetry();\r\n\t\t\t\t\t\t\t\tthis.stopTimers(); \r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.isMinRetry()\r\n\t\t\t\t\t\t\t\t\t&& \t(this.lastState != 'endDiagWithSuccess')) {\r\n\t\t\t\t\t\t\t\t\tthis.wizard('manualInstallClibCPS');\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tthis.displayWait(true);\r\n\t\t\t\t\t\t\t\t\tthis.startTimers();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\r\n\t//==================\r\n\t// Timers Management\r\n\ttimerTestSSL: null,\r\n\tretryTimeoutKO: 1000,\r\n\tinitTimer: function () {this.retryTimeoutKO = 1000;},\r\n\taccelerateTimer: function () {this.retryTimeoutKO = 250;},\r\n\tstopTimers: function() {\r\n\t\t\t\t\t\t\t\tif (this.timerTestSSL != null)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tclearTimeout(this.timerTestSSL);\r\n\t\t\t\t\t\t\t\t\tthis.timerTestSSL = null;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\tstartTimers: function() {this.timerTestSSL = setTimeout(function(){wizardStateMachine.displayRetry()}, this.retryTimeoutKO);},\r\n\t\r\n\t//=======\r\n\t// Wizard\r\n\tstartWizard: function() {this.wizard(this.startState);},\r\n\twizard: function(step, param) {\r\n\t\t\t\tconsole.log(\"wizard : step = \" + step + \", param = \" + param);\r\n\t\t\t\t\t\r\n\t\t\t\tswitch (step)\r\n\t\t\t\t{\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Pre treatment\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'notSupported':\r\n\t\t\t\t\tcase 'preAlert':\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'start');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif ((dataIHM.getUAInfos().configSupported) || (step == 'preAlert')) this.displayInstruction(true, 'preAlert');\r\n\t\t\t\t\t\telse this.displayInstruction(true, 'notSupported');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Manual Installation XPI\r\n\t\t\t\t\t// Suggestion of installation\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'manualInstallXPI':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'KO');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'manualInstallXPI');\r\n\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// XPI Installation\r\n\t\t\t\t\t// Installation process\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'XPI':\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'restartAlertXPI');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar params = {\r\n\t\t\t\t\t\t\t\t\"Installer l'Extension Cryptolib CPS\": \r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tURL: param.URL,\r\n\t\t\t\t\t\t\t\t\tIconURL: param.IconURL,\r\n\t\t\t\t\t\t\t\t\tHash: param.Hash,\r\n\t\t\t\t\t\t\t\t\ttoString: function () { return this.URL; }\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t};\r\nconsole.log(params);\r\n\t\t\t\t\t\tInstallTrigger.install(params);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// Diagnostic\r\n\t\t\t\t\t// Start\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'startDiag':\r\n\t\t\t\t\t\tthis.initRetry();\r\n\t\t\t\t\t\tthis.initTimer();\r\n\r\n\t\t\t\t\t\tthis.displayWait(true);\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'inProgress');\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tdataIHM.readClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.startTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// Diagnostic\r\n\t\t\t\t\t// Restart\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'restartDiag':\r\n\r\n\t\t\t\t\t\tdataIHM.resetClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\r\n\t\t\t\t\t//==========================\r\n\t\t\t\t\t// Progression\r\n\t\t\t\t\t//--------------------------\r\n\t\t\t\t\tcase 'inProgress':\r\n\t\t\t\t\t\t//dataIHM.readClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// this.displayDiagnosticState(true, 'inProgress');\r\n\t\t\t\t\t\t// this.displayInstruction(false);\r\n\t\t\t\t\t\t// this.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//===================\r\n\t\t\t\t\t// Ends\r\n\t\t\t\t\t//-------------------\r\n\t\t\t\t\tcase 'endDiagWithSuccess':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'OK');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tthis.displaySupport(false);\r\n\t\t\t\t\t\tthis.displayInfosCPS(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Manual Installation Cryptolib CPS\r\n\t\t\t\t\t// Suggestion of installation\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'manualInstallClibCPS':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'KO');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'manualInstallClibCPS');\r\n\t\t\t\t\t\tthis.displaySupport(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//=======================\r\n\t\t\t\t\t// Cryptolib CPS download\r\n\t\t\t\t\t// Installation process\r\n\t\t\t\t\t//-----------------------\r\n\t\t\t\t\tcase 'CryptolibCPS':\r\n\t\t\t\t\t\twindow.location = dataIHM.getServerComponentLink();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// Direct jump to Retry after installation\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'restartAlert');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\t\r\n\t\t\t\t\t//=========================\r\n\t\t\t\t\t// Other\r\n\t\t\t\t\t// Close Instruction screen\r\n\t\t\t\t\t//-------------------------\r\n\t\t\t\t\tcase 'exitInstruction':\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true);\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t// Open Support link\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'openSupport':\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tif (param !== undefined) window.open(param.URL,'_blank');\r\n\t\t\t\t\t\tbreak;\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.lastState = step;\r\n\t\t\t},\r\n\t\r\n\t//==========================\r\n\t// Screen Display Management\r\n\tdisplayElementById: function(id, display) {\r\n\t\t\t\t\t\t\tdocument.getElementById(id).style.display = display;\r\n\t\t\t\t\t\t},\r\n\thideElementById: function(id) {\r\n\t\t\t\t\t\t\tthis.displayElementById(id, \"none\");\r\n\t\t\t\t\t\t},\r\n\tdisplayInit: function(OSName) {\r\n\t\t\t\t\t\t// Events initialization\r\n\t\t\t\t\t\t//----------------------\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"cryptolib\", \t\t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"notSupported\", \t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"startDiag\", \t\t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"instructions-back\", \t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"infos_cps_caption\", \t\"click\", clickExpandCollapse);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// PreAlert initialization\r\n\t\t\t\t\t\t//------------------------\r\n\t\t\t\t\t\tthis.displayPreAlert(OSName);\r\n\t\t\t\t\t},\r\n\tdisplayInfosCPS: function (active) {\r\n\t\t\t\t\t\t\tvar infos_cps_tbody = '';\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar detailedInformations = dataIHM.getClientDetailedInfos();\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tfor (var item in detailedInformations) {\r\n\t\t\t\t\t\t\t\tinfos_cps_tbody += '<tr><td class=\"key\">' + item + '</td><td class=\"val\">' + detailedInformations[item] + '</td></tr>';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cps').className = dataIHM.getClientSSLInfos().div_cps_class;\r\n\r\n\t\t\t\t\t\t\t\tfor (var item in dataIHM.getClientSSLInfos().infos) {\r\n\t\t\t\t\t\t\t\t\tinfos_cps_tbody += '<tr><td class=\"key\">' + item + '</td><td class=\"val\">' + dataIHM.getClientSSLInfos().infos[item] + '</td></tr>';\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cps').className = \"cpsverso\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tdocument.getElementById('infos_cps_tbody').innerHTML = infos_cps_tbody;\r\n\t\t\t\t\t\t},\r\n\r\n\tdisplayWait:function (active) {\r\n\t\t\t\t\tif ( (active)\r\n\t\t\t\t\t\t&& (wizardStateMachine.nbRetry > 0) ) {\r\n\t\t\t\t\t\tthis.displayElementById('spin', \"flex\");\r\n\t\t\t\t\t\tdocument.getElementById('retry').innerHTML = wizardStateMachine.nbRetry;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.hideElementById('spin');\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\tdisplayDiagnosticState:function (active, state) {\r\n\t\t\t\t\t\t\t\tdiagStateContent = {\r\n\t\t\t\t\t\t\t\t\t'start':{content:'Cliquer sur la carte', style:'diagState diagStart'}\r\n\t\t\t\t\t\t\t\t\t, 'inProgress':{content:'Le diagnostic est en cours', style:'diagState diagInProgress'}\r\n\t\t\t\t\t\t\t\t\t, 'KO':{content:'Le diagnostic a &eacute;chou&eacute;', style:'diagState diagKO'}\r\n\t\t\t\t\t\t\t\t\t, 'OK':{content:'Le diagnostic a r&eacute;ussi', style:'diagState diagOK'}\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.hideElementById('diagState');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').style.display = \"block\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif (state !== undefined) {\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').className = diagStateContent[state].style;\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').innerHTML = diagStateContent[state].content;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\r\n\tdisplayInstruction: function (active, step) {\r\n\t\t\t\t\t\t\tthis.hideElementById('instructions-back');\r\n\t\t\t\t\t\t\tthis.hideElementById('instructions');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\tthis.displayElementById('instructions-back', \"flex\");\r\n\t\t\t\t\t\t\t\tthis.displayElementById('instructions', \"block\");\r\n\t\t\t\t\t\t\t\tthis.hideElementById('manualInstallClibCPS');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('manualInstallXPI');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('restartAlert');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('restartAlertXPI');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('preAlert');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('notSupported');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('contactSupport');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (step !== undefined) this.displayElementById(step, \"block\");\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar detailedInformations = dataIHM.getClientDetailedInfos();\r\n\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cryptolib').innerHTML = \"T&eacute;l&eacute;charger<br/>\" + dataIHM.getComponentInstallerName();\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (dataIHM.getUAInfos().os.name == 'Mac OS')\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('restartInstruction').innerHTML = \"Une fois l'installation de \" + dataIHM.getComponentInstallerName() + \" termin&eacute;e,<br/>veuillez red&eacute;marrer votre ordinateur.\";\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('restartInstruction').innerHTML = \"Une fois l'installation de \" + dataIHM.getComponentInstallerName() + \" termin&eacute;e,<br/>veuillez red&eacute;marrer votre navigateur.\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\r\n\tdisplaySupport: function (active) {\r\n\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\tthis.displayElementById('support-direction', \"flex\");\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.hideElementById('support-direction');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\r\n\tdisplayPreAlert: function(OSName) {\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-MacOS');\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-Windows');\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-Linux');\r\n\r\n\t\t\t\t\t\t\tif (OSName == 'Mac OS') this.displayElementById('alert1-MacOS', 'block');\r\n\t\t\t\t\t\t\tif (OSName == 'Windows') this.displayElementById('alert1-Windows', 'block');\r\n\t\t\t\t\t\t\tif (OSName == 'Linux') this.displayElementById('alert1-Linux', 'block');\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\r\n};\r\n\r\n//==================\r\n// Events Management\r\nfunction addEltEventListenerAllBrowser(elt, eventName, handle) {\r\n\tif (elt.addEventListener) { elt.addEventListener(eventName, handle, false);\r\n\t} else { elt.attachEvent(\"on\" + eventName, handle);\r\n\t}\r\n}\r\n\r\nfunction addIdEventListenerAllBrowser(id, eventName, handle) {\r\n\tif (document.getElementById(id)) addEltEventListenerAllBrowser(document.getElementById(id), eventName, handle);\r\n}\r\n\r\nfunction clickExpandCollapse(event) {\r\n\tif (document.getElementById('infos_cps_table').style.display != \"block\") {\r\n\t\tdocument.getElementById('infos_cps_caption_img').className = \"infos_cps_caption_img_collapse\";\r\n\t\tdocument.getElementById('infos_cps_table').style.display = \"block\";\r\n\t} else {\r\n\t\tdocument.getElementById('infos_cps_caption_img').className = \"infos_cps_caption_img_expand\";\r\n\t\tdocument.getElementById('infos_cps_table').style.display = \"none\";\r\n\t}\r\n\tevent.cancelBubble = true;\r\n\t\t\r\n\treturn false;\r\n}\r\n\r\nfunction clickActionNoPropagation(event) {\r\n\t//this.click();\r\n\r\n\tevent.cancelBubble = true;\r\n\r\n\treturn false;\r\n}\r\n\n<!-- script : /js/wizarddiagcps.js End -->\n<!-- script : /js/diagcps.js Begin -->\n//==================================\r\n// Global variable used for all data \r\n// displayed on screen \r\n// or used by state machine\r\n//==================================\r\nvar dataIHM = {\r\n\t//==========================\r\n\t// Root URL\r\n\tlocalURL: '',\r\n\tsetLocalURL: function(URL) {this.localURL = URL;},\r\n\tgetLocalURL: function() {return this.localURL;},\r\n\t\r\n\t//==========================\r\n\t// User Agent\r\n\tclientUAInfos: null,\r\n\ttimerUAInfos: null,\r\n\tinitUAInfos: function() {\r\n\t\t\t\t\t\tvar uaparser = new UAParser();\r\n\t\t\t\t\t\tthis.clientUAInfos = uaparser.getResult();\r\n\t\t\t\t\t\tthis.clientUAInfos.browser.xpi = true;\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tthis.timerUAInfos = setTimeout(function(){dataIHM.isUAInfosCPSWebEx()}, 1000);\r\n\t\t\t\t\t},\r\n\tgetUAInfos: function() {return this.clientUAInfos},\r\n\tisUAInfosCPSWebEx: function() {\r\n\t\t\t\t\tif (window.isCpsWebExAlive) {\r\n\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', window.isCpsWebExAlive());\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (this.getUAInfos().browser.name == 'Firefox') {\r\n\t\t\t\t\t\t\tif (this.getUAInfos().browser.major > 57) {\r\n\t\t\t\t\t\t\t\tthis.clientUAInfos.browser.xpi = false;\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'absente');\r\n\t\t\t\t\t\t\t\twizardStateMachine.wizard('manualInstallXPI');\r\n\t\t\t\t\t\t\t} else if (this.getUAInfos().browser.major == 57) {\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'sur cette version, l\\'installation du p&eacute;riph&eacute;rique de s&eacute;curit&eacute; doit &ecirc;tre <a href=\"http://integrateurs-cps.asipsante.fr/Installation-manuelle-PKCS11-Firefox\" target=\"_blanck\">r&eacute;alis&eacute;e manuellement</a>.');\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'd&eacute;tection impossible sur cette version');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.timerUAInfos = null;\r\n\t\t\t\t},\r\n\t\r\n\t//===============================\r\n\t// Installed Component management\r\n\tcomponentName: \"CryptolibCPS\", // By default\r\n\tsetComponentName: function(name) {this.componentName = name;},\r\n\tgetComponentName: function() {return this.componentName;},\r\n\tcomponentVersion: \"\", // By Default\r\n\tsetcomponentVersion: function(version) {this.componentVersion = version;},\r\n\tgetcomponentVersion: function() {return this.componentVersion;},\r\n\tcomponentInstallerName: \"\",\r\n\tsetComponentInstallerName: function(name) {this.componentInstallerName = name;},\r\n\tgetComponentInstallerName: function() {return this.componentInstallerName;},\r\n\tserverComponentURL: null,\r\n\tsetServerComponentURL: function(URL) {this.serverComponentURL = URL;},\r\n\tgetServerComponentLink: function(version) {\r\n\t\t\t\t\t\t\t\t\tvar componentLink = this.serverComponentURL + \"?\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"component=\" + this.getComponentName();\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&os=\" + this.getUAInfos().os.name;\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&arch=\" + this.getUAInfos().cpu.architecture;\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&version=\" + this.getcomponentVersion();\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\treturn componentLink;\r\n\t\t\t\t\t\t\t\t},\r\n\tserverComponentInfos: null,\r\n\treadServerComponentInfos: function() {\r\n\t\t\t\t\t\t\t\t// XPI 6.0.15 with Firefox < 57\r\n\t\t\t\t\t\t\t\t// ==> Use Cryptolib CPS 5.0.37 instead of last release\r\n\t\t\t\t\t\t\t\tif ((this.getUAInfos().browser.name == 'Firefox') \r\n\t\t\t\t\t\t\t\t\t&& (this.getUAInfos().browser.major < 57)) {\r\n\t\t\t\t\t\t\t\t\tswitch (this.getUAInfos().os.name) {\r\n\t\t\t\t\t\t\t\t\t\tcase 'Windows': this.setcomponentVersion('5.0.37');break;\r\n\t\t\t\t\t\t\t\t\t\tcase 'Mac OS': this.setcomponentVersion('5.0.34');break;\r\n\t\t\t\t\t\t\t\t\t\tcase 'Linux':\r\n\t\t\t\t\t\t\t\t\t\tcase 'CentOS':\r\n\t\t\t\t\t\t\t\t\t\tcase 'Ubuntu':\r\n\t\t\t\t\t\t\t\t\t\tcase 'RedHat':  this.setcomponentVersion('5.0.12');break;\r\n\t\t\t\t\t\t\t\t\t\tdefault:break;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// Use fetch if exist\r\n\t\t\t\t\t\t\t\tif (self.fetch) {\r\n\t\t\t\t\t\t\t\t\tfetch( this.getServerComponentLink() + '&filename=get' )\r\n\t\t\t\t\t\t\t\t\t.then(function(resp) {return resp.json();})\r\n\t\t\t\t\t\t\t\t\t.then(function(response) {\r\n\t\t\t\t\t\t\t\t\t\tfor (var k in response) {\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.setComponentInstallerName(response[k]);\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.addClientDetailedInfos('URL de t&eacute;l&eacute;chargement', '<a href=\"' + dataIHM.getServerComponentLink() + '\">' + dataIHM.getComponentInstallerName() + '</a>');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('readServerComponentInfos : Error with fetch (' + error.message + ')'); \r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t// Use JQuery\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$.ajax(\t{\r\n\t\t\t\t\t\t\t\t\t\turl: this.getServerComponentLink() + '&filename=get'\r\n\t\t\t\t\t\t\t\t\t\t, success: function( data) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar json;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (data === String)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson = jQuery.parseJSON(data);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson = data\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor (var k in json) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setComponentInstallerName(json[k]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.addClientDetailedInfos('URL de t&eacute;l&eacute;chargement', '<a href=\"' + dataIHM.getServerComponentLink() + '\">' + dataIHM.getComponentInstallerName() + '</a>');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t, error: function( data) { return null;}\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\r\n\t//========================================\r\n\t// Support contact informations management\r\n \tmailSupportMailbox: null,\r\n\tmailSupportDomain: null,\r\n\tsetMailSupport: function(mailbox, domain) {this.mailSupportMailbox = mailbox; this.mailSupportDomain = domain;},\r\n\tgetMailSupport: function() {return this.mailSupportMailbox + \"@\" + this.mailSupportDomain;},\r\n \t\t\r\n\t//==========================\r\n\t// Detailed informations\r\n\tclientDetailedInfos: {},\r\n\tinitClientDetailedInfos: function() {\r\n\t\t\t\t\t\t\t\tconfigSupported = true;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.getUAInfos().device.type === undefined) {\r\n\t\t\t\t\t\t\t\t\tconsole.log(\"Poste de travail\");\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tconfigSupported = false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().os.name) {\r\n\t\t\t\t\t\t\t\t\tcase 'Windows':\r\n\t\t\t\t\t\t\t\t\tcase 'Mac OS':\r\n\t\t\t\t\t\t\t\t\tcase 'Linux':\r\n\t\t\t\t\t\t\t\t\tcase 'CentOS':\r\n\t\t\t\t\t\t\t\t\tcase 'Ubuntu':\r\n\t\t\t\t\t\t\t\t\tcase 'RedHat':  configSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault: \t\tconfigSupported = configSupported & false;break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().browser.name) {\r\n\t\t\t\t\t\t\t\t\tcase 'IE':\r\n\t\t\t\t\t\t\t\t\tcase 'Safari':\r\n\t\t\t\t\t\t\t\t\tcase 'Edge':\r\n\t\t\t\t\t\t\t\t\tcase 'Chrome':\r\n\t\t\t\t\t\t\t\t\tcase 'Firefox':\tconfigSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault: \t\tconfigSupported = configSupported & false;break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().cpu.architecture) {\r\n\t\t\t\t\t\t\t\t\tcase 'ia32':\r\n\t\t\t\t\t\t\t\t\tcase 'i686':\r\n\t\t\t\t\t\t\t\t\tcase 'amd64': configSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\t\tif (this.getUAInfos().cpu.architecture === undefined)\r\n\t\t\t\t\t\t\t\t\t\t\tconfigSupported = configSupported & true;\r\n\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\tconfigSupported = configSupported & false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.getUAInfos().cpu.architecture == 'amd64')\r\n\t\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Syst&egrave;me d\\'exploitation', this.getUAInfos().os.name + \" \" + this.getUAInfos().os.version + \" (64b)\");\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Syst&egrave;me d\\'exploitation', this.getUAInfos().os.name + \" \" + this.getUAInfos().os.version);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Navigateur', this.getUAInfos().browser.name + \" \" + this.getUAInfos().browser.major);\r\n\t\t\t\t\t\t\t\t// this.addClientDetailedInfos('Compatibilit&eacute; ASIP', '<a href=\"http://integrateurs-cps.asipsante.fr/Lettre_d_information\" target=\"_blanck\">Lettre d\\'information<br/>POSTE DE TRAVAIL & Veille Technologique</a>');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.clientUAInfos.configSupported = configSupported;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\treturn configSupported;\r\n\t\t\t\t\t\t\t},\r\n\tgetClientDetailedInfos: function() {return this.clientDetailedInfos;},\r\n\taddClientDetailedInfos: function(key, value) { this.clientDetailedInfos[key] = value;},\r\n\tresetClientDetailedInfos: function() {this.clientDetailedInfos = {};},\r\n\t\t\r\n\t//==========================\r\n\t// Client SSL Informations\r\n\tclientSSLInfos: null,\r\n\tclientSSLFetchParameters: { mode:'cors', credentials: 'include', cache: 'no-cache'},\r\n\tclientSSLAjaxParameters: { cache: false, timeout: 8000, async: true},\r\n\tisDefineClientSSLInfos: function() {return (this.clientSSLInfos != undefined);},\r\n\tsetClientSSLInfos: function(data) {this.clientSSLInfos = data;},\r\n\tgetClientSSLInfos: function() {return this.clientSSLInfos;},\r\n\tinitClientSSLParameters: function() { $.ajaxSetup(this.clientSSLAjaxParameters);},\r\n\tresetClientSSLInfos: function () {\r\n\t\t\t\t\t\t\tconsole.log('resetClientSSLInfos : Erase SSL Connexion cache for ' + this.getUAInfos().browser.name);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tswitch (this.getUAInfos().browser.name) {\r\n\t\t\t\t\t\t\t\tcase 'Edge': // Works !\r\n\t\t\t\t\t\t\t\tcase 'IE': // Works !\r\n\t\t\t\t\t\t\t\t\tif (document.execCommand) document.execCommand( \"ClearAuthenticationCache\", \"false\");\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 'Firefox':\t// Works !\r\n\t\t\t\t\t\t\t\t\t//location.reload(); // Works !\r\n\t\t\t\t\t\t\t\t\tif (window.crypto) if (window.crypto.logout) window.crypto.logout(); // Works !\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 'Chrome': // Works !\r\n\t\t\t\t\t\t\t\tcase 'Safari': // Not working, restart Browser needed !\r\n\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag'); \r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\treadClientSSLInfos: function() {\r\n\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : SSL Connexion' );\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// Use fetch if exist\r\n\t\t\t\t\t\t\tif (self.fetch) {\r\n\t\t\t\t\t\t\t\t// Try to connect and get CPS informations\r\n\t\t\t\t\t\t\t\tfetch( '/visuel.php', this.clientSSLFetchParameters )\r\n\t\t\t\t\t\t\t\t.then(function(resp) {return resp.json();})\r\n\t\t\t\t\t\t\t\t.then(function(resp_json) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Success with Fetch');\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t// traitement du JSON\r\n\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(resp_json);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('endDiagWithSuccess');\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t// Case of SSL Error\r\n\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Probably SSL Error with fetch (' + error.message + ')');\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(null);\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.accelerateTimer();\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t// Use JQuery\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$.ajax(\t{\r\n\t\t\t\t\t\t\t\t\turl: 'visuel.php'\r\n\t\t\t\t\t\t\t\t\t, success: function(data, textStatus) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Success with Ajax (' + textStatus + ')');\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tif (data === String)\r\n\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(jQuery.parseJSON(data));\r\n\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(data);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('endDiagWithSuccess');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t, error: function(data, textStatus) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Probably SSL Error with Ajax (' + textStatus + ')');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(null);\r\n\t\t\t\t\t\t\t\t\t\t\twizardStateMachine.accelerateTimer();\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n}\r\n\r\n//=====\r\n// Main\r\n//=====\r\n$(function() {\r\n\t// Initialization\r\n\t//---------------\r\n\tdataIHM.initUAInfos(); // User Agent\r\n\t\r\n\tdataIHM.initClientSSLParameters();\r\n\t\r\n\t// Sp�cific parameter with no good solution @29/12/2017\r\n\tswitch (dataIHM.getUAInfos().browser.name) {\r\n\t\tcase 'IE':\r\n\t\t\tconsole.log('=========== Use Ajax =============');\r\n\t\t\tself.fetch = undefined;\r\n\t\t\tbreak;\r\n\t\tcase 'Edge':\r\n\t\tcase 'Firefox':\r\n\t\tcase 'Safari':\r\n\t\tdefault:\r\n\t\t\tconsole.log('=========== Try using fetch. If not available use Ajax =============');\r\n\t\t\tbreak;\r\n\t}\r\n\t\r\n\tdataIHM.initClientDetailedInfos(); // Informations in bottom\r\n\tdataIHM.readServerComponentInfos(); // Get from informations from Web Service\r\n\t\r\n\twizardStateMachine.startWizard(); // Start Wizard\r\n\t\t\r\n\twizardStateMachine.displayInit(dataIHM.getUAInfos().os.name);\r\n});\r\n\n<!-- script : /js/diagcps.js End -->\n\n</script>\n<script type=\"text/javascript\">\n\t// Initialization Javascript from PHP\n\tdataIHM.setComponentName('CryptolibCPS');\n\tdataIHM.setServerComponentURL('download.php');\n</script>\n<!--<div id=\"beta\"></div>-->\n<div id=\"instructions-back\" onclick=\"wizardStateMachine.wizard('exitInstruction');\">\n\t<div id=\"instructions\">\n\t\n\t\t<div class=\"screen\" id=\"preAlert\">\n\t\t\t<div class=\"instruction\"><br/>\n<h1>Assistance en cas de carte CPS non lue</h1>\n\n<h2>Pr&eacute;alablement</h2>\n<p>\nVeuillez v&eacute;rifier que votre carte est bien ins&eacute;r&eacute;e dans votre lecteur de carte ou votre terminal Vitale.<br/>\nPuis v&eacute;rifier que votre lecteur de carte ou votre terminal Vitale est correctement connect&eacute; &agrave; votre ordinateur.<br/>\n<br/>\nLa carte ins&eacute;r&eacute;e dans le lecteur doit &ecirc;tre la derni&egrave;re carte active.\n\n<table >\n\t<tr>\n\t\t<td style=\"border-top:none;\"><img src=\"images/informations32.png\" alt=\"Information :\"/></td>\n\t\t<td style=\"border-top:none;\"><i>La derni&egrave;re carte active pr&eacute;sente la date d'expiration la plus &eacute;loign&eacute;e.</i></td>\n\t</tr>\n</table>\n<br/>\nUne fois cette v&eacute;rification r&eacute;alis&eacute;e, v&eacute;rifiez que la carte est bien lue.<br/>\n</p>\n\n<div id=\"alert1-MacOS\">\n<h2>Votre ordinateur est sous Mac OS</h2>\n<p>\nSur votre syst&egrave;me d'exploitation, nous ne disposons pas de m&eacute;thode particuli&egrave;re pour v&eacute;rifier si votre carte est lue.<br/>\n<br/>\nVeuillez lancer un diagnostic de votre ordinateur et proc&eacute;der &agrave; l'installation des mises &agrave; jour sugg&eacute;r&eacute;es.<br/>\n</p>\n</div>\n\n<div id=\"alert1-Linux\">\n<h2>Votre ordinateur est sous Linux</h2>\n<p>\nSur votre syst&egrave;me d'exploitation, nous ne disposons pas de m&eacute;thode particuli&egrave;re pour v&eacute;rifier si votre carte est lue.<br/>\n<br/>\nVeuillez lancer un diagnostic de votre ordinateur et proc&eacute;der &agrave; l'installation des mises &agrave; jour sugg&eacute;r&eacute;es.<br/>\n</p>\n</div>\n\n<div id=\"alert1-Windows\">\n<h2>Votre ordinateur est sous Windows</h2>\n<b>Dans la barre des t&acirc;ches, une carte lue est signal&eacute;e par <img src=\"images/preHelper/iconeOK.png\" alt=\"Icone vert dans la barre des taches\" /> et une carte non lue par <img src=\"images/preHelper/iconeKO.png\" alt=\"Icone rouge dans la barre des taches\"/>.</b><br/>\n<h3>L'ic&ocirc;ne <img src=\"images/preHelper/iconeOK.png\" alt=\"Icone vert dans la barre des taches\"/> est introuvable</h3>\n<p>\nCliquez avec le clic droit de votre souris sur le bouton &laquo;Afficher les ic&ocirc;nes&raquo; (en bas &agrave; droite de votre &eacute;cran) ou sur la zone heure et date et selectionnez &laquo;Personnaliser les ic&ocirc;nes de notification&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/notificationsBar.png\" alt=\"Barre de notification\"/></div>\n<br/>\n<br/>\nCherchez l'ic&ocirc;ne &laquo;Gestionnaire de certificats CPS&raquo; et s&eacute;lectionnez &laquo;Afficher l'ic&ocirc;ne et les notifications&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/notificationsParameters.png\" alt=\"Parametres de notifications\"/></div>\n<br/>\nUne fois la manipulation r&eacute;alis&eacute;e vous devriez voir apparaitre l'ic&ocirc;ne (en bas &agrave; droite de votre &eacute;cran).<br/>\n<br/>\nSi l'ic&ocirc;ne n'apparait pas dans la liste, lancer le diagnostic de votre ordinateur et installez les mises &agrave; jour propos&eacute;es.<br/>\n<br/>\n</p>\n<h2>L'ic&ocirc;ne <img src=\"images/preHelper/iconeKO.png\" alt=\"Icone rouge dans la barre des taches\" /> est rouge</h2>\n<p>\nSi l'ic&ocirc;ne est encadr&eacute;e de rouge (carte non lue), assurez-vous que votre carte est bien ins&eacute;r&eacute;e dans votre lecteur, rafra&icirc;chissez le lecteur en cliquant sur l'ic&ocirc;ne avec le bouton droit de la souris. Et cliquez sur &laquo;Rafra&icirc;chir&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/rightClickCCM.png\" alt=\"Cliquer droit sur l'icone du CCM\" /></div>\n<br/>\nSi l'encadr&eacute; reste rouge apr&egrave;s la manipulation, red&eacute;marrez votre ordinateur en laissant le lecteur et la CPS connect&eacute;s.<br/>\n<br/>\nApr&egrave;s ces manipulations, si l'ic&ocirc;ne ne passe pas au vert, veuillez nous contacter.\n</p>\n<div align=\"center\"></div>\n</div>\n\n</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"startDiag\" onclick=\"wizardStateMachine.wizard('startDiag');\">Diagnostiquer mon poste</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"notSupported\">\n\t\t\t<div class=\"instruction\">Votre configuration mat&eacute;riel et/ou syst&egrave;me n'est pas support&eacute;e par nos composants logiciels. Nous ne garantissons pas le succès du diagnostic.</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"notSupported\" onclick=\"wizardStateMachine.wizard('preAlert');\">Continuer</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"manualInstallXPI\">\n\t\t\t<div class=\"instruction\" id=\"xpi_instruction\" >L'Extension Firefox n'a pas &eacute;t&eacute; d&eacute;tect&eacute;e. Elle est indispensable sous ce navigateur.<br/>Apr&egrave;s l'installation, veuillez red&eacute;marrer votre navigateur.</div>\n\t\t\t<div class=\"actions\">\n<!--\t\t\t\t<div class=\"action instruction\" id=\"xpi\" onclick=\"wizardStateMachine.wizard('XPI',{URL:'https://diagcps.eservices.esante.gouv.fr/ODI_PS/php/download_asip.php?installeur=url_interne_xpi_installation_pkcs11',IconURL:'https://diagcps.eservices.esante.gouv.fr/ODI_PS/images/asip_sante.png',Hash:'sha256:c23de3812aaf7c3a81d80e9bdf891c3e2b621e01e55e8d308226fd86ab6ef438'});\">Installer<br/>l'Extension Firefox</div>-->\n<div class=\"action instruction\" id=\"xpi\" onclick=\"wizardStateMachine.wizard('XPI',{URL:'/download.php?component=xpi',IconURL:'/images/asip_sante.png',Hash:'sha256:c23de3812aaf7c3a81d80e9bdf891c3e2b621e01e55e8d308226fd86ab6ef438'});\">Installer<br/>l'Extension Firefox</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"restartAlertXPI\">\n\t\t\t<div class=\"instruction\" id=\"restartInstructionXPI\" >Une fois l'installation de l'Extension Cryptolib CPS termin&eacute;e,<br/>veuillez red&eacute;marrer votre navigateur.</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"manualInstallClibCPS\">\n\t\t\t<div class=\"instruction\">Si vous avez ins&eacute;r&eacute; votre CPS dans votre lecteur sans succ&egrave;s, la version de Cryptolib CPS de votre poste de travail n'est peut-&ecirc;tre pas &agrave; jour.</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"cryptolib\" onclick=\"wizardStateMachine.wizard('CryptolibCPS');\">T&eacute;l&eacute;charger<br/>Cryptolib CPS</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"restartAlert\">\n\t\t\t<div class=\"instruction\" id=\"restartInstruction\" >Une fois l'installation de CryptolibCPS_vX.Y.Z termin&eacute;e, veuillez red&eacute;marrer votre navigateur.</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"contactSupport\">\n\t\t\t<div class=\"instruction\">Si vous avez installez le composant propos&eacute; sans succ&eacute;s,<br/> veuillez contacter le Support.</div>\n\t\t</div>\n\t\t\n\t</div>\n</div>\t\n<div id=\"service-direction\" class=\"column\"></div>\n<div id=\"article\">\n\t<div id=\"center\">\n\t\t<div class=\"diagState\" id=\"diagState\"></div>\n\t\t<div>\n\t\t\t<div id=\"cps\" class=\"cpsverso\" onclick=\"wizardStateMachine.wizard('restartDiag');\"><div id=\"spin\"><div id=\"retry\"></div></div></div>\n\t\t</div>\n<!--\t\t\n\t\t<div id=\"results\">\n\t\t\t<div>\n\t\t\t\t<div class=\"sign\" id=\"certificat\"></div>\n\t\t\t\t<div class=\"sign\" id=\"expired\" title=\"expire\"></div>\n\t\t\t\t<div class=\"sign\" id=\"revoc\" title=\"revoque\"></div>\n\t\t\t\t<div class=\"sign\" id=\"class\"></div>\n\t\t\t\t<div class=\"sign\" id=\"rootAC\"></div>\n\t\t\t\t<div class=\"sign\" id=\"cryptolib\" title=\"cryptolib\"></div>\n\t\t\t</div>\n\t\t</div>\n-->\n\t\t<div id=\"cps_infos\">\n\t\t\t<div id=\"infos_cps\">\n\t\t\t\t<div id=\"infos_cps_caption\"><div>Informations d&eacute;taill&eacute;es</div><div class=\"infos_cps_caption_img_expand\" id=\"infos_cps_caption_img\"></div></div>\n\t\t\t\t<table id=\"infos_cps_table\">\n\t\t\t\t\t<tbody id=\"infos_cps_tbody\"></tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n<div id=\"support-direction\" class=\"column\"></div>\n</div>\r\n<div id=\"footer\" style=\"display:flex;flex-direction:row\">\r\n    <div style=\"display:flex;flex-direction:row;width:30vw\">\r\n        <div style=\"margin:20px\">\r\n            <a href=\"https://solidarites-sante.gouv.fr/\" target=\"_blank\">\r\n                <img src=\"./images/logo-ministere.svg\" alt=\"Ministère des Solidarités et de la santé\" width=\"84\" height=\"62\">\r\n            </a>\r\n        </div>\r\n        <div style=\"margin:20px\">\r\n            <a href=\"https://esante.gouv.fr/\" target=\"_blank\">\r\n                <img src=\"./images/logo-ANS.svg\" alt=\"Agence du Numérique en Santé\" width=\"166\" height=\"50\">\r\n            </a>\r\n        </div>\r\n    </div>\r\n    <div style=\"width:60vw\">\r\n        <ul style=\"align-items:end\">\r\n            <li><a href=\"http://esante.gouv.fr/services/mentions-legales\" target=\"_blank\">Mentions l&eacute;gales</a></li>\r\n            <li><a href=\"./copyright.php\" target=\"_blank\" title=\"Copyright [nouvelle fen&ecirc;tre]\">Copyright</a></li>\r\n        </ul>\r\n    </div>\r\n</div>\r\n\r\n</body>\r\n</html>\r\n",
      "ip": "135.125.232.117",
      "timestamp": "2025-03-14T16:25:23.983443785Z",
      "curl-command": "curl -X 'GET' -H 'Accept: */*' -H 'Accept-Language: en' -H 'User-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)' 'https://diagcps.eservices.esante.gouv.fr'",
      "matcher-status": true
    },
    {
      "template": "http/technologies/openssl-detect.yaml",
      "template-url": "https://templates.nuclei.sh/public/openssl-detect",
      "template-id": "openssl-detect",
      "template-path": "/home/runner/nuclei-templates/http/technologies/openssl-detect.yaml",
      "info": {
        "name": "Openssl Detect",
        "author": [
          "h4kux",
          "princechaddha"
        ],
        "tags": [
          "tech",
          "openssl"
        ],
        "severity": "info",
        "metadata": {
          "max-request": 1,
          "product": "openssl",
          "shodan-query": "OpenSSL",
          "vendor": "openssl",
          "verified": true
        },
        "classification": {
          "cve-id": null,
          "cwe-id": null,
          "cpe": "cpe:2.3:a:openssl:openssl:*:*:*:*:*:*:*:*"
        }
      },
      "type": "http",
      "host": "https://diagcps.eservices.esante.gouv.fr",
      "matched-at": "https://diagcps.eservices.esante.gouv.fr",
      "extracted-results": [
        "OpenSSL/1.1.1g"
      ],
      "request": "GET / HTTP/1.1\r\nHost: diagcps.eservices.esante.gouv.fr\r\nUser-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)\r\nConnection: close\r\nAccept: */*\r\nAccept-Language: en\r\nAccept-Encoding: gzip\r\n\r\n",
      "response": "HTTP/1.1 200 OK\r\nConnection: close\r\nTransfer-Encoding: chunked\r\nContent-Type: text/html; charset=UTF-8\r\nDate: Fri, 14 Mar 2025 16:25:23 GMT\r\nServer: Apache/2.4.37 (centos) OpenSSL/1.1.1g\r\nX-Powered-By: PHP/7.2.24\r\n\r\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n\t<title>DiagCPS, Outil de Diagnostic SSL</title>\r\n\t<meta http-equiv=\"Content-type\" content=\"text/html; charset=UTF-8\" />\r\n\t<meta name=\"description\" content=\"DiagCPS est un Outil de Diagnostic de l'authentification en ligne à l'aide d'une Carte de Professionnel de Santé, i.e. CPS. Il est fourni par l'ASIP Santé et remplace ODI.\" />\r\n\t<meta name=\"Publisher\" content=\"ASIP Santé\" />\r\n\t<meta name=\"copyright\" content=\"Tous droits réservés - ASIP Santé\" />\r\n\t<link rel=\"shortcut icon\" href=\"./images/favicon.ico\" type=\"image/x-icon\" />\r\n\t<link rel=\"stylesheet\" href=\"diagcps_css.php\" />\r\n\t<script src=\"./js/jquery-3.2.0.min.js\"></script>\r\n\t<script src=\"./js/ua-parser.min.js\"></script>\r\n</head>\r\n<body>\r\n<div id=\"header\" style=\"display:flex;flex-direction:row\">\r\n    <div style=\"margin:20px\">\r\n        <a href=\"https://solidarites-sante.gouv.fr/\" target=\"_blank\">\r\n            <img src=\"./images/logo-ministere.svg\" alt=\"Ministère des Solidarités et de la santé\" width=\"168\" height=\"104\">\r\n        </a>\r\n    </div>\r\n\t<div id=\"title\">esante.gouv.fr</div>\r\n</div>\r\n<div id=\"section\">\r\n<script type=\"text/javascript\">\n\n<!-- script : /js/wizarddiagcps.js Begin -->\n//==================================\r\n// Global variable used for state machine management \r\n// displayed on screen \r\n// or used by state machine\r\n//==================================\r\nvar wizardStateMachine = {\r\n\tstartState: 'notSupported',\r\n\tlastState: 'notSupported',\r\n\t\r\n\t//=================\r\n\t// Retry Management\r\n\t// Variables\r\n\tnbMaxRetry: 10,\r\n\tnbRetry: 0,\r\n\t\r\n\t// Management\r\n\tinitRetry: function() {this.nbRetry = this.nbMaxRetry;},\r\n\tisMaxRetry: function() {return (this.nbRetry >= this.nbMaxRetry);},\r\n\tisMinRetry: function() {return (this.nbRetry <= 0);},\r\n\tdecRetry: function() {this.nbRetry--;},\r\n\tdisplayRetry: function() {\r\n\t\t\t\t\t\t\t\t//console.log(\"displayRetry : nbRetry = \" + this.nbRetry);\r\n\t\t\t\t\t\t\t\tthis.decRetry();\r\n\t\t\t\t\t\t\t\tthis.stopTimers(); \r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.isMinRetry()\r\n\t\t\t\t\t\t\t\t\t&& \t(this.lastState != 'endDiagWithSuccess')) {\r\n\t\t\t\t\t\t\t\t\tthis.wizard('manualInstallClibCPS');\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tthis.displayWait(true);\r\n\t\t\t\t\t\t\t\t\tthis.startTimers();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\r\n\t//==================\r\n\t// Timers Management\r\n\ttimerTestSSL: null,\r\n\tretryTimeoutKO: 1000,\r\n\tinitTimer: function () {this.retryTimeoutKO = 1000;},\r\n\taccelerateTimer: function () {this.retryTimeoutKO = 250;},\r\n\tstopTimers: function() {\r\n\t\t\t\t\t\t\t\tif (this.timerTestSSL != null)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tclearTimeout(this.timerTestSSL);\r\n\t\t\t\t\t\t\t\t\tthis.timerTestSSL = null;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\tstartTimers: function() {this.timerTestSSL = setTimeout(function(){wizardStateMachine.displayRetry()}, this.retryTimeoutKO);},\r\n\t\r\n\t//=======\r\n\t// Wizard\r\n\tstartWizard: function() {this.wizard(this.startState);},\r\n\twizard: function(step, param) {\r\n\t\t\t\tconsole.log(\"wizard : step = \" + step + \", param = \" + param);\r\n\t\t\t\t\t\r\n\t\t\t\tswitch (step)\r\n\t\t\t\t{\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Pre treatment\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'notSupported':\r\n\t\t\t\t\tcase 'preAlert':\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'start');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif ((dataIHM.getUAInfos().configSupported) || (step == 'preAlert')) this.displayInstruction(true, 'preAlert');\r\n\t\t\t\t\t\telse this.displayInstruction(true, 'notSupported');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Manual Installation XPI\r\n\t\t\t\t\t// Suggestion of installation\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'manualInstallXPI':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'KO');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'manualInstallXPI');\r\n\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// XPI Installation\r\n\t\t\t\t\t// Installation process\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'XPI':\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'restartAlertXPI');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar params = {\r\n\t\t\t\t\t\t\t\t\"Installer l'Extension Cryptolib CPS\": \r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tURL: param.URL,\r\n\t\t\t\t\t\t\t\t\tIconURL: param.IconURL,\r\n\t\t\t\t\t\t\t\t\tHash: param.Hash,\r\n\t\t\t\t\t\t\t\t\ttoString: function () { return this.URL; }\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t};\r\nconsole.log(params);\r\n\t\t\t\t\t\tInstallTrigger.install(params);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// Diagnostic\r\n\t\t\t\t\t// Start\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'startDiag':\r\n\t\t\t\t\t\tthis.initRetry();\r\n\t\t\t\t\t\tthis.initTimer();\r\n\r\n\t\t\t\t\t\tthis.displayWait(true);\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'inProgress');\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tdataIHM.readClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.startTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// Diagnostic\r\n\t\t\t\t\t// Restart\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'restartDiag':\r\n\r\n\t\t\t\t\t\tdataIHM.resetClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\r\n\t\t\t\t\t//==========================\r\n\t\t\t\t\t// Progression\r\n\t\t\t\t\t//--------------------------\r\n\t\t\t\t\tcase 'inProgress':\r\n\t\t\t\t\t\t//dataIHM.readClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// this.displayDiagnosticState(true, 'inProgress');\r\n\t\t\t\t\t\t// this.displayInstruction(false);\r\n\t\t\t\t\t\t// this.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//===================\r\n\t\t\t\t\t// Ends\r\n\t\t\t\t\t//-------------------\r\n\t\t\t\t\tcase 'endDiagWithSuccess':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'OK');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tthis.displaySupport(false);\r\n\t\t\t\t\t\tthis.displayInfosCPS(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Manual Installation Cryptolib CPS\r\n\t\t\t\t\t// Suggestion of installation\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'manualInstallClibCPS':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'KO');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'manualInstallClibCPS');\r\n\t\t\t\t\t\tthis.displaySupport(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//=======================\r\n\t\t\t\t\t// Cryptolib CPS download\r\n\t\t\t\t\t// Installation process\r\n\t\t\t\t\t//-----------------------\r\n\t\t\t\t\tcase 'CryptolibCPS':\r\n\t\t\t\t\t\twindow.location = dataIHM.getServerComponentLink();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// Direct jump to Retry after installation\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'restartAlert');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\t\r\n\t\t\t\t\t//=========================\r\n\t\t\t\t\t// Other\r\n\t\t\t\t\t// Close Instruction screen\r\n\t\t\t\t\t//-------------------------\r\n\t\t\t\t\tcase 'exitInstruction':\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true);\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t// Open Support link\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'openSupport':\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tif (param !== undefined) window.open(param.URL,'_blank');\r\n\t\t\t\t\t\tbreak;\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.lastState = step;\r\n\t\t\t},\r\n\t\r\n\t//==========================\r\n\t// Screen Display Management\r\n\tdisplayElementById: function(id, display) {\r\n\t\t\t\t\t\t\tdocument.getElementById(id).style.display = display;\r\n\t\t\t\t\t\t},\r\n\thideElementById: function(id) {\r\n\t\t\t\t\t\t\tthis.displayElementById(id, \"none\");\r\n\t\t\t\t\t\t},\r\n\tdisplayInit: function(OSName) {\r\n\t\t\t\t\t\t// Events initialization\r\n\t\t\t\t\t\t//----------------------\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"cryptolib\", \t\t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"notSupported\", \t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"startDiag\", \t\t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"instructions-back\", \t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"infos_cps_caption\", \t\"click\", clickExpandCollapse);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// PreAlert initialization\r\n\t\t\t\t\t\t//------------------------\r\n\t\t\t\t\t\tthis.displayPreAlert(OSName);\r\n\t\t\t\t\t},\r\n\tdisplayInfosCPS: function (active) {\r\n\t\t\t\t\t\t\tvar infos_cps_tbody = '';\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar detailedInformations = dataIHM.getClientDetailedInfos();\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tfor (var item in detailedInformations) {\r\n\t\t\t\t\t\t\t\tinfos_cps_tbody += '<tr><td class=\"key\">' + item + '</td><td class=\"val\">' + detailedInformations[item] + '</td></tr>';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cps').className = dataIHM.getClientSSLInfos().div_cps_class;\r\n\r\n\t\t\t\t\t\t\t\tfor (var item in dataIHM.getClientSSLInfos().infos) {\r\n\t\t\t\t\t\t\t\t\tinfos_cps_tbody += '<tr><td class=\"key\">' + item + '</td><td class=\"val\">' + dataIHM.getClientSSLInfos().infos[item] + '</td></tr>';\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cps').className = \"cpsverso\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tdocument.getElementById('infos_cps_tbody').innerHTML = infos_cps_tbody;\r\n\t\t\t\t\t\t},\r\n\r\n\tdisplayWait:function (active) {\r\n\t\t\t\t\tif ( (active)\r\n\t\t\t\t\t\t&& (wizardStateMachine.nbRetry > 0) ) {\r\n\t\t\t\t\t\tthis.displayElementById('spin', \"flex\");\r\n\t\t\t\t\t\tdocument.getElementById('retry').innerHTML = wizardStateMachine.nbRetry;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.hideElementById('spin');\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\tdisplayDiagnosticState:function (active, state) {\r\n\t\t\t\t\t\t\t\tdiagStateContent = {\r\n\t\t\t\t\t\t\t\t\t'start':{content:'Cliquer sur la carte', style:'diagState diagStart'}\r\n\t\t\t\t\t\t\t\t\t, 'inProgress':{content:'Le diagnostic est en cours', style:'diagState diagInProgress'}\r\n\t\t\t\t\t\t\t\t\t, 'KO':{content:'Le diagnostic a &eacute;chou&eacute;', style:'diagState diagKO'}\r\n\t\t\t\t\t\t\t\t\t, 'OK':{content:'Le diagnostic a r&eacute;ussi', style:'diagState diagOK'}\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.hideElementById('diagState');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').style.display = \"block\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif (state !== undefined) {\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').className = diagStateContent[state].style;\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').innerHTML = diagStateContent[state].content;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\r\n\tdisplayInstruction: function (active, step) {\r\n\t\t\t\t\t\t\tthis.hideElementById('instructions-back');\r\n\t\t\t\t\t\t\tthis.hideElementById('instructions');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\tthis.displayElementById('instructions-back', \"flex\");\r\n\t\t\t\t\t\t\t\tthis.displayElementById('instructions', \"block\");\r\n\t\t\t\t\t\t\t\tthis.hideElementById('manualInstallClibCPS');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('manualInstallXPI');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('restartAlert');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('restartAlertXPI');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('preAlert');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('notSupported');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('contactSupport');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (step !== undefined) this.displayElementById(step, \"block\");\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar detailedInformations = dataIHM.getClientDetailedInfos();\r\n\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cryptolib').innerHTML = \"T&eacute;l&eacute;charger<br/>\" + dataIHM.getComponentInstallerName();\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (dataIHM.getUAInfos().os.name == 'Mac OS')\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('restartInstruction').innerHTML = \"Une fois l'installation de \" + dataIHM.getComponentInstallerName() + \" termin&eacute;e,<br/>veuillez red&eacute;marrer votre ordinateur.\";\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('restartInstruction').innerHTML = \"Une fois l'installation de \" + dataIHM.getComponentInstallerName() + \" termin&eacute;e,<br/>veuillez red&eacute;marrer votre navigateur.\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\r\n\tdisplaySupport: function (active) {\r\n\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\tthis.displayElementById('support-direction', \"flex\");\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.hideElementById('support-direction');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\r\n\tdisplayPreAlert: function(OSName) {\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-MacOS');\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-Windows');\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-Linux');\r\n\r\n\t\t\t\t\t\t\tif (OSName == 'Mac OS') this.displayElementById('alert1-MacOS', 'block');\r\n\t\t\t\t\t\t\tif (OSName == 'Windows') this.displayElementById('alert1-Windows', 'block');\r\n\t\t\t\t\t\t\tif (OSName == 'Linux') this.displayElementById('alert1-Linux', 'block');\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\r\n};\r\n\r\n//==================\r\n// Events Management\r\nfunction addEltEventListenerAllBrowser(elt, eventName, handle) {\r\n\tif (elt.addEventListener) { elt.addEventListener(eventName, handle, false);\r\n\t} else { elt.attachEvent(\"on\" + eventName, handle);\r\n\t}\r\n}\r\n\r\nfunction addIdEventListenerAllBrowser(id, eventName, handle) {\r\n\tif (document.getElementById(id)) addEltEventListenerAllBrowser(document.getElementById(id), eventName, handle);\r\n}\r\n\r\nfunction clickExpandCollapse(event) {\r\n\tif (document.getElementById('infos_cps_table').style.display != \"block\") {\r\n\t\tdocument.getElementById('infos_cps_caption_img').className = \"infos_cps_caption_img_collapse\";\r\n\t\tdocument.getElementById('infos_cps_table').style.display = \"block\";\r\n\t} else {\r\n\t\tdocument.getElementById('infos_cps_caption_img').className = \"infos_cps_caption_img_expand\";\r\n\t\tdocument.getElementById('infos_cps_table').style.display = \"none\";\r\n\t}\r\n\tevent.cancelBubble = true;\r\n\t\t\r\n\treturn false;\r\n}\r\n\r\nfunction clickActionNoPropagation(event) {\r\n\t//this.click();\r\n\r\n\tevent.cancelBubble = true;\r\n\r\n\treturn false;\r\n}\r\n\n<!-- script : /js/wizarddiagcps.js End -->\n<!-- script : /js/diagcps.js Begin -->\n//==================================\r\n// Global variable used for all data \r\n// displayed on screen \r\n// or used by state machine\r\n//==================================\r\nvar dataIHM = {\r\n\t//==========================\r\n\t// Root URL\r\n\tlocalURL: '',\r\n\tsetLocalURL: function(URL) {this.localURL = URL;},\r\n\tgetLocalURL: function() {return this.localURL;},\r\n\t\r\n\t//==========================\r\n\t// User Agent\r\n\tclientUAInfos: null,\r\n\ttimerUAInfos: null,\r\n\tinitUAInfos: function() {\r\n\t\t\t\t\t\tvar uaparser = new UAParser();\r\n\t\t\t\t\t\tthis.clientUAInfos = uaparser.getResult();\r\n\t\t\t\t\t\tthis.clientUAInfos.browser.xpi = true;\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tthis.timerUAInfos = setTimeout(function(){dataIHM.isUAInfosCPSWebEx()}, 1000);\r\n\t\t\t\t\t},\r\n\tgetUAInfos: function() {return this.clientUAInfos},\r\n\tisUAInfosCPSWebEx: function() {\r\n\t\t\t\t\tif (window.isCpsWebExAlive) {\r\n\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', window.isCpsWebExAlive());\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (this.getUAInfos().browser.name == 'Firefox') {\r\n\t\t\t\t\t\t\tif (this.getUAInfos().browser.major > 57) {\r\n\t\t\t\t\t\t\t\tthis.clientUAInfos.browser.xpi = false;\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'absente');\r\n\t\t\t\t\t\t\t\twizardStateMachine.wizard('manualInstallXPI');\r\n\t\t\t\t\t\t\t} else if (this.getUAInfos().browser.major == 57) {\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'sur cette version, l\\'installation du p&eacute;riph&eacute;rique de s&eacute;curit&eacute; doit &ecirc;tre <a href=\"http://integrateurs-cps.asipsante.fr/Installation-manuelle-PKCS11-Firefox\" target=\"_blanck\">r&eacute;alis&eacute;e manuellement</a>.');\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'd&eacute;tection impossible sur cette version');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.timerUAInfos = null;\r\n\t\t\t\t},\r\n\t\r\n\t//===============================\r\n\t// Installed Component management\r\n\tcomponentName: \"CryptolibCPS\", // By default\r\n\tsetComponentName: function(name) {this.componentName = name;},\r\n\tgetComponentName: function() {return this.componentName;},\r\n\tcomponentVersion: \"\", // By Default\r\n\tsetcomponentVersion: function(version) {this.componentVersion = version;},\r\n\tgetcomponentVersion: function() {return this.componentVersion;},\r\n\tcomponentInstallerName: \"\",\r\n\tsetComponentInstallerName: function(name) {this.componentInstallerName = name;},\r\n\tgetComponentInstallerName: function() {return this.componentInstallerName;},\r\n\tserverComponentURL: null,\r\n\tsetServerComponentURL: function(URL) {this.serverComponentURL = URL;},\r\n\tgetServerComponentLink: function(version) {\r\n\t\t\t\t\t\t\t\t\tvar componentLink = this.serverComponentURL + \"?\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"component=\" + this.getComponentName();\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&os=\" + this.getUAInfos().os.name;\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&arch=\" + this.getUAInfos().cpu.architecture;\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&version=\" + this.getcomponentVersion();\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\treturn componentLink;\r\n\t\t\t\t\t\t\t\t},\r\n\tserverComponentInfos: null,\r\n\treadServerComponentInfos: function() {\r\n\t\t\t\t\t\t\t\t// XPI 6.0.15 with Firefox < 57\r\n\t\t\t\t\t\t\t\t// ==> Use Cryptolib CPS 5.0.37 instead of last release\r\n\t\t\t\t\t\t\t\tif ((this.getUAInfos().browser.name == 'Firefox') \r\n\t\t\t\t\t\t\t\t\t&& (this.getUAInfos().browser.major < 57)) {\r\n\t\t\t\t\t\t\t\t\tswitch (this.getUAInfos().os.name) {\r\n\t\t\t\t\t\t\t\t\t\tcase 'Windows': this.setcomponentVersion('5.0.37');break;\r\n\t\t\t\t\t\t\t\t\t\tcase 'Mac OS': this.setcomponentVersion('5.0.34');break;\r\n\t\t\t\t\t\t\t\t\t\tcase 'Linux':\r\n\t\t\t\t\t\t\t\t\t\tcase 'CentOS':\r\n\t\t\t\t\t\t\t\t\t\tcase 'Ubuntu':\r\n\t\t\t\t\t\t\t\t\t\tcase 'RedHat':  this.setcomponentVersion('5.0.12');break;\r\n\t\t\t\t\t\t\t\t\t\tdefault:break;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// Use fetch if exist\r\n\t\t\t\t\t\t\t\tif (self.fetch) {\r\n\t\t\t\t\t\t\t\t\tfetch( this.getServerComponentLink() + '&filename=get' )\r\n\t\t\t\t\t\t\t\t\t.then(function(resp) {return resp.json();})\r\n\t\t\t\t\t\t\t\t\t.then(function(response) {\r\n\t\t\t\t\t\t\t\t\t\tfor (var k in response) {\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.setComponentInstallerName(response[k]);\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.addClientDetailedInfos('URL de t&eacute;l&eacute;chargement', '<a href=\"' + dataIHM.getServerComponentLink() + '\">' + dataIHM.getComponentInstallerName() + '</a>');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('readServerComponentInfos : Error with fetch (' + error.message + ')'); \r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t// Use JQuery\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$.ajax(\t{\r\n\t\t\t\t\t\t\t\t\t\turl: this.getServerComponentLink() + '&filename=get'\r\n\t\t\t\t\t\t\t\t\t\t, success: function( data) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar json;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (data === String)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson = jQuery.parseJSON(data);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson = data\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor (var k in json) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setComponentInstallerName(json[k]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.addClientDetailedInfos('URL de t&eacute;l&eacute;chargement', '<a href=\"' + dataIHM.getServerComponentLink() + '\">' + dataIHM.getComponentInstallerName() + '</a>');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t, error: function( data) { return null;}\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\r\n\t//========================================\r\n\t// Support contact informations management\r\n \tmailSupportMailbox: null,\r\n\tmailSupportDomain: null,\r\n\tsetMailSupport: function(mailbox, domain) {this.mailSupportMailbox = mailbox; this.mailSupportDomain = domain;},\r\n\tgetMailSupport: function() {return this.mailSupportMailbox + \"@\" + this.mailSupportDomain;},\r\n \t\t\r\n\t//==========================\r\n\t// Detailed informations\r\n\tclientDetailedInfos: {},\r\n\tinitClientDetailedInfos: function() {\r\n\t\t\t\t\t\t\t\tconfigSupported = true;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.getUAInfos().device.type === undefined) {\r\n\t\t\t\t\t\t\t\t\tconsole.log(\"Poste de travail\");\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tconfigSupported = false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().os.name) {\r\n\t\t\t\t\t\t\t\t\tcase 'Windows':\r\n\t\t\t\t\t\t\t\t\tcase 'Mac OS':\r\n\t\t\t\t\t\t\t\t\tcase 'Linux':\r\n\t\t\t\t\t\t\t\t\tcase 'CentOS':\r\n\t\t\t\t\t\t\t\t\tcase 'Ubuntu':\r\n\t\t\t\t\t\t\t\t\tcase 'RedHat':  configSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault: \t\tconfigSupported = configSupported & false;break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().browser.name) {\r\n\t\t\t\t\t\t\t\t\tcase 'IE':\r\n\t\t\t\t\t\t\t\t\tcase 'Safari':\r\n\t\t\t\t\t\t\t\t\tcase 'Edge':\r\n\t\t\t\t\t\t\t\t\tcase 'Chrome':\r\n\t\t\t\t\t\t\t\t\tcase 'Firefox':\tconfigSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault: \t\tconfigSupported = configSupported & false;break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().cpu.architecture) {\r\n\t\t\t\t\t\t\t\t\tcase 'ia32':\r\n\t\t\t\t\t\t\t\t\tcase 'i686':\r\n\t\t\t\t\t\t\t\t\tcase 'amd64': configSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\t\tif (this.getUAInfos().cpu.architecture === undefined)\r\n\t\t\t\t\t\t\t\t\t\t\tconfigSupported = configSupported & true;\r\n\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\tconfigSupported = configSupported & false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.getUAInfos().cpu.architecture == 'amd64')\r\n\t\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Syst&egrave;me d\\'exploitation', this.getUAInfos().os.name + \" \" + this.getUAInfos().os.version + \" (64b)\");\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Syst&egrave;me d\\'exploitation', this.getUAInfos().os.name + \" \" + this.getUAInfos().os.version);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Navigateur', this.getUAInfos().browser.name + \" \" + this.getUAInfos().browser.major);\r\n\t\t\t\t\t\t\t\t// this.addClientDetailedInfos('Compatibilit&eacute; ASIP', '<a href=\"http://integrateurs-cps.asipsante.fr/Lettre_d_information\" target=\"_blanck\">Lettre d\\'information<br/>POSTE DE TRAVAIL & Veille Technologique</a>');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.clientUAInfos.configSupported = configSupported;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\treturn configSupported;\r\n\t\t\t\t\t\t\t},\r\n\tgetClientDetailedInfos: function() {return this.clientDetailedInfos;},\r\n\taddClientDetailedInfos: function(key, value) { this.clientDetailedInfos[key] = value;},\r\n\tresetClientDetailedInfos: function() {this.clientDetailedInfos = {};},\r\n\t\t\r\n\t//==========================\r\n\t// Client SSL Informations\r\n\tclientSSLInfos: null,\r\n\tclientSSLFetchParameters: { mode:'cors', credentials: 'include', cache: 'no-cache'},\r\n\tclientSSLAjaxParameters: { cache: false, timeout: 8000, async: true},\r\n\tisDefineClientSSLInfos: function() {return (this.clientSSLInfos != undefined);},\r\n\tsetClientSSLInfos: function(data) {this.clientSSLInfos = data;},\r\n\tgetClientSSLInfos: function() {return this.clientSSLInfos;},\r\n\tinitClientSSLParameters: function() { $.ajaxSetup(this.clientSSLAjaxParameters);},\r\n\tresetClientSSLInfos: function () {\r\n\t\t\t\t\t\t\tconsole.log('resetClientSSLInfos : Erase SSL Connexion cache for ' + this.getUAInfos().browser.name);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tswitch (this.getUAInfos().browser.name) {\r\n\t\t\t\t\t\t\t\tcase 'Edge': // Works !\r\n\t\t\t\t\t\t\t\tcase 'IE': // Works !\r\n\t\t\t\t\t\t\t\t\tif (document.execCommand) document.execCommand( \"ClearAuthenticationCache\", \"false\");\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 'Firefox':\t// Works !\r\n\t\t\t\t\t\t\t\t\t//location.reload(); // Works !\r\n\t\t\t\t\t\t\t\t\tif (window.crypto) if (window.crypto.logout) window.crypto.logout(); // Works !\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 'Chrome': // Works !\r\n\t\t\t\t\t\t\t\tcase 'Safari': // Not working, restart Browser needed !\r\n\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag'); \r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\treadClientSSLInfos: function() {\r\n\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : SSL Connexion' );\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// Use fetch if exist\r\n\t\t\t\t\t\t\tif (self.fetch) {\r\n\t\t\t\t\t\t\t\t// Try to connect and get CPS informations\r\n\t\t\t\t\t\t\t\tfetch( '/visuel.php', this.clientSSLFetchParameters )\r\n\t\t\t\t\t\t\t\t.then(function(resp) {return resp.json();})\r\n\t\t\t\t\t\t\t\t.then(function(resp_json) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Success with Fetch');\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t// traitement du JSON\r\n\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(resp_json);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('endDiagWithSuccess');\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t// Case of SSL Error\r\n\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Probably SSL Error with fetch (' + error.message + ')');\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(null);\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.accelerateTimer();\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t// Use JQuery\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$.ajax(\t{\r\n\t\t\t\t\t\t\t\t\turl: 'visuel.php'\r\n\t\t\t\t\t\t\t\t\t, success: function(data, textStatus) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Success with Ajax (' + textStatus + ')');\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tif (data === String)\r\n\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(jQuery.parseJSON(data));\r\n\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(data);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('endDiagWithSuccess');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t, error: function(data, textStatus) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Probably SSL Error with Ajax (' + textStatus + ')');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(null);\r\n\t\t\t\t\t\t\t\t\t\t\twizardStateMachine.accelerateTimer();\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n}\r\n\r\n//=====\r\n// Main\r\n//=====\r\n$(function() {\r\n\t// Initialization\r\n\t//---------------\r\n\tdataIHM.initUAInfos(); // User Agent\r\n\t\r\n\tdataIHM.initClientSSLParameters();\r\n\t\r\n\t// Sp�cific parameter with no good solution @29/12/2017\r\n\tswitch (dataIHM.getUAInfos().browser.name) {\r\n\t\tcase 'IE':\r\n\t\t\tconsole.log('=========== Use Ajax =============');\r\n\t\t\tself.fetch = undefined;\r\n\t\t\tbreak;\r\n\t\tcase 'Edge':\r\n\t\tcase 'Firefox':\r\n\t\tcase 'Safari':\r\n\t\tdefault:\r\n\t\t\tconsole.log('=========== Try using fetch. If not available use Ajax =============');\r\n\t\t\tbreak;\r\n\t}\r\n\t\r\n\tdataIHM.initClientDetailedInfos(); // Informations in bottom\r\n\tdataIHM.readServerComponentInfos(); // Get from informations from Web Service\r\n\t\r\n\twizardStateMachine.startWizard(); // Start Wizard\r\n\t\t\r\n\twizardStateMachine.displayInit(dataIHM.getUAInfos().os.name);\r\n});\r\n\n<!-- script : /js/diagcps.js End -->\n\n</script>\n<script type=\"text/javascript\">\n\t// Initialization Javascript from PHP\n\tdataIHM.setComponentName('CryptolibCPS');\n\tdataIHM.setServerComponentURL('download.php');\n</script>\n<!--<div id=\"beta\"></div>-->\n<div id=\"instructions-back\" onclick=\"wizardStateMachine.wizard('exitInstruction');\">\n\t<div id=\"instructions\">\n\t\n\t\t<div class=\"screen\" id=\"preAlert\">\n\t\t\t<div class=\"instruction\"><br/>\n<h1>Assistance en cas de carte CPS non lue</h1>\n\n<h2>Pr&eacute;alablement</h2>\n<p>\nVeuillez v&eacute;rifier que votre carte est bien ins&eacute;r&eacute;e dans votre lecteur de carte ou votre terminal Vitale.<br/>\nPuis v&eacute;rifier que votre lecteur de carte ou votre terminal Vitale est correctement connect&eacute; &agrave; votre ordinateur.<br/>\n<br/>\nLa carte ins&eacute;r&eacute;e dans le lecteur doit &ecirc;tre la derni&egrave;re carte active.\n\n<table >\n\t<tr>\n\t\t<td style=\"border-top:none;\"><img src=\"images/informations32.png\" alt=\"Information :\"/></td>\n\t\t<td style=\"border-top:none;\"><i>La derni&egrave;re carte active pr&eacute;sente la date d'expiration la plus &eacute;loign&eacute;e.</i></td>\n\t</tr>\n</table>\n<br/>\nUne fois cette v&eacute;rification r&eacute;alis&eacute;e, v&eacute;rifiez que la carte est bien lue.<br/>\n</p>\n\n<div id=\"alert1-MacOS\">\n<h2>Votre ordinateur est sous Mac OS</h2>\n<p>\nSur votre syst&egrave;me d'exploitation, nous ne disposons pas de m&eacute;thode particuli&egrave;re pour v&eacute;rifier si votre carte est lue.<br/>\n<br/>\nVeuillez lancer un diagnostic de votre ordinateur et proc&eacute;der &agrave; l'installation des mises &agrave; jour sugg&eacute;r&eacute;es.<br/>\n</p>\n</div>\n\n<div id=\"alert1-Linux\">\n<h2>Votre ordinateur est sous Linux</h2>\n<p>\nSur votre syst&egrave;me d'exploitation, nous ne disposons pas de m&eacute;thode particuli&egrave;re pour v&eacute;rifier si votre carte est lue.<br/>\n<br/>\nVeuillez lancer un diagnostic de votre ordinateur et proc&eacute;der &agrave; l'installation des mises &agrave; jour sugg&eacute;r&eacute;es.<br/>\n</p>\n</div>\n\n<div id=\"alert1-Windows\">\n<h2>Votre ordinateur est sous Windows</h2>\n<b>Dans la barre des t&acirc;ches, une carte lue est signal&eacute;e par <img src=\"images/preHelper/iconeOK.png\" alt=\"Icone vert dans la barre des taches\" /> et une carte non lue par <img src=\"images/preHelper/iconeKO.png\" alt=\"Icone rouge dans la barre des taches\"/>.</b><br/>\n<h3>L'ic&ocirc;ne <img src=\"images/preHelper/iconeOK.png\" alt=\"Icone vert dans la barre des taches\"/> est introuvable</h3>\n<p>\nCliquez avec le clic droit de votre souris sur le bouton &laquo;Afficher les ic&ocirc;nes&raquo; (en bas &agrave; droite de votre &eacute;cran) ou sur la zone heure et date et selectionnez &laquo;Personnaliser les ic&ocirc;nes de notification&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/notificationsBar.png\" alt=\"Barre de notification\"/></div>\n<br/>\n<br/>\nCherchez l'ic&ocirc;ne &laquo;Gestionnaire de certificats CPS&raquo; et s&eacute;lectionnez &laquo;Afficher l'ic&ocirc;ne et les notifications&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/notificationsParameters.png\" alt=\"Parametres de notifications\"/></div>\n<br/>\nUne fois la manipulation r&eacute;alis&eacute;e vous devriez voir apparaitre l'ic&ocirc;ne (en bas &agrave; droite de votre &eacute;cran).<br/>\n<br/>\nSi l'ic&ocirc;ne n'apparait pas dans la liste, lancer le diagnostic de votre ordinateur et installez les mises &agrave; jour propos&eacute;es.<br/>\n<br/>\n</p>\n<h2>L'ic&ocirc;ne <img src=\"images/preHelper/iconeKO.png\" alt=\"Icone rouge dans la barre des taches\" /> est rouge</h2>\n<p>\nSi l'ic&ocirc;ne est encadr&eacute;e de rouge (carte non lue), assurez-vous que votre carte est bien ins&eacute;r&eacute;e dans votre lecteur, rafra&icirc;chissez le lecteur en cliquant sur l'ic&ocirc;ne avec le bouton droit de la souris. Et cliquez sur &laquo;Rafra&icirc;chir&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/rightClickCCM.png\" alt=\"Cliquer droit sur l'icone du CCM\" /></div>\n<br/>\nSi l'encadr&eacute; reste rouge apr&egrave;s la manipulation, red&eacute;marrez votre ordinateur en laissant le lecteur et la CPS connect&eacute;s.<br/>\n<br/>\nApr&egrave;s ces manipulations, si l'ic&ocirc;ne ne passe pas au vert, veuillez nous contacter.\n</p>\n<div align=\"center\"></div>\n</div>\n\n</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"startDiag\" onclick=\"wizardStateMachine.wizard('startDiag');\">Diagnostiquer mon poste</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"notSupported\">\n\t\t\t<div class=\"instruction\">Votre configuration mat&eacute;riel et/ou syst&egrave;me n'est pas support&eacute;e par nos composants logiciels. Nous ne garantissons pas le succès du diagnostic.</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"notSupported\" onclick=\"wizardStateMachine.wizard('preAlert');\">Continuer</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"manualInstallXPI\">\n\t\t\t<div class=\"instruction\" id=\"xpi_instruction\" >L'Extension Firefox n'a pas &eacute;t&eacute; d&eacute;tect&eacute;e. Elle est indispensable sous ce navigateur.<br/>Apr&egrave;s l'installation, veuillez red&eacute;marrer votre navigateur.</div>\n\t\t\t<div class=\"actions\">\n<!--\t\t\t\t<div class=\"action instruction\" id=\"xpi\" onclick=\"wizardStateMachine.wizard('XPI',{URL:'https://diagcps.eservices.esante.gouv.fr/ODI_PS/php/download_asip.php?installeur=url_interne_xpi_installation_pkcs11',IconURL:'https://diagcps.eservices.esante.gouv.fr/ODI_PS/images/asip_sante.png',Hash:'sha256:c23de3812aaf7c3a81d80e9bdf891c3e2b621e01e55e8d308226fd86ab6ef438'});\">Installer<br/>l'Extension Firefox</div>-->\n<div class=\"action instruction\" id=\"xpi\" onclick=\"wizardStateMachine.wizard('XPI',{URL:'/download.php?component=xpi',IconURL:'/images/asip_sante.png',Hash:'sha256:c23de3812aaf7c3a81d80e9bdf891c3e2b621e01e55e8d308226fd86ab6ef438'});\">Installer<br/>l'Extension Firefox</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"restartAlertXPI\">\n\t\t\t<div class=\"instruction\" id=\"restartInstructionXPI\" >Une fois l'installation de l'Extension Cryptolib CPS termin&eacute;e,<br/>veuillez red&eacute;marrer votre navigateur.</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"manualInstallClibCPS\">\n\t\t\t<div class=\"instruction\">Si vous avez ins&eacute;r&eacute; votre CPS dans votre lecteur sans succ&egrave;s, la version de Cryptolib CPS de votre poste de travail n'est peut-&ecirc;tre pas &agrave; jour.</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"cryptolib\" onclick=\"wizardStateMachine.wizard('CryptolibCPS');\">T&eacute;l&eacute;charger<br/>Cryptolib CPS</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"restartAlert\">\n\t\t\t<div class=\"instruction\" id=\"restartInstruction\" >Une fois l'installation de CryptolibCPS_vX.Y.Z termin&eacute;e, veuillez red&eacute;marrer votre navigateur.</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"contactSupport\">\n\t\t\t<div class=\"instruction\">Si vous avez installez le composant propos&eacute; sans succ&eacute;s,<br/> veuillez contacter le Support.</div>\n\t\t</div>\n\t\t\n\t</div>\n</div>\t\n<div id=\"service-direction\" class=\"column\"></div>\n<div id=\"article\">\n\t<div id=\"center\">\n\t\t<div class=\"diagState\" id=\"diagState\"></div>\n\t\t<div>\n\t\t\t<div id=\"cps\" class=\"cpsverso\" onclick=\"wizardStateMachine.wizard('restartDiag');\"><div id=\"spin\"><div id=\"retry\"></div></div></div>\n\t\t</div>\n<!--\t\t\n\t\t<div id=\"results\">\n\t\t\t<div>\n\t\t\t\t<div class=\"sign\" id=\"certificat\"></div>\n\t\t\t\t<div class=\"sign\" id=\"expired\" title=\"expire\"></div>\n\t\t\t\t<div class=\"sign\" id=\"revoc\" title=\"revoque\"></div>\n\t\t\t\t<div class=\"sign\" id=\"class\"></div>\n\t\t\t\t<div class=\"sign\" id=\"rootAC\"></div>\n\t\t\t\t<div class=\"sign\" id=\"cryptolib\" title=\"cryptolib\"></div>\n\t\t\t</div>\n\t\t</div>\n-->\n\t\t<div id=\"cps_infos\">\n\t\t\t<div id=\"infos_cps\">\n\t\t\t\t<div id=\"infos_cps_caption\"><div>Informations d&eacute;taill&eacute;es</div><div class=\"infos_cps_caption_img_expand\" id=\"infos_cps_caption_img\"></div></div>\n\t\t\t\t<table id=\"infos_cps_table\">\n\t\t\t\t\t<tbody id=\"infos_cps_tbody\"></tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n<div id=\"support-direction\" class=\"column\"></div>\n</div>\r\n<div id=\"footer\" style=\"display:flex;flex-direction:row\">\r\n    <div style=\"display:flex;flex-direction:row;width:30vw\">\r\n        <div style=\"margin:20px\">\r\n            <a href=\"https://solidarites-sante.gouv.fr/\" target=\"_blank\">\r\n                <img src=\"./images/logo-ministere.svg\" alt=\"Ministère des Solidarités et de la santé\" width=\"84\" height=\"62\">\r\n            </a>\r\n        </div>\r\n        <div style=\"margin:20px\">\r\n            <a href=\"https://esante.gouv.fr/\" target=\"_blank\">\r\n                <img src=\"./images/logo-ANS.svg\" alt=\"Agence du Numérique en Santé\" width=\"166\" height=\"50\">\r\n            </a>\r\n        </div>\r\n    </div>\r\n    <div style=\"width:60vw\">\r\n        <ul style=\"align-items:end\">\r\n            <li><a href=\"http://esante.gouv.fr/services/mentions-legales\" target=\"_blank\">Mentions l&eacute;gales</a></li>\r\n            <li><a href=\"./copyright.php\" target=\"_blank\" title=\"Copyright [nouvelle fen&ecirc;tre]\">Copyright</a></li>\r\n        </ul>\r\n    </div>\r\n</div>\r\n\r\n</body>\r\n</html>\r\n",
      "ip": "135.125.232.117",
      "timestamp": "2025-03-14T16:25:23.994007377Z",
      "curl-command": "curl -X 'GET' -H 'Accept: */*' -H 'Accept-Language: en' -H 'User-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)' 'https://diagcps.eservices.esante.gouv.fr'",
      "matcher-status": true
    },
    {
      "template": "http/technologies/php-detect.yaml",
      "template-url": "https://templates.nuclei.sh/public/php-detect",
      "template-id": "php-detect",
      "template-path": "/home/runner/nuclei-templates/http/technologies/php-detect.yaml",
      "info": {
        "name": "PHP Detect",
        "author": [
          "y0no"
        ],
        "tags": [
          "tech",
          "php"
        ],
        "severity": "info",
        "metadata": {
          "max-request": 1,
          "product": "php",
          "shodan-query": "X-Powered-By: PHP",
          "vendor": "php",
          "verified": true
        },
        "classification": {
          "cve-id": null,
          "cwe-id": null,
          "cpe": "cpe:2.3:a:php:php:*:*:*:*:*:*:*:*"
        }
      },
      "type": "http",
      "host": "https://diagcps.eservices.esante.gouv.fr",
      "matched-at": "https://diagcps.eservices.esante.gouv.fr",
      "extracted-results": [
        "7.2.24"
      ],
      "request": "GET / HTTP/1.1\r\nHost: diagcps.eservices.esante.gouv.fr\r\nUser-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)\r\nConnection: close\r\nAccept: */*\r\nAccept-Language: en\r\nAccept-Encoding: gzip\r\n\r\n",
      "response": "HTTP/1.1 200 OK\r\nConnection: close\r\nTransfer-Encoding: chunked\r\nContent-Type: text/html; charset=UTF-8\r\nDate: Fri, 14 Mar 2025 16:25:23 GMT\r\nServer: Apache/2.4.37 (centos) OpenSSL/1.1.1g\r\nX-Powered-By: PHP/7.2.24\r\n\r\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n\t<title>DiagCPS, Outil de Diagnostic SSL</title>\r\n\t<meta http-equiv=\"Content-type\" content=\"text/html; charset=UTF-8\" />\r\n\t<meta name=\"description\" content=\"DiagCPS est un Outil de Diagnostic de l'authentification en ligne à l'aide d'une Carte de Professionnel de Santé, i.e. CPS. Il est fourni par l'ASIP Santé et remplace ODI.\" />\r\n\t<meta name=\"Publisher\" content=\"ASIP Santé\" />\r\n\t<meta name=\"copyright\" content=\"Tous droits réservés - ASIP Santé\" />\r\n\t<link rel=\"shortcut icon\" href=\"./images/favicon.ico\" type=\"image/x-icon\" />\r\n\t<link rel=\"stylesheet\" href=\"diagcps_css.php\" />\r\n\t<script src=\"./js/jquery-3.2.0.min.js\"></script>\r\n\t<script src=\"./js/ua-parser.min.js\"></script>\r\n</head>\r\n<body>\r\n<div id=\"header\" style=\"display:flex;flex-direction:row\">\r\n    <div style=\"margin:20px\">\r\n        <a href=\"https://solidarites-sante.gouv.fr/\" target=\"_blank\">\r\n            <img src=\"./images/logo-ministere.svg\" alt=\"Ministère des Solidarités et de la santé\" width=\"168\" height=\"104\">\r\n        </a>\r\n    </div>\r\n\t<div id=\"title\">esante.gouv.fr</div>\r\n</div>\r\n<div id=\"section\">\r\n<script type=\"text/javascript\">\n\n<!-- script : /js/wizarddiagcps.js Begin -->\n//==================================\r\n// Global variable used for state machine management \r\n// displayed on screen \r\n// or used by state machine\r\n//==================================\r\nvar wizardStateMachine = {\r\n\tstartState: 'notSupported',\r\n\tlastState: 'notSupported',\r\n\t\r\n\t//=================\r\n\t// Retry Management\r\n\t// Variables\r\n\tnbMaxRetry: 10,\r\n\tnbRetry: 0,\r\n\t\r\n\t// Management\r\n\tinitRetry: function() {this.nbRetry = this.nbMaxRetry;},\r\n\tisMaxRetry: function() {return (this.nbRetry >= this.nbMaxRetry);},\r\n\tisMinRetry: function() {return (this.nbRetry <= 0);},\r\n\tdecRetry: function() {this.nbRetry--;},\r\n\tdisplayRetry: function() {\r\n\t\t\t\t\t\t\t\t//console.log(\"displayRetry : nbRetry = \" + this.nbRetry);\r\n\t\t\t\t\t\t\t\tthis.decRetry();\r\n\t\t\t\t\t\t\t\tthis.stopTimers(); \r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.isMinRetry()\r\n\t\t\t\t\t\t\t\t\t&& \t(this.lastState != 'endDiagWithSuccess')) {\r\n\t\t\t\t\t\t\t\t\tthis.wizard('manualInstallClibCPS');\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tthis.displayWait(true);\r\n\t\t\t\t\t\t\t\t\tthis.startTimers();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\r\n\t//==================\r\n\t// Timers Management\r\n\ttimerTestSSL: null,\r\n\tretryTimeoutKO: 1000,\r\n\tinitTimer: function () {this.retryTimeoutKO = 1000;},\r\n\taccelerateTimer: function () {this.retryTimeoutKO = 250;},\r\n\tstopTimers: function() {\r\n\t\t\t\t\t\t\t\tif (this.timerTestSSL != null)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tclearTimeout(this.timerTestSSL);\r\n\t\t\t\t\t\t\t\t\tthis.timerTestSSL = null;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\tstartTimers: function() {this.timerTestSSL = setTimeout(function(){wizardStateMachine.displayRetry()}, this.retryTimeoutKO);},\r\n\t\r\n\t//=======\r\n\t// Wizard\r\n\tstartWizard: function() {this.wizard(this.startState);},\r\n\twizard: function(step, param) {\r\n\t\t\t\tconsole.log(\"wizard : step = \" + step + \", param = \" + param);\r\n\t\t\t\t\t\r\n\t\t\t\tswitch (step)\r\n\t\t\t\t{\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Pre treatment\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'notSupported':\r\n\t\t\t\t\tcase 'preAlert':\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'start');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif ((dataIHM.getUAInfos().configSupported) || (step == 'preAlert')) this.displayInstruction(true, 'preAlert');\r\n\t\t\t\t\t\telse this.displayInstruction(true, 'notSupported');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Manual Installation XPI\r\n\t\t\t\t\t// Suggestion of installation\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'manualInstallXPI':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'KO');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'manualInstallXPI');\r\n\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// XPI Installation\r\n\t\t\t\t\t// Installation process\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'XPI':\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'restartAlertXPI');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar params = {\r\n\t\t\t\t\t\t\t\t\"Installer l'Extension Cryptolib CPS\": \r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tURL: param.URL,\r\n\t\t\t\t\t\t\t\t\tIconURL: param.IconURL,\r\n\t\t\t\t\t\t\t\t\tHash: param.Hash,\r\n\t\t\t\t\t\t\t\t\ttoString: function () { return this.URL; }\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t};\r\nconsole.log(params);\r\n\t\t\t\t\t\tInstallTrigger.install(params);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// Diagnostic\r\n\t\t\t\t\t// Start\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'startDiag':\r\n\t\t\t\t\t\tthis.initRetry();\r\n\t\t\t\t\t\tthis.initTimer();\r\n\r\n\t\t\t\t\t\tthis.displayWait(true);\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'inProgress');\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tdataIHM.readClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.startTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// Diagnostic\r\n\t\t\t\t\t// Restart\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'restartDiag':\r\n\r\n\t\t\t\t\t\tdataIHM.resetClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\r\n\t\t\t\t\t//==========================\r\n\t\t\t\t\t// Progression\r\n\t\t\t\t\t//--------------------------\r\n\t\t\t\t\tcase 'inProgress':\r\n\t\t\t\t\t\t//dataIHM.readClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// this.displayDiagnosticState(true, 'inProgress');\r\n\t\t\t\t\t\t// this.displayInstruction(false);\r\n\t\t\t\t\t\t// this.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//===================\r\n\t\t\t\t\t// Ends\r\n\t\t\t\t\t//-------------------\r\n\t\t\t\t\tcase 'endDiagWithSuccess':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'OK');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tthis.displaySupport(false);\r\n\t\t\t\t\t\tthis.displayInfosCPS(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Manual Installation Cryptolib CPS\r\n\t\t\t\t\t// Suggestion of installation\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'manualInstallClibCPS':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'KO');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'manualInstallClibCPS');\r\n\t\t\t\t\t\tthis.displaySupport(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//=======================\r\n\t\t\t\t\t// Cryptolib CPS download\r\n\t\t\t\t\t// Installation process\r\n\t\t\t\t\t//-----------------------\r\n\t\t\t\t\tcase 'CryptolibCPS':\r\n\t\t\t\t\t\twindow.location = dataIHM.getServerComponentLink();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// Direct jump to Retry after installation\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'restartAlert');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\t\r\n\t\t\t\t\t//=========================\r\n\t\t\t\t\t// Other\r\n\t\t\t\t\t// Close Instruction screen\r\n\t\t\t\t\t//-------------------------\r\n\t\t\t\t\tcase 'exitInstruction':\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true);\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t// Open Support link\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'openSupport':\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tif (param !== undefined) window.open(param.URL,'_blank');\r\n\t\t\t\t\t\tbreak;\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.lastState = step;\r\n\t\t\t},\r\n\t\r\n\t//==========================\r\n\t// Screen Display Management\r\n\tdisplayElementById: function(id, display) {\r\n\t\t\t\t\t\t\tdocument.getElementById(id).style.display = display;\r\n\t\t\t\t\t\t},\r\n\thideElementById: function(id) {\r\n\t\t\t\t\t\t\tthis.displayElementById(id, \"none\");\r\n\t\t\t\t\t\t},\r\n\tdisplayInit: function(OSName) {\r\n\t\t\t\t\t\t// Events initialization\r\n\t\t\t\t\t\t//----------------------\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"cryptolib\", \t\t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"notSupported\", \t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"startDiag\", \t\t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"instructions-back\", \t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"infos_cps_caption\", \t\"click\", clickExpandCollapse);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// PreAlert initialization\r\n\t\t\t\t\t\t//------------------------\r\n\t\t\t\t\t\tthis.displayPreAlert(OSName);\r\n\t\t\t\t\t},\r\n\tdisplayInfosCPS: function (active) {\r\n\t\t\t\t\t\t\tvar infos_cps_tbody = '';\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar detailedInformations = dataIHM.getClientDetailedInfos();\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tfor (var item in detailedInformations) {\r\n\t\t\t\t\t\t\t\tinfos_cps_tbody += '<tr><td class=\"key\">' + item + '</td><td class=\"val\">' + detailedInformations[item] + '</td></tr>';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cps').className = dataIHM.getClientSSLInfos().div_cps_class;\r\n\r\n\t\t\t\t\t\t\t\tfor (var item in dataIHM.getClientSSLInfos().infos) {\r\n\t\t\t\t\t\t\t\t\tinfos_cps_tbody += '<tr><td class=\"key\">' + item + '</td><td class=\"val\">' + dataIHM.getClientSSLInfos().infos[item] + '</td></tr>';\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cps').className = \"cpsverso\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tdocument.getElementById('infos_cps_tbody').innerHTML = infos_cps_tbody;\r\n\t\t\t\t\t\t},\r\n\r\n\tdisplayWait:function (active) {\r\n\t\t\t\t\tif ( (active)\r\n\t\t\t\t\t\t&& (wizardStateMachine.nbRetry > 0) ) {\r\n\t\t\t\t\t\tthis.displayElementById('spin', \"flex\");\r\n\t\t\t\t\t\tdocument.getElementById('retry').innerHTML = wizardStateMachine.nbRetry;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.hideElementById('spin');\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\tdisplayDiagnosticState:function (active, state) {\r\n\t\t\t\t\t\t\t\tdiagStateContent = {\r\n\t\t\t\t\t\t\t\t\t'start':{content:'Cliquer sur la carte', style:'diagState diagStart'}\r\n\t\t\t\t\t\t\t\t\t, 'inProgress':{content:'Le diagnostic est en cours', style:'diagState diagInProgress'}\r\n\t\t\t\t\t\t\t\t\t, 'KO':{content:'Le diagnostic a &eacute;chou&eacute;', style:'diagState diagKO'}\r\n\t\t\t\t\t\t\t\t\t, 'OK':{content:'Le diagnostic a r&eacute;ussi', style:'diagState diagOK'}\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.hideElementById('diagState');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').style.display = \"block\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif (state !== undefined) {\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').className = diagStateContent[state].style;\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').innerHTML = diagStateContent[state].content;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\r\n\tdisplayInstruction: function (active, step) {\r\n\t\t\t\t\t\t\tthis.hideElementById('instructions-back');\r\n\t\t\t\t\t\t\tthis.hideElementById('instructions');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\tthis.displayElementById('instructions-back', \"flex\");\r\n\t\t\t\t\t\t\t\tthis.displayElementById('instructions', \"block\");\r\n\t\t\t\t\t\t\t\tthis.hideElementById('manualInstallClibCPS');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('manualInstallXPI');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('restartAlert');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('restartAlertXPI');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('preAlert');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('notSupported');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('contactSupport');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (step !== undefined) this.displayElementById(step, \"block\");\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar detailedInformations = dataIHM.getClientDetailedInfos();\r\n\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cryptolib').innerHTML = \"T&eacute;l&eacute;charger<br/>\" + dataIHM.getComponentInstallerName();\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (dataIHM.getUAInfos().os.name == 'Mac OS')\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('restartInstruction').innerHTML = \"Une fois l'installation de \" + dataIHM.getComponentInstallerName() + \" termin&eacute;e,<br/>veuillez red&eacute;marrer votre ordinateur.\";\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('restartInstruction').innerHTML = \"Une fois l'installation de \" + dataIHM.getComponentInstallerName() + \" termin&eacute;e,<br/>veuillez red&eacute;marrer votre navigateur.\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\r\n\tdisplaySupport: function (active) {\r\n\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\tthis.displayElementById('support-direction', \"flex\");\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.hideElementById('support-direction');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\r\n\tdisplayPreAlert: function(OSName) {\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-MacOS');\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-Windows');\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-Linux');\r\n\r\n\t\t\t\t\t\t\tif (OSName == 'Mac OS') this.displayElementById('alert1-MacOS', 'block');\r\n\t\t\t\t\t\t\tif (OSName == 'Windows') this.displayElementById('alert1-Windows', 'block');\r\n\t\t\t\t\t\t\tif (OSName == 'Linux') this.displayElementById('alert1-Linux', 'block');\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\r\n};\r\n\r\n//==================\r\n// Events Management\r\nfunction addEltEventListenerAllBrowser(elt, eventName, handle) {\r\n\tif (elt.addEventListener) { elt.addEventListener(eventName, handle, false);\r\n\t} else { elt.attachEvent(\"on\" + eventName, handle);\r\n\t}\r\n}\r\n\r\nfunction addIdEventListenerAllBrowser(id, eventName, handle) {\r\n\tif (document.getElementById(id)) addEltEventListenerAllBrowser(document.getElementById(id), eventName, handle);\r\n}\r\n\r\nfunction clickExpandCollapse(event) {\r\n\tif (document.getElementById('infos_cps_table').style.display != \"block\") {\r\n\t\tdocument.getElementById('infos_cps_caption_img').className = \"infos_cps_caption_img_collapse\";\r\n\t\tdocument.getElementById('infos_cps_table').style.display = \"block\";\r\n\t} else {\r\n\t\tdocument.getElementById('infos_cps_caption_img').className = \"infos_cps_caption_img_expand\";\r\n\t\tdocument.getElementById('infos_cps_table').style.display = \"none\";\r\n\t}\r\n\tevent.cancelBubble = true;\r\n\t\t\r\n\treturn false;\r\n}\r\n\r\nfunction clickActionNoPropagation(event) {\r\n\t//this.click();\r\n\r\n\tevent.cancelBubble = true;\r\n\r\n\treturn false;\r\n}\r\n\n<!-- script : /js/wizarddiagcps.js End -->\n<!-- script : /js/diagcps.js Begin -->\n//==================================\r\n// Global variable used for all data \r\n// displayed on screen \r\n// or used by state machine\r\n//==================================\r\nvar dataIHM = {\r\n\t//==========================\r\n\t// Root URL\r\n\tlocalURL: '',\r\n\tsetLocalURL: function(URL) {this.localURL = URL;},\r\n\tgetLocalURL: function() {return this.localURL;},\r\n\t\r\n\t//==========================\r\n\t// User Agent\r\n\tclientUAInfos: null,\r\n\ttimerUAInfos: null,\r\n\tinitUAInfos: function() {\r\n\t\t\t\t\t\tvar uaparser = new UAParser();\r\n\t\t\t\t\t\tthis.clientUAInfos = uaparser.getResult();\r\n\t\t\t\t\t\tthis.clientUAInfos.browser.xpi = true;\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tthis.timerUAInfos = setTimeout(function(){dataIHM.isUAInfosCPSWebEx()}, 1000);\r\n\t\t\t\t\t},\r\n\tgetUAInfos: function() {return this.clientUAInfos},\r\n\tisUAInfosCPSWebEx: function() {\r\n\t\t\t\t\tif (window.isCpsWebExAlive) {\r\n\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', window.isCpsWebExAlive());\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (this.getUAInfos().browser.name == 'Firefox') {\r\n\t\t\t\t\t\t\tif (this.getUAInfos().browser.major > 57) {\r\n\t\t\t\t\t\t\t\tthis.clientUAInfos.browser.xpi = false;\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'absente');\r\n\t\t\t\t\t\t\t\twizardStateMachine.wizard('manualInstallXPI');\r\n\t\t\t\t\t\t\t} else if (this.getUAInfos().browser.major == 57) {\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'sur cette version, l\\'installation du p&eacute;riph&eacute;rique de s&eacute;curit&eacute; doit &ecirc;tre <a href=\"http://integrateurs-cps.asipsante.fr/Installation-manuelle-PKCS11-Firefox\" target=\"_blanck\">r&eacute;alis&eacute;e manuellement</a>.');\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'd&eacute;tection impossible sur cette version');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.timerUAInfos = null;\r\n\t\t\t\t},\r\n\t\r\n\t//===============================\r\n\t// Installed Component management\r\n\tcomponentName: \"CryptolibCPS\", // By default\r\n\tsetComponentName: function(name) {this.componentName = name;},\r\n\tgetComponentName: function() {return this.componentName;},\r\n\tcomponentVersion: \"\", // By Default\r\n\tsetcomponentVersion: function(version) {this.componentVersion = version;},\r\n\tgetcomponentVersion: function() {return this.componentVersion;},\r\n\tcomponentInstallerName: \"\",\r\n\tsetComponentInstallerName: function(name) {this.componentInstallerName = name;},\r\n\tgetComponentInstallerName: function() {return this.componentInstallerName;},\r\n\tserverComponentURL: null,\r\n\tsetServerComponentURL: function(URL) {this.serverComponentURL = URL;},\r\n\tgetServerComponentLink: function(version) {\r\n\t\t\t\t\t\t\t\t\tvar componentLink = this.serverComponentURL + \"?\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"component=\" + this.getComponentName();\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&os=\" + this.getUAInfos().os.name;\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&arch=\" + this.getUAInfos().cpu.architecture;\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&version=\" + this.getcomponentVersion();\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\treturn componentLink;\r\n\t\t\t\t\t\t\t\t},\r\n\tserverComponentInfos: null,\r\n\treadServerComponentInfos: function() {\r\n\t\t\t\t\t\t\t\t// XPI 6.0.15 with Firefox < 57\r\n\t\t\t\t\t\t\t\t// ==> Use Cryptolib CPS 5.0.37 instead of last release\r\n\t\t\t\t\t\t\t\tif ((this.getUAInfos().browser.name == 'Firefox') \r\n\t\t\t\t\t\t\t\t\t&& (this.getUAInfos().browser.major < 57)) {\r\n\t\t\t\t\t\t\t\t\tswitch (this.getUAInfos().os.name) {\r\n\t\t\t\t\t\t\t\t\t\tcase 'Windows': this.setcomponentVersion('5.0.37');break;\r\n\t\t\t\t\t\t\t\t\t\tcase 'Mac OS': this.setcomponentVersion('5.0.34');break;\r\n\t\t\t\t\t\t\t\t\t\tcase 'Linux':\r\n\t\t\t\t\t\t\t\t\t\tcase 'CentOS':\r\n\t\t\t\t\t\t\t\t\t\tcase 'Ubuntu':\r\n\t\t\t\t\t\t\t\t\t\tcase 'RedHat':  this.setcomponentVersion('5.0.12');break;\r\n\t\t\t\t\t\t\t\t\t\tdefault:break;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// Use fetch if exist\r\n\t\t\t\t\t\t\t\tif (self.fetch) {\r\n\t\t\t\t\t\t\t\t\tfetch( this.getServerComponentLink() + '&filename=get' )\r\n\t\t\t\t\t\t\t\t\t.then(function(resp) {return resp.json();})\r\n\t\t\t\t\t\t\t\t\t.then(function(response) {\r\n\t\t\t\t\t\t\t\t\t\tfor (var k in response) {\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.setComponentInstallerName(response[k]);\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.addClientDetailedInfos('URL de t&eacute;l&eacute;chargement', '<a href=\"' + dataIHM.getServerComponentLink() + '\">' + dataIHM.getComponentInstallerName() + '</a>');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('readServerComponentInfos : Error with fetch (' + error.message + ')'); \r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t// Use JQuery\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$.ajax(\t{\r\n\t\t\t\t\t\t\t\t\t\turl: this.getServerComponentLink() + '&filename=get'\r\n\t\t\t\t\t\t\t\t\t\t, success: function( data) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar json;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (data === String)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson = jQuery.parseJSON(data);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson = data\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor (var k in json) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setComponentInstallerName(json[k]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.addClientDetailedInfos('URL de t&eacute;l&eacute;chargement', '<a href=\"' + dataIHM.getServerComponentLink() + '\">' + dataIHM.getComponentInstallerName() + '</a>');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t, error: function( data) { return null;}\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\r\n\t//========================================\r\n\t// Support contact informations management\r\n \tmailSupportMailbox: null,\r\n\tmailSupportDomain: null,\r\n\tsetMailSupport: function(mailbox, domain) {this.mailSupportMailbox = mailbox; this.mailSupportDomain = domain;},\r\n\tgetMailSupport: function() {return this.mailSupportMailbox + \"@\" + this.mailSupportDomain;},\r\n \t\t\r\n\t//==========================\r\n\t// Detailed informations\r\n\tclientDetailedInfos: {},\r\n\tinitClientDetailedInfos: function() {\r\n\t\t\t\t\t\t\t\tconfigSupported = true;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.getUAInfos().device.type === undefined) {\r\n\t\t\t\t\t\t\t\t\tconsole.log(\"Poste de travail\");\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tconfigSupported = false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().os.name) {\r\n\t\t\t\t\t\t\t\t\tcase 'Windows':\r\n\t\t\t\t\t\t\t\t\tcase 'Mac OS':\r\n\t\t\t\t\t\t\t\t\tcase 'Linux':\r\n\t\t\t\t\t\t\t\t\tcase 'CentOS':\r\n\t\t\t\t\t\t\t\t\tcase 'Ubuntu':\r\n\t\t\t\t\t\t\t\t\tcase 'RedHat':  configSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault: \t\tconfigSupported = configSupported & false;break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().browser.name) {\r\n\t\t\t\t\t\t\t\t\tcase 'IE':\r\n\t\t\t\t\t\t\t\t\tcase 'Safari':\r\n\t\t\t\t\t\t\t\t\tcase 'Edge':\r\n\t\t\t\t\t\t\t\t\tcase 'Chrome':\r\n\t\t\t\t\t\t\t\t\tcase 'Firefox':\tconfigSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault: \t\tconfigSupported = configSupported & false;break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().cpu.architecture) {\r\n\t\t\t\t\t\t\t\t\tcase 'ia32':\r\n\t\t\t\t\t\t\t\t\tcase 'i686':\r\n\t\t\t\t\t\t\t\t\tcase 'amd64': configSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\t\tif (this.getUAInfos().cpu.architecture === undefined)\r\n\t\t\t\t\t\t\t\t\t\t\tconfigSupported = configSupported & true;\r\n\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\tconfigSupported = configSupported & false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.getUAInfos().cpu.architecture == 'amd64')\r\n\t\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Syst&egrave;me d\\'exploitation', this.getUAInfos().os.name + \" \" + this.getUAInfos().os.version + \" (64b)\");\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Syst&egrave;me d\\'exploitation', this.getUAInfos().os.name + \" \" + this.getUAInfos().os.version);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Navigateur', this.getUAInfos().browser.name + \" \" + this.getUAInfos().browser.major);\r\n\t\t\t\t\t\t\t\t// this.addClientDetailedInfos('Compatibilit&eacute; ASIP', '<a href=\"http://integrateurs-cps.asipsante.fr/Lettre_d_information\" target=\"_blanck\">Lettre d\\'information<br/>POSTE DE TRAVAIL & Veille Technologique</a>');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.clientUAInfos.configSupported = configSupported;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\treturn configSupported;\r\n\t\t\t\t\t\t\t},\r\n\tgetClientDetailedInfos: function() {return this.clientDetailedInfos;},\r\n\taddClientDetailedInfos: function(key, value) { this.clientDetailedInfos[key] = value;},\r\n\tresetClientDetailedInfos: function() {this.clientDetailedInfos = {};},\r\n\t\t\r\n\t//==========================\r\n\t// Client SSL Informations\r\n\tclientSSLInfos: null,\r\n\tclientSSLFetchParameters: { mode:'cors', credentials: 'include', cache: 'no-cache'},\r\n\tclientSSLAjaxParameters: { cache: false, timeout: 8000, async: true},\r\n\tisDefineClientSSLInfos: function() {return (this.clientSSLInfos != undefined);},\r\n\tsetClientSSLInfos: function(data) {this.clientSSLInfos = data;},\r\n\tgetClientSSLInfos: function() {return this.clientSSLInfos;},\r\n\tinitClientSSLParameters: function() { $.ajaxSetup(this.clientSSLAjaxParameters);},\r\n\tresetClientSSLInfos: function () {\r\n\t\t\t\t\t\t\tconsole.log('resetClientSSLInfos : Erase SSL Connexion cache for ' + this.getUAInfos().browser.name);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tswitch (this.getUAInfos().browser.name) {\r\n\t\t\t\t\t\t\t\tcase 'Edge': // Works !\r\n\t\t\t\t\t\t\t\tcase 'IE': // Works !\r\n\t\t\t\t\t\t\t\t\tif (document.execCommand) document.execCommand( \"ClearAuthenticationCache\", \"false\");\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 'Firefox':\t// Works !\r\n\t\t\t\t\t\t\t\t\t//location.reload(); // Works !\r\n\t\t\t\t\t\t\t\t\tif (window.crypto) if (window.crypto.logout) window.crypto.logout(); // Works !\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 'Chrome': // Works !\r\n\t\t\t\t\t\t\t\tcase 'Safari': // Not working, restart Browser needed !\r\n\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag'); \r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\treadClientSSLInfos: function() {\r\n\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : SSL Connexion' );\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// Use fetch if exist\r\n\t\t\t\t\t\t\tif (self.fetch) {\r\n\t\t\t\t\t\t\t\t// Try to connect and get CPS informations\r\n\t\t\t\t\t\t\t\tfetch( '/visuel.php', this.clientSSLFetchParameters )\r\n\t\t\t\t\t\t\t\t.then(function(resp) {return resp.json();})\r\n\t\t\t\t\t\t\t\t.then(function(resp_json) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Success with Fetch');\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t// traitement du JSON\r\n\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(resp_json);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('endDiagWithSuccess');\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t// Case of SSL Error\r\n\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Probably SSL Error with fetch (' + error.message + ')');\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(null);\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.accelerateTimer();\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t// Use JQuery\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$.ajax(\t{\r\n\t\t\t\t\t\t\t\t\turl: 'visuel.php'\r\n\t\t\t\t\t\t\t\t\t, success: function(data, textStatus) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Success with Ajax (' + textStatus + ')');\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tif (data === String)\r\n\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(jQuery.parseJSON(data));\r\n\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(data);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('endDiagWithSuccess');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t, error: function(data, textStatus) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Probably SSL Error with Ajax (' + textStatus + ')');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(null);\r\n\t\t\t\t\t\t\t\t\t\t\twizardStateMachine.accelerateTimer();\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n}\r\n\r\n//=====\r\n// Main\r\n//=====\r\n$(function() {\r\n\t// Initialization\r\n\t//---------------\r\n\tdataIHM.initUAInfos(); // User Agent\r\n\t\r\n\tdataIHM.initClientSSLParameters();\r\n\t\r\n\t// Sp�cific parameter with no good solution @29/12/2017\r\n\tswitch (dataIHM.getUAInfos().browser.name) {\r\n\t\tcase 'IE':\r\n\t\t\tconsole.log('=========== Use Ajax =============');\r\n\t\t\tself.fetch = undefined;\r\n\t\t\tbreak;\r\n\t\tcase 'Edge':\r\n\t\tcase 'Firefox':\r\n\t\tcase 'Safari':\r\n\t\tdefault:\r\n\t\t\tconsole.log('=========== Try using fetch. If not available use Ajax =============');\r\n\t\t\tbreak;\r\n\t}\r\n\t\r\n\tdataIHM.initClientDetailedInfos(); // Informations in bottom\r\n\tdataIHM.readServerComponentInfos(); // Get from informations from Web Service\r\n\t\r\n\twizardStateMachine.startWizard(); // Start Wizard\r\n\t\t\r\n\twizardStateMachine.displayInit(dataIHM.getUAInfos().os.name);\r\n});\r\n\n<!-- script : /js/diagcps.js End -->\n\n</script>\n<script type=\"text/javascript\">\n\t// Initialization Javascript from PHP\n\tdataIHM.setComponentName('CryptolibCPS');\n\tdataIHM.setServerComponentURL('download.php');\n</script>\n<!--<div id=\"beta\"></div>-->\n<div id=\"instructions-back\" onclick=\"wizardStateMachine.wizard('exitInstruction');\">\n\t<div id=\"instructions\">\n\t\n\t\t<div class=\"screen\" id=\"preAlert\">\n\t\t\t<div class=\"instruction\"><br/>\n<h1>Assistance en cas de carte CPS non lue</h1>\n\n<h2>Pr&eacute;alablement</h2>\n<p>\nVeuillez v&eacute;rifier que votre carte est bien ins&eacute;r&eacute;e dans votre lecteur de carte ou votre terminal Vitale.<br/>\nPuis v&eacute;rifier que votre lecteur de carte ou votre terminal Vitale est correctement connect&eacute; &agrave; votre ordinateur.<br/>\n<br/>\nLa carte ins&eacute;r&eacute;e dans le lecteur doit &ecirc;tre la derni&egrave;re carte active.\n\n<table >\n\t<tr>\n\t\t<td style=\"border-top:none;\"><img src=\"images/informations32.png\" alt=\"Information :\"/></td>\n\t\t<td style=\"border-top:none;\"><i>La derni&egrave;re carte active pr&eacute;sente la date d'expiration la plus &eacute;loign&eacute;e.</i></td>\n\t</tr>\n</table>\n<br/>\nUne fois cette v&eacute;rification r&eacute;alis&eacute;e, v&eacute;rifiez que la carte est bien lue.<br/>\n</p>\n\n<div id=\"alert1-MacOS\">\n<h2>Votre ordinateur est sous Mac OS</h2>\n<p>\nSur votre syst&egrave;me d'exploitation, nous ne disposons pas de m&eacute;thode particuli&egrave;re pour v&eacute;rifier si votre carte est lue.<br/>\n<br/>\nVeuillez lancer un diagnostic de votre ordinateur et proc&eacute;der &agrave; l'installation des mises &agrave; jour sugg&eacute;r&eacute;es.<br/>\n</p>\n</div>\n\n<div id=\"alert1-Linux\">\n<h2>Votre ordinateur est sous Linux</h2>\n<p>\nSur votre syst&egrave;me d'exploitation, nous ne disposons pas de m&eacute;thode particuli&egrave;re pour v&eacute;rifier si votre carte est lue.<br/>\n<br/>\nVeuillez lancer un diagnostic de votre ordinateur et proc&eacute;der &agrave; l'installation des mises &agrave; jour sugg&eacute;r&eacute;es.<br/>\n</p>\n</div>\n\n<div id=\"alert1-Windows\">\n<h2>Votre ordinateur est sous Windows</h2>\n<b>Dans la barre des t&acirc;ches, une carte lue est signal&eacute;e par <img src=\"images/preHelper/iconeOK.png\" alt=\"Icone vert dans la barre des taches\" /> et une carte non lue par <img src=\"images/preHelper/iconeKO.png\" alt=\"Icone rouge dans la barre des taches\"/>.</b><br/>\n<h3>L'ic&ocirc;ne <img src=\"images/preHelper/iconeOK.png\" alt=\"Icone vert dans la barre des taches\"/> est introuvable</h3>\n<p>\nCliquez avec le clic droit de votre souris sur le bouton &laquo;Afficher les ic&ocirc;nes&raquo; (en bas &agrave; droite de votre &eacute;cran) ou sur la zone heure et date et selectionnez &laquo;Personnaliser les ic&ocirc;nes de notification&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/notificationsBar.png\" alt=\"Barre de notification\"/></div>\n<br/>\n<br/>\nCherchez l'ic&ocirc;ne &laquo;Gestionnaire de certificats CPS&raquo; et s&eacute;lectionnez &laquo;Afficher l'ic&ocirc;ne et les notifications&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/notificationsParameters.png\" alt=\"Parametres de notifications\"/></div>\n<br/>\nUne fois la manipulation r&eacute;alis&eacute;e vous devriez voir apparaitre l'ic&ocirc;ne (en bas &agrave; droite de votre &eacute;cran).<br/>\n<br/>\nSi l'ic&ocirc;ne n'apparait pas dans la liste, lancer le diagnostic de votre ordinateur et installez les mises &agrave; jour propos&eacute;es.<br/>\n<br/>\n</p>\n<h2>L'ic&ocirc;ne <img src=\"images/preHelper/iconeKO.png\" alt=\"Icone rouge dans la barre des taches\" /> est rouge</h2>\n<p>\nSi l'ic&ocirc;ne est encadr&eacute;e de rouge (carte non lue), assurez-vous que votre carte est bien ins&eacute;r&eacute;e dans votre lecteur, rafra&icirc;chissez le lecteur en cliquant sur l'ic&ocirc;ne avec le bouton droit de la souris. Et cliquez sur &laquo;Rafra&icirc;chir&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/rightClickCCM.png\" alt=\"Cliquer droit sur l'icone du CCM\" /></div>\n<br/>\nSi l'encadr&eacute; reste rouge apr&egrave;s la manipulation, red&eacute;marrez votre ordinateur en laissant le lecteur et la CPS connect&eacute;s.<br/>\n<br/>\nApr&egrave;s ces manipulations, si l'ic&ocirc;ne ne passe pas au vert, veuillez nous contacter.\n</p>\n<div align=\"center\"></div>\n</div>\n\n</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"startDiag\" onclick=\"wizardStateMachine.wizard('startDiag');\">Diagnostiquer mon poste</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"notSupported\">\n\t\t\t<div class=\"instruction\">Votre configuration mat&eacute;riel et/ou syst&egrave;me n'est pas support&eacute;e par nos composants logiciels. Nous ne garantissons pas le succès du diagnostic.</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"notSupported\" onclick=\"wizardStateMachine.wizard('preAlert');\">Continuer</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"manualInstallXPI\">\n\t\t\t<div class=\"instruction\" id=\"xpi_instruction\" >L'Extension Firefox n'a pas &eacute;t&eacute; d&eacute;tect&eacute;e. Elle est indispensable sous ce navigateur.<br/>Apr&egrave;s l'installation, veuillez red&eacute;marrer votre navigateur.</div>\n\t\t\t<div class=\"actions\">\n<!--\t\t\t\t<div class=\"action instruction\" id=\"xpi\" onclick=\"wizardStateMachine.wizard('XPI',{URL:'https://diagcps.eservices.esante.gouv.fr/ODI_PS/php/download_asip.php?installeur=url_interne_xpi_installation_pkcs11',IconURL:'https://diagcps.eservices.esante.gouv.fr/ODI_PS/images/asip_sante.png',Hash:'sha256:c23de3812aaf7c3a81d80e9bdf891c3e2b621e01e55e8d308226fd86ab6ef438'});\">Installer<br/>l'Extension Firefox</div>-->\n<div class=\"action instruction\" id=\"xpi\" onclick=\"wizardStateMachine.wizard('XPI',{URL:'/download.php?component=xpi',IconURL:'/images/asip_sante.png',Hash:'sha256:c23de3812aaf7c3a81d80e9bdf891c3e2b621e01e55e8d308226fd86ab6ef438'});\">Installer<br/>l'Extension Firefox</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"restartAlertXPI\">\n\t\t\t<div class=\"instruction\" id=\"restartInstructionXPI\" >Une fois l'installation de l'Extension Cryptolib CPS termin&eacute;e,<br/>veuillez red&eacute;marrer votre navigateur.</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"manualInstallClibCPS\">\n\t\t\t<div class=\"instruction\">Si vous avez ins&eacute;r&eacute; votre CPS dans votre lecteur sans succ&egrave;s, la version de Cryptolib CPS de votre poste de travail n'est peut-&ecirc;tre pas &agrave; jour.</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"cryptolib\" onclick=\"wizardStateMachine.wizard('CryptolibCPS');\">T&eacute;l&eacute;charger<br/>Cryptolib CPS</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"restartAlert\">\n\t\t\t<div class=\"instruction\" id=\"restartInstruction\" >Une fois l'installation de CryptolibCPS_vX.Y.Z termin&eacute;e, veuillez red&eacute;marrer votre navigateur.</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"contactSupport\">\n\t\t\t<div class=\"instruction\">Si vous avez installez le composant propos&eacute; sans succ&eacute;s,<br/> veuillez contacter le Support.</div>\n\t\t</div>\n\t\t\n\t</div>\n</div>\t\n<div id=\"service-direction\" class=\"column\"></div>\n<div id=\"article\">\n\t<div id=\"center\">\n\t\t<div class=\"diagState\" id=\"diagState\"></div>\n\t\t<div>\n\t\t\t<div id=\"cps\" class=\"cpsverso\" onclick=\"wizardStateMachine.wizard('restartDiag');\"><div id=\"spin\"><div id=\"retry\"></div></div></div>\n\t\t</div>\n<!--\t\t\n\t\t<div id=\"results\">\n\t\t\t<div>\n\t\t\t\t<div class=\"sign\" id=\"certificat\"></div>\n\t\t\t\t<div class=\"sign\" id=\"expired\" title=\"expire\"></div>\n\t\t\t\t<div class=\"sign\" id=\"revoc\" title=\"revoque\"></div>\n\t\t\t\t<div class=\"sign\" id=\"class\"></div>\n\t\t\t\t<div class=\"sign\" id=\"rootAC\"></div>\n\t\t\t\t<div class=\"sign\" id=\"cryptolib\" title=\"cryptolib\"></div>\n\t\t\t</div>\n\t\t</div>\n-->\n\t\t<div id=\"cps_infos\">\n\t\t\t<div id=\"infos_cps\">\n\t\t\t\t<div id=\"infos_cps_caption\"><div>Informations d&eacute;taill&eacute;es</div><div class=\"infos_cps_caption_img_expand\" id=\"infos_cps_caption_img\"></div></div>\n\t\t\t\t<table id=\"infos_cps_table\">\n\t\t\t\t\t<tbody id=\"infos_cps_tbody\"></tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n<div id=\"support-direction\" class=\"column\"></div>\n</div>\r\n<div id=\"footer\" style=\"display:flex;flex-direction:row\">\r\n    <div style=\"display:flex;flex-direction:row;width:30vw\">\r\n        <div style=\"margin:20px\">\r\n            <a href=\"https://solidarites-sante.gouv.fr/\" target=\"_blank\">\r\n                <img src=\"./images/logo-ministere.svg\" alt=\"Ministère des Solidarités et de la santé\" width=\"84\" height=\"62\">\r\n            </a>\r\n        </div>\r\n        <div style=\"margin:20px\">\r\n            <a href=\"https://esante.gouv.fr/\" target=\"_blank\">\r\n                <img src=\"./images/logo-ANS.svg\" alt=\"Agence du Numérique en Santé\" width=\"166\" height=\"50\">\r\n            </a>\r\n        </div>\r\n    </div>\r\n    <div style=\"width:60vw\">\r\n        <ul style=\"align-items:end\">\r\n            <li><a href=\"http://esante.gouv.fr/services/mentions-legales\" target=\"_blank\">Mentions l&eacute;gales</a></li>\r\n            <li><a href=\"./copyright.php\" target=\"_blank\" title=\"Copyright [nouvelle fen&ecirc;tre]\">Copyright</a></li>\r\n        </ul>\r\n    </div>\r\n</div>\r\n\r\n</body>\r\n</html>\r\n",
      "ip": "135.125.232.117",
      "timestamp": "2025-03-14T16:25:23.995660043Z",
      "curl-command": "curl -X 'GET' -H 'Accept: */*' -H 'Accept-Language: en' -H 'User-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)' 'https://diagcps.eservices.esante.gouv.fr'",
      "matcher-status": true
    },
    {
      "template": "http/technologies/tech-detect.yaml",
      "template-url": "https://templates.nuclei.sh/public/tech-detect",
      "template-id": "tech-detect",
      "template-path": "/home/runner/nuclei-templates/http/technologies/tech-detect.yaml",
      "info": {
        "name": "Wappalyzer Technology Detection",
        "author": [
          "hakluke",
          "righettod"
        ],
        "tags": [
          "tech"
        ],
        "severity": "info",
        "metadata": {
          "max-request": 1
        }
      },
      "matcher-name": "php",
      "type": "http",
      "host": "https://diagcps.eservices.esante.gouv.fr",
      "matched-at": "https://diagcps.eservices.esante.gouv.fr",
      "request": "GET / HTTP/1.1\r\nHost: diagcps.eservices.esante.gouv.fr\r\nUser-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)\r\nConnection: close\r\nAccept: */*\r\nAccept-Language: en\r\nAccept-Encoding: gzip\r\n\r\n",
      "response": "HTTP/1.1 200 OK\r\nConnection: close\r\nTransfer-Encoding: chunked\r\nContent-Type: text/html; charset=UTF-8\r\nDate: Fri, 14 Mar 2025 16:26:03 GMT\r\nServer: Apache/2.4.37 (centos) OpenSSL/1.1.1g\r\nX-Powered-By: PHP/7.2.24\r\n\r\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n\t<title>DiagCPS, Outil de Diagnostic SSL</title>\r\n\t<meta http-equiv=\"Content-type\" content=\"text/html; charset=UTF-8\" />\r\n\t<meta name=\"description\" content=\"DiagCPS est un Outil de Diagnostic de l'authentification en ligne à l'aide d'une Carte de Professionnel de Santé, i.e. CPS. Il est fourni par l'ASIP Santé et remplace ODI.\" />\r\n\t<meta name=\"Publisher\" content=\"ASIP Santé\" />\r\n\t<meta name=\"copyright\" content=\"Tous droits réservés - ASIP Santé\" />\r\n\t<link rel=\"shortcut icon\" href=\"./images/favicon.ico\" type=\"image/x-icon\" />\r\n\t<link rel=\"stylesheet\" href=\"diagcps_css.php\" />\r\n\t<script src=\"./js/jquery-3.2.0.min.js\"></script>\r\n\t<script src=\"./js/ua-parser.min.js\"></script>\r\n</head>\r\n<body>\r\n<div id=\"header\" style=\"display:flex;flex-direction:row\">\r\n    <div style=\"margin:20px\">\r\n        <a href=\"https://solidarites-sante.gouv.fr/\" target=\"_blank\">\r\n            <img src=\"./images/logo-ministere.svg\" alt=\"Ministère des Solidarités et de la santé\" width=\"168\" height=\"104\">\r\n        </a>\r\n    </div>\r\n\t<div id=\"title\">esante.gouv.fr</div>\r\n</div>\r\n<div id=\"section\">\r\n<script type=\"text/javascript\">\n\n<!-- script : /js/wizarddiagcps.js Begin -->\n//==================================\r\n// Global variable used for state machine management \r\n// displayed on screen \r\n// or used by state machine\r\n//==================================\r\nvar wizardStateMachine = {\r\n\tstartState: 'notSupported',\r\n\tlastState: 'notSupported',\r\n\t\r\n\t//=================\r\n\t// Retry Management\r\n\t// Variables\r\n\tnbMaxRetry: 10,\r\n\tnbRetry: 0,\r\n\t\r\n\t// Management\r\n\tinitRetry: function() {this.nbRetry = this.nbMaxRetry;},\r\n\tisMaxRetry: function() {return (this.nbRetry >= this.nbMaxRetry);},\r\n\tisMinRetry: function() {return (this.nbRetry <= 0);},\r\n\tdecRetry: function() {this.nbRetry--;},\r\n\tdisplayRetry: function() {\r\n\t\t\t\t\t\t\t\t//console.log(\"displayRetry : nbRetry = \" + this.nbRetry);\r\n\t\t\t\t\t\t\t\tthis.decRetry();\r\n\t\t\t\t\t\t\t\tthis.stopTimers(); \r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.isMinRetry()\r\n\t\t\t\t\t\t\t\t\t&& \t(this.lastState != 'endDiagWithSuccess')) {\r\n\t\t\t\t\t\t\t\t\tthis.wizard('manualInstallClibCPS');\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tthis.displayWait(true);\r\n\t\t\t\t\t\t\t\t\tthis.startTimers();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\r\n\t//==================\r\n\t// Timers Management\r\n\ttimerTestSSL: null,\r\n\tretryTimeoutKO: 1000,\r\n\tinitTimer: function () {this.retryTimeoutKO = 1000;},\r\n\taccelerateTimer: function () {this.retryTimeoutKO = 250;},\r\n\tstopTimers: function() {\r\n\t\t\t\t\t\t\t\tif (this.timerTestSSL != null)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tclearTimeout(this.timerTestSSL);\r\n\t\t\t\t\t\t\t\t\tthis.timerTestSSL = null;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\tstartTimers: function() {this.timerTestSSL = setTimeout(function(){wizardStateMachine.displayRetry()}, this.retryTimeoutKO);},\r\n\t\r\n\t//=======\r\n\t// Wizard\r\n\tstartWizard: function() {this.wizard(this.startState);},\r\n\twizard: function(step, param) {\r\n\t\t\t\tconsole.log(\"wizard : step = \" + step + \", param = \" + param);\r\n\t\t\t\t\t\r\n\t\t\t\tswitch (step)\r\n\t\t\t\t{\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Pre treatment\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'notSupported':\r\n\t\t\t\t\tcase 'preAlert':\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'start');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif ((dataIHM.getUAInfos().configSupported) || (step == 'preAlert')) this.displayInstruction(true, 'preAlert');\r\n\t\t\t\t\t\telse this.displayInstruction(true, 'notSupported');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Manual Installation XPI\r\n\t\t\t\t\t// Suggestion of installation\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'manualInstallXPI':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'KO');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'manualInstallXPI');\r\n\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// XPI Installation\r\n\t\t\t\t\t// Installation process\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'XPI':\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'restartAlertXPI');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar params = {\r\n\t\t\t\t\t\t\t\t\"Installer l'Extension Cryptolib CPS\": \r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tURL: param.URL,\r\n\t\t\t\t\t\t\t\t\tIconURL: param.IconURL,\r\n\t\t\t\t\t\t\t\t\tHash: param.Hash,\r\n\t\t\t\t\t\t\t\t\ttoString: function () { return this.URL; }\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t};\r\nconsole.log(params);\r\n\t\t\t\t\t\tInstallTrigger.install(params);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// Diagnostic\r\n\t\t\t\t\t// Start\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'startDiag':\r\n\t\t\t\t\t\tthis.initRetry();\r\n\t\t\t\t\t\tthis.initTimer();\r\n\r\n\t\t\t\t\t\tthis.displayWait(true);\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'inProgress');\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tdataIHM.readClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.startTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// Diagnostic\r\n\t\t\t\t\t// Restart\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'restartDiag':\r\n\r\n\t\t\t\t\t\tdataIHM.resetClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\r\n\t\t\t\t\t//==========================\r\n\t\t\t\t\t// Progression\r\n\t\t\t\t\t//--------------------------\r\n\t\t\t\t\tcase 'inProgress':\r\n\t\t\t\t\t\t//dataIHM.readClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// this.displayDiagnosticState(true, 'inProgress');\r\n\t\t\t\t\t\t// this.displayInstruction(false);\r\n\t\t\t\t\t\t// this.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//===================\r\n\t\t\t\t\t// Ends\r\n\t\t\t\t\t//-------------------\r\n\t\t\t\t\tcase 'endDiagWithSuccess':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'OK');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tthis.displaySupport(false);\r\n\t\t\t\t\t\tthis.displayInfosCPS(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Manual Installation Cryptolib CPS\r\n\t\t\t\t\t// Suggestion of installation\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'manualInstallClibCPS':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'KO');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'manualInstallClibCPS');\r\n\t\t\t\t\t\tthis.displaySupport(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//=======================\r\n\t\t\t\t\t// Cryptolib CPS download\r\n\t\t\t\t\t// Installation process\r\n\t\t\t\t\t//-----------------------\r\n\t\t\t\t\tcase 'CryptolibCPS':\r\n\t\t\t\t\t\twindow.location = dataIHM.getServerComponentLink();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// Direct jump to Retry after installation\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'restartAlert');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\t\r\n\t\t\t\t\t//=========================\r\n\t\t\t\t\t// Other\r\n\t\t\t\t\t// Close Instruction screen\r\n\t\t\t\t\t//-------------------------\r\n\t\t\t\t\tcase 'exitInstruction':\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true);\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t// Open Support link\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'openSupport':\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tif (param !== undefined) window.open(param.URL,'_blank');\r\n\t\t\t\t\t\tbreak;\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.lastState = step;\r\n\t\t\t},\r\n\t\r\n\t//==========================\r\n\t// Screen Display Management\r\n\tdisplayElementById: function(id, display) {\r\n\t\t\t\t\t\t\tdocument.getElementById(id).style.display = display;\r\n\t\t\t\t\t\t},\r\n\thideElementById: function(id) {\r\n\t\t\t\t\t\t\tthis.displayElementById(id, \"none\");\r\n\t\t\t\t\t\t},\r\n\tdisplayInit: function(OSName) {\r\n\t\t\t\t\t\t// Events initialization\r\n\t\t\t\t\t\t//----------------------\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"cryptolib\", \t\t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"notSupported\", \t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"startDiag\", \t\t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"instructions-back\", \t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"infos_cps_caption\", \t\"click\", clickExpandCollapse);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// PreAlert initialization\r\n\t\t\t\t\t\t//------------------------\r\n\t\t\t\t\t\tthis.displayPreAlert(OSName);\r\n\t\t\t\t\t},\r\n\tdisplayInfosCPS: function (active) {\r\n\t\t\t\t\t\t\tvar infos_cps_tbody = '';\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar detailedInformations = dataIHM.getClientDetailedInfos();\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tfor (var item in detailedInformations) {\r\n\t\t\t\t\t\t\t\tinfos_cps_tbody += '<tr><td class=\"key\">' + item + '</td><td class=\"val\">' + detailedInformations[item] + '</td></tr>';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cps').className = dataIHM.getClientSSLInfos().div_cps_class;\r\n\r\n\t\t\t\t\t\t\t\tfor (var item in dataIHM.getClientSSLInfos().infos) {\r\n\t\t\t\t\t\t\t\t\tinfos_cps_tbody += '<tr><td class=\"key\">' + item + '</td><td class=\"val\">' + dataIHM.getClientSSLInfos().infos[item] + '</td></tr>';\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cps').className = \"cpsverso\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tdocument.getElementById('infos_cps_tbody').innerHTML = infos_cps_tbody;\r\n\t\t\t\t\t\t},\r\n\r\n\tdisplayWait:function (active) {\r\n\t\t\t\t\tif ( (active)\r\n\t\t\t\t\t\t&& (wizardStateMachine.nbRetry > 0) ) {\r\n\t\t\t\t\t\tthis.displayElementById('spin', \"flex\");\r\n\t\t\t\t\t\tdocument.getElementById('retry').innerHTML = wizardStateMachine.nbRetry;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.hideElementById('spin');\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\tdisplayDiagnosticState:function (active, state) {\r\n\t\t\t\t\t\t\t\tdiagStateContent = {\r\n\t\t\t\t\t\t\t\t\t'start':{content:'Cliquer sur la carte', style:'diagState diagStart'}\r\n\t\t\t\t\t\t\t\t\t, 'inProgress':{content:'Le diagnostic est en cours', style:'diagState diagInProgress'}\r\n\t\t\t\t\t\t\t\t\t, 'KO':{content:'Le diagnostic a &eacute;chou&eacute;', style:'diagState diagKO'}\r\n\t\t\t\t\t\t\t\t\t, 'OK':{content:'Le diagnostic a r&eacute;ussi', style:'diagState diagOK'}\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.hideElementById('diagState');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').style.display = \"block\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif (state !== undefined) {\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').className = diagStateContent[state].style;\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').innerHTML = diagStateContent[state].content;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\r\n\tdisplayInstruction: function (active, step) {\r\n\t\t\t\t\t\t\tthis.hideElementById('instructions-back');\r\n\t\t\t\t\t\t\tthis.hideElementById('instructions');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\tthis.displayElementById('instructions-back', \"flex\");\r\n\t\t\t\t\t\t\t\tthis.displayElementById('instructions', \"block\");\r\n\t\t\t\t\t\t\t\tthis.hideElementById('manualInstallClibCPS');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('manualInstallXPI');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('restartAlert');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('restartAlertXPI');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('preAlert');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('notSupported');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('contactSupport');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (step !== undefined) this.displayElementById(step, \"block\");\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar detailedInformations = dataIHM.getClientDetailedInfos();\r\n\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cryptolib').innerHTML = \"T&eacute;l&eacute;charger<br/>\" + dataIHM.getComponentInstallerName();\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (dataIHM.getUAInfos().os.name == 'Mac OS')\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('restartInstruction').innerHTML = \"Une fois l'installation de \" + dataIHM.getComponentInstallerName() + \" termin&eacute;e,<br/>veuillez red&eacute;marrer votre ordinateur.\";\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('restartInstruction').innerHTML = \"Une fois l'installation de \" + dataIHM.getComponentInstallerName() + \" termin&eacute;e,<br/>veuillez red&eacute;marrer votre navigateur.\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\r\n\tdisplaySupport: function (active) {\r\n\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\tthis.displayElementById('support-direction', \"flex\");\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.hideElementById('support-direction');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\r\n\tdisplayPreAlert: function(OSName) {\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-MacOS');\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-Windows');\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-Linux');\r\n\r\n\t\t\t\t\t\t\tif (OSName == 'Mac OS') this.displayElementById('alert1-MacOS', 'block');\r\n\t\t\t\t\t\t\tif (OSName == 'Windows') this.displayElementById('alert1-Windows', 'block');\r\n\t\t\t\t\t\t\tif (OSName == 'Linux') this.displayElementById('alert1-Linux', 'block');\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\r\n};\r\n\r\n//==================\r\n// Events Management\r\nfunction addEltEventListenerAllBrowser(elt, eventName, handle) {\r\n\tif (elt.addEventListener) { elt.addEventListener(eventName, handle, false);\r\n\t} else { elt.attachEvent(\"on\" + eventName, handle);\r\n\t}\r\n}\r\n\r\nfunction addIdEventListenerAllBrowser(id, eventName, handle) {\r\n\tif (document.getElementById(id)) addEltEventListenerAllBrowser(document.getElementById(id), eventName, handle);\r\n}\r\n\r\nfunction clickExpandCollapse(event) {\r\n\tif (document.getElementById('infos_cps_table').style.display != \"block\") {\r\n\t\tdocument.getElementById('infos_cps_caption_img').className = \"infos_cps_caption_img_collapse\";\r\n\t\tdocument.getElementById('infos_cps_table').style.display = \"block\";\r\n\t} else {\r\n\t\tdocument.getElementById('infos_cps_caption_img').className = \"infos_cps_caption_img_expand\";\r\n\t\tdocument.getElementById('infos_cps_table').style.display = \"none\";\r\n\t}\r\n\tevent.cancelBubble = true;\r\n\t\t\r\n\treturn false;\r\n}\r\n\r\nfunction clickActionNoPropagation(event) {\r\n\t//this.click();\r\n\r\n\tevent.cancelBubble = true;\r\n\r\n\treturn false;\r\n}\r\n\n<!-- script : /js/wizarddiagcps.js End -->\n<!-- script : /js/diagcps.js Begin -->\n//==================================\r\n// Global variable used for all data \r\n// displayed on screen \r\n// or used by state machine\r\n//==================================\r\nvar dataIHM = {\r\n\t//==========================\r\n\t// Root URL\r\n\tlocalURL: '',\r\n\tsetLocalURL: function(URL) {this.localURL = URL;},\r\n\tgetLocalURL: function() {return this.localURL;},\r\n\t\r\n\t//==========================\r\n\t// User Agent\r\n\tclientUAInfos: null,\r\n\ttimerUAInfos: null,\r\n\tinitUAInfos: function() {\r\n\t\t\t\t\t\tvar uaparser = new UAParser();\r\n\t\t\t\t\t\tthis.clientUAInfos = uaparser.getResult();\r\n\t\t\t\t\t\tthis.clientUAInfos.browser.xpi = true;\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tthis.timerUAInfos = setTimeout(function(){dataIHM.isUAInfosCPSWebEx()}, 1000);\r\n\t\t\t\t\t},\r\n\tgetUAInfos: function() {return this.clientUAInfos},\r\n\tisUAInfosCPSWebEx: function() {\r\n\t\t\t\t\tif (window.isCpsWebExAlive) {\r\n\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', window.isCpsWebExAlive());\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (this.getUAInfos().browser.name == 'Firefox') {\r\n\t\t\t\t\t\t\tif (this.getUAInfos().browser.major > 57) {\r\n\t\t\t\t\t\t\t\tthis.clientUAInfos.browser.xpi = false;\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'absente');\r\n\t\t\t\t\t\t\t\twizardStateMachine.wizard('manualInstallXPI');\r\n\t\t\t\t\t\t\t} else if (this.getUAInfos().browser.major == 57) {\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'sur cette version, l\\'installation du p&eacute;riph&eacute;rique de s&eacute;curit&eacute; doit &ecirc;tre <a href=\"http://integrateurs-cps.asipsante.fr/Installation-manuelle-PKCS11-Firefox\" target=\"_blanck\">r&eacute;alis&eacute;e manuellement</a>.');\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'd&eacute;tection impossible sur cette version');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.timerUAInfos = null;\r\n\t\t\t\t},\r\n\t\r\n\t//===============================\r\n\t// Installed Component management\r\n\tcomponentName: \"CryptolibCPS\", // By default\r\n\tsetComponentName: function(name) {this.componentName = name;},\r\n\tgetComponentName: function() {return this.componentName;},\r\n\tcomponentVersion: \"\", // By Default\r\n\tsetcomponentVersion: function(version) {this.componentVersion = version;},\r\n\tgetcomponentVersion: function() {return this.componentVersion;},\r\n\tcomponentInstallerName: \"\",\r\n\tsetComponentInstallerName: function(name) {this.componentInstallerName = name;},\r\n\tgetComponentInstallerName: function() {return this.componentInstallerName;},\r\n\tserverComponentURL: null,\r\n\tsetServerComponentURL: function(URL) {this.serverComponentURL = URL;},\r\n\tgetServerComponentLink: function(version) {\r\n\t\t\t\t\t\t\t\t\tvar componentLink = this.serverComponentURL + \"?\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"component=\" + this.getComponentName();\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&os=\" + this.getUAInfos().os.name;\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&arch=\" + this.getUAInfos().cpu.architecture;\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&version=\" + this.getcomponentVersion();\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\treturn componentLink;\r\n\t\t\t\t\t\t\t\t},\r\n\tserverComponentInfos: null,\r\n\treadServerComponentInfos: function() {\r\n\t\t\t\t\t\t\t\t// XPI 6.0.15 with Firefox < 57\r\n\t\t\t\t\t\t\t\t// ==> Use Cryptolib CPS 5.0.37 instead of last release\r\n\t\t\t\t\t\t\t\tif ((this.getUAInfos().browser.name == 'Firefox') \r\n\t\t\t\t\t\t\t\t\t&& (this.getUAInfos().browser.major < 57)) {\r\n\t\t\t\t\t\t\t\t\tswitch (this.getUAInfos().os.name) {\r\n\t\t\t\t\t\t\t\t\t\tcase 'Windows': this.setcomponentVersion('5.0.37');break;\r\n\t\t\t\t\t\t\t\t\t\tcase 'Mac OS': this.setcomponentVersion('5.0.34');break;\r\n\t\t\t\t\t\t\t\t\t\tcase 'Linux':\r\n\t\t\t\t\t\t\t\t\t\tcase 'CentOS':\r\n\t\t\t\t\t\t\t\t\t\tcase 'Ubuntu':\r\n\t\t\t\t\t\t\t\t\t\tcase 'RedHat':  this.setcomponentVersion('5.0.12');break;\r\n\t\t\t\t\t\t\t\t\t\tdefault:break;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// Use fetch if exist\r\n\t\t\t\t\t\t\t\tif (self.fetch) {\r\n\t\t\t\t\t\t\t\t\tfetch( this.getServerComponentLink() + '&filename=get' )\r\n\t\t\t\t\t\t\t\t\t.then(function(resp) {return resp.json();})\r\n\t\t\t\t\t\t\t\t\t.then(function(response) {\r\n\t\t\t\t\t\t\t\t\t\tfor (var k in response) {\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.setComponentInstallerName(response[k]);\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.addClientDetailedInfos('URL de t&eacute;l&eacute;chargement', '<a href=\"' + dataIHM.getServerComponentLink() + '\">' + dataIHM.getComponentInstallerName() + '</a>');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('readServerComponentInfos : Error with fetch (' + error.message + ')'); \r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t// Use JQuery\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$.ajax(\t{\r\n\t\t\t\t\t\t\t\t\t\turl: this.getServerComponentLink() + '&filename=get'\r\n\t\t\t\t\t\t\t\t\t\t, success: function( data) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar json;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (data === String)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson = jQuery.parseJSON(data);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson = data\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor (var k in json) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setComponentInstallerName(json[k]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.addClientDetailedInfos('URL de t&eacute;l&eacute;chargement', '<a href=\"' + dataIHM.getServerComponentLink() + '\">' + dataIHM.getComponentInstallerName() + '</a>');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t, error: function( data) { return null;}\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\r\n\t//========================================\r\n\t// Support contact informations management\r\n \tmailSupportMailbox: null,\r\n\tmailSupportDomain: null,\r\n\tsetMailSupport: function(mailbox, domain) {this.mailSupportMailbox = mailbox; this.mailSupportDomain = domain;},\r\n\tgetMailSupport: function() {return this.mailSupportMailbox + \"@\" + this.mailSupportDomain;},\r\n \t\t\r\n\t//==========================\r\n\t// Detailed informations\r\n\tclientDetailedInfos: {},\r\n\tinitClientDetailedInfos: function() {\r\n\t\t\t\t\t\t\t\tconfigSupported = true;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.getUAInfos().device.type === undefined) {\r\n\t\t\t\t\t\t\t\t\tconsole.log(\"Poste de travail\");\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tconfigSupported = false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().os.name) {\r\n\t\t\t\t\t\t\t\t\tcase 'Windows':\r\n\t\t\t\t\t\t\t\t\tcase 'Mac OS':\r\n\t\t\t\t\t\t\t\t\tcase 'Linux':\r\n\t\t\t\t\t\t\t\t\tcase 'CentOS':\r\n\t\t\t\t\t\t\t\t\tcase 'Ubuntu':\r\n\t\t\t\t\t\t\t\t\tcase 'RedHat':  configSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault: \t\tconfigSupported = configSupported & false;break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().browser.name) {\r\n\t\t\t\t\t\t\t\t\tcase 'IE':\r\n\t\t\t\t\t\t\t\t\tcase 'Safari':\r\n\t\t\t\t\t\t\t\t\tcase 'Edge':\r\n\t\t\t\t\t\t\t\t\tcase 'Chrome':\r\n\t\t\t\t\t\t\t\t\tcase 'Firefox':\tconfigSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault: \t\tconfigSupported = configSupported & false;break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().cpu.architecture) {\r\n\t\t\t\t\t\t\t\t\tcase 'ia32':\r\n\t\t\t\t\t\t\t\t\tcase 'i686':\r\n\t\t\t\t\t\t\t\t\tcase 'amd64': configSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\t\tif (this.getUAInfos().cpu.architecture === undefined)\r\n\t\t\t\t\t\t\t\t\t\t\tconfigSupported = configSupported & true;\r\n\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\tconfigSupported = configSupported & false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.getUAInfos().cpu.architecture == 'amd64')\r\n\t\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Syst&egrave;me d\\'exploitation', this.getUAInfos().os.name + \" \" + this.getUAInfos().os.version + \" (64b)\");\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Syst&egrave;me d\\'exploitation', this.getUAInfos().os.name + \" \" + this.getUAInfos().os.version);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Navigateur', this.getUAInfos().browser.name + \" \" + this.getUAInfos().browser.major);\r\n\t\t\t\t\t\t\t\t// this.addClientDetailedInfos('Compatibilit&eacute; ASIP', '<a href=\"http://integrateurs-cps.asipsante.fr/Lettre_d_information\" target=\"_blanck\">Lettre d\\'information<br/>POSTE DE TRAVAIL & Veille Technologique</a>');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.clientUAInfos.configSupported = configSupported;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\treturn configSupported;\r\n\t\t\t\t\t\t\t},\r\n\tgetClientDetailedInfos: function() {return this.clientDetailedInfos;},\r\n\taddClientDetailedInfos: function(key, value) { this.clientDetailedInfos[key] = value;},\r\n\tresetClientDetailedInfos: function() {this.clientDetailedInfos = {};},\r\n\t\t\r\n\t//==========================\r\n\t// Client SSL Informations\r\n\tclientSSLInfos: null,\r\n\tclientSSLFetchParameters: { mode:'cors', credentials: 'include', cache: 'no-cache'},\r\n\tclientSSLAjaxParameters: { cache: false, timeout: 8000, async: true},\r\n\tisDefineClientSSLInfos: function() {return (this.clientSSLInfos != undefined);},\r\n\tsetClientSSLInfos: function(data) {this.clientSSLInfos = data;},\r\n\tgetClientSSLInfos: function() {return this.clientSSLInfos;},\r\n\tinitClientSSLParameters: function() { $.ajaxSetup(this.clientSSLAjaxParameters);},\r\n\tresetClientSSLInfos: function () {\r\n\t\t\t\t\t\t\tconsole.log('resetClientSSLInfos : Erase SSL Connexion cache for ' + this.getUAInfos().browser.name);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tswitch (this.getUAInfos().browser.name) {\r\n\t\t\t\t\t\t\t\tcase 'Edge': // Works !\r\n\t\t\t\t\t\t\t\tcase 'IE': // Works !\r\n\t\t\t\t\t\t\t\t\tif (document.execCommand) document.execCommand( \"ClearAuthenticationCache\", \"false\");\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 'Firefox':\t// Works !\r\n\t\t\t\t\t\t\t\t\t//location.reload(); // Works !\r\n\t\t\t\t\t\t\t\t\tif (window.crypto) if (window.crypto.logout) window.crypto.logout(); // Works !\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 'Chrome': // Works !\r\n\t\t\t\t\t\t\t\tcase 'Safari': // Not working, restart Browser needed !\r\n\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag'); \r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\treadClientSSLInfos: function() {\r\n\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : SSL Connexion' );\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// Use fetch if exist\r\n\t\t\t\t\t\t\tif (self.fetch) {\r\n\t\t\t\t\t\t\t\t// Try to connect and get CPS informations\r\n\t\t\t\t\t\t\t\tfetch( '/visuel.php', this.clientSSLFetchParameters )\r\n\t\t\t\t\t\t\t\t.then(function(resp) {return resp.json();})\r\n\t\t\t\t\t\t\t\t.then(function(resp_json) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Success with Fetch');\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t// traitement du JSON\r\n\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(resp_json);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('endDiagWithSuccess');\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t// Case of SSL Error\r\n\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Probably SSL Error with fetch (' + error.message + ')');\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(null);\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.accelerateTimer();\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t// Use JQuery\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$.ajax(\t{\r\n\t\t\t\t\t\t\t\t\turl: 'visuel.php'\r\n\t\t\t\t\t\t\t\t\t, success: function(data, textStatus) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Success with Ajax (' + textStatus + ')');\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tif (data === String)\r\n\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(jQuery.parseJSON(data));\r\n\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(data);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('endDiagWithSuccess');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t, error: function(data, textStatus) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Probably SSL Error with Ajax (' + textStatus + ')');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(null);\r\n\t\t\t\t\t\t\t\t\t\t\twizardStateMachine.accelerateTimer();\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n}\r\n\r\n//=====\r\n// Main\r\n//=====\r\n$(function() {\r\n\t// Initialization\r\n\t//---------------\r\n\tdataIHM.initUAInfos(); // User Agent\r\n\t\r\n\tdataIHM.initClientSSLParameters();\r\n\t\r\n\t// Sp�cific parameter with no good solution @29/12/2017\r\n\tswitch (dataIHM.getUAInfos().browser.name) {\r\n\t\tcase 'IE':\r\n\t\t\tconsole.log('=========== Use Ajax =============');\r\n\t\t\tself.fetch = undefined;\r\n\t\t\tbreak;\r\n\t\tcase 'Edge':\r\n\t\tcase 'Firefox':\r\n\t\tcase 'Safari':\r\n\t\tdefault:\r\n\t\t\tconsole.log('=========== Try using fetch. If not available use Ajax =============');\r\n\t\t\tbreak;\r\n\t}\r\n\t\r\n\tdataIHM.initClientDetailedInfos(); // Informations in bottom\r\n\tdataIHM.readServerComponentInfos(); // Get from informations from Web Service\r\n\t\r\n\twizardStateMachine.startWizard(); // Start Wizard\r\n\t\t\r\n\twizardStateMachine.displayInit(dataIHM.getUAInfos().os.name);\r\n});\r\n\n<!-- script : /js/diagcps.js End -->\n\n</script>\n<script type=\"text/javascript\">\n\t// Initialization Javascript from PHP\n\tdataIHM.setComponentName('CryptolibCPS');\n\tdataIHM.setServerComponentURL('download.php');\n</script>\n<!--<div id=\"beta\"></div>-->\n<div id=\"instructions-back\" onclick=\"wizardStateMachine.wizard('exitInstruction');\">\n\t<div id=\"instructions\">\n\t\n\t\t<div class=\"screen\" id=\"preAlert\">\n\t\t\t<div class=\"instruction\"><br/>\n<h1>Assistance en cas de carte CPS non lue</h1>\n\n<h2>Pr&eacute;alablement</h2>\n<p>\nVeuillez v&eacute;rifier que votre carte est bien ins&eacute;r&eacute;e dans votre lecteur de carte ou votre terminal Vitale.<br/>\nPuis v&eacute;rifier que votre lecteur de carte ou votre terminal Vitale est correctement connect&eacute; &agrave; votre ordinateur.<br/>\n<br/>\nLa carte ins&eacute;r&eacute;e dans le lecteur doit &ecirc;tre la derni&egrave;re carte active.\n\n<table >\n\t<tr>\n\t\t<td style=\"border-top:none;\"><img src=\"images/informations32.png\" alt=\"Information :\"/></td>\n\t\t<td style=\"border-top:none;\"><i>La derni&egrave;re carte active pr&eacute;sente la date d'expiration la plus &eacute;loign&eacute;e.</i></td>\n\t</tr>\n</table>\n<br/>\nUne fois cette v&eacute;rification r&eacute;alis&eacute;e, v&eacute;rifiez que la carte est bien lue.<br/>\n</p>\n\n<div id=\"alert1-MacOS\">\n<h2>Votre ordinateur est sous Mac OS</h2>\n<p>\nSur votre syst&egrave;me d'exploitation, nous ne disposons pas de m&eacute;thode particuli&egrave;re pour v&eacute;rifier si votre carte est lue.<br/>\n<br/>\nVeuillez lancer un diagnostic de votre ordinateur et proc&eacute;der &agrave; l'installation des mises &agrave; jour sugg&eacute;r&eacute;es.<br/>\n</p>\n</div>\n\n<div id=\"alert1-Linux\">\n<h2>Votre ordinateur est sous Linux</h2>\n<p>\nSur votre syst&egrave;me d'exploitation, nous ne disposons pas de m&eacute;thode particuli&egrave;re pour v&eacute;rifier si votre carte est lue.<br/>\n<br/>\nVeuillez lancer un diagnostic de votre ordinateur et proc&eacute;der &agrave; l'installation des mises &agrave; jour sugg&eacute;r&eacute;es.<br/>\n</p>\n</div>\n\n<div id=\"alert1-Windows\">\n<h2>Votre ordinateur est sous Windows</h2>\n<b>Dans la barre des t&acirc;ches, une carte lue est signal&eacute;e par <img src=\"images/preHelper/iconeOK.png\" alt=\"Icone vert dans la barre des taches\" /> et une carte non lue par <img src=\"images/preHelper/iconeKO.png\" alt=\"Icone rouge dans la barre des taches\"/>.</b><br/>\n<h3>L'ic&ocirc;ne <img src=\"images/preHelper/iconeOK.png\" alt=\"Icone vert dans la barre des taches\"/> est introuvable</h3>\n<p>\nCliquez avec le clic droit de votre souris sur le bouton &laquo;Afficher les ic&ocirc;nes&raquo; (en bas &agrave; droite de votre &eacute;cran) ou sur la zone heure et date et selectionnez &laquo;Personnaliser les ic&ocirc;nes de notification&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/notificationsBar.png\" alt=\"Barre de notification\"/></div>\n<br/>\n<br/>\nCherchez l'ic&ocirc;ne &laquo;Gestionnaire de certificats CPS&raquo; et s&eacute;lectionnez &laquo;Afficher l'ic&ocirc;ne et les notifications&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/notificationsParameters.png\" alt=\"Parametres de notifications\"/></div>\n<br/>\nUne fois la manipulation r&eacute;alis&eacute;e vous devriez voir apparaitre l'ic&ocirc;ne (en bas &agrave; droite de votre &eacute;cran).<br/>\n<br/>\nSi l'ic&ocirc;ne n'apparait pas dans la liste, lancer le diagnostic de votre ordinateur et installez les mises &agrave; jour propos&eacute;es.<br/>\n<br/>\n</p>\n<h2>L'ic&ocirc;ne <img src=\"images/preHelper/iconeKO.png\" alt=\"Icone rouge dans la barre des taches\" /> est rouge</h2>\n<p>\nSi l'ic&ocirc;ne est encadr&eacute;e de rouge (carte non lue), assurez-vous que votre carte est bien ins&eacute;r&eacute;e dans votre lecteur, rafra&icirc;chissez le lecteur en cliquant sur l'ic&ocirc;ne avec le bouton droit de la souris. Et cliquez sur &laquo;Rafra&icirc;chir&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/rightClickCCM.png\" alt=\"Cliquer droit sur l'icone du CCM\" /></div>\n<br/>\nSi l'encadr&eacute; reste rouge apr&egrave;s la manipulation, red&eacute;marrez votre ordinateur en laissant le lecteur et la CPS connect&eacute;s.<br/>\n<br/>\nApr&egrave;s ces manipulations, si l'ic&ocirc;ne ne passe pas au vert, veuillez nous contacter.\n</p>\n<div align=\"center\"></div>\n</div>\n\n</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"startDiag\" onclick=\"wizardStateMachine.wizard('startDiag');\">Diagnostiquer mon poste</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"notSupported\">\n\t\t\t<div class=\"instruction\">Votre configuration mat&eacute;riel et/ou syst&egrave;me n'est pas support&eacute;e par nos composants logiciels. Nous ne garantissons pas le succès du diagnostic.</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"notSupported\" onclick=\"wizardStateMachine.wizard('preAlert');\">Continuer</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"manualInstallXPI\">\n\t\t\t<div class=\"instruction\" id=\"xpi_instruction\" >L'Extension Firefox n'a pas &eacute;t&eacute; d&eacute;tect&eacute;e. Elle est indispensable sous ce navigateur.<br/>Apr&egrave;s l'installation, veuillez red&eacute;marrer votre navigateur.</div>\n\t\t\t<div class=\"actions\">\n<!--\t\t\t\t<div class=\"action instruction\" id=\"xpi\" onclick=\"wizardStateMachine.wizard('XPI',{URL:'https://diagcps.eservices.esante.gouv.fr/ODI_PS/php/download_asip.php?installeur=url_interne_xpi_installation_pkcs11',IconURL:'https://diagcps.eservices.esante.gouv.fr/ODI_PS/images/asip_sante.png',Hash:'sha256:c23de3812aaf7c3a81d80e9bdf891c3e2b621e01e55e8d308226fd86ab6ef438'});\">Installer<br/>l'Extension Firefox</div>-->\n<div class=\"action instruction\" id=\"xpi\" onclick=\"wizardStateMachine.wizard('XPI',{URL:'/download.php?component=xpi',IconURL:'/images/asip_sante.png',Hash:'sha256:c23de3812aaf7c3a81d80e9bdf891c3e2b621e01e55e8d308226fd86ab6ef438'});\">Installer<br/>l'Extension Firefox</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"restartAlertXPI\">\n\t\t\t<div class=\"instruction\" id=\"restartInstructionXPI\" >Une fois l'installation de l'Extension Cryptolib CPS termin&eacute;e,<br/>veuillez red&eacute;marrer votre navigateur.</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"manualInstallClibCPS\">\n\t\t\t<div class=\"instruction\">Si vous avez ins&eacute;r&eacute; votre CPS dans votre lecteur sans succ&egrave;s, la version de Cryptolib CPS de votre poste de travail n'est peut-&ecirc;tre pas &agrave; jour.</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"cryptolib\" onclick=\"wizardStateMachine.wizard('CryptolibCPS');\">T&eacute;l&eacute;charger<br/>Cryptolib CPS</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"restartAlert\">\n\t\t\t<div class=\"instruction\" id=\"restartInstruction\" >Une fois l'installation de CryptolibCPS_vX.Y.Z termin&eacute;e, veuillez red&eacute;marrer votre navigateur.</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"contactSupport\">\n\t\t\t<div class=\"instruction\">Si vous avez installez le composant propos&eacute; sans succ&eacute;s,<br/> veuillez contacter le Support.</div>\n\t\t</div>\n\t\t\n\t</div>\n</div>\t\n<div id=\"service-direction\" class=\"column\"></div>\n<div id=\"article\">\n\t<div id=\"center\">\n\t\t<div class=\"diagState\" id=\"diagState\"></div>\n\t\t<div>\n\t\t\t<div id=\"cps\" class=\"cpsverso\" onclick=\"wizardStateMachine.wizard('restartDiag');\"><div id=\"spin\"><div id=\"retry\"></div></div></div>\n\t\t</div>\n<!--\t\t\n\t\t<div id=\"results\">\n\t\t\t<div>\n\t\t\t\t<div class=\"sign\" id=\"certificat\"></div>\n\t\t\t\t<div class=\"sign\" id=\"expired\" title=\"expire\"></div>\n\t\t\t\t<div class=\"sign\" id=\"revoc\" title=\"revoque\"></div>\n\t\t\t\t<div class=\"sign\" id=\"class\"></div>\n\t\t\t\t<div class=\"sign\" id=\"rootAC\"></div>\n\t\t\t\t<div class=\"sign\" id=\"cryptolib\" title=\"cryptolib\"></div>\n\t\t\t</div>\n\t\t</div>\n-->\n\t\t<div id=\"cps_infos\">\n\t\t\t<div id=\"infos_cps\">\n\t\t\t\t<div id=\"infos_cps_caption\"><div>Informations d&eacute;taill&eacute;es</div><div class=\"infos_cps_caption_img_expand\" id=\"infos_cps_caption_img\"></div></div>\n\t\t\t\t<table id=\"infos_cps_table\">\n\t\t\t\t\t<tbody id=\"infos_cps_tbody\"></tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n<div id=\"support-direction\" class=\"column\"></div>\n</div>\r\n<div id=\"footer\" style=\"display:flex;flex-direction:row\">\r\n    <div style=\"display:flex;flex-direction:row;width:30vw\">\r\n        <div style=\"margin:20px\">\r\n            <a href=\"https://solidarites-sante.gouv.fr/\" target=\"_blank\">\r\n                <img src=\"./images/logo-ministere.svg\" alt=\"Ministère des Solidarités et de la santé\" width=\"84\" height=\"62\">\r\n            </a>\r\n        </div>\r\n        <div style=\"margin:20px\">\r\n            <a href=\"https://esante.gouv.fr/\" target=\"_blank\">\r\n                <img src=\"./images/logo-ANS.svg\" alt=\"Agence du Numérique en Santé\" width=\"166\" height=\"50\">\r\n            </a>\r\n        </div>\r\n    </div>\r\n    <div style=\"width:60vw\">\r\n        <ul style=\"align-items:end\">\r\n            <li><a href=\"http://esante.gouv.fr/services/mentions-legales\" target=\"_blank\">Mentions l&eacute;gales</a></li>\r\n            <li><a href=\"./copyright.php\" target=\"_blank\" title=\"Copyright [nouvelle fen&ecirc;tre]\">Copyright</a></li>\r\n        </ul>\r\n    </div>\r\n</div>\r\n\r\n</body>\r\n</html>\r\n",
      "ip": "135.125.232.117",
      "timestamp": "2025-03-14T16:26:05.336575192Z",
      "curl-command": "curl -X 'GET' -H 'Accept: */*' -H 'Accept-Language: en' -H 'User-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)' 'https://diagcps.eservices.esante.gouv.fr'",
      "matcher-status": true
    },
    {
      "template": "http/misconfiguration/http-missing-security-headers.yaml",
      "template-url": "https://templates.nuclei.sh/public/http-missing-security-headers",
      "template-id": "http-missing-security-headers",
      "template-path": "/home/runner/nuclei-templates/http/misconfiguration/http-missing-security-headers.yaml",
      "info": {
        "name": "HTTP Missing Security Headers",
        "author": [
          "socketz",
          "geeknik",
          "g4l1t0",
          "convisoappsec",
          "kurohost",
          "dawid-czarnecki",
          "forgedhallpass",
          "jub0bs",
          "userdehghani"
        ],
        "tags": [
          "misconfig",
          "headers",
          "generic"
        ],
        "description": "This template searches for missing HTTP security headers. The impact of these missing headers can vary.\n",
        "severity": "info",
        "metadata": {
          "max-request": 1
        }
      },
      "matcher-name": "cross-origin-embedder-policy",
      "type": "http",
      "host": "https://diagcps.eservices.esante.gouv.fr",
      "matched-at": "https://diagcps.eservices.esante.gouv.fr",
      "request": "GET / HTTP/1.1\r\nHost: diagcps.eservices.esante.gouv.fr\r\nUser-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)\r\nConnection: close\r\nAccept: */*\r\nAccept-Language: en\r\nAccept-Encoding: gzip\r\n\r\n",
      "response": "HTTP/1.1 200 OK\r\nConnection: close\r\nTransfer-Encoding: chunked\r\nContent-Type: text/html; charset=UTF-8\r\nDate: Fri, 14 Mar 2025 16:26:19 GMT\r\nServer: Apache/2.4.37 (centos) OpenSSL/1.1.1g\r\nX-Powered-By: PHP/7.2.24\r\n\r\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n\t<title>DiagCPS, Outil de Diagnostic SSL</title>\r\n\t<meta http-equiv=\"Content-type\" content=\"text/html; charset=UTF-8\" />\r\n\t<meta name=\"description\" content=\"DiagCPS est un Outil de Diagnostic de l'authentification en ligne à l'aide d'une Carte de Professionnel de Santé, i.e. CPS. Il est fourni par l'ASIP Santé et remplace ODI.\" />\r\n\t<meta name=\"Publisher\" content=\"ASIP Santé\" />\r\n\t<meta name=\"copyright\" content=\"Tous droits réservés - ASIP Santé\" />\r\n\t<link rel=\"shortcut icon\" href=\"./images/favicon.ico\" type=\"image/x-icon\" />\r\n\t<link rel=\"stylesheet\" href=\"diagcps_css.php\" />\r\n\t<script src=\"./js/jquery-3.2.0.min.js\"></script>\r\n\t<script src=\"./js/ua-parser.min.js\"></script>\r\n</head>\r\n<body>\r\n<div id=\"header\" style=\"display:flex;flex-direction:row\">\r\n    <div style=\"margin:20px\">\r\n        <a href=\"https://solidarites-sante.gouv.fr/\" target=\"_blank\">\r\n            <img src=\"./images/logo-ministere.svg\" alt=\"Ministère des Solidarités et de la santé\" width=\"168\" height=\"104\">\r\n        </a>\r\n    </div>\r\n\t<div id=\"title\">esante.gouv.fr</div>\r\n</div>\r\n<div id=\"section\">\r\n<script type=\"text/javascript\">\n\n<!-- script : /js/wizarddiagcps.js Begin -->\n//==================================\r\n// Global variable used for state machine management \r\n// displayed on screen \r\n// or used by state machine\r\n//==================================\r\nvar wizardStateMachine = {\r\n\tstartState: 'notSupported',\r\n\tlastState: 'notSupported',\r\n\t\r\n\t//=================\r\n\t// Retry Management\r\n\t// Variables\r\n\tnbMaxRetry: 10,\r\n\tnbRetry: 0,\r\n\t\r\n\t// Management\r\n\tinitRetry: function() {this.nbRetry = this.nbMaxRetry;},\r\n\tisMaxRetry: function() {return (this.nbRetry >= this.nbMaxRetry);},\r\n\tisMinRetry: function() {return (this.nbRetry <= 0);},\r\n\tdecRetry: function() {this.nbRetry--;},\r\n\tdisplayRetry: function() {\r\n\t\t\t\t\t\t\t\t//console.log(\"displayRetry : nbRetry = \" + this.nbRetry);\r\n\t\t\t\t\t\t\t\tthis.decRetry();\r\n\t\t\t\t\t\t\t\tthis.stopTimers(); \r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.isMinRetry()\r\n\t\t\t\t\t\t\t\t\t&& \t(this.lastState != 'endDiagWithSuccess')) {\r\n\t\t\t\t\t\t\t\t\tthis.wizard('manualInstallClibCPS');\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tthis.displayWait(true);\r\n\t\t\t\t\t\t\t\t\tthis.startTimers();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\r\n\t//==================\r\n\t// Timers Management\r\n\ttimerTestSSL: null,\r\n\tretryTimeoutKO: 1000,\r\n\tinitTimer: function () {this.retryTimeoutKO = 1000;},\r\n\taccelerateTimer: function () {this.retryTimeoutKO = 250;},\r\n\tstopTimers: function() {\r\n\t\t\t\t\t\t\t\tif (this.timerTestSSL != null)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tclearTimeout(this.timerTestSSL);\r\n\t\t\t\t\t\t\t\t\tthis.timerTestSSL = null;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\tstartTimers: function() {this.timerTestSSL = setTimeout(function(){wizardStateMachine.displayRetry()}, this.retryTimeoutKO);},\r\n\t\r\n\t//=======\r\n\t// Wizard\r\n\tstartWizard: function() {this.wizard(this.startState);},\r\n\twizard: function(step, param) {\r\n\t\t\t\tconsole.log(\"wizard : step = \" + step + \", param = \" + param);\r\n\t\t\t\t\t\r\n\t\t\t\tswitch (step)\r\n\t\t\t\t{\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Pre treatment\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'notSupported':\r\n\t\t\t\t\tcase 'preAlert':\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'start');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif ((dataIHM.getUAInfos().configSupported) || (step == 'preAlert')) this.displayInstruction(true, 'preAlert');\r\n\t\t\t\t\t\telse this.displayInstruction(true, 'notSupported');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Manual Installation XPI\r\n\t\t\t\t\t// Suggestion of installation\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'manualInstallXPI':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'KO');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'manualInstallXPI');\r\n\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// XPI Installation\r\n\t\t\t\t\t// Installation process\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'XPI':\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'restartAlertXPI');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar params = {\r\n\t\t\t\t\t\t\t\t\"Installer l'Extension Cryptolib CPS\": \r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tURL: param.URL,\r\n\t\t\t\t\t\t\t\t\tIconURL: param.IconURL,\r\n\t\t\t\t\t\t\t\t\tHash: param.Hash,\r\n\t\t\t\t\t\t\t\t\ttoString: function () { return this.URL; }\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t};\r\nconsole.log(params);\r\n\t\t\t\t\t\tInstallTrigger.install(params);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// Diagnostic\r\n\t\t\t\t\t// Start\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'startDiag':\r\n\t\t\t\t\t\tthis.initRetry();\r\n\t\t\t\t\t\tthis.initTimer();\r\n\r\n\t\t\t\t\t\tthis.displayWait(true);\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'inProgress');\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tdataIHM.readClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.startTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// Diagnostic\r\n\t\t\t\t\t// Restart\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'restartDiag':\r\n\r\n\t\t\t\t\t\tdataIHM.resetClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\r\n\t\t\t\t\t//==========================\r\n\t\t\t\t\t// Progression\r\n\t\t\t\t\t//--------------------------\r\n\t\t\t\t\tcase 'inProgress':\r\n\t\t\t\t\t\t//dataIHM.readClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// this.displayDiagnosticState(true, 'inProgress');\r\n\t\t\t\t\t\t// this.displayInstruction(false);\r\n\t\t\t\t\t\t// this.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//===================\r\n\t\t\t\t\t// Ends\r\n\t\t\t\t\t//-------------------\r\n\t\t\t\t\tcase 'endDiagWithSuccess':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'OK');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tthis.displaySupport(false);\r\n\t\t\t\t\t\tthis.displayInfosCPS(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Manual Installation Cryptolib CPS\r\n\t\t\t\t\t// Suggestion of installation\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'manualInstallClibCPS':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'KO');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'manualInstallClibCPS');\r\n\t\t\t\t\t\tthis.displaySupport(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//=======================\r\n\t\t\t\t\t// Cryptolib CPS download\r\n\t\t\t\t\t// Installation process\r\n\t\t\t\t\t//-----------------------\r\n\t\t\t\t\tcase 'CryptolibCPS':\r\n\t\t\t\t\t\twindow.location = dataIHM.getServerComponentLink();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// Direct jump to Retry after installation\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'restartAlert');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\t\r\n\t\t\t\t\t//=========================\r\n\t\t\t\t\t// Other\r\n\t\t\t\t\t// Close Instruction screen\r\n\t\t\t\t\t//-------------------------\r\n\t\t\t\t\tcase 'exitInstruction':\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true);\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t// Open Support link\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'openSupport':\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tif (param !== undefined) window.open(param.URL,'_blank');\r\n\t\t\t\t\t\tbreak;\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.lastState = step;\r\n\t\t\t},\r\n\t\r\n\t//==========================\r\n\t// Screen Display Management\r\n\tdisplayElementById: function(id, display) {\r\n\t\t\t\t\t\t\tdocument.getElementById(id).style.display = display;\r\n\t\t\t\t\t\t},\r\n\thideElementById: function(id) {\r\n\t\t\t\t\t\t\tthis.displayElementById(id, \"none\");\r\n\t\t\t\t\t\t},\r\n\tdisplayInit: function(OSName) {\r\n\t\t\t\t\t\t// Events initialization\r\n\t\t\t\t\t\t//----------------------\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"cryptolib\", \t\t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"notSupported\", \t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"startDiag\", \t\t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"instructions-back\", \t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"infos_cps_caption\", \t\"click\", clickExpandCollapse);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// PreAlert initialization\r\n\t\t\t\t\t\t//------------------------\r\n\t\t\t\t\t\tthis.displayPreAlert(OSName);\r\n\t\t\t\t\t},\r\n\tdisplayInfosCPS: function (active) {\r\n\t\t\t\t\t\t\tvar infos_cps_tbody = '';\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar detailedInformations = dataIHM.getClientDetailedInfos();\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tfor (var item in detailedInformations) {\r\n\t\t\t\t\t\t\t\tinfos_cps_tbody += '<tr><td class=\"key\">' + item + '</td><td class=\"val\">' + detailedInformations[item] + '</td></tr>';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cps').className = dataIHM.getClientSSLInfos().div_cps_class;\r\n\r\n\t\t\t\t\t\t\t\tfor (var item in dataIHM.getClientSSLInfos().infos) {\r\n\t\t\t\t\t\t\t\t\tinfos_cps_tbody += '<tr><td class=\"key\">' + item + '</td><td class=\"val\">' + dataIHM.getClientSSLInfos().infos[item] + '</td></tr>';\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cps').className = \"cpsverso\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tdocument.getElementById('infos_cps_tbody').innerHTML = infos_cps_tbody;\r\n\t\t\t\t\t\t},\r\n\r\n\tdisplayWait:function (active) {\r\n\t\t\t\t\tif ( (active)\r\n\t\t\t\t\t\t&& (wizardStateMachine.nbRetry > 0) ) {\r\n\t\t\t\t\t\tthis.displayElementById('spin', \"flex\");\r\n\t\t\t\t\t\tdocument.getElementById('retry').innerHTML = wizardStateMachine.nbRetry;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.hideElementById('spin');\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\tdisplayDiagnosticState:function (active, state) {\r\n\t\t\t\t\t\t\t\tdiagStateContent = {\r\n\t\t\t\t\t\t\t\t\t'start':{content:'Cliquer sur la carte', style:'diagState diagStart'}\r\n\t\t\t\t\t\t\t\t\t, 'inProgress':{content:'Le diagnostic est en cours', style:'diagState diagInProgress'}\r\n\t\t\t\t\t\t\t\t\t, 'KO':{content:'Le diagnostic a &eacute;chou&eacute;', style:'diagState diagKO'}\r\n\t\t\t\t\t\t\t\t\t, 'OK':{content:'Le diagnostic a r&eacute;ussi', style:'diagState diagOK'}\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.hideElementById('diagState');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').style.display = \"block\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif (state !== undefined) {\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').className = diagStateContent[state].style;\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').innerHTML = diagStateContent[state].content;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\r\n\tdisplayInstruction: function (active, step) {\r\n\t\t\t\t\t\t\tthis.hideElementById('instructions-back');\r\n\t\t\t\t\t\t\tthis.hideElementById('instructions');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\tthis.displayElementById('instructions-back', \"flex\");\r\n\t\t\t\t\t\t\t\tthis.displayElementById('instructions', \"block\");\r\n\t\t\t\t\t\t\t\tthis.hideElementById('manualInstallClibCPS');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('manualInstallXPI');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('restartAlert');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('restartAlertXPI');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('preAlert');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('notSupported');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('contactSupport');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (step !== undefined) this.displayElementById(step, \"block\");\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar detailedInformations = dataIHM.getClientDetailedInfos();\r\n\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cryptolib').innerHTML = \"T&eacute;l&eacute;charger<br/>\" + dataIHM.getComponentInstallerName();\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (dataIHM.getUAInfos().os.name == 'Mac OS')\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('restartInstruction').innerHTML = \"Une fois l'installation de \" + dataIHM.getComponentInstallerName() + \" termin&eacute;e,<br/>veuillez red&eacute;marrer votre ordinateur.\";\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('restartInstruction').innerHTML = \"Une fois l'installation de \" + dataIHM.getComponentInstallerName() + \" termin&eacute;e,<br/>veuillez red&eacute;marrer votre navigateur.\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\r\n\tdisplaySupport: function (active) {\r\n\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\tthis.displayElementById('support-direction', \"flex\");\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.hideElementById('support-direction');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\r\n\tdisplayPreAlert: function(OSName) {\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-MacOS');\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-Windows');\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-Linux');\r\n\r\n\t\t\t\t\t\t\tif (OSName == 'Mac OS') this.displayElementById('alert1-MacOS', 'block');\r\n\t\t\t\t\t\t\tif (OSName == 'Windows') this.displayElementById('alert1-Windows', 'block');\r\n\t\t\t\t\t\t\tif (OSName == 'Linux') this.displayElementById('alert1-Linux', 'block');\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\r\n};\r\n\r\n//==================\r\n// Events Management\r\nfunction addEltEventListenerAllBrowser(elt, eventName, handle) {\r\n\tif (elt.addEventListener) { elt.addEventListener(eventName, handle, false);\r\n\t} else { elt.attachEvent(\"on\" + eventName, handle);\r\n\t}\r\n}\r\n\r\nfunction addIdEventListenerAllBrowser(id, eventName, handle) {\r\n\tif (document.getElementById(id)) addEltEventListenerAllBrowser(document.getElementById(id), eventName, handle);\r\n}\r\n\r\nfunction clickExpandCollapse(event) {\r\n\tif (document.getElementById('infos_cps_table').style.display != \"block\") {\r\n\t\tdocument.getElementById('infos_cps_caption_img').className = \"infos_cps_caption_img_collapse\";\r\n\t\tdocument.getElementById('infos_cps_table').style.display = \"block\";\r\n\t} else {\r\n\t\tdocument.getElementById('infos_cps_caption_img').className = \"infos_cps_caption_img_expand\";\r\n\t\tdocument.getElementById('infos_cps_table').style.display = \"none\";\r\n\t}\r\n\tevent.cancelBubble = true;\r\n\t\t\r\n\treturn false;\r\n}\r\n\r\nfunction clickActionNoPropagation(event) {\r\n\t//this.click();\r\n\r\n\tevent.cancelBubble = true;\r\n\r\n\treturn false;\r\n}\r\n\n<!-- script : /js/wizarddiagcps.js End -->\n<!-- script : /js/diagcps.js Begin -->\n//==================================\r\n// Global variable used for all data \r\n// displayed on screen \r\n// or used by state machine\r\n//==================================\r\nvar dataIHM = {\r\n\t//==========================\r\n\t// Root URL\r\n\tlocalURL: '',\r\n\tsetLocalURL: function(URL) {this.localURL = URL;},\r\n\tgetLocalURL: function() {return this.localURL;},\r\n\t\r\n\t//==========================\r\n\t// User Agent\r\n\tclientUAInfos: null,\r\n\ttimerUAInfos: null,\r\n\tinitUAInfos: function() {\r\n\t\t\t\t\t\tvar uaparser = new UAParser();\r\n\t\t\t\t\t\tthis.clientUAInfos = uaparser.getResult();\r\n\t\t\t\t\t\tthis.clientUAInfos.browser.xpi = true;\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tthis.timerUAInfos = setTimeout(function(){dataIHM.isUAInfosCPSWebEx()}, 1000);\r\n\t\t\t\t\t},\r\n\tgetUAInfos: function() {return this.clientUAInfos},\r\n\tisUAInfosCPSWebEx: function() {\r\n\t\t\t\t\tif (window.isCpsWebExAlive) {\r\n\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', window.isCpsWebExAlive());\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (this.getUAInfos().browser.name == 'Firefox') {\r\n\t\t\t\t\t\t\tif (this.getUAInfos().browser.major > 57) {\r\n\t\t\t\t\t\t\t\tthis.clientUAInfos.browser.xpi = false;\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'absente');\r\n\t\t\t\t\t\t\t\twizardStateMachine.wizard('manualInstallXPI');\r\n\t\t\t\t\t\t\t} else if (this.getUAInfos().browser.major == 57) {\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'sur cette version, l\\'installation du p&eacute;riph&eacute;rique de s&eacute;curit&eacute; doit &ecirc;tre <a href=\"http://integrateurs-cps.asipsante.fr/Installation-manuelle-PKCS11-Firefox\" target=\"_blanck\">r&eacute;alis&eacute;e manuellement</a>.');\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'd&eacute;tection impossible sur cette version');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.timerUAInfos = null;\r\n\t\t\t\t},\r\n\t\r\n\t//===============================\r\n\t// Installed Component management\r\n\tcomponentName: \"CryptolibCPS\", // By default\r\n\tsetComponentName: function(name) {this.componentName = name;},\r\n\tgetComponentName: function() {return this.componentName;},\r\n\tcomponentVersion: \"\", // By Default\r\n\tsetcomponentVersion: function(version) {this.componentVersion = version;},\r\n\tgetcomponentVersion: function() {return this.componentVersion;},\r\n\tcomponentInstallerName: \"\",\r\n\tsetComponentInstallerName: function(name) {this.componentInstallerName = name;},\r\n\tgetComponentInstallerName: function() {return this.componentInstallerName;},\r\n\tserverComponentURL: null,\r\n\tsetServerComponentURL: function(URL) {this.serverComponentURL = URL;},\r\n\tgetServerComponentLink: function(version) {\r\n\t\t\t\t\t\t\t\t\tvar componentLink = this.serverComponentURL + \"?\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"component=\" + this.getComponentName();\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&os=\" + this.getUAInfos().os.name;\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&arch=\" + this.getUAInfos().cpu.architecture;\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&version=\" + this.getcomponentVersion();\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\treturn componentLink;\r\n\t\t\t\t\t\t\t\t},\r\n\tserverComponentInfos: null,\r\n\treadServerComponentInfos: function() {\r\n\t\t\t\t\t\t\t\t// XPI 6.0.15 with Firefox < 57\r\n\t\t\t\t\t\t\t\t// ==> Use Cryptolib CPS 5.0.37 instead of last release\r\n\t\t\t\t\t\t\t\tif ((this.getUAInfos().browser.name == 'Firefox') \r\n\t\t\t\t\t\t\t\t\t&& (this.getUAInfos().browser.major < 57)) {\r\n\t\t\t\t\t\t\t\t\tswitch (this.getUAInfos().os.name) {\r\n\t\t\t\t\t\t\t\t\t\tcase 'Windows': this.setcomponentVersion('5.0.37');break;\r\n\t\t\t\t\t\t\t\t\t\tcase 'Mac OS': this.setcomponentVersion('5.0.34');break;\r\n\t\t\t\t\t\t\t\t\t\tcase 'Linux':\r\n\t\t\t\t\t\t\t\t\t\tcase 'CentOS':\r\n\t\t\t\t\t\t\t\t\t\tcase 'Ubuntu':\r\n\t\t\t\t\t\t\t\t\t\tcase 'RedHat':  this.setcomponentVersion('5.0.12');break;\r\n\t\t\t\t\t\t\t\t\t\tdefault:break;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// Use fetch if exist\r\n\t\t\t\t\t\t\t\tif (self.fetch) {\r\n\t\t\t\t\t\t\t\t\tfetch( this.getServerComponentLink() + '&filename=get' )\r\n\t\t\t\t\t\t\t\t\t.then(function(resp) {return resp.json();})\r\n\t\t\t\t\t\t\t\t\t.then(function(response) {\r\n\t\t\t\t\t\t\t\t\t\tfor (var k in response) {\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.setComponentInstallerName(response[k]);\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.addClientDetailedInfos('URL de t&eacute;l&eacute;chargement', '<a href=\"' + dataIHM.getServerComponentLink() + '\">' + dataIHM.getComponentInstallerName() + '</a>');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('readServerComponentInfos : Error with fetch (' + error.message + ')'); \r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t// Use JQuery\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$.ajax(\t{\r\n\t\t\t\t\t\t\t\t\t\turl: this.getServerComponentLink() + '&filename=get'\r\n\t\t\t\t\t\t\t\t\t\t, success: function( data) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar json;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (data === String)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson = jQuery.parseJSON(data);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson = data\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor (var k in json) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setComponentInstallerName(json[k]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.addClientDetailedInfos('URL de t&eacute;l&eacute;chargement', '<a href=\"' + dataIHM.getServerComponentLink() + '\">' + dataIHM.getComponentInstallerName() + '</a>');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t, error: function( data) { return null;}\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\r\n\t//========================================\r\n\t// Support contact informations management\r\n \tmailSupportMailbox: null,\r\n\tmailSupportDomain: null,\r\n\tsetMailSupport: function(mailbox, domain) {this.mailSupportMailbox = mailbox; this.mailSupportDomain = domain;},\r\n\tgetMailSupport: function() {return this.mailSupportMailbox + \"@\" + this.mailSupportDomain;},\r\n \t\t\r\n\t//==========================\r\n\t// Detailed informations\r\n\tclientDetailedInfos: {},\r\n\tinitClientDetailedInfos: function() {\r\n\t\t\t\t\t\t\t\tconfigSupported = true;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.getUAInfos().device.type === undefined) {\r\n\t\t\t\t\t\t\t\t\tconsole.log(\"Poste de travail\");\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tconfigSupported = false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().os.name) {\r\n\t\t\t\t\t\t\t\t\tcase 'Windows':\r\n\t\t\t\t\t\t\t\t\tcase 'Mac OS':\r\n\t\t\t\t\t\t\t\t\tcase 'Linux':\r\n\t\t\t\t\t\t\t\t\tcase 'CentOS':\r\n\t\t\t\t\t\t\t\t\tcase 'Ubuntu':\r\n\t\t\t\t\t\t\t\t\tcase 'RedHat':  configSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault: \t\tconfigSupported = configSupported & false;break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().browser.name) {\r\n\t\t\t\t\t\t\t\t\tcase 'IE':\r\n\t\t\t\t\t\t\t\t\tcase 'Safari':\r\n\t\t\t\t\t\t\t\t\tcase 'Edge':\r\n\t\t\t\t\t\t\t\t\tcase 'Chrome':\r\n\t\t\t\t\t\t\t\t\tcase 'Firefox':\tconfigSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault: \t\tconfigSupported = configSupported & false;break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().cpu.architecture) {\r\n\t\t\t\t\t\t\t\t\tcase 'ia32':\r\n\t\t\t\t\t\t\t\t\tcase 'i686':\r\n\t\t\t\t\t\t\t\t\tcase 'amd64': configSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\t\tif (this.getUAInfos().cpu.architecture === undefined)\r\n\t\t\t\t\t\t\t\t\t\t\tconfigSupported = configSupported & true;\r\n\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\tconfigSupported = configSupported & false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.getUAInfos().cpu.architecture == 'amd64')\r\n\t\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Syst&egrave;me d\\'exploitation', this.getUAInfos().os.name + \" \" + this.getUAInfos().os.version + \" (64b)\");\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Syst&egrave;me d\\'exploitation', this.getUAInfos().os.name + \" \" + this.getUAInfos().os.version);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Navigateur', this.getUAInfos().browser.name + \" \" + this.getUAInfos().browser.major);\r\n\t\t\t\t\t\t\t\t// this.addClientDetailedInfos('Compatibilit&eacute; ASIP', '<a href=\"http://integrateurs-cps.asipsante.fr/Lettre_d_information\" target=\"_blanck\">Lettre d\\'information<br/>POSTE DE TRAVAIL & Veille Technologique</a>');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.clientUAInfos.configSupported = configSupported;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\treturn configSupported;\r\n\t\t\t\t\t\t\t},\r\n\tgetClientDetailedInfos: function() {return this.clientDetailedInfos;},\r\n\taddClientDetailedInfos: function(key, value) { this.clientDetailedInfos[key] = value;},\r\n\tresetClientDetailedInfos: function() {this.clientDetailedInfos = {};},\r\n\t\t\r\n\t//==========================\r\n\t// Client SSL Informations\r\n\tclientSSLInfos: null,\r\n\tclientSSLFetchParameters: { mode:'cors', credentials: 'include', cache: 'no-cache'},\r\n\tclientSSLAjaxParameters: { cache: false, timeout: 8000, async: true},\r\n\tisDefineClientSSLInfos: function() {return (this.clientSSLInfos != undefined);},\r\n\tsetClientSSLInfos: function(data) {this.clientSSLInfos = data;},\r\n\tgetClientSSLInfos: function() {return this.clientSSLInfos;},\r\n\tinitClientSSLParameters: function() { $.ajaxSetup(this.clientSSLAjaxParameters);},\r\n\tresetClientSSLInfos: function () {\r\n\t\t\t\t\t\t\tconsole.log('resetClientSSLInfos : Erase SSL Connexion cache for ' + this.getUAInfos().browser.name);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tswitch (this.getUAInfos().browser.name) {\r\n\t\t\t\t\t\t\t\tcase 'Edge': // Works !\r\n\t\t\t\t\t\t\t\tcase 'IE': // Works !\r\n\t\t\t\t\t\t\t\t\tif (document.execCommand) document.execCommand( \"ClearAuthenticationCache\", \"false\");\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 'Firefox':\t// Works !\r\n\t\t\t\t\t\t\t\t\t//location.reload(); // Works !\r\n\t\t\t\t\t\t\t\t\tif (window.crypto) if (window.crypto.logout) window.crypto.logout(); // Works !\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 'Chrome': // Works !\r\n\t\t\t\t\t\t\t\tcase 'Safari': // Not working, restart Browser needed !\r\n\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag'); \r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\treadClientSSLInfos: function() {\r\n\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : SSL Connexion' );\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// Use fetch if exist\r\n\t\t\t\t\t\t\tif (self.fetch) {\r\n\t\t\t\t\t\t\t\t// Try to connect and get CPS informations\r\n\t\t\t\t\t\t\t\tfetch( '/visuel.php', this.clientSSLFetchParameters )\r\n\t\t\t\t\t\t\t\t.then(function(resp) {return resp.json();})\r\n\t\t\t\t\t\t\t\t.then(function(resp_json) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Success with Fetch');\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t// traitement du JSON\r\n\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(resp_json);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('endDiagWithSuccess');\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t// Case of SSL Error\r\n\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Probably SSL Error with fetch (' + error.message + ')');\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(null);\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.accelerateTimer();\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t// Use JQuery\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$.ajax(\t{\r\n\t\t\t\t\t\t\t\t\turl: 'visuel.php'\r\n\t\t\t\t\t\t\t\t\t, success: function(data, textStatus) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Success with Ajax (' + textStatus + ')');\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tif (data === String)\r\n\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(jQuery.parseJSON(data));\r\n\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(data);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('endDiagWithSuccess');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t, error: function(data, textStatus) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Probably SSL Error with Ajax (' + textStatus + ')');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(null);\r\n\t\t\t\t\t\t\t\t\t\t\twizardStateMachine.accelerateTimer();\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n}\r\n\r\n//=====\r\n// Main\r\n//=====\r\n$(function() {\r\n\t// Initialization\r\n\t//---------------\r\n\tdataIHM.initUAInfos(); // User Agent\r\n\t\r\n\tdataIHM.initClientSSLParameters();\r\n\t\r\n\t// Sp�cific parameter with no good solution @29/12/2017\r\n\tswitch (dataIHM.getUAInfos().browser.name) {\r\n\t\tcase 'IE':\r\n\t\t\tconsole.log('=========== Use Ajax =============');\r\n\t\t\tself.fetch = undefined;\r\n\t\t\tbreak;\r\n\t\tcase 'Edge':\r\n\t\tcase 'Firefox':\r\n\t\tcase 'Safari':\r\n\t\tdefault:\r\n\t\t\tconsole.log('=========== Try using fetch. If not available use Ajax =============');\r\n\t\t\tbreak;\r\n\t}\r\n\t\r\n\tdataIHM.initClientDetailedInfos(); // Informations in bottom\r\n\tdataIHM.readServerComponentInfos(); // Get from informations from Web Service\r\n\t\r\n\twizardStateMachine.startWizard(); // Start Wizard\r\n\t\t\r\n\twizardStateMachine.displayInit(dataIHM.getUAInfos().os.name);\r\n});\r\n\n<!-- script : /js/diagcps.js End -->\n\n</script>\n<script type=\"text/javascript\">\n\t// Initialization Javascript from PHP\n\tdataIHM.setComponentName('CryptolibCPS');\n\tdataIHM.setServerComponentURL('download.php');\n</script>\n<!--<div id=\"beta\"></div>-->\n<div id=\"instructions-back\" onclick=\"wizardStateMachine.wizard('exitInstruction');\">\n\t<div id=\"instructions\">\n\t\n\t\t<div class=\"screen\" id=\"preAlert\">\n\t\t\t<div class=\"instruction\"><br/>\n<h1>Assistance en cas de carte CPS non lue</h1>\n\n<h2>Pr&eacute;alablement</h2>\n<p>\nVeuillez v&eacute;rifier que votre carte est bien ins&eacute;r&eacute;e dans votre lecteur de carte ou votre terminal Vitale.<br/>\nPuis v&eacute;rifier que votre lecteur de carte ou votre terminal Vitale est correctement connect&eacute; &agrave; votre ordinateur.<br/>\n<br/>\nLa carte ins&eacute;r&eacute;e dans le lecteur doit &ecirc;tre la derni&egrave;re carte active.\n\n<table >\n\t<tr>\n\t\t<td style=\"border-top:none;\"><img src=\"images/informations32.png\" alt=\"Information :\"/></td>\n\t\t<td style=\"border-top:none;\"><i>La derni&egrave;re carte active pr&eacute;sente la date d'expiration la plus &eacute;loign&eacute;e.</i></td>\n\t</tr>\n</table>\n<br/>\nUne fois cette v&eacute;rification r&eacute;alis&eacute;e, v&eacute;rifiez que la carte est bien lue.<br/>\n</p>\n\n<div id=\"alert1-MacOS\">\n<h2>Votre ordinateur est sous Mac OS</h2>\n<p>\nSur votre syst&egrave;me d'exploitation, nous ne disposons pas de m&eacute;thode particuli&egrave;re pour v&eacute;rifier si votre carte est lue.<br/>\n<br/>\nVeuillez lancer un diagnostic de votre ordinateur et proc&eacute;der &agrave; l'installation des mises &agrave; jour sugg&eacute;r&eacute;es.<br/>\n</p>\n</div>\n\n<div id=\"alert1-Linux\">\n<h2>Votre ordinateur est sous Linux</h2>\n<p>\nSur votre syst&egrave;me d'exploitation, nous ne disposons pas de m&eacute;thode particuli&egrave;re pour v&eacute;rifier si votre carte est lue.<br/>\n<br/>\nVeuillez lancer un diagnostic de votre ordinateur et proc&eacute;der &agrave; l'installation des mises &agrave; jour sugg&eacute;r&eacute;es.<br/>\n</p>\n</div>\n\n<div id=\"alert1-Windows\">\n<h2>Votre ordinateur est sous Windows</h2>\n<b>Dans la barre des t&acirc;ches, une carte lue est signal&eacute;e par <img src=\"images/preHelper/iconeOK.png\" alt=\"Icone vert dans la barre des taches\" /> et une carte non lue par <img src=\"images/preHelper/iconeKO.png\" alt=\"Icone rouge dans la barre des taches\"/>.</b><br/>\n<h3>L'ic&ocirc;ne <img src=\"images/preHelper/iconeOK.png\" alt=\"Icone vert dans la barre des taches\"/> est introuvable</h3>\n<p>\nCliquez avec le clic droit de votre souris sur le bouton &laquo;Afficher les ic&ocirc;nes&raquo; (en bas &agrave; droite de votre &eacute;cran) ou sur la zone heure et date et selectionnez &laquo;Personnaliser les ic&ocirc;nes de notification&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/notificationsBar.png\" alt=\"Barre de notification\"/></div>\n<br/>\n<br/>\nCherchez l'ic&ocirc;ne &laquo;Gestionnaire de certificats CPS&raquo; et s&eacute;lectionnez &laquo;Afficher l'ic&ocirc;ne et les notifications&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/notificationsParameters.png\" alt=\"Parametres de notifications\"/></div>\n<br/>\nUne fois la manipulation r&eacute;alis&eacute;e vous devriez voir apparaitre l'ic&ocirc;ne (en bas &agrave; droite de votre &eacute;cran).<br/>\n<br/>\nSi l'ic&ocirc;ne n'apparait pas dans la liste, lancer le diagnostic de votre ordinateur et installez les mises &agrave; jour propos&eacute;es.<br/>\n<br/>\n</p>\n<h2>L'ic&ocirc;ne <img src=\"images/preHelper/iconeKO.png\" alt=\"Icone rouge dans la barre des taches\" /> est rouge</h2>\n<p>\nSi l'ic&ocirc;ne est encadr&eacute;e de rouge (carte non lue), assurez-vous que votre carte est bien ins&eacute;r&eacute;e dans votre lecteur, rafra&icirc;chissez le lecteur en cliquant sur l'ic&ocirc;ne avec le bouton droit de la souris. Et cliquez sur &laquo;Rafra&icirc;chir&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/rightClickCCM.png\" alt=\"Cliquer droit sur l'icone du CCM\" /></div>\n<br/>\nSi l'encadr&eacute; reste rouge apr&egrave;s la manipulation, red&eacute;marrez votre ordinateur en laissant le lecteur et la CPS connect&eacute;s.<br/>\n<br/>\nApr&egrave;s ces manipulations, si l'ic&ocirc;ne ne passe pas au vert, veuillez nous contacter.\n</p>\n<div align=\"center\"></div>\n</div>\n\n</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"startDiag\" onclick=\"wizardStateMachine.wizard('startDiag');\">Diagnostiquer mon poste</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"notSupported\">\n\t\t\t<div class=\"instruction\">Votre configuration mat&eacute;riel et/ou syst&egrave;me n'est pas support&eacute;e par nos composants logiciels. Nous ne garantissons pas le succès du diagnostic.</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"notSupported\" onclick=\"wizardStateMachine.wizard('preAlert');\">Continuer</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"manualInstallXPI\">\n\t\t\t<div class=\"instruction\" id=\"xpi_instruction\" >L'Extension Firefox n'a pas &eacute;t&eacute; d&eacute;tect&eacute;e. Elle est indispensable sous ce navigateur.<br/>Apr&egrave;s l'installation, veuillez red&eacute;marrer votre navigateur.</div>\n\t\t\t<div class=\"actions\">\n<!--\t\t\t\t<div class=\"action instruction\" id=\"xpi\" onclick=\"wizardStateMachine.wizard('XPI',{URL:'https://diagcps.eservices.esante.gouv.fr/ODI_PS/php/download_asip.php?installeur=url_interne_xpi_installation_pkcs11',IconURL:'https://diagcps.eservices.esante.gouv.fr/ODI_PS/images/asip_sante.png',Hash:'sha256:c23de3812aaf7c3a81d80e9bdf891c3e2b621e01e55e8d308226fd86ab6ef438'});\">Installer<br/>l'Extension Firefox</div>-->\n<div class=\"action instruction\" id=\"xpi\" onclick=\"wizardStateMachine.wizard('XPI',{URL:'/download.php?component=xpi',IconURL:'/images/asip_sante.png',Hash:'sha256:c23de3812aaf7c3a81d80e9bdf891c3e2b621e01e55e8d308226fd86ab6ef438'});\">Installer<br/>l'Extension Firefox</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"restartAlertXPI\">\n\t\t\t<div class=\"instruction\" id=\"restartInstructionXPI\" >Une fois l'installation de l'Extension Cryptolib CPS termin&eacute;e,<br/>veuillez red&eacute;marrer votre navigateur.</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"manualInstallClibCPS\">\n\t\t\t<div class=\"instruction\">Si vous avez ins&eacute;r&eacute; votre CPS dans votre lecteur sans succ&egrave;s, la version de Cryptolib CPS de votre poste de travail n'est peut-&ecirc;tre pas &agrave; jour.</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"cryptolib\" onclick=\"wizardStateMachine.wizard('CryptolibCPS');\">T&eacute;l&eacute;charger<br/>Cryptolib CPS</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"restartAlert\">\n\t\t\t<div class=\"instruction\" id=\"restartInstruction\" >Une fois l'installation de CryptolibCPS_vX.Y.Z termin&eacute;e, veuillez red&eacute;marrer votre navigateur.</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"contactSupport\">\n\t\t\t<div class=\"instruction\">Si vous avez installez le composant propos&eacute; sans succ&eacute;s,<br/> veuillez contacter le Support.</div>\n\t\t</div>\n\t\t\n\t</div>\n</div>\t\n<div id=\"service-direction\" class=\"column\"></div>\n<div id=\"article\">\n\t<div id=\"center\">\n\t\t<div class=\"diagState\" id=\"diagState\"></div>\n\t\t<div>\n\t\t\t<div id=\"cps\" class=\"cpsverso\" onclick=\"wizardStateMachine.wizard('restartDiag');\"><div id=\"spin\"><div id=\"retry\"></div></div></div>\n\t\t</div>\n<!--\t\t\n\t\t<div id=\"results\">\n\t\t\t<div>\n\t\t\t\t<div class=\"sign\" id=\"certificat\"></div>\n\t\t\t\t<div class=\"sign\" id=\"expired\" title=\"expire\"></div>\n\t\t\t\t<div class=\"sign\" id=\"revoc\" title=\"revoque\"></div>\n\t\t\t\t<div class=\"sign\" id=\"class\"></div>\n\t\t\t\t<div class=\"sign\" id=\"rootAC\"></div>\n\t\t\t\t<div class=\"sign\" id=\"cryptolib\" title=\"cryptolib\"></div>\n\t\t\t</div>\n\t\t</div>\n-->\n\t\t<div id=\"cps_infos\">\n\t\t\t<div id=\"infos_cps\">\n\t\t\t\t<div id=\"infos_cps_caption\"><div>Informations d&eacute;taill&eacute;es</div><div class=\"infos_cps_caption_img_expand\" id=\"infos_cps_caption_img\"></div></div>\n\t\t\t\t<table id=\"infos_cps_table\">\n\t\t\t\t\t<tbody id=\"infos_cps_tbody\"></tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n<div id=\"support-direction\" class=\"column\"></div>\n</div>\r\n<div id=\"footer\" style=\"display:flex;flex-direction:row\">\r\n    <div style=\"display:flex;flex-direction:row;width:30vw\">\r\n        <div style=\"margin:20px\">\r\n            <a href=\"https://solidarites-sante.gouv.fr/\" target=\"_blank\">\r\n                <img src=\"./images/logo-ministere.svg\" alt=\"Ministère des Solidarités et de la santé\" width=\"84\" height=\"62\">\r\n            </a>\r\n        </div>\r\n        <div style=\"margin:20px\">\r\n            <a href=\"https://esante.gouv.fr/\" target=\"_blank\">\r\n                <img src=\"./images/logo-ANS.svg\" alt=\"Agence du Numérique en Santé\" width=\"166\" height=\"50\">\r\n            </a>\r\n        </div>\r\n    </div>\r\n    <div style=\"width:60vw\">\r\n        <ul style=\"align-items:end\">\r\n            <li><a href=\"http://esante.gouv.fr/services/mentions-legales\" target=\"_blank\">Mentions l&eacute;gales</a></li>\r\n            <li><a href=\"./copyright.php\" target=\"_blank\" title=\"Copyright [nouvelle fen&ecirc;tre]\">Copyright</a></li>\r\n        </ul>\r\n    </div>\r\n</div>\r\n\r\n</body>\r\n</html>\r\n",
      "ip": "135.125.232.117",
      "timestamp": "2025-03-14T16:26:19.506317547Z",
      "curl-command": "curl -X 'GET' -H 'Accept: */*' -H 'Accept-Language: en' -H 'User-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)' 'https://diagcps.eservices.esante.gouv.fr'",
      "matcher-status": true
    },
    {
      "template": "http/misconfiguration/http-missing-security-headers.yaml",
      "template-url": "https://templates.nuclei.sh/public/http-missing-security-headers",
      "template-id": "http-missing-security-headers",
      "template-path": "/home/runner/nuclei-templates/http/misconfiguration/http-missing-security-headers.yaml",
      "info": {
        "name": "HTTP Missing Security Headers",
        "author": [
          "socketz",
          "geeknik",
          "g4l1t0",
          "convisoappsec",
          "kurohost",
          "dawid-czarnecki",
          "forgedhallpass",
          "jub0bs",
          "userdehghani"
        ],
        "tags": [
          "misconfig",
          "headers",
          "generic"
        ],
        "description": "This template searches for missing HTTP security headers. The impact of these missing headers can vary.\n",
        "severity": "info",
        "metadata": {
          "max-request": 1
        }
      },
      "matcher-name": "x-frame-options",
      "type": "http",
      "host": "https://diagcps.eservices.esante.gouv.fr",
      "matched-at": "https://diagcps.eservices.esante.gouv.fr",
      "request": "GET / HTTP/1.1\r\nHost: diagcps.eservices.esante.gouv.fr\r\nUser-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)\r\nConnection: close\r\nAccept: */*\r\nAccept-Language: en\r\nAccept-Encoding: gzip\r\n\r\n",
      "response": "HTTP/1.1 200 OK\r\nConnection: close\r\nTransfer-Encoding: chunked\r\nContent-Type: text/html; charset=UTF-8\r\nDate: Fri, 14 Mar 2025 16:26:19 GMT\r\nServer: Apache/2.4.37 (centos) OpenSSL/1.1.1g\r\nX-Powered-By: PHP/7.2.24\r\n\r\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n\t<title>DiagCPS, Outil de Diagnostic SSL</title>\r\n\t<meta http-equiv=\"Content-type\" content=\"text/html; charset=UTF-8\" />\r\n\t<meta name=\"description\" content=\"DiagCPS est un Outil de Diagnostic de l'authentification en ligne à l'aide d'une Carte de Professionnel de Santé, i.e. CPS. Il est fourni par l'ASIP Santé et remplace ODI.\" />\r\n\t<meta name=\"Publisher\" content=\"ASIP Santé\" />\r\n\t<meta name=\"copyright\" content=\"Tous droits réservés - ASIP Santé\" />\r\n\t<link rel=\"shortcut icon\" href=\"./images/favicon.ico\" type=\"image/x-icon\" />\r\n\t<link rel=\"stylesheet\" href=\"diagcps_css.php\" />\r\n\t<script src=\"./js/jquery-3.2.0.min.js\"></script>\r\n\t<script src=\"./js/ua-parser.min.js\"></script>\r\n</head>\r\n<body>\r\n<div id=\"header\" style=\"display:flex;flex-direction:row\">\r\n    <div style=\"margin:20px\">\r\n        <a href=\"https://solidarites-sante.gouv.fr/\" target=\"_blank\">\r\n            <img src=\"./images/logo-ministere.svg\" alt=\"Ministère des Solidarités et de la santé\" width=\"168\" height=\"104\">\r\n        </a>\r\n    </div>\r\n\t<div id=\"title\">esante.gouv.fr</div>\r\n</div>\r\n<div id=\"section\">\r\n<script type=\"text/javascript\">\n\n<!-- script : /js/wizarddiagcps.js Begin -->\n//==================================\r\n// Global variable used for state machine management \r\n// displayed on screen \r\n// or used by state machine\r\n//==================================\r\nvar wizardStateMachine = {\r\n\tstartState: 'notSupported',\r\n\tlastState: 'notSupported',\r\n\t\r\n\t//=================\r\n\t// Retry Management\r\n\t// Variables\r\n\tnbMaxRetry: 10,\r\n\tnbRetry: 0,\r\n\t\r\n\t// Management\r\n\tinitRetry: function() {this.nbRetry = this.nbMaxRetry;},\r\n\tisMaxRetry: function() {return (this.nbRetry >= this.nbMaxRetry);},\r\n\tisMinRetry: function() {return (this.nbRetry <= 0);},\r\n\tdecRetry: function() {this.nbRetry--;},\r\n\tdisplayRetry: function() {\r\n\t\t\t\t\t\t\t\t//console.log(\"displayRetry : nbRetry = \" + this.nbRetry);\r\n\t\t\t\t\t\t\t\tthis.decRetry();\r\n\t\t\t\t\t\t\t\tthis.stopTimers(); \r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.isMinRetry()\r\n\t\t\t\t\t\t\t\t\t&& \t(this.lastState != 'endDiagWithSuccess')) {\r\n\t\t\t\t\t\t\t\t\tthis.wizard('manualInstallClibCPS');\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tthis.displayWait(true);\r\n\t\t\t\t\t\t\t\t\tthis.startTimers();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\r\n\t//==================\r\n\t// Timers Management\r\n\ttimerTestSSL: null,\r\n\tretryTimeoutKO: 1000,\r\n\tinitTimer: function () {this.retryTimeoutKO = 1000;},\r\n\taccelerateTimer: function () {this.retryTimeoutKO = 250;},\r\n\tstopTimers: function() {\r\n\t\t\t\t\t\t\t\tif (this.timerTestSSL != null)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tclearTimeout(this.timerTestSSL);\r\n\t\t\t\t\t\t\t\t\tthis.timerTestSSL = null;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\tstartTimers: function() {this.timerTestSSL = setTimeout(function(){wizardStateMachine.displayRetry()}, this.retryTimeoutKO);},\r\n\t\r\n\t//=======\r\n\t// Wizard\r\n\tstartWizard: function() {this.wizard(this.startState);},\r\n\twizard: function(step, param) {\r\n\t\t\t\tconsole.log(\"wizard : step = \" + step + \", param = \" + param);\r\n\t\t\t\t\t\r\n\t\t\t\tswitch (step)\r\n\t\t\t\t{\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Pre treatment\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'notSupported':\r\n\t\t\t\t\tcase 'preAlert':\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'start');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif ((dataIHM.getUAInfos().configSupported) || (step == 'preAlert')) this.displayInstruction(true, 'preAlert');\r\n\t\t\t\t\t\telse this.displayInstruction(true, 'notSupported');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Manual Installation XPI\r\n\t\t\t\t\t// Suggestion of installation\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'manualInstallXPI':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'KO');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'manualInstallXPI');\r\n\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// XPI Installation\r\n\t\t\t\t\t// Installation process\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'XPI':\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'restartAlertXPI');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar params = {\r\n\t\t\t\t\t\t\t\t\"Installer l'Extension Cryptolib CPS\": \r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tURL: param.URL,\r\n\t\t\t\t\t\t\t\t\tIconURL: param.IconURL,\r\n\t\t\t\t\t\t\t\t\tHash: param.Hash,\r\n\t\t\t\t\t\t\t\t\ttoString: function () { return this.URL; }\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t};\r\nconsole.log(params);\r\n\t\t\t\t\t\tInstallTrigger.install(params);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// Diagnostic\r\n\t\t\t\t\t// Start\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'startDiag':\r\n\t\t\t\t\t\tthis.initRetry();\r\n\t\t\t\t\t\tthis.initTimer();\r\n\r\n\t\t\t\t\t\tthis.displayWait(true);\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'inProgress');\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tdataIHM.readClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.startTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// Diagnostic\r\n\t\t\t\t\t// Restart\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'restartDiag':\r\n\r\n\t\t\t\t\t\tdataIHM.resetClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\r\n\t\t\t\t\t//==========================\r\n\t\t\t\t\t// Progression\r\n\t\t\t\t\t//--------------------------\r\n\t\t\t\t\tcase 'inProgress':\r\n\t\t\t\t\t\t//dataIHM.readClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// this.displayDiagnosticState(true, 'inProgress');\r\n\t\t\t\t\t\t// this.displayInstruction(false);\r\n\t\t\t\t\t\t// this.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//===================\r\n\t\t\t\t\t// Ends\r\n\t\t\t\t\t//-------------------\r\n\t\t\t\t\tcase 'endDiagWithSuccess':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'OK');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tthis.displaySupport(false);\r\n\t\t\t\t\t\tthis.displayInfosCPS(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Manual Installation Cryptolib CPS\r\n\t\t\t\t\t// Suggestion of installation\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'manualInstallClibCPS':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'KO');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'manualInstallClibCPS');\r\n\t\t\t\t\t\tthis.displaySupport(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//=======================\r\n\t\t\t\t\t// Cryptolib CPS download\r\n\t\t\t\t\t// Installation process\r\n\t\t\t\t\t//-----------------------\r\n\t\t\t\t\tcase 'CryptolibCPS':\r\n\t\t\t\t\t\twindow.location = dataIHM.getServerComponentLink();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// Direct jump to Retry after installation\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'restartAlert');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\t\r\n\t\t\t\t\t//=========================\r\n\t\t\t\t\t// Other\r\n\t\t\t\t\t// Close Instruction screen\r\n\t\t\t\t\t//-------------------------\r\n\t\t\t\t\tcase 'exitInstruction':\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true);\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t// Open Support link\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'openSupport':\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tif (param !== undefined) window.open(param.URL,'_blank');\r\n\t\t\t\t\t\tbreak;\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.lastState = step;\r\n\t\t\t},\r\n\t\r\n\t//==========================\r\n\t// Screen Display Management\r\n\tdisplayElementById: function(id, display) {\r\n\t\t\t\t\t\t\tdocument.getElementById(id).style.display = display;\r\n\t\t\t\t\t\t},\r\n\thideElementById: function(id) {\r\n\t\t\t\t\t\t\tthis.displayElementById(id, \"none\");\r\n\t\t\t\t\t\t},\r\n\tdisplayInit: function(OSName) {\r\n\t\t\t\t\t\t// Events initialization\r\n\t\t\t\t\t\t//----------------------\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"cryptolib\", \t\t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"notSupported\", \t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"startDiag\", \t\t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"instructions-back\", \t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"infos_cps_caption\", \t\"click\", clickExpandCollapse);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// PreAlert initialization\r\n\t\t\t\t\t\t//------------------------\r\n\t\t\t\t\t\tthis.displayPreAlert(OSName);\r\n\t\t\t\t\t},\r\n\tdisplayInfosCPS: function (active) {\r\n\t\t\t\t\t\t\tvar infos_cps_tbody = '';\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar detailedInformations = dataIHM.getClientDetailedInfos();\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tfor (var item in detailedInformations) {\r\n\t\t\t\t\t\t\t\tinfos_cps_tbody += '<tr><td class=\"key\">' + item + '</td><td class=\"val\">' + detailedInformations[item] + '</td></tr>';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cps').className = dataIHM.getClientSSLInfos().div_cps_class;\r\n\r\n\t\t\t\t\t\t\t\tfor (var item in dataIHM.getClientSSLInfos().infos) {\r\n\t\t\t\t\t\t\t\t\tinfos_cps_tbody += '<tr><td class=\"key\">' + item + '</td><td class=\"val\">' + dataIHM.getClientSSLInfos().infos[item] + '</td></tr>';\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cps').className = \"cpsverso\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tdocument.getElementById('infos_cps_tbody').innerHTML = infos_cps_tbody;\r\n\t\t\t\t\t\t},\r\n\r\n\tdisplayWait:function (active) {\r\n\t\t\t\t\tif ( (active)\r\n\t\t\t\t\t\t&& (wizardStateMachine.nbRetry > 0) ) {\r\n\t\t\t\t\t\tthis.displayElementById('spin', \"flex\");\r\n\t\t\t\t\t\tdocument.getElementById('retry').innerHTML = wizardStateMachine.nbRetry;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.hideElementById('spin');\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\tdisplayDiagnosticState:function (active, state) {\r\n\t\t\t\t\t\t\t\tdiagStateContent = {\r\n\t\t\t\t\t\t\t\t\t'start':{content:'Cliquer sur la carte', style:'diagState diagStart'}\r\n\t\t\t\t\t\t\t\t\t, 'inProgress':{content:'Le diagnostic est en cours', style:'diagState diagInProgress'}\r\n\t\t\t\t\t\t\t\t\t, 'KO':{content:'Le diagnostic a &eacute;chou&eacute;', style:'diagState diagKO'}\r\n\t\t\t\t\t\t\t\t\t, 'OK':{content:'Le diagnostic a r&eacute;ussi', style:'diagState diagOK'}\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.hideElementById('diagState');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').style.display = \"block\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif (state !== undefined) {\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').className = diagStateContent[state].style;\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').innerHTML = diagStateContent[state].content;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\r\n\tdisplayInstruction: function (active, step) {\r\n\t\t\t\t\t\t\tthis.hideElementById('instructions-back');\r\n\t\t\t\t\t\t\tthis.hideElementById('instructions');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\tthis.displayElementById('instructions-back', \"flex\");\r\n\t\t\t\t\t\t\t\tthis.displayElementById('instructions', \"block\");\r\n\t\t\t\t\t\t\t\tthis.hideElementById('manualInstallClibCPS');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('manualInstallXPI');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('restartAlert');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('restartAlertXPI');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('preAlert');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('notSupported');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('contactSupport');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (step !== undefined) this.displayElementById(step, \"block\");\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar detailedInformations = dataIHM.getClientDetailedInfos();\r\n\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cryptolib').innerHTML = \"T&eacute;l&eacute;charger<br/>\" + dataIHM.getComponentInstallerName();\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (dataIHM.getUAInfos().os.name == 'Mac OS')\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('restartInstruction').innerHTML = \"Une fois l'installation de \" + dataIHM.getComponentInstallerName() + \" termin&eacute;e,<br/>veuillez red&eacute;marrer votre ordinateur.\";\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('restartInstruction').innerHTML = \"Une fois l'installation de \" + dataIHM.getComponentInstallerName() + \" termin&eacute;e,<br/>veuillez red&eacute;marrer votre navigateur.\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\r\n\tdisplaySupport: function (active) {\r\n\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\tthis.displayElementById('support-direction', \"flex\");\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.hideElementById('support-direction');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\r\n\tdisplayPreAlert: function(OSName) {\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-MacOS');\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-Windows');\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-Linux');\r\n\r\n\t\t\t\t\t\t\tif (OSName == 'Mac OS') this.displayElementById('alert1-MacOS', 'block');\r\n\t\t\t\t\t\t\tif (OSName == 'Windows') this.displayElementById('alert1-Windows', 'block');\r\n\t\t\t\t\t\t\tif (OSName == 'Linux') this.displayElementById('alert1-Linux', 'block');\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\r\n};\r\n\r\n//==================\r\n// Events Management\r\nfunction addEltEventListenerAllBrowser(elt, eventName, handle) {\r\n\tif (elt.addEventListener) { elt.addEventListener(eventName, handle, false);\r\n\t} else { elt.attachEvent(\"on\" + eventName, handle);\r\n\t}\r\n}\r\n\r\nfunction addIdEventListenerAllBrowser(id, eventName, handle) {\r\n\tif (document.getElementById(id)) addEltEventListenerAllBrowser(document.getElementById(id), eventName, handle);\r\n}\r\n\r\nfunction clickExpandCollapse(event) {\r\n\tif (document.getElementById('infos_cps_table').style.display != \"block\") {\r\n\t\tdocument.getElementById('infos_cps_caption_img').className = \"infos_cps_caption_img_collapse\";\r\n\t\tdocument.getElementById('infos_cps_table').style.display = \"block\";\r\n\t} else {\r\n\t\tdocument.getElementById('infos_cps_caption_img').className = \"infos_cps_caption_img_expand\";\r\n\t\tdocument.getElementById('infos_cps_table').style.display = \"none\";\r\n\t}\r\n\tevent.cancelBubble = true;\r\n\t\t\r\n\treturn false;\r\n}\r\n\r\nfunction clickActionNoPropagation(event) {\r\n\t//this.click();\r\n\r\n\tevent.cancelBubble = true;\r\n\r\n\treturn false;\r\n}\r\n\n<!-- script : /js/wizarddiagcps.js End -->\n<!-- script : /js/diagcps.js Begin -->\n//==================================\r\n// Global variable used for all data \r\n// displayed on screen \r\n// or used by state machine\r\n//==================================\r\nvar dataIHM = {\r\n\t//==========================\r\n\t// Root URL\r\n\tlocalURL: '',\r\n\tsetLocalURL: function(URL) {this.localURL = URL;},\r\n\tgetLocalURL: function() {return this.localURL;},\r\n\t\r\n\t//==========================\r\n\t// User Agent\r\n\tclientUAInfos: null,\r\n\ttimerUAInfos: null,\r\n\tinitUAInfos: function() {\r\n\t\t\t\t\t\tvar uaparser = new UAParser();\r\n\t\t\t\t\t\tthis.clientUAInfos = uaparser.getResult();\r\n\t\t\t\t\t\tthis.clientUAInfos.browser.xpi = true;\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tthis.timerUAInfos = setTimeout(function(){dataIHM.isUAInfosCPSWebEx()}, 1000);\r\n\t\t\t\t\t},\r\n\tgetUAInfos: function() {return this.clientUAInfos},\r\n\tisUAInfosCPSWebEx: function() {\r\n\t\t\t\t\tif (window.isCpsWebExAlive) {\r\n\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', window.isCpsWebExAlive());\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (this.getUAInfos().browser.name == 'Firefox') {\r\n\t\t\t\t\t\t\tif (this.getUAInfos().browser.major > 57) {\r\n\t\t\t\t\t\t\t\tthis.clientUAInfos.browser.xpi = false;\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'absente');\r\n\t\t\t\t\t\t\t\twizardStateMachine.wizard('manualInstallXPI');\r\n\t\t\t\t\t\t\t} else if (this.getUAInfos().browser.major == 57) {\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'sur cette version, l\\'installation du p&eacute;riph&eacute;rique de s&eacute;curit&eacute; doit &ecirc;tre <a href=\"http://integrateurs-cps.asipsante.fr/Installation-manuelle-PKCS11-Firefox\" target=\"_blanck\">r&eacute;alis&eacute;e manuellement</a>.');\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'd&eacute;tection impossible sur cette version');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.timerUAInfos = null;\r\n\t\t\t\t},\r\n\t\r\n\t//===============================\r\n\t// Installed Component management\r\n\tcomponentName: \"CryptolibCPS\", // By default\r\n\tsetComponentName: function(name) {this.componentName = name;},\r\n\tgetComponentName: function() {return this.componentName;},\r\n\tcomponentVersion: \"\", // By Default\r\n\tsetcomponentVersion: function(version) {this.componentVersion = version;},\r\n\tgetcomponentVersion: function() {return this.componentVersion;},\r\n\tcomponentInstallerName: \"\",\r\n\tsetComponentInstallerName: function(name) {this.componentInstallerName = name;},\r\n\tgetComponentInstallerName: function() {return this.componentInstallerName;},\r\n\tserverComponentURL: null,\r\n\tsetServerComponentURL: function(URL) {this.serverComponentURL = URL;},\r\n\tgetServerComponentLink: function(version) {\r\n\t\t\t\t\t\t\t\t\tvar componentLink = this.serverComponentURL + \"?\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"component=\" + this.getComponentName();\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&os=\" + this.getUAInfos().os.name;\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&arch=\" + this.getUAInfos().cpu.architecture;\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&version=\" + this.getcomponentVersion();\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\treturn componentLink;\r\n\t\t\t\t\t\t\t\t},\r\n\tserverComponentInfos: null,\r\n\treadServerComponentInfos: function() {\r\n\t\t\t\t\t\t\t\t// XPI 6.0.15 with Firefox < 57\r\n\t\t\t\t\t\t\t\t// ==> Use Cryptolib CPS 5.0.37 instead of last release\r\n\t\t\t\t\t\t\t\tif ((this.getUAInfos().browser.name == 'Firefox') \r\n\t\t\t\t\t\t\t\t\t&& (this.getUAInfos().browser.major < 57)) {\r\n\t\t\t\t\t\t\t\t\tswitch (this.getUAInfos().os.name) {\r\n\t\t\t\t\t\t\t\t\t\tcase 'Windows': this.setcomponentVersion('5.0.37');break;\r\n\t\t\t\t\t\t\t\t\t\tcase 'Mac OS': this.setcomponentVersion('5.0.34');break;\r\n\t\t\t\t\t\t\t\t\t\tcase 'Linux':\r\n\t\t\t\t\t\t\t\t\t\tcase 'CentOS':\r\n\t\t\t\t\t\t\t\t\t\tcase 'Ubuntu':\r\n\t\t\t\t\t\t\t\t\t\tcase 'RedHat':  this.setcomponentVersion('5.0.12');break;\r\n\t\t\t\t\t\t\t\t\t\tdefault:break;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// Use fetch if exist\r\n\t\t\t\t\t\t\t\tif (self.fetch) {\r\n\t\t\t\t\t\t\t\t\tfetch( this.getServerComponentLink() + '&filename=get' )\r\n\t\t\t\t\t\t\t\t\t.then(function(resp) {return resp.json();})\r\n\t\t\t\t\t\t\t\t\t.then(function(response) {\r\n\t\t\t\t\t\t\t\t\t\tfor (var k in response) {\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.setComponentInstallerName(response[k]);\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.addClientDetailedInfos('URL de t&eacute;l&eacute;chargement', '<a href=\"' + dataIHM.getServerComponentLink() + '\">' + dataIHM.getComponentInstallerName() + '</a>');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('readServerComponentInfos : Error with fetch (' + error.message + ')'); \r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t// Use JQuery\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$.ajax(\t{\r\n\t\t\t\t\t\t\t\t\t\turl: this.getServerComponentLink() + '&filename=get'\r\n\t\t\t\t\t\t\t\t\t\t, success: function( data) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar json;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (data === String)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson = jQuery.parseJSON(data);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson = data\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor (var k in json) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setComponentInstallerName(json[k]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.addClientDetailedInfos('URL de t&eacute;l&eacute;chargement', '<a href=\"' + dataIHM.getServerComponentLink() + '\">' + dataIHM.getComponentInstallerName() + '</a>');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t, error: function( data) { return null;}\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\r\n\t//========================================\r\n\t// Support contact informations management\r\n \tmailSupportMailbox: null,\r\n\tmailSupportDomain: null,\r\n\tsetMailSupport: function(mailbox, domain) {this.mailSupportMailbox = mailbox; this.mailSupportDomain = domain;},\r\n\tgetMailSupport: function() {return this.mailSupportMailbox + \"@\" + this.mailSupportDomain;},\r\n \t\t\r\n\t//==========================\r\n\t// Detailed informations\r\n\tclientDetailedInfos: {},\r\n\tinitClientDetailedInfos: function() {\r\n\t\t\t\t\t\t\t\tconfigSupported = true;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.getUAInfos().device.type === undefined) {\r\n\t\t\t\t\t\t\t\t\tconsole.log(\"Poste de travail\");\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tconfigSupported = false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().os.name) {\r\n\t\t\t\t\t\t\t\t\tcase 'Windows':\r\n\t\t\t\t\t\t\t\t\tcase 'Mac OS':\r\n\t\t\t\t\t\t\t\t\tcase 'Linux':\r\n\t\t\t\t\t\t\t\t\tcase 'CentOS':\r\n\t\t\t\t\t\t\t\t\tcase 'Ubuntu':\r\n\t\t\t\t\t\t\t\t\tcase 'RedHat':  configSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault: \t\tconfigSupported = configSupported & false;break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().browser.name) {\r\n\t\t\t\t\t\t\t\t\tcase 'IE':\r\n\t\t\t\t\t\t\t\t\tcase 'Safari':\r\n\t\t\t\t\t\t\t\t\tcase 'Edge':\r\n\t\t\t\t\t\t\t\t\tcase 'Chrome':\r\n\t\t\t\t\t\t\t\t\tcase 'Firefox':\tconfigSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault: \t\tconfigSupported = configSupported & false;break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().cpu.architecture) {\r\n\t\t\t\t\t\t\t\t\tcase 'ia32':\r\n\t\t\t\t\t\t\t\t\tcase 'i686':\r\n\t\t\t\t\t\t\t\t\tcase 'amd64': configSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\t\tif (this.getUAInfos().cpu.architecture === undefined)\r\n\t\t\t\t\t\t\t\t\t\t\tconfigSupported = configSupported & true;\r\n\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\tconfigSupported = configSupported & false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.getUAInfos().cpu.architecture == 'amd64')\r\n\t\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Syst&egrave;me d\\'exploitation', this.getUAInfos().os.name + \" \" + this.getUAInfos().os.version + \" (64b)\");\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Syst&egrave;me d\\'exploitation', this.getUAInfos().os.name + \" \" + this.getUAInfos().os.version);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Navigateur', this.getUAInfos().browser.name + \" \" + this.getUAInfos().browser.major);\r\n\t\t\t\t\t\t\t\t// this.addClientDetailedInfos('Compatibilit&eacute; ASIP', '<a href=\"http://integrateurs-cps.asipsante.fr/Lettre_d_information\" target=\"_blanck\">Lettre d\\'information<br/>POSTE DE TRAVAIL & Veille Technologique</a>');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.clientUAInfos.configSupported = configSupported;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\treturn configSupported;\r\n\t\t\t\t\t\t\t},\r\n\tgetClientDetailedInfos: function() {return this.clientDetailedInfos;},\r\n\taddClientDetailedInfos: function(key, value) { this.clientDetailedInfos[key] = value;},\r\n\tresetClientDetailedInfos: function() {this.clientDetailedInfos = {};},\r\n\t\t\r\n\t//==========================\r\n\t// Client SSL Informations\r\n\tclientSSLInfos: null,\r\n\tclientSSLFetchParameters: { mode:'cors', credentials: 'include', cache: 'no-cache'},\r\n\tclientSSLAjaxParameters: { cache: false, timeout: 8000, async: true},\r\n\tisDefineClientSSLInfos: function() {return (this.clientSSLInfos != undefined);},\r\n\tsetClientSSLInfos: function(data) {this.clientSSLInfos = data;},\r\n\tgetClientSSLInfos: function() {return this.clientSSLInfos;},\r\n\tinitClientSSLParameters: function() { $.ajaxSetup(this.clientSSLAjaxParameters);},\r\n\tresetClientSSLInfos: function () {\r\n\t\t\t\t\t\t\tconsole.log('resetClientSSLInfos : Erase SSL Connexion cache for ' + this.getUAInfos().browser.name);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tswitch (this.getUAInfos().browser.name) {\r\n\t\t\t\t\t\t\t\tcase 'Edge': // Works !\r\n\t\t\t\t\t\t\t\tcase 'IE': // Works !\r\n\t\t\t\t\t\t\t\t\tif (document.execCommand) document.execCommand( \"ClearAuthenticationCache\", \"false\");\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 'Firefox':\t// Works !\r\n\t\t\t\t\t\t\t\t\t//location.reload(); // Works !\r\n\t\t\t\t\t\t\t\t\tif (window.crypto) if (window.crypto.logout) window.crypto.logout(); // Works !\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 'Chrome': // Works !\r\n\t\t\t\t\t\t\t\tcase 'Safari': // Not working, restart Browser needed !\r\n\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag'); \r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\treadClientSSLInfos: function() {\r\n\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : SSL Connexion' );\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// Use fetch if exist\r\n\t\t\t\t\t\t\tif (self.fetch) {\r\n\t\t\t\t\t\t\t\t// Try to connect and get CPS informations\r\n\t\t\t\t\t\t\t\tfetch( '/visuel.php', this.clientSSLFetchParameters )\r\n\t\t\t\t\t\t\t\t.then(function(resp) {return resp.json();})\r\n\t\t\t\t\t\t\t\t.then(function(resp_json) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Success with Fetch');\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t// traitement du JSON\r\n\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(resp_json);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('endDiagWithSuccess');\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t// Case of SSL Error\r\n\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Probably SSL Error with fetch (' + error.message + ')');\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(null);\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.accelerateTimer();\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t// Use JQuery\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$.ajax(\t{\r\n\t\t\t\t\t\t\t\t\turl: 'visuel.php'\r\n\t\t\t\t\t\t\t\t\t, success: function(data, textStatus) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Success with Ajax (' + textStatus + ')');\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tif (data === String)\r\n\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(jQuery.parseJSON(data));\r\n\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(data);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('endDiagWithSuccess');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t, error: function(data, textStatus) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Probably SSL Error with Ajax (' + textStatus + ')');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(null);\r\n\t\t\t\t\t\t\t\t\t\t\twizardStateMachine.accelerateTimer();\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n}\r\n\r\n//=====\r\n// Main\r\n//=====\r\n$(function() {\r\n\t// Initialization\r\n\t//---------------\r\n\tdataIHM.initUAInfos(); // User Agent\r\n\t\r\n\tdataIHM.initClientSSLParameters();\r\n\t\r\n\t// Sp�cific parameter with no good solution @29/12/2017\r\n\tswitch (dataIHM.getUAInfos().browser.name) {\r\n\t\tcase 'IE':\r\n\t\t\tconsole.log('=========== Use Ajax =============');\r\n\t\t\tself.fetch = undefined;\r\n\t\t\tbreak;\r\n\t\tcase 'Edge':\r\n\t\tcase 'Firefox':\r\n\t\tcase 'Safari':\r\n\t\tdefault:\r\n\t\t\tconsole.log('=========== Try using fetch. If not available use Ajax =============');\r\n\t\t\tbreak;\r\n\t}\r\n\t\r\n\tdataIHM.initClientDetailedInfos(); // Informations in bottom\r\n\tdataIHM.readServerComponentInfos(); // Get from informations from Web Service\r\n\t\r\n\twizardStateMachine.startWizard(); // Start Wizard\r\n\t\t\r\n\twizardStateMachine.displayInit(dataIHM.getUAInfos().os.name);\r\n});\r\n\n<!-- script : /js/diagcps.js End -->\n\n</script>\n<script type=\"text/javascript\">\n\t// Initialization Javascript from PHP\n\tdataIHM.setComponentName('CryptolibCPS');\n\tdataIHM.setServerComponentURL('download.php');\n</script>\n<!--<div id=\"beta\"></div>-->\n<div id=\"instructions-back\" onclick=\"wizardStateMachine.wizard('exitInstruction');\">\n\t<div id=\"instructions\">\n\t\n\t\t<div class=\"screen\" id=\"preAlert\">\n\t\t\t<div class=\"instruction\"><br/>\n<h1>Assistance en cas de carte CPS non lue</h1>\n\n<h2>Pr&eacute;alablement</h2>\n<p>\nVeuillez v&eacute;rifier que votre carte est bien ins&eacute;r&eacute;e dans votre lecteur de carte ou votre terminal Vitale.<br/>\nPuis v&eacute;rifier que votre lecteur de carte ou votre terminal Vitale est correctement connect&eacute; &agrave; votre ordinateur.<br/>\n<br/>\nLa carte ins&eacute;r&eacute;e dans le lecteur doit &ecirc;tre la derni&egrave;re carte active.\n\n<table >\n\t<tr>\n\t\t<td style=\"border-top:none;\"><img src=\"images/informations32.png\" alt=\"Information :\"/></td>\n\t\t<td style=\"border-top:none;\"><i>La derni&egrave;re carte active pr&eacute;sente la date d'expiration la plus &eacute;loign&eacute;e.</i></td>\n\t</tr>\n</table>\n<br/>\nUne fois cette v&eacute;rification r&eacute;alis&eacute;e, v&eacute;rifiez que la carte est bien lue.<br/>\n</p>\n\n<div id=\"alert1-MacOS\">\n<h2>Votre ordinateur est sous Mac OS</h2>\n<p>\nSur votre syst&egrave;me d'exploitation, nous ne disposons pas de m&eacute;thode particuli&egrave;re pour v&eacute;rifier si votre carte est lue.<br/>\n<br/>\nVeuillez lancer un diagnostic de votre ordinateur et proc&eacute;der &agrave; l'installation des mises &agrave; jour sugg&eacute;r&eacute;es.<br/>\n</p>\n</div>\n\n<div id=\"alert1-Linux\">\n<h2>Votre ordinateur est sous Linux</h2>\n<p>\nSur votre syst&egrave;me d'exploitation, nous ne disposons pas de m&eacute;thode particuli&egrave;re pour v&eacute;rifier si votre carte est lue.<br/>\n<br/>\nVeuillez lancer un diagnostic de votre ordinateur et proc&eacute;der &agrave; l'installation des mises &agrave; jour sugg&eacute;r&eacute;es.<br/>\n</p>\n</div>\n\n<div id=\"alert1-Windows\">\n<h2>Votre ordinateur est sous Windows</h2>\n<b>Dans la barre des t&acirc;ches, une carte lue est signal&eacute;e par <img src=\"images/preHelper/iconeOK.png\" alt=\"Icone vert dans la barre des taches\" /> et une carte non lue par <img src=\"images/preHelper/iconeKO.png\" alt=\"Icone rouge dans la barre des taches\"/>.</b><br/>\n<h3>L'ic&ocirc;ne <img src=\"images/preHelper/iconeOK.png\" alt=\"Icone vert dans la barre des taches\"/> est introuvable</h3>\n<p>\nCliquez avec le clic droit de votre souris sur le bouton &laquo;Afficher les ic&ocirc;nes&raquo; (en bas &agrave; droite de votre &eacute;cran) ou sur la zone heure et date et selectionnez &laquo;Personnaliser les ic&ocirc;nes de notification&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/notificationsBar.png\" alt=\"Barre de notification\"/></div>\n<br/>\n<br/>\nCherchez l'ic&ocirc;ne &laquo;Gestionnaire de certificats CPS&raquo; et s&eacute;lectionnez &laquo;Afficher l'ic&ocirc;ne et les notifications&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/notificationsParameters.png\" alt=\"Parametres de notifications\"/></div>\n<br/>\nUne fois la manipulation r&eacute;alis&eacute;e vous devriez voir apparaitre l'ic&ocirc;ne (en bas &agrave; droite de votre &eacute;cran).<br/>\n<br/>\nSi l'ic&ocirc;ne n'apparait pas dans la liste, lancer le diagnostic de votre ordinateur et installez les mises &agrave; jour propos&eacute;es.<br/>\n<br/>\n</p>\n<h2>L'ic&ocirc;ne <img src=\"images/preHelper/iconeKO.png\" alt=\"Icone rouge dans la barre des taches\" /> est rouge</h2>\n<p>\nSi l'ic&ocirc;ne est encadr&eacute;e de rouge (carte non lue), assurez-vous que votre carte est bien ins&eacute;r&eacute;e dans votre lecteur, rafra&icirc;chissez le lecteur en cliquant sur l'ic&ocirc;ne avec le bouton droit de la souris. Et cliquez sur &laquo;Rafra&icirc;chir&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/rightClickCCM.png\" alt=\"Cliquer droit sur l'icone du CCM\" /></div>\n<br/>\nSi l'encadr&eacute; reste rouge apr&egrave;s la manipulation, red&eacute;marrez votre ordinateur en laissant le lecteur et la CPS connect&eacute;s.<br/>\n<br/>\nApr&egrave;s ces manipulations, si l'ic&ocirc;ne ne passe pas au vert, veuillez nous contacter.\n</p>\n<div align=\"center\"></div>\n</div>\n\n</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"startDiag\" onclick=\"wizardStateMachine.wizard('startDiag');\">Diagnostiquer mon poste</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"notSupported\">\n\t\t\t<div class=\"instruction\">Votre configuration mat&eacute;riel et/ou syst&egrave;me n'est pas support&eacute;e par nos composants logiciels. Nous ne garantissons pas le succès du diagnostic.</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"notSupported\" onclick=\"wizardStateMachine.wizard('preAlert');\">Continuer</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"manualInstallXPI\">\n\t\t\t<div class=\"instruction\" id=\"xpi_instruction\" >L'Extension Firefox n'a pas &eacute;t&eacute; d&eacute;tect&eacute;e. Elle est indispensable sous ce navigateur.<br/>Apr&egrave;s l'installation, veuillez red&eacute;marrer votre navigateur.</div>\n\t\t\t<div class=\"actions\">\n<!--\t\t\t\t<div class=\"action instruction\" id=\"xpi\" onclick=\"wizardStateMachine.wizard('XPI',{URL:'https://diagcps.eservices.esante.gouv.fr/ODI_PS/php/download_asip.php?installeur=url_interne_xpi_installation_pkcs11',IconURL:'https://diagcps.eservices.esante.gouv.fr/ODI_PS/images/asip_sante.png',Hash:'sha256:c23de3812aaf7c3a81d80e9bdf891c3e2b621e01e55e8d308226fd86ab6ef438'});\">Installer<br/>l'Extension Firefox</div>-->\n<div class=\"action instruction\" id=\"xpi\" onclick=\"wizardStateMachine.wizard('XPI',{URL:'/download.php?component=xpi',IconURL:'/images/asip_sante.png',Hash:'sha256:c23de3812aaf7c3a81d80e9bdf891c3e2b621e01e55e8d308226fd86ab6ef438'});\">Installer<br/>l'Extension Firefox</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"restartAlertXPI\">\n\t\t\t<div class=\"instruction\" id=\"restartInstructionXPI\" >Une fois l'installation de l'Extension Cryptolib CPS termin&eacute;e,<br/>veuillez red&eacute;marrer votre navigateur.</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"manualInstallClibCPS\">\n\t\t\t<div class=\"instruction\">Si vous avez ins&eacute;r&eacute; votre CPS dans votre lecteur sans succ&egrave;s, la version de Cryptolib CPS de votre poste de travail n'est peut-&ecirc;tre pas &agrave; jour.</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"cryptolib\" onclick=\"wizardStateMachine.wizard('CryptolibCPS');\">T&eacute;l&eacute;charger<br/>Cryptolib CPS</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"restartAlert\">\n\t\t\t<div class=\"instruction\" id=\"restartInstruction\" >Une fois l'installation de CryptolibCPS_vX.Y.Z termin&eacute;e, veuillez red&eacute;marrer votre navigateur.</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"contactSupport\">\n\t\t\t<div class=\"instruction\">Si vous avez installez le composant propos&eacute; sans succ&eacute;s,<br/> veuillez contacter le Support.</div>\n\t\t</div>\n\t\t\n\t</div>\n</div>\t\n<div id=\"service-direction\" class=\"column\"></div>\n<div id=\"article\">\n\t<div id=\"center\">\n\t\t<div class=\"diagState\" id=\"diagState\"></div>\n\t\t<div>\n\t\t\t<div id=\"cps\" class=\"cpsverso\" onclick=\"wizardStateMachine.wizard('restartDiag');\"><div id=\"spin\"><div id=\"retry\"></div></div></div>\n\t\t</div>\n<!--\t\t\n\t\t<div id=\"results\">\n\t\t\t<div>\n\t\t\t\t<div class=\"sign\" id=\"certificat\"></div>\n\t\t\t\t<div class=\"sign\" id=\"expired\" title=\"expire\"></div>\n\t\t\t\t<div class=\"sign\" id=\"revoc\" title=\"revoque\"></div>\n\t\t\t\t<div class=\"sign\" id=\"class\"></div>\n\t\t\t\t<div class=\"sign\" id=\"rootAC\"></div>\n\t\t\t\t<div class=\"sign\" id=\"cryptolib\" title=\"cryptolib\"></div>\n\t\t\t</div>\n\t\t</div>\n-->\n\t\t<div id=\"cps_infos\">\n\t\t\t<div id=\"infos_cps\">\n\t\t\t\t<div id=\"infos_cps_caption\"><div>Informations d&eacute;taill&eacute;es</div><div class=\"infos_cps_caption_img_expand\" id=\"infos_cps_caption_img\"></div></div>\n\t\t\t\t<table id=\"infos_cps_table\">\n\t\t\t\t\t<tbody id=\"infos_cps_tbody\"></tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n<div id=\"support-direction\" class=\"column\"></div>\n</div>\r\n<div id=\"footer\" style=\"display:flex;flex-direction:row\">\r\n    <div style=\"display:flex;flex-direction:row;width:30vw\">\r\n        <div style=\"margin:20px\">\r\n            <a href=\"https://solidarites-sante.gouv.fr/\" target=\"_blank\">\r\n                <img src=\"./images/logo-ministere.svg\" alt=\"Ministère des Solidarités et de la santé\" width=\"84\" height=\"62\">\r\n            </a>\r\n        </div>\r\n        <div style=\"margin:20px\">\r\n            <a href=\"https://esante.gouv.fr/\" target=\"_blank\">\r\n                <img src=\"./images/logo-ANS.svg\" alt=\"Agence du Numérique en Santé\" width=\"166\" height=\"50\">\r\n            </a>\r\n        </div>\r\n    </div>\r\n    <div style=\"width:60vw\">\r\n        <ul style=\"align-items:end\">\r\n            <li><a href=\"http://esante.gouv.fr/services/mentions-legales\" target=\"_blank\">Mentions l&eacute;gales</a></li>\r\n            <li><a href=\"./copyright.php\" target=\"_blank\" title=\"Copyright [nouvelle fen&ecirc;tre]\">Copyright</a></li>\r\n        </ul>\r\n    </div>\r\n</div>\r\n\r\n</body>\r\n</html>\r\n",
      "ip": "135.125.232.117",
      "timestamp": "2025-03-14T16:26:19.506366068Z",
      "curl-command": "curl -X 'GET' -H 'Accept: */*' -H 'Accept-Language: en' -H 'User-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)' 'https://diagcps.eservices.esante.gouv.fr'",
      "matcher-status": true
    },
    {
      "template": "http/misconfiguration/http-missing-security-headers.yaml",
      "template-url": "https://templates.nuclei.sh/public/http-missing-security-headers",
      "template-id": "http-missing-security-headers",
      "template-path": "/home/runner/nuclei-templates/http/misconfiguration/http-missing-security-headers.yaml",
      "info": {
        "name": "HTTP Missing Security Headers",
        "author": [
          "socketz",
          "geeknik",
          "g4l1t0",
          "convisoappsec",
          "kurohost",
          "dawid-czarnecki",
          "forgedhallpass",
          "jub0bs",
          "userdehghani"
        ],
        "tags": [
          "misconfig",
          "headers",
          "generic"
        ],
        "description": "This template searches for missing HTTP security headers. The impact of these missing headers can vary.\n",
        "severity": "info",
        "metadata": {
          "max-request": 1
        }
      },
      "matcher-name": "x-content-type-options",
      "type": "http",
      "host": "https://diagcps.eservices.esante.gouv.fr",
      "matched-at": "https://diagcps.eservices.esante.gouv.fr",
      "request": "GET / HTTP/1.1\r\nHost: diagcps.eservices.esante.gouv.fr\r\nUser-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)\r\nConnection: close\r\nAccept: */*\r\nAccept-Language: en\r\nAccept-Encoding: gzip\r\n\r\n",
      "response": "HTTP/1.1 200 OK\r\nConnection: close\r\nTransfer-Encoding: chunked\r\nContent-Type: text/html; charset=UTF-8\r\nDate: Fri, 14 Mar 2025 16:26:19 GMT\r\nServer: Apache/2.4.37 (centos) OpenSSL/1.1.1g\r\nX-Powered-By: PHP/7.2.24\r\n\r\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n\t<title>DiagCPS, Outil de Diagnostic SSL</title>\r\n\t<meta http-equiv=\"Content-type\" content=\"text/html; charset=UTF-8\" />\r\n\t<meta name=\"description\" content=\"DiagCPS est un Outil de Diagnostic de l'authentification en ligne à l'aide d'une Carte de Professionnel de Santé, i.e. CPS. Il est fourni par l'ASIP Santé et remplace ODI.\" />\r\n\t<meta name=\"Publisher\" content=\"ASIP Santé\" />\r\n\t<meta name=\"copyright\" content=\"Tous droits réservés - ASIP Santé\" />\r\n\t<link rel=\"shortcut icon\" href=\"./images/favicon.ico\" type=\"image/x-icon\" />\r\n\t<link rel=\"stylesheet\" href=\"diagcps_css.php\" />\r\n\t<script src=\"./js/jquery-3.2.0.min.js\"></script>\r\n\t<script src=\"./js/ua-parser.min.js\"></script>\r\n</head>\r\n<body>\r\n<div id=\"header\" style=\"display:flex;flex-direction:row\">\r\n    <div style=\"margin:20px\">\r\n        <a href=\"https://solidarites-sante.gouv.fr/\" target=\"_blank\">\r\n            <img src=\"./images/logo-ministere.svg\" alt=\"Ministère des Solidarités et de la santé\" width=\"168\" height=\"104\">\r\n        </a>\r\n    </div>\r\n\t<div id=\"title\">esante.gouv.fr</div>\r\n</div>\r\n<div id=\"section\">\r\n<script type=\"text/javascript\">\n\n<!-- script : /js/wizarddiagcps.js Begin -->\n//==================================\r\n// Global variable used for state machine management \r\n// displayed on screen \r\n// or used by state machine\r\n//==================================\r\nvar wizardStateMachine = {\r\n\tstartState: 'notSupported',\r\n\tlastState: 'notSupported',\r\n\t\r\n\t//=================\r\n\t// Retry Management\r\n\t// Variables\r\n\tnbMaxRetry: 10,\r\n\tnbRetry: 0,\r\n\t\r\n\t// Management\r\n\tinitRetry: function() {this.nbRetry = this.nbMaxRetry;},\r\n\tisMaxRetry: function() {return (this.nbRetry >= this.nbMaxRetry);},\r\n\tisMinRetry: function() {return (this.nbRetry <= 0);},\r\n\tdecRetry: function() {this.nbRetry--;},\r\n\tdisplayRetry: function() {\r\n\t\t\t\t\t\t\t\t//console.log(\"displayRetry : nbRetry = \" + this.nbRetry);\r\n\t\t\t\t\t\t\t\tthis.decRetry();\r\n\t\t\t\t\t\t\t\tthis.stopTimers(); \r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.isMinRetry()\r\n\t\t\t\t\t\t\t\t\t&& \t(this.lastState != 'endDiagWithSuccess')) {\r\n\t\t\t\t\t\t\t\t\tthis.wizard('manualInstallClibCPS');\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tthis.displayWait(true);\r\n\t\t\t\t\t\t\t\t\tthis.startTimers();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\r\n\t//==================\r\n\t// Timers Management\r\n\ttimerTestSSL: null,\r\n\tretryTimeoutKO: 1000,\r\n\tinitTimer: function () {this.retryTimeoutKO = 1000;},\r\n\taccelerateTimer: function () {this.retryTimeoutKO = 250;},\r\n\tstopTimers: function() {\r\n\t\t\t\t\t\t\t\tif (this.timerTestSSL != null)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tclearTimeout(this.timerTestSSL);\r\n\t\t\t\t\t\t\t\t\tthis.timerTestSSL = null;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\tstartTimers: function() {this.timerTestSSL = setTimeout(function(){wizardStateMachine.displayRetry()}, this.retryTimeoutKO);},\r\n\t\r\n\t//=======\r\n\t// Wizard\r\n\tstartWizard: function() {this.wizard(this.startState);},\r\n\twizard: function(step, param) {\r\n\t\t\t\tconsole.log(\"wizard : step = \" + step + \", param = \" + param);\r\n\t\t\t\t\t\r\n\t\t\t\tswitch (step)\r\n\t\t\t\t{\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Pre treatment\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'notSupported':\r\n\t\t\t\t\tcase 'preAlert':\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'start');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif ((dataIHM.getUAInfos().configSupported) || (step == 'preAlert')) this.displayInstruction(true, 'preAlert');\r\n\t\t\t\t\t\telse this.displayInstruction(true, 'notSupported');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Manual Installation XPI\r\n\t\t\t\t\t// Suggestion of installation\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'manualInstallXPI':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'KO');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'manualInstallXPI');\r\n\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// XPI Installation\r\n\t\t\t\t\t// Installation process\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'XPI':\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'restartAlertXPI');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar params = {\r\n\t\t\t\t\t\t\t\t\"Installer l'Extension Cryptolib CPS\": \r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tURL: param.URL,\r\n\t\t\t\t\t\t\t\t\tIconURL: param.IconURL,\r\n\t\t\t\t\t\t\t\t\tHash: param.Hash,\r\n\t\t\t\t\t\t\t\t\ttoString: function () { return this.URL; }\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t};\r\nconsole.log(params);\r\n\t\t\t\t\t\tInstallTrigger.install(params);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// Diagnostic\r\n\t\t\t\t\t// Start\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'startDiag':\r\n\t\t\t\t\t\tthis.initRetry();\r\n\t\t\t\t\t\tthis.initTimer();\r\n\r\n\t\t\t\t\t\tthis.displayWait(true);\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'inProgress');\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tdataIHM.readClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.startTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// Diagnostic\r\n\t\t\t\t\t// Restart\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'restartDiag':\r\n\r\n\t\t\t\t\t\tdataIHM.resetClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\r\n\t\t\t\t\t//==========================\r\n\t\t\t\t\t// Progression\r\n\t\t\t\t\t//--------------------------\r\n\t\t\t\t\tcase 'inProgress':\r\n\t\t\t\t\t\t//dataIHM.readClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// this.displayDiagnosticState(true, 'inProgress');\r\n\t\t\t\t\t\t// this.displayInstruction(false);\r\n\t\t\t\t\t\t// this.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//===================\r\n\t\t\t\t\t// Ends\r\n\t\t\t\t\t//-------------------\r\n\t\t\t\t\tcase 'endDiagWithSuccess':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'OK');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tthis.displaySupport(false);\r\n\t\t\t\t\t\tthis.displayInfosCPS(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Manual Installation Cryptolib CPS\r\n\t\t\t\t\t// Suggestion of installation\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'manualInstallClibCPS':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'KO');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'manualInstallClibCPS');\r\n\t\t\t\t\t\tthis.displaySupport(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//=======================\r\n\t\t\t\t\t// Cryptolib CPS download\r\n\t\t\t\t\t// Installation process\r\n\t\t\t\t\t//-----------------------\r\n\t\t\t\t\tcase 'CryptolibCPS':\r\n\t\t\t\t\t\twindow.location = dataIHM.getServerComponentLink();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// Direct jump to Retry after installation\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'restartAlert');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\t\r\n\t\t\t\t\t//=========================\r\n\t\t\t\t\t// Other\r\n\t\t\t\t\t// Close Instruction screen\r\n\t\t\t\t\t//-------------------------\r\n\t\t\t\t\tcase 'exitInstruction':\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true);\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t// Open Support link\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'openSupport':\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tif (param !== undefined) window.open(param.URL,'_blank');\r\n\t\t\t\t\t\tbreak;\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.lastState = step;\r\n\t\t\t},\r\n\t\r\n\t//==========================\r\n\t// Screen Display Management\r\n\tdisplayElementById: function(id, display) {\r\n\t\t\t\t\t\t\tdocument.getElementById(id).style.display = display;\r\n\t\t\t\t\t\t},\r\n\thideElementById: function(id) {\r\n\t\t\t\t\t\t\tthis.displayElementById(id, \"none\");\r\n\t\t\t\t\t\t},\r\n\tdisplayInit: function(OSName) {\r\n\t\t\t\t\t\t// Events initialization\r\n\t\t\t\t\t\t//----------------------\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"cryptolib\", \t\t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"notSupported\", \t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"startDiag\", \t\t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"instructions-back\", \t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"infos_cps_caption\", \t\"click\", clickExpandCollapse);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// PreAlert initialization\r\n\t\t\t\t\t\t//------------------------\r\n\t\t\t\t\t\tthis.displayPreAlert(OSName);\r\n\t\t\t\t\t},\r\n\tdisplayInfosCPS: function (active) {\r\n\t\t\t\t\t\t\tvar infos_cps_tbody = '';\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar detailedInformations = dataIHM.getClientDetailedInfos();\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tfor (var item in detailedInformations) {\r\n\t\t\t\t\t\t\t\tinfos_cps_tbody += '<tr><td class=\"key\">' + item + '</td><td class=\"val\">' + detailedInformations[item] + '</td></tr>';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cps').className = dataIHM.getClientSSLInfos().div_cps_class;\r\n\r\n\t\t\t\t\t\t\t\tfor (var item in dataIHM.getClientSSLInfos().infos) {\r\n\t\t\t\t\t\t\t\t\tinfos_cps_tbody += '<tr><td class=\"key\">' + item + '</td><td class=\"val\">' + dataIHM.getClientSSLInfos().infos[item] + '</td></tr>';\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cps').className = \"cpsverso\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tdocument.getElementById('infos_cps_tbody').innerHTML = infos_cps_tbody;\r\n\t\t\t\t\t\t},\r\n\r\n\tdisplayWait:function (active) {\r\n\t\t\t\t\tif ( (active)\r\n\t\t\t\t\t\t&& (wizardStateMachine.nbRetry > 0) ) {\r\n\t\t\t\t\t\tthis.displayElementById('spin', \"flex\");\r\n\t\t\t\t\t\tdocument.getElementById('retry').innerHTML = wizardStateMachine.nbRetry;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.hideElementById('spin');\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\tdisplayDiagnosticState:function (active, state) {\r\n\t\t\t\t\t\t\t\tdiagStateContent = {\r\n\t\t\t\t\t\t\t\t\t'start':{content:'Cliquer sur la carte', style:'diagState diagStart'}\r\n\t\t\t\t\t\t\t\t\t, 'inProgress':{content:'Le diagnostic est en cours', style:'diagState diagInProgress'}\r\n\t\t\t\t\t\t\t\t\t, 'KO':{content:'Le diagnostic a &eacute;chou&eacute;', style:'diagState diagKO'}\r\n\t\t\t\t\t\t\t\t\t, 'OK':{content:'Le diagnostic a r&eacute;ussi', style:'diagState diagOK'}\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.hideElementById('diagState');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').style.display = \"block\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif (state !== undefined) {\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').className = diagStateContent[state].style;\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').innerHTML = diagStateContent[state].content;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\r\n\tdisplayInstruction: function (active, step) {\r\n\t\t\t\t\t\t\tthis.hideElementById('instructions-back');\r\n\t\t\t\t\t\t\tthis.hideElementById('instructions');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\tthis.displayElementById('instructions-back', \"flex\");\r\n\t\t\t\t\t\t\t\tthis.displayElementById('instructions', \"block\");\r\n\t\t\t\t\t\t\t\tthis.hideElementById('manualInstallClibCPS');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('manualInstallXPI');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('restartAlert');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('restartAlertXPI');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('preAlert');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('notSupported');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('contactSupport');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (step !== undefined) this.displayElementById(step, \"block\");\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar detailedInformations = dataIHM.getClientDetailedInfos();\r\n\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cryptolib').innerHTML = \"T&eacute;l&eacute;charger<br/>\" + dataIHM.getComponentInstallerName();\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (dataIHM.getUAInfos().os.name == 'Mac OS')\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('restartInstruction').innerHTML = \"Une fois l'installation de \" + dataIHM.getComponentInstallerName() + \" termin&eacute;e,<br/>veuillez red&eacute;marrer votre ordinateur.\";\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('restartInstruction').innerHTML = \"Une fois l'installation de \" + dataIHM.getComponentInstallerName() + \" termin&eacute;e,<br/>veuillez red&eacute;marrer votre navigateur.\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\r\n\tdisplaySupport: function (active) {\r\n\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\tthis.displayElementById('support-direction', \"flex\");\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.hideElementById('support-direction');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\r\n\tdisplayPreAlert: function(OSName) {\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-MacOS');\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-Windows');\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-Linux');\r\n\r\n\t\t\t\t\t\t\tif (OSName == 'Mac OS') this.displayElementById('alert1-MacOS', 'block');\r\n\t\t\t\t\t\t\tif (OSName == 'Windows') this.displayElementById('alert1-Windows', 'block');\r\n\t\t\t\t\t\t\tif (OSName == 'Linux') this.displayElementById('alert1-Linux', 'block');\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\r\n};\r\n\r\n//==================\r\n// Events Management\r\nfunction addEltEventListenerAllBrowser(elt, eventName, handle) {\r\n\tif (elt.addEventListener) { elt.addEventListener(eventName, handle, false);\r\n\t} else { elt.attachEvent(\"on\" + eventName, handle);\r\n\t}\r\n}\r\n\r\nfunction addIdEventListenerAllBrowser(id, eventName, handle) {\r\n\tif (document.getElementById(id)) addEltEventListenerAllBrowser(document.getElementById(id), eventName, handle);\r\n}\r\n\r\nfunction clickExpandCollapse(event) {\r\n\tif (document.getElementById('infos_cps_table').style.display != \"block\") {\r\n\t\tdocument.getElementById('infos_cps_caption_img').className = \"infos_cps_caption_img_collapse\";\r\n\t\tdocument.getElementById('infos_cps_table').style.display = \"block\";\r\n\t} else {\r\n\t\tdocument.getElementById('infos_cps_caption_img').className = \"infos_cps_caption_img_expand\";\r\n\t\tdocument.getElementById('infos_cps_table').style.display = \"none\";\r\n\t}\r\n\tevent.cancelBubble = true;\r\n\t\t\r\n\treturn false;\r\n}\r\n\r\nfunction clickActionNoPropagation(event) {\r\n\t//this.click();\r\n\r\n\tevent.cancelBubble = true;\r\n\r\n\treturn false;\r\n}\r\n\n<!-- script : /js/wizarddiagcps.js End -->\n<!-- script : /js/diagcps.js Begin -->\n//==================================\r\n// Global variable used for all data \r\n// displayed on screen \r\n// or used by state machine\r\n//==================================\r\nvar dataIHM = {\r\n\t//==========================\r\n\t// Root URL\r\n\tlocalURL: '',\r\n\tsetLocalURL: function(URL) {this.localURL = URL;},\r\n\tgetLocalURL: function() {return this.localURL;},\r\n\t\r\n\t//==========================\r\n\t// User Agent\r\n\tclientUAInfos: null,\r\n\ttimerUAInfos: null,\r\n\tinitUAInfos: function() {\r\n\t\t\t\t\t\tvar uaparser = new UAParser();\r\n\t\t\t\t\t\tthis.clientUAInfos = uaparser.getResult();\r\n\t\t\t\t\t\tthis.clientUAInfos.browser.xpi = true;\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tthis.timerUAInfos = setTimeout(function(){dataIHM.isUAInfosCPSWebEx()}, 1000);\r\n\t\t\t\t\t},\r\n\tgetUAInfos: function() {return this.clientUAInfos},\r\n\tisUAInfosCPSWebEx: function() {\r\n\t\t\t\t\tif (window.isCpsWebExAlive) {\r\n\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', window.isCpsWebExAlive());\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (this.getUAInfos().browser.name == 'Firefox') {\r\n\t\t\t\t\t\t\tif (this.getUAInfos().browser.major > 57) {\r\n\t\t\t\t\t\t\t\tthis.clientUAInfos.browser.xpi = false;\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'absente');\r\n\t\t\t\t\t\t\t\twizardStateMachine.wizard('manualInstallXPI');\r\n\t\t\t\t\t\t\t} else if (this.getUAInfos().browser.major == 57) {\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'sur cette version, l\\'installation du p&eacute;riph&eacute;rique de s&eacute;curit&eacute; doit &ecirc;tre <a href=\"http://integrateurs-cps.asipsante.fr/Installation-manuelle-PKCS11-Firefox\" target=\"_blanck\">r&eacute;alis&eacute;e manuellement</a>.');\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'd&eacute;tection impossible sur cette version');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.timerUAInfos = null;\r\n\t\t\t\t},\r\n\t\r\n\t//===============================\r\n\t// Installed Component management\r\n\tcomponentName: \"CryptolibCPS\", // By default\r\n\tsetComponentName: function(name) {this.componentName = name;},\r\n\tgetComponentName: function() {return this.componentName;},\r\n\tcomponentVersion: \"\", // By Default\r\n\tsetcomponentVersion: function(version) {this.componentVersion = version;},\r\n\tgetcomponentVersion: function() {return this.componentVersion;},\r\n\tcomponentInstallerName: \"\",\r\n\tsetComponentInstallerName: function(name) {this.componentInstallerName = name;},\r\n\tgetComponentInstallerName: function() {return this.componentInstallerName;},\r\n\tserverComponentURL: null,\r\n\tsetServerComponentURL: function(URL) {this.serverComponentURL = URL;},\r\n\tgetServerComponentLink: function(version) {\r\n\t\t\t\t\t\t\t\t\tvar componentLink = this.serverComponentURL + \"?\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"component=\" + this.getComponentName();\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&os=\" + this.getUAInfos().os.name;\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&arch=\" + this.getUAInfos().cpu.architecture;\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&version=\" + this.getcomponentVersion();\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\treturn componentLink;\r\n\t\t\t\t\t\t\t\t},\r\n\tserverComponentInfos: null,\r\n\treadServerComponentInfos: function() {\r\n\t\t\t\t\t\t\t\t// XPI 6.0.15 with Firefox < 57\r\n\t\t\t\t\t\t\t\t// ==> Use Cryptolib CPS 5.0.37 instead of last release\r\n\t\t\t\t\t\t\t\tif ((this.getUAInfos().browser.name == 'Firefox') \r\n\t\t\t\t\t\t\t\t\t&& (this.getUAInfos().browser.major < 57)) {\r\n\t\t\t\t\t\t\t\t\tswitch (this.getUAInfos().os.name) {\r\n\t\t\t\t\t\t\t\t\t\tcase 'Windows': this.setcomponentVersion('5.0.37');break;\r\n\t\t\t\t\t\t\t\t\t\tcase 'Mac OS': this.setcomponentVersion('5.0.34');break;\r\n\t\t\t\t\t\t\t\t\t\tcase 'Linux':\r\n\t\t\t\t\t\t\t\t\t\tcase 'CentOS':\r\n\t\t\t\t\t\t\t\t\t\tcase 'Ubuntu':\r\n\t\t\t\t\t\t\t\t\t\tcase 'RedHat':  this.setcomponentVersion('5.0.12');break;\r\n\t\t\t\t\t\t\t\t\t\tdefault:break;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// Use fetch if exist\r\n\t\t\t\t\t\t\t\tif (self.fetch) {\r\n\t\t\t\t\t\t\t\t\tfetch( this.getServerComponentLink() + '&filename=get' )\r\n\t\t\t\t\t\t\t\t\t.then(function(resp) {return resp.json();})\r\n\t\t\t\t\t\t\t\t\t.then(function(response) {\r\n\t\t\t\t\t\t\t\t\t\tfor (var k in response) {\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.setComponentInstallerName(response[k]);\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.addClientDetailedInfos('URL de t&eacute;l&eacute;chargement', '<a href=\"' + dataIHM.getServerComponentLink() + '\">' + dataIHM.getComponentInstallerName() + '</a>');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('readServerComponentInfos : Error with fetch (' + error.message + ')'); \r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t// Use JQuery\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$.ajax(\t{\r\n\t\t\t\t\t\t\t\t\t\turl: this.getServerComponentLink() + '&filename=get'\r\n\t\t\t\t\t\t\t\t\t\t, success: function( data) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar json;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (data === String)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson = jQuery.parseJSON(data);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson = data\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor (var k in json) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setComponentInstallerName(json[k]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.addClientDetailedInfos('URL de t&eacute;l&eacute;chargement', '<a href=\"' + dataIHM.getServerComponentLink() + '\">' + dataIHM.getComponentInstallerName() + '</a>');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t, error: function( data) { return null;}\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\r\n\t//========================================\r\n\t// Support contact informations management\r\n \tmailSupportMailbox: null,\r\n\tmailSupportDomain: null,\r\n\tsetMailSupport: function(mailbox, domain) {this.mailSupportMailbox = mailbox; this.mailSupportDomain = domain;},\r\n\tgetMailSupport: function() {return this.mailSupportMailbox + \"@\" + this.mailSupportDomain;},\r\n \t\t\r\n\t//==========================\r\n\t// Detailed informations\r\n\tclientDetailedInfos: {},\r\n\tinitClientDetailedInfos: function() {\r\n\t\t\t\t\t\t\t\tconfigSupported = true;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.getUAInfos().device.type === undefined) {\r\n\t\t\t\t\t\t\t\t\tconsole.log(\"Poste de travail\");\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tconfigSupported = false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().os.name) {\r\n\t\t\t\t\t\t\t\t\tcase 'Windows':\r\n\t\t\t\t\t\t\t\t\tcase 'Mac OS':\r\n\t\t\t\t\t\t\t\t\tcase 'Linux':\r\n\t\t\t\t\t\t\t\t\tcase 'CentOS':\r\n\t\t\t\t\t\t\t\t\tcase 'Ubuntu':\r\n\t\t\t\t\t\t\t\t\tcase 'RedHat':  configSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault: \t\tconfigSupported = configSupported & false;break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().browser.name) {\r\n\t\t\t\t\t\t\t\t\tcase 'IE':\r\n\t\t\t\t\t\t\t\t\tcase 'Safari':\r\n\t\t\t\t\t\t\t\t\tcase 'Edge':\r\n\t\t\t\t\t\t\t\t\tcase 'Chrome':\r\n\t\t\t\t\t\t\t\t\tcase 'Firefox':\tconfigSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault: \t\tconfigSupported = configSupported & false;break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().cpu.architecture) {\r\n\t\t\t\t\t\t\t\t\tcase 'ia32':\r\n\t\t\t\t\t\t\t\t\tcase 'i686':\r\n\t\t\t\t\t\t\t\t\tcase 'amd64': configSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\t\tif (this.getUAInfos().cpu.architecture === undefined)\r\n\t\t\t\t\t\t\t\t\t\t\tconfigSupported = configSupported & true;\r\n\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\tconfigSupported = configSupported & false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.getUAInfos().cpu.architecture == 'amd64')\r\n\t\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Syst&egrave;me d\\'exploitation', this.getUAInfos().os.name + \" \" + this.getUAInfos().os.version + \" (64b)\");\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Syst&egrave;me d\\'exploitation', this.getUAInfos().os.name + \" \" + this.getUAInfos().os.version);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Navigateur', this.getUAInfos().browser.name + \" \" + this.getUAInfos().browser.major);\r\n\t\t\t\t\t\t\t\t// this.addClientDetailedInfos('Compatibilit&eacute; ASIP', '<a href=\"http://integrateurs-cps.asipsante.fr/Lettre_d_information\" target=\"_blanck\">Lettre d\\'information<br/>POSTE DE TRAVAIL & Veille Technologique</a>');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.clientUAInfos.configSupported = configSupported;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\treturn configSupported;\r\n\t\t\t\t\t\t\t},\r\n\tgetClientDetailedInfos: function() {return this.clientDetailedInfos;},\r\n\taddClientDetailedInfos: function(key, value) { this.clientDetailedInfos[key] = value;},\r\n\tresetClientDetailedInfos: function() {this.clientDetailedInfos = {};},\r\n\t\t\r\n\t//==========================\r\n\t// Client SSL Informations\r\n\tclientSSLInfos: null,\r\n\tclientSSLFetchParameters: { mode:'cors', credentials: 'include', cache: 'no-cache'},\r\n\tclientSSLAjaxParameters: { cache: false, timeout: 8000, async: true},\r\n\tisDefineClientSSLInfos: function() {return (this.clientSSLInfos != undefined);},\r\n\tsetClientSSLInfos: function(data) {this.clientSSLInfos = data;},\r\n\tgetClientSSLInfos: function() {return this.clientSSLInfos;},\r\n\tinitClientSSLParameters: function() { $.ajaxSetup(this.clientSSLAjaxParameters);},\r\n\tresetClientSSLInfos: function () {\r\n\t\t\t\t\t\t\tconsole.log('resetClientSSLInfos : Erase SSL Connexion cache for ' + this.getUAInfos().browser.name);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tswitch (this.getUAInfos().browser.name) {\r\n\t\t\t\t\t\t\t\tcase 'Edge': // Works !\r\n\t\t\t\t\t\t\t\tcase 'IE': // Works !\r\n\t\t\t\t\t\t\t\t\tif (document.execCommand) document.execCommand( \"ClearAuthenticationCache\", \"false\");\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 'Firefox':\t// Works !\r\n\t\t\t\t\t\t\t\t\t//location.reload(); // Works !\r\n\t\t\t\t\t\t\t\t\tif (window.crypto) if (window.crypto.logout) window.crypto.logout(); // Works !\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 'Chrome': // Works !\r\n\t\t\t\t\t\t\t\tcase 'Safari': // Not working, restart Browser needed !\r\n\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag'); \r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\treadClientSSLInfos: function() {\r\n\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : SSL Connexion' );\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// Use fetch if exist\r\n\t\t\t\t\t\t\tif (self.fetch) {\r\n\t\t\t\t\t\t\t\t// Try to connect and get CPS informations\r\n\t\t\t\t\t\t\t\tfetch( '/visuel.php', this.clientSSLFetchParameters )\r\n\t\t\t\t\t\t\t\t.then(function(resp) {return resp.json();})\r\n\t\t\t\t\t\t\t\t.then(function(resp_json) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Success with Fetch');\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t// traitement du JSON\r\n\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(resp_json);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('endDiagWithSuccess');\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t// Case of SSL Error\r\n\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Probably SSL Error with fetch (' + error.message + ')');\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(null);\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.accelerateTimer();\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t// Use JQuery\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$.ajax(\t{\r\n\t\t\t\t\t\t\t\t\turl: 'visuel.php'\r\n\t\t\t\t\t\t\t\t\t, success: function(data, textStatus) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Success with Ajax (' + textStatus + ')');\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tif (data === String)\r\n\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(jQuery.parseJSON(data));\r\n\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(data);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('endDiagWithSuccess');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t, error: function(data, textStatus) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Probably SSL Error with Ajax (' + textStatus + ')');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(null);\r\n\t\t\t\t\t\t\t\t\t\t\twizardStateMachine.accelerateTimer();\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n}\r\n\r\n//=====\r\n// Main\r\n//=====\r\n$(function() {\r\n\t// Initialization\r\n\t//---------------\r\n\tdataIHM.initUAInfos(); // User Agent\r\n\t\r\n\tdataIHM.initClientSSLParameters();\r\n\t\r\n\t// Sp�cific parameter with no good solution @29/12/2017\r\n\tswitch (dataIHM.getUAInfos().browser.name) {\r\n\t\tcase 'IE':\r\n\t\t\tconsole.log('=========== Use Ajax =============');\r\n\t\t\tself.fetch = undefined;\r\n\t\t\tbreak;\r\n\t\tcase 'Edge':\r\n\t\tcase 'Firefox':\r\n\t\tcase 'Safari':\r\n\t\tdefault:\r\n\t\t\tconsole.log('=========== Try using fetch. If not available use Ajax =============');\r\n\t\t\tbreak;\r\n\t}\r\n\t\r\n\tdataIHM.initClientDetailedInfos(); // Informations in bottom\r\n\tdataIHM.readServerComponentInfos(); // Get from informations from Web Service\r\n\t\r\n\twizardStateMachine.startWizard(); // Start Wizard\r\n\t\t\r\n\twizardStateMachine.displayInit(dataIHM.getUAInfos().os.name);\r\n});\r\n\n<!-- script : /js/diagcps.js End -->\n\n</script>\n<script type=\"text/javascript\">\n\t// Initialization Javascript from PHP\n\tdataIHM.setComponentName('CryptolibCPS');\n\tdataIHM.setServerComponentURL('download.php');\n</script>\n<!--<div id=\"beta\"></div>-->\n<div id=\"instructions-back\" onclick=\"wizardStateMachine.wizard('exitInstruction');\">\n\t<div id=\"instructions\">\n\t\n\t\t<div class=\"screen\" id=\"preAlert\">\n\t\t\t<div class=\"instruction\"><br/>\n<h1>Assistance en cas de carte CPS non lue</h1>\n\n<h2>Pr&eacute;alablement</h2>\n<p>\nVeuillez v&eacute;rifier que votre carte est bien ins&eacute;r&eacute;e dans votre lecteur de carte ou votre terminal Vitale.<br/>\nPuis v&eacute;rifier que votre lecteur de carte ou votre terminal Vitale est correctement connect&eacute; &agrave; votre ordinateur.<br/>\n<br/>\nLa carte ins&eacute;r&eacute;e dans le lecteur doit &ecirc;tre la derni&egrave;re carte active.\n\n<table >\n\t<tr>\n\t\t<td style=\"border-top:none;\"><img src=\"images/informations32.png\" alt=\"Information :\"/></td>\n\t\t<td style=\"border-top:none;\"><i>La derni&egrave;re carte active pr&eacute;sente la date d'expiration la plus &eacute;loign&eacute;e.</i></td>\n\t</tr>\n</table>\n<br/>\nUne fois cette v&eacute;rification r&eacute;alis&eacute;e, v&eacute;rifiez que la carte est bien lue.<br/>\n</p>\n\n<div id=\"alert1-MacOS\">\n<h2>Votre ordinateur est sous Mac OS</h2>\n<p>\nSur votre syst&egrave;me d'exploitation, nous ne disposons pas de m&eacute;thode particuli&egrave;re pour v&eacute;rifier si votre carte est lue.<br/>\n<br/>\nVeuillez lancer un diagnostic de votre ordinateur et proc&eacute;der &agrave; l'installation des mises &agrave; jour sugg&eacute;r&eacute;es.<br/>\n</p>\n</div>\n\n<div id=\"alert1-Linux\">\n<h2>Votre ordinateur est sous Linux</h2>\n<p>\nSur votre syst&egrave;me d'exploitation, nous ne disposons pas de m&eacute;thode particuli&egrave;re pour v&eacute;rifier si votre carte est lue.<br/>\n<br/>\nVeuillez lancer un diagnostic de votre ordinateur et proc&eacute;der &agrave; l'installation des mises &agrave; jour sugg&eacute;r&eacute;es.<br/>\n</p>\n</div>\n\n<div id=\"alert1-Windows\">\n<h2>Votre ordinateur est sous Windows</h2>\n<b>Dans la barre des t&acirc;ches, une carte lue est signal&eacute;e par <img src=\"images/preHelper/iconeOK.png\" alt=\"Icone vert dans la barre des taches\" /> et une carte non lue par <img src=\"images/preHelper/iconeKO.png\" alt=\"Icone rouge dans la barre des taches\"/>.</b><br/>\n<h3>L'ic&ocirc;ne <img src=\"images/preHelper/iconeOK.png\" alt=\"Icone vert dans la barre des taches\"/> est introuvable</h3>\n<p>\nCliquez avec le clic droit de votre souris sur le bouton &laquo;Afficher les ic&ocirc;nes&raquo; (en bas &agrave; droite de votre &eacute;cran) ou sur la zone heure et date et selectionnez &laquo;Personnaliser les ic&ocirc;nes de notification&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/notificationsBar.png\" alt=\"Barre de notification\"/></div>\n<br/>\n<br/>\nCherchez l'ic&ocirc;ne &laquo;Gestionnaire de certificats CPS&raquo; et s&eacute;lectionnez &laquo;Afficher l'ic&ocirc;ne et les notifications&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/notificationsParameters.png\" alt=\"Parametres de notifications\"/></div>\n<br/>\nUne fois la manipulation r&eacute;alis&eacute;e vous devriez voir apparaitre l'ic&ocirc;ne (en bas &agrave; droite de votre &eacute;cran).<br/>\n<br/>\nSi l'ic&ocirc;ne n'apparait pas dans la liste, lancer le diagnostic de votre ordinateur et installez les mises &agrave; jour propos&eacute;es.<br/>\n<br/>\n</p>\n<h2>L'ic&ocirc;ne <img src=\"images/preHelper/iconeKO.png\" alt=\"Icone rouge dans la barre des taches\" /> est rouge</h2>\n<p>\nSi l'ic&ocirc;ne est encadr&eacute;e de rouge (carte non lue), assurez-vous que votre carte est bien ins&eacute;r&eacute;e dans votre lecteur, rafra&icirc;chissez le lecteur en cliquant sur l'ic&ocirc;ne avec le bouton droit de la souris. Et cliquez sur &laquo;Rafra&icirc;chir&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/rightClickCCM.png\" alt=\"Cliquer droit sur l'icone du CCM\" /></div>\n<br/>\nSi l'encadr&eacute; reste rouge apr&egrave;s la manipulation, red&eacute;marrez votre ordinateur en laissant le lecteur et la CPS connect&eacute;s.<br/>\n<br/>\nApr&egrave;s ces manipulations, si l'ic&ocirc;ne ne passe pas au vert, veuillez nous contacter.\n</p>\n<div align=\"center\"></div>\n</div>\n\n</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"startDiag\" onclick=\"wizardStateMachine.wizard('startDiag');\">Diagnostiquer mon poste</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"notSupported\">\n\t\t\t<div class=\"instruction\">Votre configuration mat&eacute;riel et/ou syst&egrave;me n'est pas support&eacute;e par nos composants logiciels. Nous ne garantissons pas le succès du diagnostic.</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"notSupported\" onclick=\"wizardStateMachine.wizard('preAlert');\">Continuer</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"manualInstallXPI\">\n\t\t\t<div class=\"instruction\" id=\"xpi_instruction\" >L'Extension Firefox n'a pas &eacute;t&eacute; d&eacute;tect&eacute;e. Elle est indispensable sous ce navigateur.<br/>Apr&egrave;s l'installation, veuillez red&eacute;marrer votre navigateur.</div>\n\t\t\t<div class=\"actions\">\n<!--\t\t\t\t<div class=\"action instruction\" id=\"xpi\" onclick=\"wizardStateMachine.wizard('XPI',{URL:'https://diagcps.eservices.esante.gouv.fr/ODI_PS/php/download_asip.php?installeur=url_interne_xpi_installation_pkcs11',IconURL:'https://diagcps.eservices.esante.gouv.fr/ODI_PS/images/asip_sante.png',Hash:'sha256:c23de3812aaf7c3a81d80e9bdf891c3e2b621e01e55e8d308226fd86ab6ef438'});\">Installer<br/>l'Extension Firefox</div>-->\n<div class=\"action instruction\" id=\"xpi\" onclick=\"wizardStateMachine.wizard('XPI',{URL:'/download.php?component=xpi',IconURL:'/images/asip_sante.png',Hash:'sha256:c23de3812aaf7c3a81d80e9bdf891c3e2b621e01e55e8d308226fd86ab6ef438'});\">Installer<br/>l'Extension Firefox</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"restartAlertXPI\">\n\t\t\t<div class=\"instruction\" id=\"restartInstructionXPI\" >Une fois l'installation de l'Extension Cryptolib CPS termin&eacute;e,<br/>veuillez red&eacute;marrer votre navigateur.</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"manualInstallClibCPS\">\n\t\t\t<div class=\"instruction\">Si vous avez ins&eacute;r&eacute; votre CPS dans votre lecteur sans succ&egrave;s, la version de Cryptolib CPS de votre poste de travail n'est peut-&ecirc;tre pas &agrave; jour.</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"cryptolib\" onclick=\"wizardStateMachine.wizard('CryptolibCPS');\">T&eacute;l&eacute;charger<br/>Cryptolib CPS</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"restartAlert\">\n\t\t\t<div class=\"instruction\" id=\"restartInstruction\" >Une fois l'installation de CryptolibCPS_vX.Y.Z termin&eacute;e, veuillez red&eacute;marrer votre navigateur.</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"contactSupport\">\n\t\t\t<div class=\"instruction\">Si vous avez installez le composant propos&eacute; sans succ&eacute;s,<br/> veuillez contacter le Support.</div>\n\t\t</div>\n\t\t\n\t</div>\n</div>\t\n<div id=\"service-direction\" class=\"column\"></div>\n<div id=\"article\">\n\t<div id=\"center\">\n\t\t<div class=\"diagState\" id=\"diagState\"></div>\n\t\t<div>\n\t\t\t<div id=\"cps\" class=\"cpsverso\" onclick=\"wizardStateMachine.wizard('restartDiag');\"><div id=\"spin\"><div id=\"retry\"></div></div></div>\n\t\t</div>\n<!--\t\t\n\t\t<div id=\"results\">\n\t\t\t<div>\n\t\t\t\t<div class=\"sign\" id=\"certificat\"></div>\n\t\t\t\t<div class=\"sign\" id=\"expired\" title=\"expire\"></div>\n\t\t\t\t<div class=\"sign\" id=\"revoc\" title=\"revoque\"></div>\n\t\t\t\t<div class=\"sign\" id=\"class\"></div>\n\t\t\t\t<div class=\"sign\" id=\"rootAC\"></div>\n\t\t\t\t<div class=\"sign\" id=\"cryptolib\" title=\"cryptolib\"></div>\n\t\t\t</div>\n\t\t</div>\n-->\n\t\t<div id=\"cps_infos\">\n\t\t\t<div id=\"infos_cps\">\n\t\t\t\t<div id=\"infos_cps_caption\"><div>Informations d&eacute;taill&eacute;es</div><div class=\"infos_cps_caption_img_expand\" id=\"infos_cps_caption_img\"></div></div>\n\t\t\t\t<table id=\"infos_cps_table\">\n\t\t\t\t\t<tbody id=\"infos_cps_tbody\"></tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n<div id=\"support-direction\" class=\"column\"></div>\n</div>\r\n<div id=\"footer\" style=\"display:flex;flex-direction:row\">\r\n    <div style=\"display:flex;flex-direction:row;width:30vw\">\r\n        <div style=\"margin:20px\">\r\n            <a href=\"https://solidarites-sante.gouv.fr/\" target=\"_blank\">\r\n                <img src=\"./images/logo-ministere.svg\" alt=\"Ministère des Solidarités et de la santé\" width=\"84\" height=\"62\">\r\n            </a>\r\n        </div>\r\n        <div style=\"margin:20px\">\r\n            <a href=\"https://esante.gouv.fr/\" target=\"_blank\">\r\n                <img src=\"./images/logo-ANS.svg\" alt=\"Agence du Numérique en Santé\" width=\"166\" height=\"50\">\r\n            </a>\r\n        </div>\r\n    </div>\r\n    <div style=\"width:60vw\">\r\n        <ul style=\"align-items:end\">\r\n            <li><a href=\"http://esante.gouv.fr/services/mentions-legales\" target=\"_blank\">Mentions l&eacute;gales</a></li>\r\n            <li><a href=\"./copyright.php\" target=\"_blank\" title=\"Copyright [nouvelle fen&ecirc;tre]\">Copyright</a></li>\r\n        </ul>\r\n    </div>\r\n</div>\r\n\r\n</body>\r\n</html>\r\n",
      "ip": "135.125.232.117",
      "timestamp": "2025-03-14T16:26:19.506384843Z",
      "curl-command": "curl -X 'GET' -H 'Accept: */*' -H 'Accept-Language: en' -H 'User-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)' 'https://diagcps.eservices.esante.gouv.fr'",
      "matcher-status": true
    },
    {
      "template": "http/misconfiguration/http-missing-security-headers.yaml",
      "template-url": "https://templates.nuclei.sh/public/http-missing-security-headers",
      "template-id": "http-missing-security-headers",
      "template-path": "/home/runner/nuclei-templates/http/misconfiguration/http-missing-security-headers.yaml",
      "info": {
        "name": "HTTP Missing Security Headers",
        "author": [
          "socketz",
          "geeknik",
          "g4l1t0",
          "convisoappsec",
          "kurohost",
          "dawid-czarnecki",
          "forgedhallpass",
          "jub0bs",
          "userdehghani"
        ],
        "tags": [
          "misconfig",
          "headers",
          "generic"
        ],
        "description": "This template searches for missing HTTP security headers. The impact of these missing headers can vary.\n",
        "severity": "info",
        "metadata": {
          "max-request": 1
        }
      },
      "matcher-name": "x-permitted-cross-domain-policies",
      "type": "http",
      "host": "https://diagcps.eservices.esante.gouv.fr",
      "matched-at": "https://diagcps.eservices.esante.gouv.fr",
      "request": "GET / HTTP/1.1\r\nHost: diagcps.eservices.esante.gouv.fr\r\nUser-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)\r\nConnection: close\r\nAccept: */*\r\nAccept-Language: en\r\nAccept-Encoding: gzip\r\n\r\n",
      "response": "HTTP/1.1 200 OK\r\nConnection: close\r\nTransfer-Encoding: chunked\r\nContent-Type: text/html; charset=UTF-8\r\nDate: Fri, 14 Mar 2025 16:26:19 GMT\r\nServer: Apache/2.4.37 (centos) OpenSSL/1.1.1g\r\nX-Powered-By: PHP/7.2.24\r\n\r\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n\t<title>DiagCPS, Outil de Diagnostic SSL</title>\r\n\t<meta http-equiv=\"Content-type\" content=\"text/html; charset=UTF-8\" />\r\n\t<meta name=\"description\" content=\"DiagCPS est un Outil de Diagnostic de l'authentification en ligne à l'aide d'une Carte de Professionnel de Santé, i.e. CPS. Il est fourni par l'ASIP Santé et remplace ODI.\" />\r\n\t<meta name=\"Publisher\" content=\"ASIP Santé\" />\r\n\t<meta name=\"copyright\" content=\"Tous droits réservés - ASIP Santé\" />\r\n\t<link rel=\"shortcut icon\" href=\"./images/favicon.ico\" type=\"image/x-icon\" />\r\n\t<link rel=\"stylesheet\" href=\"diagcps_css.php\" />\r\n\t<script src=\"./js/jquery-3.2.0.min.js\"></script>\r\n\t<script src=\"./js/ua-parser.min.js\"></script>\r\n</head>\r\n<body>\r\n<div id=\"header\" style=\"display:flex;flex-direction:row\">\r\n    <div style=\"margin:20px\">\r\n        <a href=\"https://solidarites-sante.gouv.fr/\" target=\"_blank\">\r\n            <img src=\"./images/logo-ministere.svg\" alt=\"Ministère des Solidarités et de la santé\" width=\"168\" height=\"104\">\r\n        </a>\r\n    </div>\r\n\t<div id=\"title\">esante.gouv.fr</div>\r\n</div>\r\n<div id=\"section\">\r\n<script type=\"text/javascript\">\n\n<!-- script : /js/wizarddiagcps.js Begin -->\n//==================================\r\n// Global variable used for state machine management \r\n// displayed on screen \r\n// or used by state machine\r\n//==================================\r\nvar wizardStateMachine = {\r\n\tstartState: 'notSupported',\r\n\tlastState: 'notSupported',\r\n\t\r\n\t//=================\r\n\t// Retry Management\r\n\t// Variables\r\n\tnbMaxRetry: 10,\r\n\tnbRetry: 0,\r\n\t\r\n\t// Management\r\n\tinitRetry: function() {this.nbRetry = this.nbMaxRetry;},\r\n\tisMaxRetry: function() {return (this.nbRetry >= this.nbMaxRetry);},\r\n\tisMinRetry: function() {return (this.nbRetry <= 0);},\r\n\tdecRetry: function() {this.nbRetry--;},\r\n\tdisplayRetry: function() {\r\n\t\t\t\t\t\t\t\t//console.log(\"displayRetry : nbRetry = \" + this.nbRetry);\r\n\t\t\t\t\t\t\t\tthis.decRetry();\r\n\t\t\t\t\t\t\t\tthis.stopTimers(); \r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.isMinRetry()\r\n\t\t\t\t\t\t\t\t\t&& \t(this.lastState != 'endDiagWithSuccess')) {\r\n\t\t\t\t\t\t\t\t\tthis.wizard('manualInstallClibCPS');\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tthis.displayWait(true);\r\n\t\t\t\t\t\t\t\t\tthis.startTimers();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\r\n\t//==================\r\n\t// Timers Management\r\n\ttimerTestSSL: null,\r\n\tretryTimeoutKO: 1000,\r\n\tinitTimer: function () {this.retryTimeoutKO = 1000;},\r\n\taccelerateTimer: function () {this.retryTimeoutKO = 250;},\r\n\tstopTimers: function() {\r\n\t\t\t\t\t\t\t\tif (this.timerTestSSL != null)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tclearTimeout(this.timerTestSSL);\r\n\t\t\t\t\t\t\t\t\tthis.timerTestSSL = null;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\tstartTimers: function() {this.timerTestSSL = setTimeout(function(){wizardStateMachine.displayRetry()}, this.retryTimeoutKO);},\r\n\t\r\n\t//=======\r\n\t// Wizard\r\n\tstartWizard: function() {this.wizard(this.startState);},\r\n\twizard: function(step, param) {\r\n\t\t\t\tconsole.log(\"wizard : step = \" + step + \", param = \" + param);\r\n\t\t\t\t\t\r\n\t\t\t\tswitch (step)\r\n\t\t\t\t{\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Pre treatment\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'notSupported':\r\n\t\t\t\t\tcase 'preAlert':\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'start');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif ((dataIHM.getUAInfos().configSupported) || (step == 'preAlert')) this.displayInstruction(true, 'preAlert');\r\n\t\t\t\t\t\telse this.displayInstruction(true, 'notSupported');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Manual Installation XPI\r\n\t\t\t\t\t// Suggestion of installation\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'manualInstallXPI':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'KO');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'manualInstallXPI');\r\n\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// XPI Installation\r\n\t\t\t\t\t// Installation process\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'XPI':\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'restartAlertXPI');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar params = {\r\n\t\t\t\t\t\t\t\t\"Installer l'Extension Cryptolib CPS\": \r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tURL: param.URL,\r\n\t\t\t\t\t\t\t\t\tIconURL: param.IconURL,\r\n\t\t\t\t\t\t\t\t\tHash: param.Hash,\r\n\t\t\t\t\t\t\t\t\ttoString: function () { return this.URL; }\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t};\r\nconsole.log(params);\r\n\t\t\t\t\t\tInstallTrigger.install(params);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// Diagnostic\r\n\t\t\t\t\t// Start\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'startDiag':\r\n\t\t\t\t\t\tthis.initRetry();\r\n\t\t\t\t\t\tthis.initTimer();\r\n\r\n\t\t\t\t\t\tthis.displayWait(true);\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'inProgress');\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tdataIHM.readClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.startTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// Diagnostic\r\n\t\t\t\t\t// Restart\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'restartDiag':\r\n\r\n\t\t\t\t\t\tdataIHM.resetClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\r\n\t\t\t\t\t//==========================\r\n\t\t\t\t\t// Progression\r\n\t\t\t\t\t//--------------------------\r\n\t\t\t\t\tcase 'inProgress':\r\n\t\t\t\t\t\t//dataIHM.readClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// this.displayDiagnosticState(true, 'inProgress');\r\n\t\t\t\t\t\t// this.displayInstruction(false);\r\n\t\t\t\t\t\t// this.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//===================\r\n\t\t\t\t\t// Ends\r\n\t\t\t\t\t//-------------------\r\n\t\t\t\t\tcase 'endDiagWithSuccess':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'OK');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tthis.displaySupport(false);\r\n\t\t\t\t\t\tthis.displayInfosCPS(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Manual Installation Cryptolib CPS\r\n\t\t\t\t\t// Suggestion of installation\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'manualInstallClibCPS':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'KO');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'manualInstallClibCPS');\r\n\t\t\t\t\t\tthis.displaySupport(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//=======================\r\n\t\t\t\t\t// Cryptolib CPS download\r\n\t\t\t\t\t// Installation process\r\n\t\t\t\t\t//-----------------------\r\n\t\t\t\t\tcase 'CryptolibCPS':\r\n\t\t\t\t\t\twindow.location = dataIHM.getServerComponentLink();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// Direct jump to Retry after installation\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'restartAlert');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\t\r\n\t\t\t\t\t//=========================\r\n\t\t\t\t\t// Other\r\n\t\t\t\t\t// Close Instruction screen\r\n\t\t\t\t\t//-------------------------\r\n\t\t\t\t\tcase 'exitInstruction':\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true);\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t// Open Support link\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'openSupport':\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tif (param !== undefined) window.open(param.URL,'_blank');\r\n\t\t\t\t\t\tbreak;\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.lastState = step;\r\n\t\t\t},\r\n\t\r\n\t//==========================\r\n\t// Screen Display Management\r\n\tdisplayElementById: function(id, display) {\r\n\t\t\t\t\t\t\tdocument.getElementById(id).style.display = display;\r\n\t\t\t\t\t\t},\r\n\thideElementById: function(id) {\r\n\t\t\t\t\t\t\tthis.displayElementById(id, \"none\");\r\n\t\t\t\t\t\t},\r\n\tdisplayInit: function(OSName) {\r\n\t\t\t\t\t\t// Events initialization\r\n\t\t\t\t\t\t//----------------------\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"cryptolib\", \t\t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"notSupported\", \t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"startDiag\", \t\t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"instructions-back\", \t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"infos_cps_caption\", \t\"click\", clickExpandCollapse);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// PreAlert initialization\r\n\t\t\t\t\t\t//------------------------\r\n\t\t\t\t\t\tthis.displayPreAlert(OSName);\r\n\t\t\t\t\t},\r\n\tdisplayInfosCPS: function (active) {\r\n\t\t\t\t\t\t\tvar infos_cps_tbody = '';\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar detailedInformations = dataIHM.getClientDetailedInfos();\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tfor (var item in detailedInformations) {\r\n\t\t\t\t\t\t\t\tinfos_cps_tbody += '<tr><td class=\"key\">' + item + '</td><td class=\"val\">' + detailedInformations[item] + '</td></tr>';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cps').className = dataIHM.getClientSSLInfos().div_cps_class;\r\n\r\n\t\t\t\t\t\t\t\tfor (var item in dataIHM.getClientSSLInfos().infos) {\r\n\t\t\t\t\t\t\t\t\tinfos_cps_tbody += '<tr><td class=\"key\">' + item + '</td><td class=\"val\">' + dataIHM.getClientSSLInfos().infos[item] + '</td></tr>';\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cps').className = \"cpsverso\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tdocument.getElementById('infos_cps_tbody').innerHTML = infos_cps_tbody;\r\n\t\t\t\t\t\t},\r\n\r\n\tdisplayWait:function (active) {\r\n\t\t\t\t\tif ( (active)\r\n\t\t\t\t\t\t&& (wizardStateMachine.nbRetry > 0) ) {\r\n\t\t\t\t\t\tthis.displayElementById('spin', \"flex\");\r\n\t\t\t\t\t\tdocument.getElementById('retry').innerHTML = wizardStateMachine.nbRetry;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.hideElementById('spin');\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\tdisplayDiagnosticState:function (active, state) {\r\n\t\t\t\t\t\t\t\tdiagStateContent = {\r\n\t\t\t\t\t\t\t\t\t'start':{content:'Cliquer sur la carte', style:'diagState diagStart'}\r\n\t\t\t\t\t\t\t\t\t, 'inProgress':{content:'Le diagnostic est en cours', style:'diagState diagInProgress'}\r\n\t\t\t\t\t\t\t\t\t, 'KO':{content:'Le diagnostic a &eacute;chou&eacute;', style:'diagState diagKO'}\r\n\t\t\t\t\t\t\t\t\t, 'OK':{content:'Le diagnostic a r&eacute;ussi', style:'diagState diagOK'}\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.hideElementById('diagState');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').style.display = \"block\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif (state !== undefined) {\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').className = diagStateContent[state].style;\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').innerHTML = diagStateContent[state].content;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\r\n\tdisplayInstruction: function (active, step) {\r\n\t\t\t\t\t\t\tthis.hideElementById('instructions-back');\r\n\t\t\t\t\t\t\tthis.hideElementById('instructions');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\tthis.displayElementById('instructions-back', \"flex\");\r\n\t\t\t\t\t\t\t\tthis.displayElementById('instructions', \"block\");\r\n\t\t\t\t\t\t\t\tthis.hideElementById('manualInstallClibCPS');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('manualInstallXPI');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('restartAlert');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('restartAlertXPI');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('preAlert');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('notSupported');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('contactSupport');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (step !== undefined) this.displayElementById(step, \"block\");\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar detailedInformations = dataIHM.getClientDetailedInfos();\r\n\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cryptolib').innerHTML = \"T&eacute;l&eacute;charger<br/>\" + dataIHM.getComponentInstallerName();\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (dataIHM.getUAInfos().os.name == 'Mac OS')\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('restartInstruction').innerHTML = \"Une fois l'installation de \" + dataIHM.getComponentInstallerName() + \" termin&eacute;e,<br/>veuillez red&eacute;marrer votre ordinateur.\";\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('restartInstruction').innerHTML = \"Une fois l'installation de \" + dataIHM.getComponentInstallerName() + \" termin&eacute;e,<br/>veuillez red&eacute;marrer votre navigateur.\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\r\n\tdisplaySupport: function (active) {\r\n\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\tthis.displayElementById('support-direction', \"flex\");\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.hideElementById('support-direction');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\r\n\tdisplayPreAlert: function(OSName) {\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-MacOS');\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-Windows');\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-Linux');\r\n\r\n\t\t\t\t\t\t\tif (OSName == 'Mac OS') this.displayElementById('alert1-MacOS', 'block');\r\n\t\t\t\t\t\t\tif (OSName == 'Windows') this.displayElementById('alert1-Windows', 'block');\r\n\t\t\t\t\t\t\tif (OSName == 'Linux') this.displayElementById('alert1-Linux', 'block');\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\r\n};\r\n\r\n//==================\r\n// Events Management\r\nfunction addEltEventListenerAllBrowser(elt, eventName, handle) {\r\n\tif (elt.addEventListener) { elt.addEventListener(eventName, handle, false);\r\n\t} else { elt.attachEvent(\"on\" + eventName, handle);\r\n\t}\r\n}\r\n\r\nfunction addIdEventListenerAllBrowser(id, eventName, handle) {\r\n\tif (document.getElementById(id)) addEltEventListenerAllBrowser(document.getElementById(id), eventName, handle);\r\n}\r\n\r\nfunction clickExpandCollapse(event) {\r\n\tif (document.getElementById('infos_cps_table').style.display != \"block\") {\r\n\t\tdocument.getElementById('infos_cps_caption_img').className = \"infos_cps_caption_img_collapse\";\r\n\t\tdocument.getElementById('infos_cps_table').style.display = \"block\";\r\n\t} else {\r\n\t\tdocument.getElementById('infos_cps_caption_img').className = \"infos_cps_caption_img_expand\";\r\n\t\tdocument.getElementById('infos_cps_table').style.display = \"none\";\r\n\t}\r\n\tevent.cancelBubble = true;\r\n\t\t\r\n\treturn false;\r\n}\r\n\r\nfunction clickActionNoPropagation(event) {\r\n\t//this.click();\r\n\r\n\tevent.cancelBubble = true;\r\n\r\n\treturn false;\r\n}\r\n\n<!-- script : /js/wizarddiagcps.js End -->\n<!-- script : /js/diagcps.js Begin -->\n//==================================\r\n// Global variable used for all data \r\n// displayed on screen \r\n// or used by state machine\r\n//==================================\r\nvar dataIHM = {\r\n\t//==========================\r\n\t// Root URL\r\n\tlocalURL: '',\r\n\tsetLocalURL: function(URL) {this.localURL = URL;},\r\n\tgetLocalURL: function() {return this.localURL;},\r\n\t\r\n\t//==========================\r\n\t// User Agent\r\n\tclientUAInfos: null,\r\n\ttimerUAInfos: null,\r\n\tinitUAInfos: function() {\r\n\t\t\t\t\t\tvar uaparser = new UAParser();\r\n\t\t\t\t\t\tthis.clientUAInfos = uaparser.getResult();\r\n\t\t\t\t\t\tthis.clientUAInfos.browser.xpi = true;\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tthis.timerUAInfos = setTimeout(function(){dataIHM.isUAInfosCPSWebEx()}, 1000);\r\n\t\t\t\t\t},\r\n\tgetUAInfos: function() {return this.clientUAInfos},\r\n\tisUAInfosCPSWebEx: function() {\r\n\t\t\t\t\tif (window.isCpsWebExAlive) {\r\n\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', window.isCpsWebExAlive());\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (this.getUAInfos().browser.name == 'Firefox') {\r\n\t\t\t\t\t\t\tif (this.getUAInfos().browser.major > 57) {\r\n\t\t\t\t\t\t\t\tthis.clientUAInfos.browser.xpi = false;\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'absente');\r\n\t\t\t\t\t\t\t\twizardStateMachine.wizard('manualInstallXPI');\r\n\t\t\t\t\t\t\t} else if (this.getUAInfos().browser.major == 57) {\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'sur cette version, l\\'installation du p&eacute;riph&eacute;rique de s&eacute;curit&eacute; doit &ecirc;tre <a href=\"http://integrateurs-cps.asipsante.fr/Installation-manuelle-PKCS11-Firefox\" target=\"_blanck\">r&eacute;alis&eacute;e manuellement</a>.');\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'd&eacute;tection impossible sur cette version');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.timerUAInfos = null;\r\n\t\t\t\t},\r\n\t\r\n\t//===============================\r\n\t// Installed Component management\r\n\tcomponentName: \"CryptolibCPS\", // By default\r\n\tsetComponentName: function(name) {this.componentName = name;},\r\n\tgetComponentName: function() {return this.componentName;},\r\n\tcomponentVersion: \"\", // By Default\r\n\tsetcomponentVersion: function(version) {this.componentVersion = version;},\r\n\tgetcomponentVersion: function() {return this.componentVersion;},\r\n\tcomponentInstallerName: \"\",\r\n\tsetComponentInstallerName: function(name) {this.componentInstallerName = name;},\r\n\tgetComponentInstallerName: function() {return this.componentInstallerName;},\r\n\tserverComponentURL: null,\r\n\tsetServerComponentURL: function(URL) {this.serverComponentURL = URL;},\r\n\tgetServerComponentLink: function(version) {\r\n\t\t\t\t\t\t\t\t\tvar componentLink = this.serverComponentURL + \"?\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"component=\" + this.getComponentName();\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&os=\" + this.getUAInfos().os.name;\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&arch=\" + this.getUAInfos().cpu.architecture;\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&version=\" + this.getcomponentVersion();\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\treturn componentLink;\r\n\t\t\t\t\t\t\t\t},\r\n\tserverComponentInfos: null,\r\n\treadServerComponentInfos: function() {\r\n\t\t\t\t\t\t\t\t// XPI 6.0.15 with Firefox < 57\r\n\t\t\t\t\t\t\t\t// ==> Use Cryptolib CPS 5.0.37 instead of last release\r\n\t\t\t\t\t\t\t\tif ((this.getUAInfos().browser.name == 'Firefox') \r\n\t\t\t\t\t\t\t\t\t&& (this.getUAInfos().browser.major < 57)) {\r\n\t\t\t\t\t\t\t\t\tswitch (this.getUAInfos().os.name) {\r\n\t\t\t\t\t\t\t\t\t\tcase 'Windows': this.setcomponentVersion('5.0.37');break;\r\n\t\t\t\t\t\t\t\t\t\tcase 'Mac OS': this.setcomponentVersion('5.0.34');break;\r\n\t\t\t\t\t\t\t\t\t\tcase 'Linux':\r\n\t\t\t\t\t\t\t\t\t\tcase 'CentOS':\r\n\t\t\t\t\t\t\t\t\t\tcase 'Ubuntu':\r\n\t\t\t\t\t\t\t\t\t\tcase 'RedHat':  this.setcomponentVersion('5.0.12');break;\r\n\t\t\t\t\t\t\t\t\t\tdefault:break;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// Use fetch if exist\r\n\t\t\t\t\t\t\t\tif (self.fetch) {\r\n\t\t\t\t\t\t\t\t\tfetch( this.getServerComponentLink() + '&filename=get' )\r\n\t\t\t\t\t\t\t\t\t.then(function(resp) {return resp.json();})\r\n\t\t\t\t\t\t\t\t\t.then(function(response) {\r\n\t\t\t\t\t\t\t\t\t\tfor (var k in response) {\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.setComponentInstallerName(response[k]);\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.addClientDetailedInfos('URL de t&eacute;l&eacute;chargement', '<a href=\"' + dataIHM.getServerComponentLink() + '\">' + dataIHM.getComponentInstallerName() + '</a>');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('readServerComponentInfos : Error with fetch (' + error.message + ')'); \r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t// Use JQuery\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$.ajax(\t{\r\n\t\t\t\t\t\t\t\t\t\turl: this.getServerComponentLink() + '&filename=get'\r\n\t\t\t\t\t\t\t\t\t\t, success: function( data) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar json;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (data === String)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson = jQuery.parseJSON(data);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson = data\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor (var k in json) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setComponentInstallerName(json[k]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.addClientDetailedInfos('URL de t&eacute;l&eacute;chargement', '<a href=\"' + dataIHM.getServerComponentLink() + '\">' + dataIHM.getComponentInstallerName() + '</a>');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t, error: function( data) { return null;}\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\r\n\t//========================================\r\n\t// Support contact informations management\r\n \tmailSupportMailbox: null,\r\n\tmailSupportDomain: null,\r\n\tsetMailSupport: function(mailbox, domain) {this.mailSupportMailbox = mailbox; this.mailSupportDomain = domain;},\r\n\tgetMailSupport: function() {return this.mailSupportMailbox + \"@\" + this.mailSupportDomain;},\r\n \t\t\r\n\t//==========================\r\n\t// Detailed informations\r\n\tclientDetailedInfos: {},\r\n\tinitClientDetailedInfos: function() {\r\n\t\t\t\t\t\t\t\tconfigSupported = true;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.getUAInfos().device.type === undefined) {\r\n\t\t\t\t\t\t\t\t\tconsole.log(\"Poste de travail\");\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tconfigSupported = false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().os.name) {\r\n\t\t\t\t\t\t\t\t\tcase 'Windows':\r\n\t\t\t\t\t\t\t\t\tcase 'Mac OS':\r\n\t\t\t\t\t\t\t\t\tcase 'Linux':\r\n\t\t\t\t\t\t\t\t\tcase 'CentOS':\r\n\t\t\t\t\t\t\t\t\tcase 'Ubuntu':\r\n\t\t\t\t\t\t\t\t\tcase 'RedHat':  configSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault: \t\tconfigSupported = configSupported & false;break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().browser.name) {\r\n\t\t\t\t\t\t\t\t\tcase 'IE':\r\n\t\t\t\t\t\t\t\t\tcase 'Safari':\r\n\t\t\t\t\t\t\t\t\tcase 'Edge':\r\n\t\t\t\t\t\t\t\t\tcase 'Chrome':\r\n\t\t\t\t\t\t\t\t\tcase 'Firefox':\tconfigSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault: \t\tconfigSupported = configSupported & false;break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().cpu.architecture) {\r\n\t\t\t\t\t\t\t\t\tcase 'ia32':\r\n\t\t\t\t\t\t\t\t\tcase 'i686':\r\n\t\t\t\t\t\t\t\t\tcase 'amd64': configSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\t\tif (this.getUAInfos().cpu.architecture === undefined)\r\n\t\t\t\t\t\t\t\t\t\t\tconfigSupported = configSupported & true;\r\n\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\tconfigSupported = configSupported & false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.getUAInfos().cpu.architecture == 'amd64')\r\n\t\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Syst&egrave;me d\\'exploitation', this.getUAInfos().os.name + \" \" + this.getUAInfos().os.version + \" (64b)\");\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Syst&egrave;me d\\'exploitation', this.getUAInfos().os.name + \" \" + this.getUAInfos().os.version);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Navigateur', this.getUAInfos().browser.name + \" \" + this.getUAInfos().browser.major);\r\n\t\t\t\t\t\t\t\t// this.addClientDetailedInfos('Compatibilit&eacute; ASIP', '<a href=\"http://integrateurs-cps.asipsante.fr/Lettre_d_information\" target=\"_blanck\">Lettre d\\'information<br/>POSTE DE TRAVAIL & Veille Technologique</a>');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.clientUAInfos.configSupported = configSupported;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\treturn configSupported;\r\n\t\t\t\t\t\t\t},\r\n\tgetClientDetailedInfos: function() {return this.clientDetailedInfos;},\r\n\taddClientDetailedInfos: function(key, value) { this.clientDetailedInfos[key] = value;},\r\n\tresetClientDetailedInfos: function() {this.clientDetailedInfos = {};},\r\n\t\t\r\n\t//==========================\r\n\t// Client SSL Informations\r\n\tclientSSLInfos: null,\r\n\tclientSSLFetchParameters: { mode:'cors', credentials: 'include', cache: 'no-cache'},\r\n\tclientSSLAjaxParameters: { cache: false, timeout: 8000, async: true},\r\n\tisDefineClientSSLInfos: function() {return (this.clientSSLInfos != undefined);},\r\n\tsetClientSSLInfos: function(data) {this.clientSSLInfos = data;},\r\n\tgetClientSSLInfos: function() {return this.clientSSLInfos;},\r\n\tinitClientSSLParameters: function() { $.ajaxSetup(this.clientSSLAjaxParameters);},\r\n\tresetClientSSLInfos: function () {\r\n\t\t\t\t\t\t\tconsole.log('resetClientSSLInfos : Erase SSL Connexion cache for ' + this.getUAInfos().browser.name);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tswitch (this.getUAInfos().browser.name) {\r\n\t\t\t\t\t\t\t\tcase 'Edge': // Works !\r\n\t\t\t\t\t\t\t\tcase 'IE': // Works !\r\n\t\t\t\t\t\t\t\t\tif (document.execCommand) document.execCommand( \"ClearAuthenticationCache\", \"false\");\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 'Firefox':\t// Works !\r\n\t\t\t\t\t\t\t\t\t//location.reload(); // Works !\r\n\t\t\t\t\t\t\t\t\tif (window.crypto) if (window.crypto.logout) window.crypto.logout(); // Works !\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 'Chrome': // Works !\r\n\t\t\t\t\t\t\t\tcase 'Safari': // Not working, restart Browser needed !\r\n\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag'); \r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\treadClientSSLInfos: function() {\r\n\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : SSL Connexion' );\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// Use fetch if exist\r\n\t\t\t\t\t\t\tif (self.fetch) {\r\n\t\t\t\t\t\t\t\t// Try to connect and get CPS informations\r\n\t\t\t\t\t\t\t\tfetch( '/visuel.php', this.clientSSLFetchParameters )\r\n\t\t\t\t\t\t\t\t.then(function(resp) {return resp.json();})\r\n\t\t\t\t\t\t\t\t.then(function(resp_json) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Success with Fetch');\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t// traitement du JSON\r\n\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(resp_json);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('endDiagWithSuccess');\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t// Case of SSL Error\r\n\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Probably SSL Error with fetch (' + error.message + ')');\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(null);\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.accelerateTimer();\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t// Use JQuery\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$.ajax(\t{\r\n\t\t\t\t\t\t\t\t\turl: 'visuel.php'\r\n\t\t\t\t\t\t\t\t\t, success: function(data, textStatus) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Success with Ajax (' + textStatus + ')');\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tif (data === String)\r\n\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(jQuery.parseJSON(data));\r\n\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(data);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('endDiagWithSuccess');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t, error: function(data, textStatus) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Probably SSL Error with Ajax (' + textStatus + ')');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(null);\r\n\t\t\t\t\t\t\t\t\t\t\twizardStateMachine.accelerateTimer();\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n}\r\n\r\n//=====\r\n// Main\r\n//=====\r\n$(function() {\r\n\t// Initialization\r\n\t//---------------\r\n\tdataIHM.initUAInfos(); // User Agent\r\n\t\r\n\tdataIHM.initClientSSLParameters();\r\n\t\r\n\t// Sp�cific parameter with no good solution @29/12/2017\r\n\tswitch (dataIHM.getUAInfos().browser.name) {\r\n\t\tcase 'IE':\r\n\t\t\tconsole.log('=========== Use Ajax =============');\r\n\t\t\tself.fetch = undefined;\r\n\t\t\tbreak;\r\n\t\tcase 'Edge':\r\n\t\tcase 'Firefox':\r\n\t\tcase 'Safari':\r\n\t\tdefault:\r\n\t\t\tconsole.log('=========== Try using fetch. If not available use Ajax =============');\r\n\t\t\tbreak;\r\n\t}\r\n\t\r\n\tdataIHM.initClientDetailedInfos(); // Informations in bottom\r\n\tdataIHM.readServerComponentInfos(); // Get from informations from Web Service\r\n\t\r\n\twizardStateMachine.startWizard(); // Start Wizard\r\n\t\t\r\n\twizardStateMachine.displayInit(dataIHM.getUAInfos().os.name);\r\n});\r\n\n<!-- script : /js/diagcps.js End -->\n\n</script>\n<script type=\"text/javascript\">\n\t// Initialization Javascript from PHP\n\tdataIHM.setComponentName('CryptolibCPS');\n\tdataIHM.setServerComponentURL('download.php');\n</script>\n<!--<div id=\"beta\"></div>-->\n<div id=\"instructions-back\" onclick=\"wizardStateMachine.wizard('exitInstruction');\">\n\t<div id=\"instructions\">\n\t\n\t\t<div class=\"screen\" id=\"preAlert\">\n\t\t\t<div class=\"instruction\"><br/>\n<h1>Assistance en cas de carte CPS non lue</h1>\n\n<h2>Pr&eacute;alablement</h2>\n<p>\nVeuillez v&eacute;rifier que votre carte est bien ins&eacute;r&eacute;e dans votre lecteur de carte ou votre terminal Vitale.<br/>\nPuis v&eacute;rifier que votre lecteur de carte ou votre terminal Vitale est correctement connect&eacute; &agrave; votre ordinateur.<br/>\n<br/>\nLa carte ins&eacute;r&eacute;e dans le lecteur doit &ecirc;tre la derni&egrave;re carte active.\n\n<table >\n\t<tr>\n\t\t<td style=\"border-top:none;\"><img src=\"images/informations32.png\" alt=\"Information :\"/></td>\n\t\t<td style=\"border-top:none;\"><i>La derni&egrave;re carte active pr&eacute;sente la date d'expiration la plus &eacute;loign&eacute;e.</i></td>\n\t</tr>\n</table>\n<br/>\nUne fois cette v&eacute;rification r&eacute;alis&eacute;e, v&eacute;rifiez que la carte est bien lue.<br/>\n</p>\n\n<div id=\"alert1-MacOS\">\n<h2>Votre ordinateur est sous Mac OS</h2>\n<p>\nSur votre syst&egrave;me d'exploitation, nous ne disposons pas de m&eacute;thode particuli&egrave;re pour v&eacute;rifier si votre carte est lue.<br/>\n<br/>\nVeuillez lancer un diagnostic de votre ordinateur et proc&eacute;der &agrave; l'installation des mises &agrave; jour sugg&eacute;r&eacute;es.<br/>\n</p>\n</div>\n\n<div id=\"alert1-Linux\">\n<h2>Votre ordinateur est sous Linux</h2>\n<p>\nSur votre syst&egrave;me d'exploitation, nous ne disposons pas de m&eacute;thode particuli&egrave;re pour v&eacute;rifier si votre carte est lue.<br/>\n<br/>\nVeuillez lancer un diagnostic de votre ordinateur et proc&eacute;der &agrave; l'installation des mises &agrave; jour sugg&eacute;r&eacute;es.<br/>\n</p>\n</div>\n\n<div id=\"alert1-Windows\">\n<h2>Votre ordinateur est sous Windows</h2>\n<b>Dans la barre des t&acirc;ches, une carte lue est signal&eacute;e par <img src=\"images/preHelper/iconeOK.png\" alt=\"Icone vert dans la barre des taches\" /> et une carte non lue par <img src=\"images/preHelper/iconeKO.png\" alt=\"Icone rouge dans la barre des taches\"/>.</b><br/>\n<h3>L'ic&ocirc;ne <img src=\"images/preHelper/iconeOK.png\" alt=\"Icone vert dans la barre des taches\"/> est introuvable</h3>\n<p>\nCliquez avec le clic droit de votre souris sur le bouton &laquo;Afficher les ic&ocirc;nes&raquo; (en bas &agrave; droite de votre &eacute;cran) ou sur la zone heure et date et selectionnez &laquo;Personnaliser les ic&ocirc;nes de notification&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/notificationsBar.png\" alt=\"Barre de notification\"/></div>\n<br/>\n<br/>\nCherchez l'ic&ocirc;ne &laquo;Gestionnaire de certificats CPS&raquo; et s&eacute;lectionnez &laquo;Afficher l'ic&ocirc;ne et les notifications&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/notificationsParameters.png\" alt=\"Parametres de notifications\"/></div>\n<br/>\nUne fois la manipulation r&eacute;alis&eacute;e vous devriez voir apparaitre l'ic&ocirc;ne (en bas &agrave; droite de votre &eacute;cran).<br/>\n<br/>\nSi l'ic&ocirc;ne n'apparait pas dans la liste, lancer le diagnostic de votre ordinateur et installez les mises &agrave; jour propos&eacute;es.<br/>\n<br/>\n</p>\n<h2>L'ic&ocirc;ne <img src=\"images/preHelper/iconeKO.png\" alt=\"Icone rouge dans la barre des taches\" /> est rouge</h2>\n<p>\nSi l'ic&ocirc;ne est encadr&eacute;e de rouge (carte non lue), assurez-vous que votre carte est bien ins&eacute;r&eacute;e dans votre lecteur, rafra&icirc;chissez le lecteur en cliquant sur l'ic&ocirc;ne avec le bouton droit de la souris. Et cliquez sur &laquo;Rafra&icirc;chir&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/rightClickCCM.png\" alt=\"Cliquer droit sur l'icone du CCM\" /></div>\n<br/>\nSi l'encadr&eacute; reste rouge apr&egrave;s la manipulation, red&eacute;marrez votre ordinateur en laissant le lecteur et la CPS connect&eacute;s.<br/>\n<br/>\nApr&egrave;s ces manipulations, si l'ic&ocirc;ne ne passe pas au vert, veuillez nous contacter.\n</p>\n<div align=\"center\"></div>\n</div>\n\n</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"startDiag\" onclick=\"wizardStateMachine.wizard('startDiag');\">Diagnostiquer mon poste</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"notSupported\">\n\t\t\t<div class=\"instruction\">Votre configuration mat&eacute;riel et/ou syst&egrave;me n'est pas support&eacute;e par nos composants logiciels. Nous ne garantissons pas le succès du diagnostic.</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"notSupported\" onclick=\"wizardStateMachine.wizard('preAlert');\">Continuer</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"manualInstallXPI\">\n\t\t\t<div class=\"instruction\" id=\"xpi_instruction\" >L'Extension Firefox n'a pas &eacute;t&eacute; d&eacute;tect&eacute;e. Elle est indispensable sous ce navigateur.<br/>Apr&egrave;s l'installation, veuillez red&eacute;marrer votre navigateur.</div>\n\t\t\t<div class=\"actions\">\n<!--\t\t\t\t<div class=\"action instruction\" id=\"xpi\" onclick=\"wizardStateMachine.wizard('XPI',{URL:'https://diagcps.eservices.esante.gouv.fr/ODI_PS/php/download_asip.php?installeur=url_interne_xpi_installation_pkcs11',IconURL:'https://diagcps.eservices.esante.gouv.fr/ODI_PS/images/asip_sante.png',Hash:'sha256:c23de3812aaf7c3a81d80e9bdf891c3e2b621e01e55e8d308226fd86ab6ef438'});\">Installer<br/>l'Extension Firefox</div>-->\n<div class=\"action instruction\" id=\"xpi\" onclick=\"wizardStateMachine.wizard('XPI',{URL:'/download.php?component=xpi',IconURL:'/images/asip_sante.png',Hash:'sha256:c23de3812aaf7c3a81d80e9bdf891c3e2b621e01e55e8d308226fd86ab6ef438'});\">Installer<br/>l'Extension Firefox</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"restartAlertXPI\">\n\t\t\t<div class=\"instruction\" id=\"restartInstructionXPI\" >Une fois l'installation de l'Extension Cryptolib CPS termin&eacute;e,<br/>veuillez red&eacute;marrer votre navigateur.</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"manualInstallClibCPS\">\n\t\t\t<div class=\"instruction\">Si vous avez ins&eacute;r&eacute; votre CPS dans votre lecteur sans succ&egrave;s, la version de Cryptolib CPS de votre poste de travail n'est peut-&ecirc;tre pas &agrave; jour.</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"cryptolib\" onclick=\"wizardStateMachine.wizard('CryptolibCPS');\">T&eacute;l&eacute;charger<br/>Cryptolib CPS</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"restartAlert\">\n\t\t\t<div class=\"instruction\" id=\"restartInstruction\" >Une fois l'installation de CryptolibCPS_vX.Y.Z termin&eacute;e, veuillez red&eacute;marrer votre navigateur.</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"contactSupport\">\n\t\t\t<div class=\"instruction\">Si vous avez installez le composant propos&eacute; sans succ&eacute;s,<br/> veuillez contacter le Support.</div>\n\t\t</div>\n\t\t\n\t</div>\n</div>\t\n<div id=\"service-direction\" class=\"column\"></div>\n<div id=\"article\">\n\t<div id=\"center\">\n\t\t<div class=\"diagState\" id=\"diagState\"></div>\n\t\t<div>\n\t\t\t<div id=\"cps\" class=\"cpsverso\" onclick=\"wizardStateMachine.wizard('restartDiag');\"><div id=\"spin\"><div id=\"retry\"></div></div></div>\n\t\t</div>\n<!--\t\t\n\t\t<div id=\"results\">\n\t\t\t<div>\n\t\t\t\t<div class=\"sign\" id=\"certificat\"></div>\n\t\t\t\t<div class=\"sign\" id=\"expired\" title=\"expire\"></div>\n\t\t\t\t<div class=\"sign\" id=\"revoc\" title=\"revoque\"></div>\n\t\t\t\t<div class=\"sign\" id=\"class\"></div>\n\t\t\t\t<div class=\"sign\" id=\"rootAC\"></div>\n\t\t\t\t<div class=\"sign\" id=\"cryptolib\" title=\"cryptolib\"></div>\n\t\t\t</div>\n\t\t</div>\n-->\n\t\t<div id=\"cps_infos\">\n\t\t\t<div id=\"infos_cps\">\n\t\t\t\t<div id=\"infos_cps_caption\"><div>Informations d&eacute;taill&eacute;es</div><div class=\"infos_cps_caption_img_expand\" id=\"infos_cps_caption_img\"></div></div>\n\t\t\t\t<table id=\"infos_cps_table\">\n\t\t\t\t\t<tbody id=\"infos_cps_tbody\"></tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n<div id=\"support-direction\" class=\"column\"></div>\n</div>\r\n<div id=\"footer\" style=\"display:flex;flex-direction:row\">\r\n    <div style=\"display:flex;flex-direction:row;width:30vw\">\r\n        <div style=\"margin:20px\">\r\n            <a href=\"https://solidarites-sante.gouv.fr/\" target=\"_blank\">\r\n                <img src=\"./images/logo-ministere.svg\" alt=\"Ministère des Solidarités et de la santé\" width=\"84\" height=\"62\">\r\n            </a>\r\n        </div>\r\n        <div style=\"margin:20px\">\r\n            <a href=\"https://esante.gouv.fr/\" target=\"_blank\">\r\n                <img src=\"./images/logo-ANS.svg\" alt=\"Agence du Numérique en Santé\" width=\"166\" height=\"50\">\r\n            </a>\r\n        </div>\r\n    </div>\r\n    <div style=\"width:60vw\">\r\n        <ul style=\"align-items:end\">\r\n            <li><a href=\"http://esante.gouv.fr/services/mentions-legales\" target=\"_blank\">Mentions l&eacute;gales</a></li>\r\n            <li><a href=\"./copyright.php\" target=\"_blank\" title=\"Copyright [nouvelle fen&ecirc;tre]\">Copyright</a></li>\r\n        </ul>\r\n    </div>\r\n</div>\r\n\r\n</body>\r\n</html>\r\n",
      "ip": "135.125.232.117",
      "timestamp": "2025-03-14T16:26:19.506401423Z",
      "curl-command": "curl -X 'GET' -H 'Accept: */*' -H 'Accept-Language: en' -H 'User-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)' 'https://diagcps.eservices.esante.gouv.fr'",
      "matcher-status": true
    },
    {
      "template": "http/misconfiguration/http-missing-security-headers.yaml",
      "template-url": "https://templates.nuclei.sh/public/http-missing-security-headers",
      "template-id": "http-missing-security-headers",
      "template-path": "/home/runner/nuclei-templates/http/misconfiguration/http-missing-security-headers.yaml",
      "info": {
        "name": "HTTP Missing Security Headers",
        "author": [
          "socketz",
          "geeknik",
          "g4l1t0",
          "convisoappsec",
          "kurohost",
          "dawid-czarnecki",
          "forgedhallpass",
          "jub0bs",
          "userdehghani"
        ],
        "tags": [
          "misconfig",
          "headers",
          "generic"
        ],
        "description": "This template searches for missing HTTP security headers. The impact of these missing headers can vary.\n",
        "severity": "info",
        "metadata": {
          "max-request": 1
        }
      },
      "matcher-name": "referrer-policy",
      "type": "http",
      "host": "https://diagcps.eservices.esante.gouv.fr",
      "matched-at": "https://diagcps.eservices.esante.gouv.fr",
      "request": "GET / HTTP/1.1\r\nHost: diagcps.eservices.esante.gouv.fr\r\nUser-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)\r\nConnection: close\r\nAccept: */*\r\nAccept-Language: en\r\nAccept-Encoding: gzip\r\n\r\n",
      "response": "HTTP/1.1 200 OK\r\nConnection: close\r\nTransfer-Encoding: chunked\r\nContent-Type: text/html; charset=UTF-8\r\nDate: Fri, 14 Mar 2025 16:26:19 GMT\r\nServer: Apache/2.4.37 (centos) OpenSSL/1.1.1g\r\nX-Powered-By: PHP/7.2.24\r\n\r\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n\t<title>DiagCPS, Outil de Diagnostic SSL</title>\r\n\t<meta http-equiv=\"Content-type\" content=\"text/html; charset=UTF-8\" />\r\n\t<meta name=\"description\" content=\"DiagCPS est un Outil de Diagnostic de l'authentification en ligne à l'aide d'une Carte de Professionnel de Santé, i.e. CPS. Il est fourni par l'ASIP Santé et remplace ODI.\" />\r\n\t<meta name=\"Publisher\" content=\"ASIP Santé\" />\r\n\t<meta name=\"copyright\" content=\"Tous droits réservés - ASIP Santé\" />\r\n\t<link rel=\"shortcut icon\" href=\"./images/favicon.ico\" type=\"image/x-icon\" />\r\n\t<link rel=\"stylesheet\" href=\"diagcps_css.php\" />\r\n\t<script src=\"./js/jquery-3.2.0.min.js\"></script>\r\n\t<script src=\"./js/ua-parser.min.js\"></script>\r\n</head>\r\n<body>\r\n<div id=\"header\" style=\"display:flex;flex-direction:row\">\r\n    <div style=\"margin:20px\">\r\n        <a href=\"https://solidarites-sante.gouv.fr/\" target=\"_blank\">\r\n            <img src=\"./images/logo-ministere.svg\" alt=\"Ministère des Solidarités et de la santé\" width=\"168\" height=\"104\">\r\n        </a>\r\n    </div>\r\n\t<div id=\"title\">esante.gouv.fr</div>\r\n</div>\r\n<div id=\"section\">\r\n<script type=\"text/javascript\">\n\n<!-- script : /js/wizarddiagcps.js Begin -->\n//==================================\r\n// Global variable used for state machine management \r\n// displayed on screen \r\n// or used by state machine\r\n//==================================\r\nvar wizardStateMachine = {\r\n\tstartState: 'notSupported',\r\n\tlastState: 'notSupported',\r\n\t\r\n\t//=================\r\n\t// Retry Management\r\n\t// Variables\r\n\tnbMaxRetry: 10,\r\n\tnbRetry: 0,\r\n\t\r\n\t// Management\r\n\tinitRetry: function() {this.nbRetry = this.nbMaxRetry;},\r\n\tisMaxRetry: function() {return (this.nbRetry >= this.nbMaxRetry);},\r\n\tisMinRetry: function() {return (this.nbRetry <= 0);},\r\n\tdecRetry: function() {this.nbRetry--;},\r\n\tdisplayRetry: function() {\r\n\t\t\t\t\t\t\t\t//console.log(\"displayRetry : nbRetry = \" + this.nbRetry);\r\n\t\t\t\t\t\t\t\tthis.decRetry();\r\n\t\t\t\t\t\t\t\tthis.stopTimers(); \r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.isMinRetry()\r\n\t\t\t\t\t\t\t\t\t&& \t(this.lastState != 'endDiagWithSuccess')) {\r\n\t\t\t\t\t\t\t\t\tthis.wizard('manualInstallClibCPS');\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tthis.displayWait(true);\r\n\t\t\t\t\t\t\t\t\tthis.startTimers();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\r\n\t//==================\r\n\t// Timers Management\r\n\ttimerTestSSL: null,\r\n\tretryTimeoutKO: 1000,\r\n\tinitTimer: function () {this.retryTimeoutKO = 1000;},\r\n\taccelerateTimer: function () {this.retryTimeoutKO = 250;},\r\n\tstopTimers: function() {\r\n\t\t\t\t\t\t\t\tif (this.timerTestSSL != null)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tclearTimeout(this.timerTestSSL);\r\n\t\t\t\t\t\t\t\t\tthis.timerTestSSL = null;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\tstartTimers: function() {this.timerTestSSL = setTimeout(function(){wizardStateMachine.displayRetry()}, this.retryTimeoutKO);},\r\n\t\r\n\t//=======\r\n\t// Wizard\r\n\tstartWizard: function() {this.wizard(this.startState);},\r\n\twizard: function(step, param) {\r\n\t\t\t\tconsole.log(\"wizard : step = \" + step + \", param = \" + param);\r\n\t\t\t\t\t\r\n\t\t\t\tswitch (step)\r\n\t\t\t\t{\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Pre treatment\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'notSupported':\r\n\t\t\t\t\tcase 'preAlert':\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'start');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif ((dataIHM.getUAInfos().configSupported) || (step == 'preAlert')) this.displayInstruction(true, 'preAlert');\r\n\t\t\t\t\t\telse this.displayInstruction(true, 'notSupported');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Manual Installation XPI\r\n\t\t\t\t\t// Suggestion of installation\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'manualInstallXPI':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'KO');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'manualInstallXPI');\r\n\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// XPI Installation\r\n\t\t\t\t\t// Installation process\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'XPI':\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'restartAlertXPI');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar params = {\r\n\t\t\t\t\t\t\t\t\"Installer l'Extension Cryptolib CPS\": \r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tURL: param.URL,\r\n\t\t\t\t\t\t\t\t\tIconURL: param.IconURL,\r\n\t\t\t\t\t\t\t\t\tHash: param.Hash,\r\n\t\t\t\t\t\t\t\t\ttoString: function () { return this.URL; }\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t};\r\nconsole.log(params);\r\n\t\t\t\t\t\tInstallTrigger.install(params);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// Diagnostic\r\n\t\t\t\t\t// Start\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'startDiag':\r\n\t\t\t\t\t\tthis.initRetry();\r\n\t\t\t\t\t\tthis.initTimer();\r\n\r\n\t\t\t\t\t\tthis.displayWait(true);\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'inProgress');\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tdataIHM.readClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.startTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// Diagnostic\r\n\t\t\t\t\t// Restart\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'restartDiag':\r\n\r\n\t\t\t\t\t\tdataIHM.resetClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\r\n\t\t\t\t\t//==========================\r\n\t\t\t\t\t// Progression\r\n\t\t\t\t\t//--------------------------\r\n\t\t\t\t\tcase 'inProgress':\r\n\t\t\t\t\t\t//dataIHM.readClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// this.displayDiagnosticState(true, 'inProgress');\r\n\t\t\t\t\t\t// this.displayInstruction(false);\r\n\t\t\t\t\t\t// this.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//===================\r\n\t\t\t\t\t// Ends\r\n\t\t\t\t\t//-------------------\r\n\t\t\t\t\tcase 'endDiagWithSuccess':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'OK');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tthis.displaySupport(false);\r\n\t\t\t\t\t\tthis.displayInfosCPS(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Manual Installation Cryptolib CPS\r\n\t\t\t\t\t// Suggestion of installation\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'manualInstallClibCPS':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'KO');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'manualInstallClibCPS');\r\n\t\t\t\t\t\tthis.displaySupport(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//=======================\r\n\t\t\t\t\t// Cryptolib CPS download\r\n\t\t\t\t\t// Installation process\r\n\t\t\t\t\t//-----------------------\r\n\t\t\t\t\tcase 'CryptolibCPS':\r\n\t\t\t\t\t\twindow.location = dataIHM.getServerComponentLink();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// Direct jump to Retry after installation\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'restartAlert');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\t\r\n\t\t\t\t\t//=========================\r\n\t\t\t\t\t// Other\r\n\t\t\t\t\t// Close Instruction screen\r\n\t\t\t\t\t//-------------------------\r\n\t\t\t\t\tcase 'exitInstruction':\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true);\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t// Open Support link\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'openSupport':\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tif (param !== undefined) window.open(param.URL,'_blank');\r\n\t\t\t\t\t\tbreak;\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.lastState = step;\r\n\t\t\t},\r\n\t\r\n\t//==========================\r\n\t// Screen Display Management\r\n\tdisplayElementById: function(id, display) {\r\n\t\t\t\t\t\t\tdocument.getElementById(id).style.display = display;\r\n\t\t\t\t\t\t},\r\n\thideElementById: function(id) {\r\n\t\t\t\t\t\t\tthis.displayElementById(id, \"none\");\r\n\t\t\t\t\t\t},\r\n\tdisplayInit: function(OSName) {\r\n\t\t\t\t\t\t// Events initialization\r\n\t\t\t\t\t\t//----------------------\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"cryptolib\", \t\t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"notSupported\", \t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"startDiag\", \t\t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"instructions-back\", \t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"infos_cps_caption\", \t\"click\", clickExpandCollapse);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// PreAlert initialization\r\n\t\t\t\t\t\t//------------------------\r\n\t\t\t\t\t\tthis.displayPreAlert(OSName);\r\n\t\t\t\t\t},\r\n\tdisplayInfosCPS: function (active) {\r\n\t\t\t\t\t\t\tvar infos_cps_tbody = '';\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar detailedInformations = dataIHM.getClientDetailedInfos();\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tfor (var item in detailedInformations) {\r\n\t\t\t\t\t\t\t\tinfos_cps_tbody += '<tr><td class=\"key\">' + item + '</td><td class=\"val\">' + detailedInformations[item] + '</td></tr>';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cps').className = dataIHM.getClientSSLInfos().div_cps_class;\r\n\r\n\t\t\t\t\t\t\t\tfor (var item in dataIHM.getClientSSLInfos().infos) {\r\n\t\t\t\t\t\t\t\t\tinfos_cps_tbody += '<tr><td class=\"key\">' + item + '</td><td class=\"val\">' + dataIHM.getClientSSLInfos().infos[item] + '</td></tr>';\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cps').className = \"cpsverso\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tdocument.getElementById('infos_cps_tbody').innerHTML = infos_cps_tbody;\r\n\t\t\t\t\t\t},\r\n\r\n\tdisplayWait:function (active) {\r\n\t\t\t\t\tif ( (active)\r\n\t\t\t\t\t\t&& (wizardStateMachine.nbRetry > 0) ) {\r\n\t\t\t\t\t\tthis.displayElementById('spin', \"flex\");\r\n\t\t\t\t\t\tdocument.getElementById('retry').innerHTML = wizardStateMachine.nbRetry;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.hideElementById('spin');\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\tdisplayDiagnosticState:function (active, state) {\r\n\t\t\t\t\t\t\t\tdiagStateContent = {\r\n\t\t\t\t\t\t\t\t\t'start':{content:'Cliquer sur la carte', style:'diagState diagStart'}\r\n\t\t\t\t\t\t\t\t\t, 'inProgress':{content:'Le diagnostic est en cours', style:'diagState diagInProgress'}\r\n\t\t\t\t\t\t\t\t\t, 'KO':{content:'Le diagnostic a &eacute;chou&eacute;', style:'diagState diagKO'}\r\n\t\t\t\t\t\t\t\t\t, 'OK':{content:'Le diagnostic a r&eacute;ussi', style:'diagState diagOK'}\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.hideElementById('diagState');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').style.display = \"block\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif (state !== undefined) {\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').className = diagStateContent[state].style;\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').innerHTML = diagStateContent[state].content;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\r\n\tdisplayInstruction: function (active, step) {\r\n\t\t\t\t\t\t\tthis.hideElementById('instructions-back');\r\n\t\t\t\t\t\t\tthis.hideElementById('instructions');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\tthis.displayElementById('instructions-back', \"flex\");\r\n\t\t\t\t\t\t\t\tthis.displayElementById('instructions', \"block\");\r\n\t\t\t\t\t\t\t\tthis.hideElementById('manualInstallClibCPS');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('manualInstallXPI');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('restartAlert');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('restartAlertXPI');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('preAlert');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('notSupported');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('contactSupport');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (step !== undefined) this.displayElementById(step, \"block\");\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar detailedInformations = dataIHM.getClientDetailedInfos();\r\n\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cryptolib').innerHTML = \"T&eacute;l&eacute;charger<br/>\" + dataIHM.getComponentInstallerName();\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (dataIHM.getUAInfos().os.name == 'Mac OS')\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('restartInstruction').innerHTML = \"Une fois l'installation de \" + dataIHM.getComponentInstallerName() + \" termin&eacute;e,<br/>veuillez red&eacute;marrer votre ordinateur.\";\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('restartInstruction').innerHTML = \"Une fois l'installation de \" + dataIHM.getComponentInstallerName() + \" termin&eacute;e,<br/>veuillez red&eacute;marrer votre navigateur.\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\r\n\tdisplaySupport: function (active) {\r\n\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\tthis.displayElementById('support-direction', \"flex\");\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.hideElementById('support-direction');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\r\n\tdisplayPreAlert: function(OSName) {\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-MacOS');\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-Windows');\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-Linux');\r\n\r\n\t\t\t\t\t\t\tif (OSName == 'Mac OS') this.displayElementById('alert1-MacOS', 'block');\r\n\t\t\t\t\t\t\tif (OSName == 'Windows') this.displayElementById('alert1-Windows', 'block');\r\n\t\t\t\t\t\t\tif (OSName == 'Linux') this.displayElementById('alert1-Linux', 'block');\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\r\n};\r\n\r\n//==================\r\n// Events Management\r\nfunction addEltEventListenerAllBrowser(elt, eventName, handle) {\r\n\tif (elt.addEventListener) { elt.addEventListener(eventName, handle, false);\r\n\t} else { elt.attachEvent(\"on\" + eventName, handle);\r\n\t}\r\n}\r\n\r\nfunction addIdEventListenerAllBrowser(id, eventName, handle) {\r\n\tif (document.getElementById(id)) addEltEventListenerAllBrowser(document.getElementById(id), eventName, handle);\r\n}\r\n\r\nfunction clickExpandCollapse(event) {\r\n\tif (document.getElementById('infos_cps_table').style.display != \"block\") {\r\n\t\tdocument.getElementById('infos_cps_caption_img').className = \"infos_cps_caption_img_collapse\";\r\n\t\tdocument.getElementById('infos_cps_table').style.display = \"block\";\r\n\t} else {\r\n\t\tdocument.getElementById('infos_cps_caption_img').className = \"infos_cps_caption_img_expand\";\r\n\t\tdocument.getElementById('infos_cps_table').style.display = \"none\";\r\n\t}\r\n\tevent.cancelBubble = true;\r\n\t\t\r\n\treturn false;\r\n}\r\n\r\nfunction clickActionNoPropagation(event) {\r\n\t//this.click();\r\n\r\n\tevent.cancelBubble = true;\r\n\r\n\treturn false;\r\n}\r\n\n<!-- script : /js/wizarddiagcps.js End -->\n<!-- script : /js/diagcps.js Begin -->\n//==================================\r\n// Global variable used for all data \r\n// displayed on screen \r\n// or used by state machine\r\n//==================================\r\nvar dataIHM = {\r\n\t//==========================\r\n\t// Root URL\r\n\tlocalURL: '',\r\n\tsetLocalURL: function(URL) {this.localURL = URL;},\r\n\tgetLocalURL: function() {return this.localURL;},\r\n\t\r\n\t//==========================\r\n\t// User Agent\r\n\tclientUAInfos: null,\r\n\ttimerUAInfos: null,\r\n\tinitUAInfos: function() {\r\n\t\t\t\t\t\tvar uaparser = new UAParser();\r\n\t\t\t\t\t\tthis.clientUAInfos = uaparser.getResult();\r\n\t\t\t\t\t\tthis.clientUAInfos.browser.xpi = true;\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tthis.timerUAInfos = setTimeout(function(){dataIHM.isUAInfosCPSWebEx()}, 1000);\r\n\t\t\t\t\t},\r\n\tgetUAInfos: function() {return this.clientUAInfos},\r\n\tisUAInfosCPSWebEx: function() {\r\n\t\t\t\t\tif (window.isCpsWebExAlive) {\r\n\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', window.isCpsWebExAlive());\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (this.getUAInfos().browser.name == 'Firefox') {\r\n\t\t\t\t\t\t\tif (this.getUAInfos().browser.major > 57) {\r\n\t\t\t\t\t\t\t\tthis.clientUAInfos.browser.xpi = false;\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'absente');\r\n\t\t\t\t\t\t\t\twizardStateMachine.wizard('manualInstallXPI');\r\n\t\t\t\t\t\t\t} else if (this.getUAInfos().browser.major == 57) {\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'sur cette version, l\\'installation du p&eacute;riph&eacute;rique de s&eacute;curit&eacute; doit &ecirc;tre <a href=\"http://integrateurs-cps.asipsante.fr/Installation-manuelle-PKCS11-Firefox\" target=\"_blanck\">r&eacute;alis&eacute;e manuellement</a>.');\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'd&eacute;tection impossible sur cette version');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.timerUAInfos = null;\r\n\t\t\t\t},\r\n\t\r\n\t//===============================\r\n\t// Installed Component management\r\n\tcomponentName: \"CryptolibCPS\", // By default\r\n\tsetComponentName: function(name) {this.componentName = name;},\r\n\tgetComponentName: function() {return this.componentName;},\r\n\tcomponentVersion: \"\", // By Default\r\n\tsetcomponentVersion: function(version) {this.componentVersion = version;},\r\n\tgetcomponentVersion: function() {return this.componentVersion;},\r\n\tcomponentInstallerName: \"\",\r\n\tsetComponentInstallerName: function(name) {this.componentInstallerName = name;},\r\n\tgetComponentInstallerName: function() {return this.componentInstallerName;},\r\n\tserverComponentURL: null,\r\n\tsetServerComponentURL: function(URL) {this.serverComponentURL = URL;},\r\n\tgetServerComponentLink: function(version) {\r\n\t\t\t\t\t\t\t\t\tvar componentLink = this.serverComponentURL + \"?\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"component=\" + this.getComponentName();\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&os=\" + this.getUAInfos().os.name;\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&arch=\" + this.getUAInfos().cpu.architecture;\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&version=\" + this.getcomponentVersion();\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\treturn componentLink;\r\n\t\t\t\t\t\t\t\t},\r\n\tserverComponentInfos: null,\r\n\treadServerComponentInfos: function() {\r\n\t\t\t\t\t\t\t\t// XPI 6.0.15 with Firefox < 57\r\n\t\t\t\t\t\t\t\t// ==> Use Cryptolib CPS 5.0.37 instead of last release\r\n\t\t\t\t\t\t\t\tif ((this.getUAInfos().browser.name == 'Firefox') \r\n\t\t\t\t\t\t\t\t\t&& (this.getUAInfos().browser.major < 57)) {\r\n\t\t\t\t\t\t\t\t\tswitch (this.getUAInfos().os.name) {\r\n\t\t\t\t\t\t\t\t\t\tcase 'Windows': this.setcomponentVersion('5.0.37');break;\r\n\t\t\t\t\t\t\t\t\t\tcase 'Mac OS': this.setcomponentVersion('5.0.34');break;\r\n\t\t\t\t\t\t\t\t\t\tcase 'Linux':\r\n\t\t\t\t\t\t\t\t\t\tcase 'CentOS':\r\n\t\t\t\t\t\t\t\t\t\tcase 'Ubuntu':\r\n\t\t\t\t\t\t\t\t\t\tcase 'RedHat':  this.setcomponentVersion('5.0.12');break;\r\n\t\t\t\t\t\t\t\t\t\tdefault:break;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// Use fetch if exist\r\n\t\t\t\t\t\t\t\tif (self.fetch) {\r\n\t\t\t\t\t\t\t\t\tfetch( this.getServerComponentLink() + '&filename=get' )\r\n\t\t\t\t\t\t\t\t\t.then(function(resp) {return resp.json();})\r\n\t\t\t\t\t\t\t\t\t.then(function(response) {\r\n\t\t\t\t\t\t\t\t\t\tfor (var k in response) {\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.setComponentInstallerName(response[k]);\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.addClientDetailedInfos('URL de t&eacute;l&eacute;chargement', '<a href=\"' + dataIHM.getServerComponentLink() + '\">' + dataIHM.getComponentInstallerName() + '</a>');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('readServerComponentInfos : Error with fetch (' + error.message + ')'); \r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t// Use JQuery\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$.ajax(\t{\r\n\t\t\t\t\t\t\t\t\t\turl: this.getServerComponentLink() + '&filename=get'\r\n\t\t\t\t\t\t\t\t\t\t, success: function( data) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar json;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (data === String)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson = jQuery.parseJSON(data);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson = data\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor (var k in json) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setComponentInstallerName(json[k]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.addClientDetailedInfos('URL de t&eacute;l&eacute;chargement', '<a href=\"' + dataIHM.getServerComponentLink() + '\">' + dataIHM.getComponentInstallerName() + '</a>');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t, error: function( data) { return null;}\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\r\n\t//========================================\r\n\t// Support contact informations management\r\n \tmailSupportMailbox: null,\r\n\tmailSupportDomain: null,\r\n\tsetMailSupport: function(mailbox, domain) {this.mailSupportMailbox = mailbox; this.mailSupportDomain = domain;},\r\n\tgetMailSupport: function() {return this.mailSupportMailbox + \"@\" + this.mailSupportDomain;},\r\n \t\t\r\n\t//==========================\r\n\t// Detailed informations\r\n\tclientDetailedInfos: {},\r\n\tinitClientDetailedInfos: function() {\r\n\t\t\t\t\t\t\t\tconfigSupported = true;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.getUAInfos().device.type === undefined) {\r\n\t\t\t\t\t\t\t\t\tconsole.log(\"Poste de travail\");\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tconfigSupported = false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().os.name) {\r\n\t\t\t\t\t\t\t\t\tcase 'Windows':\r\n\t\t\t\t\t\t\t\t\tcase 'Mac OS':\r\n\t\t\t\t\t\t\t\t\tcase 'Linux':\r\n\t\t\t\t\t\t\t\t\tcase 'CentOS':\r\n\t\t\t\t\t\t\t\t\tcase 'Ubuntu':\r\n\t\t\t\t\t\t\t\t\tcase 'RedHat':  configSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault: \t\tconfigSupported = configSupported & false;break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().browser.name) {\r\n\t\t\t\t\t\t\t\t\tcase 'IE':\r\n\t\t\t\t\t\t\t\t\tcase 'Safari':\r\n\t\t\t\t\t\t\t\t\tcase 'Edge':\r\n\t\t\t\t\t\t\t\t\tcase 'Chrome':\r\n\t\t\t\t\t\t\t\t\tcase 'Firefox':\tconfigSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault: \t\tconfigSupported = configSupported & false;break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().cpu.architecture) {\r\n\t\t\t\t\t\t\t\t\tcase 'ia32':\r\n\t\t\t\t\t\t\t\t\tcase 'i686':\r\n\t\t\t\t\t\t\t\t\tcase 'amd64': configSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\t\tif (this.getUAInfos().cpu.architecture === undefined)\r\n\t\t\t\t\t\t\t\t\t\t\tconfigSupported = configSupported & true;\r\n\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\tconfigSupported = configSupported & false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.getUAInfos().cpu.architecture == 'amd64')\r\n\t\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Syst&egrave;me d\\'exploitation', this.getUAInfos().os.name + \" \" + this.getUAInfos().os.version + \" (64b)\");\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Syst&egrave;me d\\'exploitation', this.getUAInfos().os.name + \" \" + this.getUAInfos().os.version);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Navigateur', this.getUAInfos().browser.name + \" \" + this.getUAInfos().browser.major);\r\n\t\t\t\t\t\t\t\t// this.addClientDetailedInfos('Compatibilit&eacute; ASIP', '<a href=\"http://integrateurs-cps.asipsante.fr/Lettre_d_information\" target=\"_blanck\">Lettre d\\'information<br/>POSTE DE TRAVAIL & Veille Technologique</a>');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.clientUAInfos.configSupported = configSupported;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\treturn configSupported;\r\n\t\t\t\t\t\t\t},\r\n\tgetClientDetailedInfos: function() {return this.clientDetailedInfos;},\r\n\taddClientDetailedInfos: function(key, value) { this.clientDetailedInfos[key] = value;},\r\n\tresetClientDetailedInfos: function() {this.clientDetailedInfos = {};},\r\n\t\t\r\n\t//==========================\r\n\t// Client SSL Informations\r\n\tclientSSLInfos: null,\r\n\tclientSSLFetchParameters: { mode:'cors', credentials: 'include', cache: 'no-cache'},\r\n\tclientSSLAjaxParameters: { cache: false, timeout: 8000, async: true},\r\n\tisDefineClientSSLInfos: function() {return (this.clientSSLInfos != undefined);},\r\n\tsetClientSSLInfos: function(data) {this.clientSSLInfos = data;},\r\n\tgetClientSSLInfos: function() {return this.clientSSLInfos;},\r\n\tinitClientSSLParameters: function() { $.ajaxSetup(this.clientSSLAjaxParameters);},\r\n\tresetClientSSLInfos: function () {\r\n\t\t\t\t\t\t\tconsole.log('resetClientSSLInfos : Erase SSL Connexion cache for ' + this.getUAInfos().browser.name);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tswitch (this.getUAInfos().browser.name) {\r\n\t\t\t\t\t\t\t\tcase 'Edge': // Works !\r\n\t\t\t\t\t\t\t\tcase 'IE': // Works !\r\n\t\t\t\t\t\t\t\t\tif (document.execCommand) document.execCommand( \"ClearAuthenticationCache\", \"false\");\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 'Firefox':\t// Works !\r\n\t\t\t\t\t\t\t\t\t//location.reload(); // Works !\r\n\t\t\t\t\t\t\t\t\tif (window.crypto) if (window.crypto.logout) window.crypto.logout(); // Works !\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 'Chrome': // Works !\r\n\t\t\t\t\t\t\t\tcase 'Safari': // Not working, restart Browser needed !\r\n\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag'); \r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\treadClientSSLInfos: function() {\r\n\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : SSL Connexion' );\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// Use fetch if exist\r\n\t\t\t\t\t\t\tif (self.fetch) {\r\n\t\t\t\t\t\t\t\t// Try to connect and get CPS informations\r\n\t\t\t\t\t\t\t\tfetch( '/visuel.php', this.clientSSLFetchParameters )\r\n\t\t\t\t\t\t\t\t.then(function(resp) {return resp.json();})\r\n\t\t\t\t\t\t\t\t.then(function(resp_json) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Success with Fetch');\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t// traitement du JSON\r\n\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(resp_json);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('endDiagWithSuccess');\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t// Case of SSL Error\r\n\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Probably SSL Error with fetch (' + error.message + ')');\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(null);\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.accelerateTimer();\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t// Use JQuery\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$.ajax(\t{\r\n\t\t\t\t\t\t\t\t\turl: 'visuel.php'\r\n\t\t\t\t\t\t\t\t\t, success: function(data, textStatus) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Success with Ajax (' + textStatus + ')');\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tif (data === String)\r\n\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(jQuery.parseJSON(data));\r\n\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(data);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('endDiagWithSuccess');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t, error: function(data, textStatus) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Probably SSL Error with Ajax (' + textStatus + ')');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(null);\r\n\t\t\t\t\t\t\t\t\t\t\twizardStateMachine.accelerateTimer();\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n}\r\n\r\n//=====\r\n// Main\r\n//=====\r\n$(function() {\r\n\t// Initialization\r\n\t//---------------\r\n\tdataIHM.initUAInfos(); // User Agent\r\n\t\r\n\tdataIHM.initClientSSLParameters();\r\n\t\r\n\t// Sp�cific parameter with no good solution @29/12/2017\r\n\tswitch (dataIHM.getUAInfos().browser.name) {\r\n\t\tcase 'IE':\r\n\t\t\tconsole.log('=========== Use Ajax =============');\r\n\t\t\tself.fetch = undefined;\r\n\t\t\tbreak;\r\n\t\tcase 'Edge':\r\n\t\tcase 'Firefox':\r\n\t\tcase 'Safari':\r\n\t\tdefault:\r\n\t\t\tconsole.log('=========== Try using fetch. If not available use Ajax =============');\r\n\t\t\tbreak;\r\n\t}\r\n\t\r\n\tdataIHM.initClientDetailedInfos(); // Informations in bottom\r\n\tdataIHM.readServerComponentInfos(); // Get from informations from Web Service\r\n\t\r\n\twizardStateMachine.startWizard(); // Start Wizard\r\n\t\t\r\n\twizardStateMachine.displayInit(dataIHM.getUAInfos().os.name);\r\n});\r\n\n<!-- script : /js/diagcps.js End -->\n\n</script>\n<script type=\"text/javascript\">\n\t// Initialization Javascript from PHP\n\tdataIHM.setComponentName('CryptolibCPS');\n\tdataIHM.setServerComponentURL('download.php');\n</script>\n<!--<div id=\"beta\"></div>-->\n<div id=\"instructions-back\" onclick=\"wizardStateMachine.wizard('exitInstruction');\">\n\t<div id=\"instructions\">\n\t\n\t\t<div class=\"screen\" id=\"preAlert\">\n\t\t\t<div class=\"instruction\"><br/>\n<h1>Assistance en cas de carte CPS non lue</h1>\n\n<h2>Pr&eacute;alablement</h2>\n<p>\nVeuillez v&eacute;rifier que votre carte est bien ins&eacute;r&eacute;e dans votre lecteur de carte ou votre terminal Vitale.<br/>\nPuis v&eacute;rifier que votre lecteur de carte ou votre terminal Vitale est correctement connect&eacute; &agrave; votre ordinateur.<br/>\n<br/>\nLa carte ins&eacute;r&eacute;e dans le lecteur doit &ecirc;tre la derni&egrave;re carte active.\n\n<table >\n\t<tr>\n\t\t<td style=\"border-top:none;\"><img src=\"images/informations32.png\" alt=\"Information :\"/></td>\n\t\t<td style=\"border-top:none;\"><i>La derni&egrave;re carte active pr&eacute;sente la date d'expiration la plus &eacute;loign&eacute;e.</i></td>\n\t</tr>\n</table>\n<br/>\nUne fois cette v&eacute;rification r&eacute;alis&eacute;e, v&eacute;rifiez que la carte est bien lue.<br/>\n</p>\n\n<div id=\"alert1-MacOS\">\n<h2>Votre ordinateur est sous Mac OS</h2>\n<p>\nSur votre syst&egrave;me d'exploitation, nous ne disposons pas de m&eacute;thode particuli&egrave;re pour v&eacute;rifier si votre carte est lue.<br/>\n<br/>\nVeuillez lancer un diagnostic de votre ordinateur et proc&eacute;der &agrave; l'installation des mises &agrave; jour sugg&eacute;r&eacute;es.<br/>\n</p>\n</div>\n\n<div id=\"alert1-Linux\">\n<h2>Votre ordinateur est sous Linux</h2>\n<p>\nSur votre syst&egrave;me d'exploitation, nous ne disposons pas de m&eacute;thode particuli&egrave;re pour v&eacute;rifier si votre carte est lue.<br/>\n<br/>\nVeuillez lancer un diagnostic de votre ordinateur et proc&eacute;der &agrave; l'installation des mises &agrave; jour sugg&eacute;r&eacute;es.<br/>\n</p>\n</div>\n\n<div id=\"alert1-Windows\">\n<h2>Votre ordinateur est sous Windows</h2>\n<b>Dans la barre des t&acirc;ches, une carte lue est signal&eacute;e par <img src=\"images/preHelper/iconeOK.png\" alt=\"Icone vert dans la barre des taches\" /> et une carte non lue par <img src=\"images/preHelper/iconeKO.png\" alt=\"Icone rouge dans la barre des taches\"/>.</b><br/>\n<h3>L'ic&ocirc;ne <img src=\"images/preHelper/iconeOK.png\" alt=\"Icone vert dans la barre des taches\"/> est introuvable</h3>\n<p>\nCliquez avec le clic droit de votre souris sur le bouton &laquo;Afficher les ic&ocirc;nes&raquo; (en bas &agrave; droite de votre &eacute;cran) ou sur la zone heure et date et selectionnez &laquo;Personnaliser les ic&ocirc;nes de notification&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/notificationsBar.png\" alt=\"Barre de notification\"/></div>\n<br/>\n<br/>\nCherchez l'ic&ocirc;ne &laquo;Gestionnaire de certificats CPS&raquo; et s&eacute;lectionnez &laquo;Afficher l'ic&ocirc;ne et les notifications&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/notificationsParameters.png\" alt=\"Parametres de notifications\"/></div>\n<br/>\nUne fois la manipulation r&eacute;alis&eacute;e vous devriez voir apparaitre l'ic&ocirc;ne (en bas &agrave; droite de votre &eacute;cran).<br/>\n<br/>\nSi l'ic&ocirc;ne n'apparait pas dans la liste, lancer le diagnostic de votre ordinateur et installez les mises &agrave; jour propos&eacute;es.<br/>\n<br/>\n</p>\n<h2>L'ic&ocirc;ne <img src=\"images/preHelper/iconeKO.png\" alt=\"Icone rouge dans la barre des taches\" /> est rouge</h2>\n<p>\nSi l'ic&ocirc;ne est encadr&eacute;e de rouge (carte non lue), assurez-vous que votre carte est bien ins&eacute;r&eacute;e dans votre lecteur, rafra&icirc;chissez le lecteur en cliquant sur l'ic&ocirc;ne avec le bouton droit de la souris. Et cliquez sur &laquo;Rafra&icirc;chir&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/rightClickCCM.png\" alt=\"Cliquer droit sur l'icone du CCM\" /></div>\n<br/>\nSi l'encadr&eacute; reste rouge apr&egrave;s la manipulation, red&eacute;marrez votre ordinateur en laissant le lecteur et la CPS connect&eacute;s.<br/>\n<br/>\nApr&egrave;s ces manipulations, si l'ic&ocirc;ne ne passe pas au vert, veuillez nous contacter.\n</p>\n<div align=\"center\"></div>\n</div>\n\n</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"startDiag\" onclick=\"wizardStateMachine.wizard('startDiag');\">Diagnostiquer mon poste</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"notSupported\">\n\t\t\t<div class=\"instruction\">Votre configuration mat&eacute;riel et/ou syst&egrave;me n'est pas support&eacute;e par nos composants logiciels. Nous ne garantissons pas le succès du diagnostic.</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"notSupported\" onclick=\"wizardStateMachine.wizard('preAlert');\">Continuer</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"manualInstallXPI\">\n\t\t\t<div class=\"instruction\" id=\"xpi_instruction\" >L'Extension Firefox n'a pas &eacute;t&eacute; d&eacute;tect&eacute;e. Elle est indispensable sous ce navigateur.<br/>Apr&egrave;s l'installation, veuillez red&eacute;marrer votre navigateur.</div>\n\t\t\t<div class=\"actions\">\n<!--\t\t\t\t<div class=\"action instruction\" id=\"xpi\" onclick=\"wizardStateMachine.wizard('XPI',{URL:'https://diagcps.eservices.esante.gouv.fr/ODI_PS/php/download_asip.php?installeur=url_interne_xpi_installation_pkcs11',IconURL:'https://diagcps.eservices.esante.gouv.fr/ODI_PS/images/asip_sante.png',Hash:'sha256:c23de3812aaf7c3a81d80e9bdf891c3e2b621e01e55e8d308226fd86ab6ef438'});\">Installer<br/>l'Extension Firefox</div>-->\n<div class=\"action instruction\" id=\"xpi\" onclick=\"wizardStateMachine.wizard('XPI',{URL:'/download.php?component=xpi',IconURL:'/images/asip_sante.png',Hash:'sha256:c23de3812aaf7c3a81d80e9bdf891c3e2b621e01e55e8d308226fd86ab6ef438'});\">Installer<br/>l'Extension Firefox</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"restartAlertXPI\">\n\t\t\t<div class=\"instruction\" id=\"restartInstructionXPI\" >Une fois l'installation de l'Extension Cryptolib CPS termin&eacute;e,<br/>veuillez red&eacute;marrer votre navigateur.</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"manualInstallClibCPS\">\n\t\t\t<div class=\"instruction\">Si vous avez ins&eacute;r&eacute; votre CPS dans votre lecteur sans succ&egrave;s, la version de Cryptolib CPS de votre poste de travail n'est peut-&ecirc;tre pas &agrave; jour.</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"cryptolib\" onclick=\"wizardStateMachine.wizard('CryptolibCPS');\">T&eacute;l&eacute;charger<br/>Cryptolib CPS</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"restartAlert\">\n\t\t\t<div class=\"instruction\" id=\"restartInstruction\" >Une fois l'installation de CryptolibCPS_vX.Y.Z termin&eacute;e, veuillez red&eacute;marrer votre navigateur.</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"contactSupport\">\n\t\t\t<div class=\"instruction\">Si vous avez installez le composant propos&eacute; sans succ&eacute;s,<br/> veuillez contacter le Support.</div>\n\t\t</div>\n\t\t\n\t</div>\n</div>\t\n<div id=\"service-direction\" class=\"column\"></div>\n<div id=\"article\">\n\t<div id=\"center\">\n\t\t<div class=\"diagState\" id=\"diagState\"></div>\n\t\t<div>\n\t\t\t<div id=\"cps\" class=\"cpsverso\" onclick=\"wizardStateMachine.wizard('restartDiag');\"><div id=\"spin\"><div id=\"retry\"></div></div></div>\n\t\t</div>\n<!--\t\t\n\t\t<div id=\"results\">\n\t\t\t<div>\n\t\t\t\t<div class=\"sign\" id=\"certificat\"></div>\n\t\t\t\t<div class=\"sign\" id=\"expired\" title=\"expire\"></div>\n\t\t\t\t<div class=\"sign\" id=\"revoc\" title=\"revoque\"></div>\n\t\t\t\t<div class=\"sign\" id=\"class\"></div>\n\t\t\t\t<div class=\"sign\" id=\"rootAC\"></div>\n\t\t\t\t<div class=\"sign\" id=\"cryptolib\" title=\"cryptolib\"></div>\n\t\t\t</div>\n\t\t</div>\n-->\n\t\t<div id=\"cps_infos\">\n\t\t\t<div id=\"infos_cps\">\n\t\t\t\t<div id=\"infos_cps_caption\"><div>Informations d&eacute;taill&eacute;es</div><div class=\"infos_cps_caption_img_expand\" id=\"infos_cps_caption_img\"></div></div>\n\t\t\t\t<table id=\"infos_cps_table\">\n\t\t\t\t\t<tbody id=\"infos_cps_tbody\"></tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n<div id=\"support-direction\" class=\"column\"></div>\n</div>\r\n<div id=\"footer\" style=\"display:flex;flex-direction:row\">\r\n    <div style=\"display:flex;flex-direction:row;width:30vw\">\r\n        <div style=\"margin:20px\">\r\n            <a href=\"https://solidarites-sante.gouv.fr/\" target=\"_blank\">\r\n                <img src=\"./images/logo-ministere.svg\" alt=\"Ministère des Solidarités et de la santé\" width=\"84\" height=\"62\">\r\n            </a>\r\n        </div>\r\n        <div style=\"margin:20px\">\r\n            <a href=\"https://esante.gouv.fr/\" target=\"_blank\">\r\n                <img src=\"./images/logo-ANS.svg\" alt=\"Agence du Numérique en Santé\" width=\"166\" height=\"50\">\r\n            </a>\r\n        </div>\r\n    </div>\r\n    <div style=\"width:60vw\">\r\n        <ul style=\"align-items:end\">\r\n            <li><a href=\"http://esante.gouv.fr/services/mentions-legales\" target=\"_blank\">Mentions l&eacute;gales</a></li>\r\n            <li><a href=\"./copyright.php\" target=\"_blank\" title=\"Copyright [nouvelle fen&ecirc;tre]\">Copyright</a></li>\r\n        </ul>\r\n    </div>\r\n</div>\r\n\r\n</body>\r\n</html>\r\n",
      "ip": "135.125.232.117",
      "timestamp": "2025-03-14T16:26:19.506417052Z",
      "curl-command": "curl -X 'GET' -H 'Accept: */*' -H 'Accept-Language: en' -H 'User-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)' 'https://diagcps.eservices.esante.gouv.fr'",
      "matcher-status": true
    },
    {
      "template": "http/misconfiguration/http-missing-security-headers.yaml",
      "template-url": "https://templates.nuclei.sh/public/http-missing-security-headers",
      "template-id": "http-missing-security-headers",
      "template-path": "/home/runner/nuclei-templates/http/misconfiguration/http-missing-security-headers.yaml",
      "info": {
        "name": "HTTP Missing Security Headers",
        "author": [
          "socketz",
          "geeknik",
          "g4l1t0",
          "convisoappsec",
          "kurohost",
          "dawid-czarnecki",
          "forgedhallpass",
          "jub0bs",
          "userdehghani"
        ],
        "tags": [
          "misconfig",
          "headers",
          "generic"
        ],
        "description": "This template searches for missing HTTP security headers. The impact of these missing headers can vary.\n",
        "severity": "info",
        "metadata": {
          "max-request": 1
        }
      },
      "matcher-name": "clear-site-data",
      "type": "http",
      "host": "https://diagcps.eservices.esante.gouv.fr",
      "matched-at": "https://diagcps.eservices.esante.gouv.fr",
      "request": "GET / HTTP/1.1\r\nHost: diagcps.eservices.esante.gouv.fr\r\nUser-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)\r\nConnection: close\r\nAccept: */*\r\nAccept-Language: en\r\nAccept-Encoding: gzip\r\n\r\n",
      "response": "HTTP/1.1 200 OK\r\nConnection: close\r\nTransfer-Encoding: chunked\r\nContent-Type: text/html; charset=UTF-8\r\nDate: Fri, 14 Mar 2025 16:26:19 GMT\r\nServer: Apache/2.4.37 (centos) OpenSSL/1.1.1g\r\nX-Powered-By: PHP/7.2.24\r\n\r\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n\t<title>DiagCPS, Outil de Diagnostic SSL</title>\r\n\t<meta http-equiv=\"Content-type\" content=\"text/html; charset=UTF-8\" />\r\n\t<meta name=\"description\" content=\"DiagCPS est un Outil de Diagnostic de l'authentification en ligne à l'aide d'une Carte de Professionnel de Santé, i.e. CPS. Il est fourni par l'ASIP Santé et remplace ODI.\" />\r\n\t<meta name=\"Publisher\" content=\"ASIP Santé\" />\r\n\t<meta name=\"copyright\" content=\"Tous droits réservés - ASIP Santé\" />\r\n\t<link rel=\"shortcut icon\" href=\"./images/favicon.ico\" type=\"image/x-icon\" />\r\n\t<link rel=\"stylesheet\" href=\"diagcps_css.php\" />\r\n\t<script src=\"./js/jquery-3.2.0.min.js\"></script>\r\n\t<script src=\"./js/ua-parser.min.js\"></script>\r\n</head>\r\n<body>\r\n<div id=\"header\" style=\"display:flex;flex-direction:row\">\r\n    <div style=\"margin:20px\">\r\n        <a href=\"https://solidarites-sante.gouv.fr/\" target=\"_blank\">\r\n            <img src=\"./images/logo-ministere.svg\" alt=\"Ministère des Solidarités et de la santé\" width=\"168\" height=\"104\">\r\n        </a>\r\n    </div>\r\n\t<div id=\"title\">esante.gouv.fr</div>\r\n</div>\r\n<div id=\"section\">\r\n<script type=\"text/javascript\">\n\n<!-- script : /js/wizarddiagcps.js Begin -->\n//==================================\r\n// Global variable used for state machine management \r\n// displayed on screen \r\n// or used by state machine\r\n//==================================\r\nvar wizardStateMachine = {\r\n\tstartState: 'notSupported',\r\n\tlastState: 'notSupported',\r\n\t\r\n\t//=================\r\n\t// Retry Management\r\n\t// Variables\r\n\tnbMaxRetry: 10,\r\n\tnbRetry: 0,\r\n\t\r\n\t// Management\r\n\tinitRetry: function() {this.nbRetry = this.nbMaxRetry;},\r\n\tisMaxRetry: function() {return (this.nbRetry >= this.nbMaxRetry);},\r\n\tisMinRetry: function() {return (this.nbRetry <= 0);},\r\n\tdecRetry: function() {this.nbRetry--;},\r\n\tdisplayRetry: function() {\r\n\t\t\t\t\t\t\t\t//console.log(\"displayRetry : nbRetry = \" + this.nbRetry);\r\n\t\t\t\t\t\t\t\tthis.decRetry();\r\n\t\t\t\t\t\t\t\tthis.stopTimers(); \r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.isMinRetry()\r\n\t\t\t\t\t\t\t\t\t&& \t(this.lastState != 'endDiagWithSuccess')) {\r\n\t\t\t\t\t\t\t\t\tthis.wizard('manualInstallClibCPS');\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tthis.displayWait(true);\r\n\t\t\t\t\t\t\t\t\tthis.startTimers();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\r\n\t//==================\r\n\t// Timers Management\r\n\ttimerTestSSL: null,\r\n\tretryTimeoutKO: 1000,\r\n\tinitTimer: function () {this.retryTimeoutKO = 1000;},\r\n\taccelerateTimer: function () {this.retryTimeoutKO = 250;},\r\n\tstopTimers: function() {\r\n\t\t\t\t\t\t\t\tif (this.timerTestSSL != null)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tclearTimeout(this.timerTestSSL);\r\n\t\t\t\t\t\t\t\t\tthis.timerTestSSL = null;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\tstartTimers: function() {this.timerTestSSL = setTimeout(function(){wizardStateMachine.displayRetry()}, this.retryTimeoutKO);},\r\n\t\r\n\t//=======\r\n\t// Wizard\r\n\tstartWizard: function() {this.wizard(this.startState);},\r\n\twizard: function(step, param) {\r\n\t\t\t\tconsole.log(\"wizard : step = \" + step + \", param = \" + param);\r\n\t\t\t\t\t\r\n\t\t\t\tswitch (step)\r\n\t\t\t\t{\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Pre treatment\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'notSupported':\r\n\t\t\t\t\tcase 'preAlert':\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'start');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif ((dataIHM.getUAInfos().configSupported) || (step == 'preAlert')) this.displayInstruction(true, 'preAlert');\r\n\t\t\t\t\t\telse this.displayInstruction(true, 'notSupported');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Manual Installation XPI\r\n\t\t\t\t\t// Suggestion of installation\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'manualInstallXPI':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'KO');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'manualInstallXPI');\r\n\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// XPI Installation\r\n\t\t\t\t\t// Installation process\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'XPI':\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'restartAlertXPI');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar params = {\r\n\t\t\t\t\t\t\t\t\"Installer l'Extension Cryptolib CPS\": \r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tURL: param.URL,\r\n\t\t\t\t\t\t\t\t\tIconURL: param.IconURL,\r\n\t\t\t\t\t\t\t\t\tHash: param.Hash,\r\n\t\t\t\t\t\t\t\t\ttoString: function () { return this.URL; }\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t};\r\nconsole.log(params);\r\n\t\t\t\t\t\tInstallTrigger.install(params);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// Diagnostic\r\n\t\t\t\t\t// Start\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'startDiag':\r\n\t\t\t\t\t\tthis.initRetry();\r\n\t\t\t\t\t\tthis.initTimer();\r\n\r\n\t\t\t\t\t\tthis.displayWait(true);\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'inProgress');\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tdataIHM.readClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.startTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// Diagnostic\r\n\t\t\t\t\t// Restart\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'restartDiag':\r\n\r\n\t\t\t\t\t\tdataIHM.resetClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\r\n\t\t\t\t\t//==========================\r\n\t\t\t\t\t// Progression\r\n\t\t\t\t\t//--------------------------\r\n\t\t\t\t\tcase 'inProgress':\r\n\t\t\t\t\t\t//dataIHM.readClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// this.displayDiagnosticState(true, 'inProgress');\r\n\t\t\t\t\t\t// this.displayInstruction(false);\r\n\t\t\t\t\t\t// this.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//===================\r\n\t\t\t\t\t// Ends\r\n\t\t\t\t\t//-------------------\r\n\t\t\t\t\tcase 'endDiagWithSuccess':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'OK');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tthis.displaySupport(false);\r\n\t\t\t\t\t\tthis.displayInfosCPS(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Manual Installation Cryptolib CPS\r\n\t\t\t\t\t// Suggestion of installation\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'manualInstallClibCPS':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'KO');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'manualInstallClibCPS');\r\n\t\t\t\t\t\tthis.displaySupport(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//=======================\r\n\t\t\t\t\t// Cryptolib CPS download\r\n\t\t\t\t\t// Installation process\r\n\t\t\t\t\t//-----------------------\r\n\t\t\t\t\tcase 'CryptolibCPS':\r\n\t\t\t\t\t\twindow.location = dataIHM.getServerComponentLink();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// Direct jump to Retry after installation\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'restartAlert');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\t\r\n\t\t\t\t\t//=========================\r\n\t\t\t\t\t// Other\r\n\t\t\t\t\t// Close Instruction screen\r\n\t\t\t\t\t//-------------------------\r\n\t\t\t\t\tcase 'exitInstruction':\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true);\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t// Open Support link\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'openSupport':\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tif (param !== undefined) window.open(param.URL,'_blank');\r\n\t\t\t\t\t\tbreak;\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.lastState = step;\r\n\t\t\t},\r\n\t\r\n\t//==========================\r\n\t// Screen Display Management\r\n\tdisplayElementById: function(id, display) {\r\n\t\t\t\t\t\t\tdocument.getElementById(id).style.display = display;\r\n\t\t\t\t\t\t},\r\n\thideElementById: function(id) {\r\n\t\t\t\t\t\t\tthis.displayElementById(id, \"none\");\r\n\t\t\t\t\t\t},\r\n\tdisplayInit: function(OSName) {\r\n\t\t\t\t\t\t// Events initialization\r\n\t\t\t\t\t\t//----------------------\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"cryptolib\", \t\t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"notSupported\", \t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"startDiag\", \t\t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"instructions-back\", \t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"infos_cps_caption\", \t\"click\", clickExpandCollapse);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// PreAlert initialization\r\n\t\t\t\t\t\t//------------------------\r\n\t\t\t\t\t\tthis.displayPreAlert(OSName);\r\n\t\t\t\t\t},\r\n\tdisplayInfosCPS: function (active) {\r\n\t\t\t\t\t\t\tvar infos_cps_tbody = '';\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar detailedInformations = dataIHM.getClientDetailedInfos();\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tfor (var item in detailedInformations) {\r\n\t\t\t\t\t\t\t\tinfos_cps_tbody += '<tr><td class=\"key\">' + item + '</td><td class=\"val\">' + detailedInformations[item] + '</td></tr>';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cps').className = dataIHM.getClientSSLInfos().div_cps_class;\r\n\r\n\t\t\t\t\t\t\t\tfor (var item in dataIHM.getClientSSLInfos().infos) {\r\n\t\t\t\t\t\t\t\t\tinfos_cps_tbody += '<tr><td class=\"key\">' + item + '</td><td class=\"val\">' + dataIHM.getClientSSLInfos().infos[item] + '</td></tr>';\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cps').className = \"cpsverso\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tdocument.getElementById('infos_cps_tbody').innerHTML = infos_cps_tbody;\r\n\t\t\t\t\t\t},\r\n\r\n\tdisplayWait:function (active) {\r\n\t\t\t\t\tif ( (active)\r\n\t\t\t\t\t\t&& (wizardStateMachine.nbRetry > 0) ) {\r\n\t\t\t\t\t\tthis.displayElementById('spin', \"flex\");\r\n\t\t\t\t\t\tdocument.getElementById('retry').innerHTML = wizardStateMachine.nbRetry;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.hideElementById('spin');\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\tdisplayDiagnosticState:function (active, state) {\r\n\t\t\t\t\t\t\t\tdiagStateContent = {\r\n\t\t\t\t\t\t\t\t\t'start':{content:'Cliquer sur la carte', style:'diagState diagStart'}\r\n\t\t\t\t\t\t\t\t\t, 'inProgress':{content:'Le diagnostic est en cours', style:'diagState diagInProgress'}\r\n\t\t\t\t\t\t\t\t\t, 'KO':{content:'Le diagnostic a &eacute;chou&eacute;', style:'diagState diagKO'}\r\n\t\t\t\t\t\t\t\t\t, 'OK':{content:'Le diagnostic a r&eacute;ussi', style:'diagState diagOK'}\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.hideElementById('diagState');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').style.display = \"block\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif (state !== undefined) {\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').className = diagStateContent[state].style;\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').innerHTML = diagStateContent[state].content;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\r\n\tdisplayInstruction: function (active, step) {\r\n\t\t\t\t\t\t\tthis.hideElementById('instructions-back');\r\n\t\t\t\t\t\t\tthis.hideElementById('instructions');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\tthis.displayElementById('instructions-back', \"flex\");\r\n\t\t\t\t\t\t\t\tthis.displayElementById('instructions', \"block\");\r\n\t\t\t\t\t\t\t\tthis.hideElementById('manualInstallClibCPS');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('manualInstallXPI');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('restartAlert');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('restartAlertXPI');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('preAlert');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('notSupported');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('contactSupport');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (step !== undefined) this.displayElementById(step, \"block\");\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar detailedInformations = dataIHM.getClientDetailedInfos();\r\n\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cryptolib').innerHTML = \"T&eacute;l&eacute;charger<br/>\" + dataIHM.getComponentInstallerName();\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (dataIHM.getUAInfos().os.name == 'Mac OS')\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('restartInstruction').innerHTML = \"Une fois l'installation de \" + dataIHM.getComponentInstallerName() + \" termin&eacute;e,<br/>veuillez red&eacute;marrer votre ordinateur.\";\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('restartInstruction').innerHTML = \"Une fois l'installation de \" + dataIHM.getComponentInstallerName() + \" termin&eacute;e,<br/>veuillez red&eacute;marrer votre navigateur.\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\r\n\tdisplaySupport: function (active) {\r\n\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\tthis.displayElementById('support-direction', \"flex\");\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.hideElementById('support-direction');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\r\n\tdisplayPreAlert: function(OSName) {\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-MacOS');\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-Windows');\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-Linux');\r\n\r\n\t\t\t\t\t\t\tif (OSName == 'Mac OS') this.displayElementById('alert1-MacOS', 'block');\r\n\t\t\t\t\t\t\tif (OSName == 'Windows') this.displayElementById('alert1-Windows', 'block');\r\n\t\t\t\t\t\t\tif (OSName == 'Linux') this.displayElementById('alert1-Linux', 'block');\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\r\n};\r\n\r\n//==================\r\n// Events Management\r\nfunction addEltEventListenerAllBrowser(elt, eventName, handle) {\r\n\tif (elt.addEventListener) { elt.addEventListener(eventName, handle, false);\r\n\t} else { elt.attachEvent(\"on\" + eventName, handle);\r\n\t}\r\n}\r\n\r\nfunction addIdEventListenerAllBrowser(id, eventName, handle) {\r\n\tif (document.getElementById(id)) addEltEventListenerAllBrowser(document.getElementById(id), eventName, handle);\r\n}\r\n\r\nfunction clickExpandCollapse(event) {\r\n\tif (document.getElementById('infos_cps_table').style.display != \"block\") {\r\n\t\tdocument.getElementById('infos_cps_caption_img').className = \"infos_cps_caption_img_collapse\";\r\n\t\tdocument.getElementById('infos_cps_table').style.display = \"block\";\r\n\t} else {\r\n\t\tdocument.getElementById('infos_cps_caption_img').className = \"infos_cps_caption_img_expand\";\r\n\t\tdocument.getElementById('infos_cps_table').style.display = \"none\";\r\n\t}\r\n\tevent.cancelBubble = true;\r\n\t\t\r\n\treturn false;\r\n}\r\n\r\nfunction clickActionNoPropagation(event) {\r\n\t//this.click();\r\n\r\n\tevent.cancelBubble = true;\r\n\r\n\treturn false;\r\n}\r\n\n<!-- script : /js/wizarddiagcps.js End -->\n<!-- script : /js/diagcps.js Begin -->\n//==================================\r\n// Global variable used for all data \r\n// displayed on screen \r\n// or used by state machine\r\n//==================================\r\nvar dataIHM = {\r\n\t//==========================\r\n\t// Root URL\r\n\tlocalURL: '',\r\n\tsetLocalURL: function(URL) {this.localURL = URL;},\r\n\tgetLocalURL: function() {return this.localURL;},\r\n\t\r\n\t//==========================\r\n\t// User Agent\r\n\tclientUAInfos: null,\r\n\ttimerUAInfos: null,\r\n\tinitUAInfos: function() {\r\n\t\t\t\t\t\tvar uaparser = new UAParser();\r\n\t\t\t\t\t\tthis.clientUAInfos = uaparser.getResult();\r\n\t\t\t\t\t\tthis.clientUAInfos.browser.xpi = true;\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tthis.timerUAInfos = setTimeout(function(){dataIHM.isUAInfosCPSWebEx()}, 1000);\r\n\t\t\t\t\t},\r\n\tgetUAInfos: function() {return this.clientUAInfos},\r\n\tisUAInfosCPSWebEx: function() {\r\n\t\t\t\t\tif (window.isCpsWebExAlive) {\r\n\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', window.isCpsWebExAlive());\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (this.getUAInfos().browser.name == 'Firefox') {\r\n\t\t\t\t\t\t\tif (this.getUAInfos().browser.major > 57) {\r\n\t\t\t\t\t\t\t\tthis.clientUAInfos.browser.xpi = false;\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'absente');\r\n\t\t\t\t\t\t\t\twizardStateMachine.wizard('manualInstallXPI');\r\n\t\t\t\t\t\t\t} else if (this.getUAInfos().browser.major == 57) {\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'sur cette version, l\\'installation du p&eacute;riph&eacute;rique de s&eacute;curit&eacute; doit &ecirc;tre <a href=\"http://integrateurs-cps.asipsante.fr/Installation-manuelle-PKCS11-Firefox\" target=\"_blanck\">r&eacute;alis&eacute;e manuellement</a>.');\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'd&eacute;tection impossible sur cette version');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.timerUAInfos = null;\r\n\t\t\t\t},\r\n\t\r\n\t//===============================\r\n\t// Installed Component management\r\n\tcomponentName: \"CryptolibCPS\", // By default\r\n\tsetComponentName: function(name) {this.componentName = name;},\r\n\tgetComponentName: function() {return this.componentName;},\r\n\tcomponentVersion: \"\", // By Default\r\n\tsetcomponentVersion: function(version) {this.componentVersion = version;},\r\n\tgetcomponentVersion: function() {return this.componentVersion;},\r\n\tcomponentInstallerName: \"\",\r\n\tsetComponentInstallerName: function(name) {this.componentInstallerName = name;},\r\n\tgetComponentInstallerName: function() {return this.componentInstallerName;},\r\n\tserverComponentURL: null,\r\n\tsetServerComponentURL: function(URL) {this.serverComponentURL = URL;},\r\n\tgetServerComponentLink: function(version) {\r\n\t\t\t\t\t\t\t\t\tvar componentLink = this.serverComponentURL + \"?\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"component=\" + this.getComponentName();\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&os=\" + this.getUAInfos().os.name;\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&arch=\" + this.getUAInfos().cpu.architecture;\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&version=\" + this.getcomponentVersion();\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\treturn componentLink;\r\n\t\t\t\t\t\t\t\t},\r\n\tserverComponentInfos: null,\r\n\treadServerComponentInfos: function() {\r\n\t\t\t\t\t\t\t\t// XPI 6.0.15 with Firefox < 57\r\n\t\t\t\t\t\t\t\t// ==> Use Cryptolib CPS 5.0.37 instead of last release\r\n\t\t\t\t\t\t\t\tif ((this.getUAInfos().browser.name == 'Firefox') \r\n\t\t\t\t\t\t\t\t\t&& (this.getUAInfos().browser.major < 57)) {\r\n\t\t\t\t\t\t\t\t\tswitch (this.getUAInfos().os.name) {\r\n\t\t\t\t\t\t\t\t\t\tcase 'Windows': this.setcomponentVersion('5.0.37');break;\r\n\t\t\t\t\t\t\t\t\t\tcase 'Mac OS': this.setcomponentVersion('5.0.34');break;\r\n\t\t\t\t\t\t\t\t\t\tcase 'Linux':\r\n\t\t\t\t\t\t\t\t\t\tcase 'CentOS':\r\n\t\t\t\t\t\t\t\t\t\tcase 'Ubuntu':\r\n\t\t\t\t\t\t\t\t\t\tcase 'RedHat':  this.setcomponentVersion('5.0.12');break;\r\n\t\t\t\t\t\t\t\t\t\tdefault:break;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// Use fetch if exist\r\n\t\t\t\t\t\t\t\tif (self.fetch) {\r\n\t\t\t\t\t\t\t\t\tfetch( this.getServerComponentLink() + '&filename=get' )\r\n\t\t\t\t\t\t\t\t\t.then(function(resp) {return resp.json();})\r\n\t\t\t\t\t\t\t\t\t.then(function(response) {\r\n\t\t\t\t\t\t\t\t\t\tfor (var k in response) {\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.setComponentInstallerName(response[k]);\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.addClientDetailedInfos('URL de t&eacute;l&eacute;chargement', '<a href=\"' + dataIHM.getServerComponentLink() + '\">' + dataIHM.getComponentInstallerName() + '</a>');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('readServerComponentInfos : Error with fetch (' + error.message + ')'); \r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t// Use JQuery\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$.ajax(\t{\r\n\t\t\t\t\t\t\t\t\t\turl: this.getServerComponentLink() + '&filename=get'\r\n\t\t\t\t\t\t\t\t\t\t, success: function( data) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar json;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (data === String)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson = jQuery.parseJSON(data);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson = data\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor (var k in json) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setComponentInstallerName(json[k]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.addClientDetailedInfos('URL de t&eacute;l&eacute;chargement', '<a href=\"' + dataIHM.getServerComponentLink() + '\">' + dataIHM.getComponentInstallerName() + '</a>');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t, error: function( data) { return null;}\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\r\n\t//========================================\r\n\t// Support contact informations management\r\n \tmailSupportMailbox: null,\r\n\tmailSupportDomain: null,\r\n\tsetMailSupport: function(mailbox, domain) {this.mailSupportMailbox = mailbox; this.mailSupportDomain = domain;},\r\n\tgetMailSupport: function() {return this.mailSupportMailbox + \"@\" + this.mailSupportDomain;},\r\n \t\t\r\n\t//==========================\r\n\t// Detailed informations\r\n\tclientDetailedInfos: {},\r\n\tinitClientDetailedInfos: function() {\r\n\t\t\t\t\t\t\t\tconfigSupported = true;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.getUAInfos().device.type === undefined) {\r\n\t\t\t\t\t\t\t\t\tconsole.log(\"Poste de travail\");\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tconfigSupported = false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().os.name) {\r\n\t\t\t\t\t\t\t\t\tcase 'Windows':\r\n\t\t\t\t\t\t\t\t\tcase 'Mac OS':\r\n\t\t\t\t\t\t\t\t\tcase 'Linux':\r\n\t\t\t\t\t\t\t\t\tcase 'CentOS':\r\n\t\t\t\t\t\t\t\t\tcase 'Ubuntu':\r\n\t\t\t\t\t\t\t\t\tcase 'RedHat':  configSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault: \t\tconfigSupported = configSupported & false;break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().browser.name) {\r\n\t\t\t\t\t\t\t\t\tcase 'IE':\r\n\t\t\t\t\t\t\t\t\tcase 'Safari':\r\n\t\t\t\t\t\t\t\t\tcase 'Edge':\r\n\t\t\t\t\t\t\t\t\tcase 'Chrome':\r\n\t\t\t\t\t\t\t\t\tcase 'Firefox':\tconfigSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault: \t\tconfigSupported = configSupported & false;break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().cpu.architecture) {\r\n\t\t\t\t\t\t\t\t\tcase 'ia32':\r\n\t\t\t\t\t\t\t\t\tcase 'i686':\r\n\t\t\t\t\t\t\t\t\tcase 'amd64': configSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\t\tif (this.getUAInfos().cpu.architecture === undefined)\r\n\t\t\t\t\t\t\t\t\t\t\tconfigSupported = configSupported & true;\r\n\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\tconfigSupported = configSupported & false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.getUAInfos().cpu.architecture == 'amd64')\r\n\t\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Syst&egrave;me d\\'exploitation', this.getUAInfos().os.name + \" \" + this.getUAInfos().os.version + \" (64b)\");\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Syst&egrave;me d\\'exploitation', this.getUAInfos().os.name + \" \" + this.getUAInfos().os.version);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Navigateur', this.getUAInfos().browser.name + \" \" + this.getUAInfos().browser.major);\r\n\t\t\t\t\t\t\t\t// this.addClientDetailedInfos('Compatibilit&eacute; ASIP', '<a href=\"http://integrateurs-cps.asipsante.fr/Lettre_d_information\" target=\"_blanck\">Lettre d\\'information<br/>POSTE DE TRAVAIL & Veille Technologique</a>');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.clientUAInfos.configSupported = configSupported;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\treturn configSupported;\r\n\t\t\t\t\t\t\t},\r\n\tgetClientDetailedInfos: function() {return this.clientDetailedInfos;},\r\n\taddClientDetailedInfos: function(key, value) { this.clientDetailedInfos[key] = value;},\r\n\tresetClientDetailedInfos: function() {this.clientDetailedInfos = {};},\r\n\t\t\r\n\t//==========================\r\n\t// Client SSL Informations\r\n\tclientSSLInfos: null,\r\n\tclientSSLFetchParameters: { mode:'cors', credentials: 'include', cache: 'no-cache'},\r\n\tclientSSLAjaxParameters: { cache: false, timeout: 8000, async: true},\r\n\tisDefineClientSSLInfos: function() {return (this.clientSSLInfos != undefined);},\r\n\tsetClientSSLInfos: function(data) {this.clientSSLInfos = data;},\r\n\tgetClientSSLInfos: function() {return this.clientSSLInfos;},\r\n\tinitClientSSLParameters: function() { $.ajaxSetup(this.clientSSLAjaxParameters);},\r\n\tresetClientSSLInfos: function () {\r\n\t\t\t\t\t\t\tconsole.log('resetClientSSLInfos : Erase SSL Connexion cache for ' + this.getUAInfos().browser.name);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tswitch (this.getUAInfos().browser.name) {\r\n\t\t\t\t\t\t\t\tcase 'Edge': // Works !\r\n\t\t\t\t\t\t\t\tcase 'IE': // Works !\r\n\t\t\t\t\t\t\t\t\tif (document.execCommand) document.execCommand( \"ClearAuthenticationCache\", \"false\");\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 'Firefox':\t// Works !\r\n\t\t\t\t\t\t\t\t\t//location.reload(); // Works !\r\n\t\t\t\t\t\t\t\t\tif (window.crypto) if (window.crypto.logout) window.crypto.logout(); // Works !\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 'Chrome': // Works !\r\n\t\t\t\t\t\t\t\tcase 'Safari': // Not working, restart Browser needed !\r\n\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag'); \r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\treadClientSSLInfos: function() {\r\n\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : SSL Connexion' );\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// Use fetch if exist\r\n\t\t\t\t\t\t\tif (self.fetch) {\r\n\t\t\t\t\t\t\t\t// Try to connect and get CPS informations\r\n\t\t\t\t\t\t\t\tfetch( '/visuel.php', this.clientSSLFetchParameters )\r\n\t\t\t\t\t\t\t\t.then(function(resp) {return resp.json();})\r\n\t\t\t\t\t\t\t\t.then(function(resp_json) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Success with Fetch');\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t// traitement du JSON\r\n\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(resp_json);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('endDiagWithSuccess');\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t// Case of SSL Error\r\n\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Probably SSL Error with fetch (' + error.message + ')');\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(null);\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.accelerateTimer();\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t// Use JQuery\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$.ajax(\t{\r\n\t\t\t\t\t\t\t\t\turl: 'visuel.php'\r\n\t\t\t\t\t\t\t\t\t, success: function(data, textStatus) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Success with Ajax (' + textStatus + ')');\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tif (data === String)\r\n\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(jQuery.parseJSON(data));\r\n\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(data);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('endDiagWithSuccess');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t, error: function(data, textStatus) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Probably SSL Error with Ajax (' + textStatus + ')');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(null);\r\n\t\t\t\t\t\t\t\t\t\t\twizardStateMachine.accelerateTimer();\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n}\r\n\r\n//=====\r\n// Main\r\n//=====\r\n$(function() {\r\n\t// Initialization\r\n\t//---------------\r\n\tdataIHM.initUAInfos(); // User Agent\r\n\t\r\n\tdataIHM.initClientSSLParameters();\r\n\t\r\n\t// Sp�cific parameter with no good solution @29/12/2017\r\n\tswitch (dataIHM.getUAInfos().browser.name) {\r\n\t\tcase 'IE':\r\n\t\t\tconsole.log('=========== Use Ajax =============');\r\n\t\t\tself.fetch = undefined;\r\n\t\t\tbreak;\r\n\t\tcase 'Edge':\r\n\t\tcase 'Firefox':\r\n\t\tcase 'Safari':\r\n\t\tdefault:\r\n\t\t\tconsole.log('=========== Try using fetch. If not available use Ajax =============');\r\n\t\t\tbreak;\r\n\t}\r\n\t\r\n\tdataIHM.initClientDetailedInfos(); // Informations in bottom\r\n\tdataIHM.readServerComponentInfos(); // Get from informations from Web Service\r\n\t\r\n\twizardStateMachine.startWizard(); // Start Wizard\r\n\t\t\r\n\twizardStateMachine.displayInit(dataIHM.getUAInfos().os.name);\r\n});\r\n\n<!-- script : /js/diagcps.js End -->\n\n</script>\n<script type=\"text/javascript\">\n\t// Initialization Javascript from PHP\n\tdataIHM.setComponentName('CryptolibCPS');\n\tdataIHM.setServerComponentURL('download.php');\n</script>\n<!--<div id=\"beta\"></div>-->\n<div id=\"instructions-back\" onclick=\"wizardStateMachine.wizard('exitInstruction');\">\n\t<div id=\"instructions\">\n\t\n\t\t<div class=\"screen\" id=\"preAlert\">\n\t\t\t<div class=\"instruction\"><br/>\n<h1>Assistance en cas de carte CPS non lue</h1>\n\n<h2>Pr&eacute;alablement</h2>\n<p>\nVeuillez v&eacute;rifier que votre carte est bien ins&eacute;r&eacute;e dans votre lecteur de carte ou votre terminal Vitale.<br/>\nPuis v&eacute;rifier que votre lecteur de carte ou votre terminal Vitale est correctement connect&eacute; &agrave; votre ordinateur.<br/>\n<br/>\nLa carte ins&eacute;r&eacute;e dans le lecteur doit &ecirc;tre la derni&egrave;re carte active.\n\n<table >\n\t<tr>\n\t\t<td style=\"border-top:none;\"><img src=\"images/informations32.png\" alt=\"Information :\"/></td>\n\t\t<td style=\"border-top:none;\"><i>La derni&egrave;re carte active pr&eacute;sente la date d'expiration la plus &eacute;loign&eacute;e.</i></td>\n\t</tr>\n</table>\n<br/>\nUne fois cette v&eacute;rification r&eacute;alis&eacute;e, v&eacute;rifiez que la carte est bien lue.<br/>\n</p>\n\n<div id=\"alert1-MacOS\">\n<h2>Votre ordinateur est sous Mac OS</h2>\n<p>\nSur votre syst&egrave;me d'exploitation, nous ne disposons pas de m&eacute;thode particuli&egrave;re pour v&eacute;rifier si votre carte est lue.<br/>\n<br/>\nVeuillez lancer un diagnostic de votre ordinateur et proc&eacute;der &agrave; l'installation des mises &agrave; jour sugg&eacute;r&eacute;es.<br/>\n</p>\n</div>\n\n<div id=\"alert1-Linux\">\n<h2>Votre ordinateur est sous Linux</h2>\n<p>\nSur votre syst&egrave;me d'exploitation, nous ne disposons pas de m&eacute;thode particuli&egrave;re pour v&eacute;rifier si votre carte est lue.<br/>\n<br/>\nVeuillez lancer un diagnostic de votre ordinateur et proc&eacute;der &agrave; l'installation des mises &agrave; jour sugg&eacute;r&eacute;es.<br/>\n</p>\n</div>\n\n<div id=\"alert1-Windows\">\n<h2>Votre ordinateur est sous Windows</h2>\n<b>Dans la barre des t&acirc;ches, une carte lue est signal&eacute;e par <img src=\"images/preHelper/iconeOK.png\" alt=\"Icone vert dans la barre des taches\" /> et une carte non lue par <img src=\"images/preHelper/iconeKO.png\" alt=\"Icone rouge dans la barre des taches\"/>.</b><br/>\n<h3>L'ic&ocirc;ne <img src=\"images/preHelper/iconeOK.png\" alt=\"Icone vert dans la barre des taches\"/> est introuvable</h3>\n<p>\nCliquez avec le clic droit de votre souris sur le bouton &laquo;Afficher les ic&ocirc;nes&raquo; (en bas &agrave; droite de votre &eacute;cran) ou sur la zone heure et date et selectionnez &laquo;Personnaliser les ic&ocirc;nes de notification&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/notificationsBar.png\" alt=\"Barre de notification\"/></div>\n<br/>\n<br/>\nCherchez l'ic&ocirc;ne &laquo;Gestionnaire de certificats CPS&raquo; et s&eacute;lectionnez &laquo;Afficher l'ic&ocirc;ne et les notifications&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/notificationsParameters.png\" alt=\"Parametres de notifications\"/></div>\n<br/>\nUne fois la manipulation r&eacute;alis&eacute;e vous devriez voir apparaitre l'ic&ocirc;ne (en bas &agrave; droite de votre &eacute;cran).<br/>\n<br/>\nSi l'ic&ocirc;ne n'apparait pas dans la liste, lancer le diagnostic de votre ordinateur et installez les mises &agrave; jour propos&eacute;es.<br/>\n<br/>\n</p>\n<h2>L'ic&ocirc;ne <img src=\"images/preHelper/iconeKO.png\" alt=\"Icone rouge dans la barre des taches\" /> est rouge</h2>\n<p>\nSi l'ic&ocirc;ne est encadr&eacute;e de rouge (carte non lue), assurez-vous que votre carte est bien ins&eacute;r&eacute;e dans votre lecteur, rafra&icirc;chissez le lecteur en cliquant sur l'ic&ocirc;ne avec le bouton droit de la souris. Et cliquez sur &laquo;Rafra&icirc;chir&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/rightClickCCM.png\" alt=\"Cliquer droit sur l'icone du CCM\" /></div>\n<br/>\nSi l'encadr&eacute; reste rouge apr&egrave;s la manipulation, red&eacute;marrez votre ordinateur en laissant le lecteur et la CPS connect&eacute;s.<br/>\n<br/>\nApr&egrave;s ces manipulations, si l'ic&ocirc;ne ne passe pas au vert, veuillez nous contacter.\n</p>\n<div align=\"center\"></div>\n</div>\n\n</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"startDiag\" onclick=\"wizardStateMachine.wizard('startDiag');\">Diagnostiquer mon poste</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"notSupported\">\n\t\t\t<div class=\"instruction\">Votre configuration mat&eacute;riel et/ou syst&egrave;me n'est pas support&eacute;e par nos composants logiciels. Nous ne garantissons pas le succès du diagnostic.</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"notSupported\" onclick=\"wizardStateMachine.wizard('preAlert');\">Continuer</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"manualInstallXPI\">\n\t\t\t<div class=\"instruction\" id=\"xpi_instruction\" >L'Extension Firefox n'a pas &eacute;t&eacute; d&eacute;tect&eacute;e. Elle est indispensable sous ce navigateur.<br/>Apr&egrave;s l'installation, veuillez red&eacute;marrer votre navigateur.</div>\n\t\t\t<div class=\"actions\">\n<!--\t\t\t\t<div class=\"action instruction\" id=\"xpi\" onclick=\"wizardStateMachine.wizard('XPI',{URL:'https://diagcps.eservices.esante.gouv.fr/ODI_PS/php/download_asip.php?installeur=url_interne_xpi_installation_pkcs11',IconURL:'https://diagcps.eservices.esante.gouv.fr/ODI_PS/images/asip_sante.png',Hash:'sha256:c23de3812aaf7c3a81d80e9bdf891c3e2b621e01e55e8d308226fd86ab6ef438'});\">Installer<br/>l'Extension Firefox</div>-->\n<div class=\"action instruction\" id=\"xpi\" onclick=\"wizardStateMachine.wizard('XPI',{URL:'/download.php?component=xpi',IconURL:'/images/asip_sante.png',Hash:'sha256:c23de3812aaf7c3a81d80e9bdf891c3e2b621e01e55e8d308226fd86ab6ef438'});\">Installer<br/>l'Extension Firefox</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"restartAlertXPI\">\n\t\t\t<div class=\"instruction\" id=\"restartInstructionXPI\" >Une fois l'installation de l'Extension Cryptolib CPS termin&eacute;e,<br/>veuillez red&eacute;marrer votre navigateur.</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"manualInstallClibCPS\">\n\t\t\t<div class=\"instruction\">Si vous avez ins&eacute;r&eacute; votre CPS dans votre lecteur sans succ&egrave;s, la version de Cryptolib CPS de votre poste de travail n'est peut-&ecirc;tre pas &agrave; jour.</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"cryptolib\" onclick=\"wizardStateMachine.wizard('CryptolibCPS');\">T&eacute;l&eacute;charger<br/>Cryptolib CPS</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"restartAlert\">\n\t\t\t<div class=\"instruction\" id=\"restartInstruction\" >Une fois l'installation de CryptolibCPS_vX.Y.Z termin&eacute;e, veuillez red&eacute;marrer votre navigateur.</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"contactSupport\">\n\t\t\t<div class=\"instruction\">Si vous avez installez le composant propos&eacute; sans succ&eacute;s,<br/> veuillez contacter le Support.</div>\n\t\t</div>\n\t\t\n\t</div>\n</div>\t\n<div id=\"service-direction\" class=\"column\"></div>\n<div id=\"article\">\n\t<div id=\"center\">\n\t\t<div class=\"diagState\" id=\"diagState\"></div>\n\t\t<div>\n\t\t\t<div id=\"cps\" class=\"cpsverso\" onclick=\"wizardStateMachine.wizard('restartDiag');\"><div id=\"spin\"><div id=\"retry\"></div></div></div>\n\t\t</div>\n<!--\t\t\n\t\t<div id=\"results\">\n\t\t\t<div>\n\t\t\t\t<div class=\"sign\" id=\"certificat\"></div>\n\t\t\t\t<div class=\"sign\" id=\"expired\" title=\"expire\"></div>\n\t\t\t\t<div class=\"sign\" id=\"revoc\" title=\"revoque\"></div>\n\t\t\t\t<div class=\"sign\" id=\"class\"></div>\n\t\t\t\t<div class=\"sign\" id=\"rootAC\"></div>\n\t\t\t\t<div class=\"sign\" id=\"cryptolib\" title=\"cryptolib\"></div>\n\t\t\t</div>\n\t\t</div>\n-->\n\t\t<div id=\"cps_infos\">\n\t\t\t<div id=\"infos_cps\">\n\t\t\t\t<div id=\"infos_cps_caption\"><div>Informations d&eacute;taill&eacute;es</div><div class=\"infos_cps_caption_img_expand\" id=\"infos_cps_caption_img\"></div></div>\n\t\t\t\t<table id=\"infos_cps_table\">\n\t\t\t\t\t<tbody id=\"infos_cps_tbody\"></tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n<div id=\"support-direction\" class=\"column\"></div>\n</div>\r\n<div id=\"footer\" style=\"display:flex;flex-direction:row\">\r\n    <div style=\"display:flex;flex-direction:row;width:30vw\">\r\n        <div style=\"margin:20px\">\r\n            <a href=\"https://solidarites-sante.gouv.fr/\" target=\"_blank\">\r\n                <img src=\"./images/logo-ministere.svg\" alt=\"Ministère des Solidarités et de la santé\" width=\"84\" height=\"62\">\r\n            </a>\r\n        </div>\r\n        <div style=\"margin:20px\">\r\n            <a href=\"https://esante.gouv.fr/\" target=\"_blank\">\r\n                <img src=\"./images/logo-ANS.svg\" alt=\"Agence du Numérique en Santé\" width=\"166\" height=\"50\">\r\n            </a>\r\n        </div>\r\n    </div>\r\n    <div style=\"width:60vw\">\r\n        <ul style=\"align-items:end\">\r\n            <li><a href=\"http://esante.gouv.fr/services/mentions-legales\" target=\"_blank\">Mentions l&eacute;gales</a></li>\r\n            <li><a href=\"./copyright.php\" target=\"_blank\" title=\"Copyright [nouvelle fen&ecirc;tre]\">Copyright</a></li>\r\n        </ul>\r\n    </div>\r\n</div>\r\n\r\n</body>\r\n</html>\r\n",
      "ip": "135.125.232.117",
      "timestamp": "2025-03-14T16:26:19.506429315Z",
      "curl-command": "curl -X 'GET' -H 'Accept: */*' -H 'Accept-Language: en' -H 'User-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)' 'https://diagcps.eservices.esante.gouv.fr'",
      "matcher-status": true
    },
    {
      "template": "http/misconfiguration/http-missing-security-headers.yaml",
      "template-url": "https://templates.nuclei.sh/public/http-missing-security-headers",
      "template-id": "http-missing-security-headers",
      "template-path": "/home/runner/nuclei-templates/http/misconfiguration/http-missing-security-headers.yaml",
      "info": {
        "name": "HTTP Missing Security Headers",
        "author": [
          "socketz",
          "geeknik",
          "g4l1t0",
          "convisoappsec",
          "kurohost",
          "dawid-czarnecki",
          "forgedhallpass",
          "jub0bs",
          "userdehghani"
        ],
        "tags": [
          "misconfig",
          "headers",
          "generic"
        ],
        "description": "This template searches for missing HTTP security headers. The impact of these missing headers can vary.\n",
        "severity": "info",
        "metadata": {
          "max-request": 1
        }
      },
      "matcher-name": "cross-origin-opener-policy",
      "type": "http",
      "host": "https://diagcps.eservices.esante.gouv.fr",
      "matched-at": "https://diagcps.eservices.esante.gouv.fr",
      "request": "GET / HTTP/1.1\r\nHost: diagcps.eservices.esante.gouv.fr\r\nUser-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)\r\nConnection: close\r\nAccept: */*\r\nAccept-Language: en\r\nAccept-Encoding: gzip\r\n\r\n",
      "response": "HTTP/1.1 200 OK\r\nConnection: close\r\nTransfer-Encoding: chunked\r\nContent-Type: text/html; charset=UTF-8\r\nDate: Fri, 14 Mar 2025 16:26:19 GMT\r\nServer: Apache/2.4.37 (centos) OpenSSL/1.1.1g\r\nX-Powered-By: PHP/7.2.24\r\n\r\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n\t<title>DiagCPS, Outil de Diagnostic SSL</title>\r\n\t<meta http-equiv=\"Content-type\" content=\"text/html; charset=UTF-8\" />\r\n\t<meta name=\"description\" content=\"DiagCPS est un Outil de Diagnostic de l'authentification en ligne à l'aide d'une Carte de Professionnel de Santé, i.e. CPS. Il est fourni par l'ASIP Santé et remplace ODI.\" />\r\n\t<meta name=\"Publisher\" content=\"ASIP Santé\" />\r\n\t<meta name=\"copyright\" content=\"Tous droits réservés - ASIP Santé\" />\r\n\t<link rel=\"shortcut icon\" href=\"./images/favicon.ico\" type=\"image/x-icon\" />\r\n\t<link rel=\"stylesheet\" href=\"diagcps_css.php\" />\r\n\t<script src=\"./js/jquery-3.2.0.min.js\"></script>\r\n\t<script src=\"./js/ua-parser.min.js\"></script>\r\n</head>\r\n<body>\r\n<div id=\"header\" style=\"display:flex;flex-direction:row\">\r\n    <div style=\"margin:20px\">\r\n        <a href=\"https://solidarites-sante.gouv.fr/\" target=\"_blank\">\r\n            <img src=\"./images/logo-ministere.svg\" alt=\"Ministère des Solidarités et de la santé\" width=\"168\" height=\"104\">\r\n        </a>\r\n    </div>\r\n\t<div id=\"title\">esante.gouv.fr</div>\r\n</div>\r\n<div id=\"section\">\r\n<script type=\"text/javascript\">\n\n<!-- script : /js/wizarddiagcps.js Begin -->\n//==================================\r\n// Global variable used for state machine management \r\n// displayed on screen \r\n// or used by state machine\r\n//==================================\r\nvar wizardStateMachine = {\r\n\tstartState: 'notSupported',\r\n\tlastState: 'notSupported',\r\n\t\r\n\t//=================\r\n\t// Retry Management\r\n\t// Variables\r\n\tnbMaxRetry: 10,\r\n\tnbRetry: 0,\r\n\t\r\n\t// Management\r\n\tinitRetry: function() {this.nbRetry = this.nbMaxRetry;},\r\n\tisMaxRetry: function() {return (this.nbRetry >= this.nbMaxRetry);},\r\n\tisMinRetry: function() {return (this.nbRetry <= 0);},\r\n\tdecRetry: function() {this.nbRetry--;},\r\n\tdisplayRetry: function() {\r\n\t\t\t\t\t\t\t\t//console.log(\"displayRetry : nbRetry = \" + this.nbRetry);\r\n\t\t\t\t\t\t\t\tthis.decRetry();\r\n\t\t\t\t\t\t\t\tthis.stopTimers(); \r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.isMinRetry()\r\n\t\t\t\t\t\t\t\t\t&& \t(this.lastState != 'endDiagWithSuccess')) {\r\n\t\t\t\t\t\t\t\t\tthis.wizard('manualInstallClibCPS');\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tthis.displayWait(true);\r\n\t\t\t\t\t\t\t\t\tthis.startTimers();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\r\n\t//==================\r\n\t// Timers Management\r\n\ttimerTestSSL: null,\r\n\tretryTimeoutKO: 1000,\r\n\tinitTimer: function () {this.retryTimeoutKO = 1000;},\r\n\taccelerateTimer: function () {this.retryTimeoutKO = 250;},\r\n\tstopTimers: function() {\r\n\t\t\t\t\t\t\t\tif (this.timerTestSSL != null)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tclearTimeout(this.timerTestSSL);\r\n\t\t\t\t\t\t\t\t\tthis.timerTestSSL = null;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\tstartTimers: function() {this.timerTestSSL = setTimeout(function(){wizardStateMachine.displayRetry()}, this.retryTimeoutKO);},\r\n\t\r\n\t//=======\r\n\t// Wizard\r\n\tstartWizard: function() {this.wizard(this.startState);},\r\n\twizard: function(step, param) {\r\n\t\t\t\tconsole.log(\"wizard : step = \" + step + \", param = \" + param);\r\n\t\t\t\t\t\r\n\t\t\t\tswitch (step)\r\n\t\t\t\t{\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Pre treatment\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'notSupported':\r\n\t\t\t\t\tcase 'preAlert':\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'start');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif ((dataIHM.getUAInfos().configSupported) || (step == 'preAlert')) this.displayInstruction(true, 'preAlert');\r\n\t\t\t\t\t\telse this.displayInstruction(true, 'notSupported');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Manual Installation XPI\r\n\t\t\t\t\t// Suggestion of installation\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'manualInstallXPI':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'KO');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'manualInstallXPI');\r\n\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// XPI Installation\r\n\t\t\t\t\t// Installation process\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'XPI':\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'restartAlertXPI');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar params = {\r\n\t\t\t\t\t\t\t\t\"Installer l'Extension Cryptolib CPS\": \r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tURL: param.URL,\r\n\t\t\t\t\t\t\t\t\tIconURL: param.IconURL,\r\n\t\t\t\t\t\t\t\t\tHash: param.Hash,\r\n\t\t\t\t\t\t\t\t\ttoString: function () { return this.URL; }\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t};\r\nconsole.log(params);\r\n\t\t\t\t\t\tInstallTrigger.install(params);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// Diagnostic\r\n\t\t\t\t\t// Start\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'startDiag':\r\n\t\t\t\t\t\tthis.initRetry();\r\n\t\t\t\t\t\tthis.initTimer();\r\n\r\n\t\t\t\t\t\tthis.displayWait(true);\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'inProgress');\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tdataIHM.readClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.startTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// Diagnostic\r\n\t\t\t\t\t// Restart\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'restartDiag':\r\n\r\n\t\t\t\t\t\tdataIHM.resetClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\r\n\t\t\t\t\t//==========================\r\n\t\t\t\t\t// Progression\r\n\t\t\t\t\t//--------------------------\r\n\t\t\t\t\tcase 'inProgress':\r\n\t\t\t\t\t\t//dataIHM.readClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// this.displayDiagnosticState(true, 'inProgress');\r\n\t\t\t\t\t\t// this.displayInstruction(false);\r\n\t\t\t\t\t\t// this.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//===================\r\n\t\t\t\t\t// Ends\r\n\t\t\t\t\t//-------------------\r\n\t\t\t\t\tcase 'endDiagWithSuccess':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'OK');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tthis.displaySupport(false);\r\n\t\t\t\t\t\tthis.displayInfosCPS(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Manual Installation Cryptolib CPS\r\n\t\t\t\t\t// Suggestion of installation\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'manualInstallClibCPS':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'KO');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'manualInstallClibCPS');\r\n\t\t\t\t\t\tthis.displaySupport(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//=======================\r\n\t\t\t\t\t// Cryptolib CPS download\r\n\t\t\t\t\t// Installation process\r\n\t\t\t\t\t//-----------------------\r\n\t\t\t\t\tcase 'CryptolibCPS':\r\n\t\t\t\t\t\twindow.location = dataIHM.getServerComponentLink();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// Direct jump to Retry after installation\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'restartAlert');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\t\r\n\t\t\t\t\t//=========================\r\n\t\t\t\t\t// Other\r\n\t\t\t\t\t// Close Instruction screen\r\n\t\t\t\t\t//-------------------------\r\n\t\t\t\t\tcase 'exitInstruction':\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true);\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t// Open Support link\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'openSupport':\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tif (param !== undefined) window.open(param.URL,'_blank');\r\n\t\t\t\t\t\tbreak;\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.lastState = step;\r\n\t\t\t},\r\n\t\r\n\t//==========================\r\n\t// Screen Display Management\r\n\tdisplayElementById: function(id, display) {\r\n\t\t\t\t\t\t\tdocument.getElementById(id).style.display = display;\r\n\t\t\t\t\t\t},\r\n\thideElementById: function(id) {\r\n\t\t\t\t\t\t\tthis.displayElementById(id, \"none\");\r\n\t\t\t\t\t\t},\r\n\tdisplayInit: function(OSName) {\r\n\t\t\t\t\t\t// Events initialization\r\n\t\t\t\t\t\t//----------------------\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"cryptolib\", \t\t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"notSupported\", \t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"startDiag\", \t\t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"instructions-back\", \t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"infos_cps_caption\", \t\"click\", clickExpandCollapse);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// PreAlert initialization\r\n\t\t\t\t\t\t//------------------------\r\n\t\t\t\t\t\tthis.displayPreAlert(OSName);\r\n\t\t\t\t\t},\r\n\tdisplayInfosCPS: function (active) {\r\n\t\t\t\t\t\t\tvar infos_cps_tbody = '';\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar detailedInformations = dataIHM.getClientDetailedInfos();\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tfor (var item in detailedInformations) {\r\n\t\t\t\t\t\t\t\tinfos_cps_tbody += '<tr><td class=\"key\">' + item + '</td><td class=\"val\">' + detailedInformations[item] + '</td></tr>';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cps').className = dataIHM.getClientSSLInfos().div_cps_class;\r\n\r\n\t\t\t\t\t\t\t\tfor (var item in dataIHM.getClientSSLInfos().infos) {\r\n\t\t\t\t\t\t\t\t\tinfos_cps_tbody += '<tr><td class=\"key\">' + item + '</td><td class=\"val\">' + dataIHM.getClientSSLInfos().infos[item] + '</td></tr>';\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cps').className = \"cpsverso\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tdocument.getElementById('infos_cps_tbody').innerHTML = infos_cps_tbody;\r\n\t\t\t\t\t\t},\r\n\r\n\tdisplayWait:function (active) {\r\n\t\t\t\t\tif ( (active)\r\n\t\t\t\t\t\t&& (wizardStateMachine.nbRetry > 0) ) {\r\n\t\t\t\t\t\tthis.displayElementById('spin', \"flex\");\r\n\t\t\t\t\t\tdocument.getElementById('retry').innerHTML = wizardStateMachine.nbRetry;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.hideElementById('spin');\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\tdisplayDiagnosticState:function (active, state) {\r\n\t\t\t\t\t\t\t\tdiagStateContent = {\r\n\t\t\t\t\t\t\t\t\t'start':{content:'Cliquer sur la carte', style:'diagState diagStart'}\r\n\t\t\t\t\t\t\t\t\t, 'inProgress':{content:'Le diagnostic est en cours', style:'diagState diagInProgress'}\r\n\t\t\t\t\t\t\t\t\t, 'KO':{content:'Le diagnostic a &eacute;chou&eacute;', style:'diagState diagKO'}\r\n\t\t\t\t\t\t\t\t\t, 'OK':{content:'Le diagnostic a r&eacute;ussi', style:'diagState diagOK'}\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.hideElementById('diagState');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').style.display = \"block\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif (state !== undefined) {\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').className = diagStateContent[state].style;\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').innerHTML = diagStateContent[state].content;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\r\n\tdisplayInstruction: function (active, step) {\r\n\t\t\t\t\t\t\tthis.hideElementById('instructions-back');\r\n\t\t\t\t\t\t\tthis.hideElementById('instructions');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\tthis.displayElementById('instructions-back', \"flex\");\r\n\t\t\t\t\t\t\t\tthis.displayElementById('instructions', \"block\");\r\n\t\t\t\t\t\t\t\tthis.hideElementById('manualInstallClibCPS');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('manualInstallXPI');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('restartAlert');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('restartAlertXPI');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('preAlert');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('notSupported');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('contactSupport');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (step !== undefined) this.displayElementById(step, \"block\");\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar detailedInformations = dataIHM.getClientDetailedInfos();\r\n\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cryptolib').innerHTML = \"T&eacute;l&eacute;charger<br/>\" + dataIHM.getComponentInstallerName();\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (dataIHM.getUAInfos().os.name == 'Mac OS')\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('restartInstruction').innerHTML = \"Une fois l'installation de \" + dataIHM.getComponentInstallerName() + \" termin&eacute;e,<br/>veuillez red&eacute;marrer votre ordinateur.\";\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('restartInstruction').innerHTML = \"Une fois l'installation de \" + dataIHM.getComponentInstallerName() + \" termin&eacute;e,<br/>veuillez red&eacute;marrer votre navigateur.\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\r\n\tdisplaySupport: function (active) {\r\n\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\tthis.displayElementById('support-direction', \"flex\");\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.hideElementById('support-direction');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\r\n\tdisplayPreAlert: function(OSName) {\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-MacOS');\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-Windows');\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-Linux');\r\n\r\n\t\t\t\t\t\t\tif (OSName == 'Mac OS') this.displayElementById('alert1-MacOS', 'block');\r\n\t\t\t\t\t\t\tif (OSName == 'Windows') this.displayElementById('alert1-Windows', 'block');\r\n\t\t\t\t\t\t\tif (OSName == 'Linux') this.displayElementById('alert1-Linux', 'block');\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\r\n};\r\n\r\n//==================\r\n// Events Management\r\nfunction addEltEventListenerAllBrowser(elt, eventName, handle) {\r\n\tif (elt.addEventListener) { elt.addEventListener(eventName, handle, false);\r\n\t} else { elt.attachEvent(\"on\" + eventName, handle);\r\n\t}\r\n}\r\n\r\nfunction addIdEventListenerAllBrowser(id, eventName, handle) {\r\n\tif (document.getElementById(id)) addEltEventListenerAllBrowser(document.getElementById(id), eventName, handle);\r\n}\r\n\r\nfunction clickExpandCollapse(event) {\r\n\tif (document.getElementById('infos_cps_table').style.display != \"block\") {\r\n\t\tdocument.getElementById('infos_cps_caption_img').className = \"infos_cps_caption_img_collapse\";\r\n\t\tdocument.getElementById('infos_cps_table').style.display = \"block\";\r\n\t} else {\r\n\t\tdocument.getElementById('infos_cps_caption_img').className = \"infos_cps_caption_img_expand\";\r\n\t\tdocument.getElementById('infos_cps_table').style.display = \"none\";\r\n\t}\r\n\tevent.cancelBubble = true;\r\n\t\t\r\n\treturn false;\r\n}\r\n\r\nfunction clickActionNoPropagation(event) {\r\n\t//this.click();\r\n\r\n\tevent.cancelBubble = true;\r\n\r\n\treturn false;\r\n}\r\n\n<!-- script : /js/wizarddiagcps.js End -->\n<!-- script : /js/diagcps.js Begin -->\n//==================================\r\n// Global variable used for all data \r\n// displayed on screen \r\n// or used by state machine\r\n//==================================\r\nvar dataIHM = {\r\n\t//==========================\r\n\t// Root URL\r\n\tlocalURL: '',\r\n\tsetLocalURL: function(URL) {this.localURL = URL;},\r\n\tgetLocalURL: function() {return this.localURL;},\r\n\t\r\n\t//==========================\r\n\t// User Agent\r\n\tclientUAInfos: null,\r\n\ttimerUAInfos: null,\r\n\tinitUAInfos: function() {\r\n\t\t\t\t\t\tvar uaparser = new UAParser();\r\n\t\t\t\t\t\tthis.clientUAInfos = uaparser.getResult();\r\n\t\t\t\t\t\tthis.clientUAInfos.browser.xpi = true;\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tthis.timerUAInfos = setTimeout(function(){dataIHM.isUAInfosCPSWebEx()}, 1000);\r\n\t\t\t\t\t},\r\n\tgetUAInfos: function() {return this.clientUAInfos},\r\n\tisUAInfosCPSWebEx: function() {\r\n\t\t\t\t\tif (window.isCpsWebExAlive) {\r\n\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', window.isCpsWebExAlive());\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (this.getUAInfos().browser.name == 'Firefox') {\r\n\t\t\t\t\t\t\tif (this.getUAInfos().browser.major > 57) {\r\n\t\t\t\t\t\t\t\tthis.clientUAInfos.browser.xpi = false;\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'absente');\r\n\t\t\t\t\t\t\t\twizardStateMachine.wizard('manualInstallXPI');\r\n\t\t\t\t\t\t\t} else if (this.getUAInfos().browser.major == 57) {\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'sur cette version, l\\'installation du p&eacute;riph&eacute;rique de s&eacute;curit&eacute; doit &ecirc;tre <a href=\"http://integrateurs-cps.asipsante.fr/Installation-manuelle-PKCS11-Firefox\" target=\"_blanck\">r&eacute;alis&eacute;e manuellement</a>.');\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'd&eacute;tection impossible sur cette version');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.timerUAInfos = null;\r\n\t\t\t\t},\r\n\t\r\n\t//===============================\r\n\t// Installed Component management\r\n\tcomponentName: \"CryptolibCPS\", // By default\r\n\tsetComponentName: function(name) {this.componentName = name;},\r\n\tgetComponentName: function() {return this.componentName;},\r\n\tcomponentVersion: \"\", // By Default\r\n\tsetcomponentVersion: function(version) {this.componentVersion = version;},\r\n\tgetcomponentVersion: function() {return this.componentVersion;},\r\n\tcomponentInstallerName: \"\",\r\n\tsetComponentInstallerName: function(name) {this.componentInstallerName = name;},\r\n\tgetComponentInstallerName: function() {return this.componentInstallerName;},\r\n\tserverComponentURL: null,\r\n\tsetServerComponentURL: function(URL) {this.serverComponentURL = URL;},\r\n\tgetServerComponentLink: function(version) {\r\n\t\t\t\t\t\t\t\t\tvar componentLink = this.serverComponentURL + \"?\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"component=\" + this.getComponentName();\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&os=\" + this.getUAInfos().os.name;\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&arch=\" + this.getUAInfos().cpu.architecture;\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&version=\" + this.getcomponentVersion();\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\treturn componentLink;\r\n\t\t\t\t\t\t\t\t},\r\n\tserverComponentInfos: null,\r\n\treadServerComponentInfos: function() {\r\n\t\t\t\t\t\t\t\t// XPI 6.0.15 with Firefox < 57\r\n\t\t\t\t\t\t\t\t// ==> Use Cryptolib CPS 5.0.37 instead of last release\r\n\t\t\t\t\t\t\t\tif ((this.getUAInfos().browser.name == 'Firefox') \r\n\t\t\t\t\t\t\t\t\t&& (this.getUAInfos().browser.major < 57)) {\r\n\t\t\t\t\t\t\t\t\tswitch (this.getUAInfos().os.name) {\r\n\t\t\t\t\t\t\t\t\t\tcase 'Windows': this.setcomponentVersion('5.0.37');break;\r\n\t\t\t\t\t\t\t\t\t\tcase 'Mac OS': this.setcomponentVersion('5.0.34');break;\r\n\t\t\t\t\t\t\t\t\t\tcase 'Linux':\r\n\t\t\t\t\t\t\t\t\t\tcase 'CentOS':\r\n\t\t\t\t\t\t\t\t\t\tcase 'Ubuntu':\r\n\t\t\t\t\t\t\t\t\t\tcase 'RedHat':  this.setcomponentVersion('5.0.12');break;\r\n\t\t\t\t\t\t\t\t\t\tdefault:break;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// Use fetch if exist\r\n\t\t\t\t\t\t\t\tif (self.fetch) {\r\n\t\t\t\t\t\t\t\t\tfetch( this.getServerComponentLink() + '&filename=get' )\r\n\t\t\t\t\t\t\t\t\t.then(function(resp) {return resp.json();})\r\n\t\t\t\t\t\t\t\t\t.then(function(response) {\r\n\t\t\t\t\t\t\t\t\t\tfor (var k in response) {\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.setComponentInstallerName(response[k]);\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.addClientDetailedInfos('URL de t&eacute;l&eacute;chargement', '<a href=\"' + dataIHM.getServerComponentLink() + '\">' + dataIHM.getComponentInstallerName() + '</a>');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('readServerComponentInfos : Error with fetch (' + error.message + ')'); \r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t// Use JQuery\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$.ajax(\t{\r\n\t\t\t\t\t\t\t\t\t\turl: this.getServerComponentLink() + '&filename=get'\r\n\t\t\t\t\t\t\t\t\t\t, success: function( data) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar json;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (data === String)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson = jQuery.parseJSON(data);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson = data\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor (var k in json) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setComponentInstallerName(json[k]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.addClientDetailedInfos('URL de t&eacute;l&eacute;chargement', '<a href=\"' + dataIHM.getServerComponentLink() + '\">' + dataIHM.getComponentInstallerName() + '</a>');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t, error: function( data) { return null;}\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\r\n\t//========================================\r\n\t// Support contact informations management\r\n \tmailSupportMailbox: null,\r\n\tmailSupportDomain: null,\r\n\tsetMailSupport: function(mailbox, domain) {this.mailSupportMailbox = mailbox; this.mailSupportDomain = domain;},\r\n\tgetMailSupport: function() {return this.mailSupportMailbox + \"@\" + this.mailSupportDomain;},\r\n \t\t\r\n\t//==========================\r\n\t// Detailed informations\r\n\tclientDetailedInfos: {},\r\n\tinitClientDetailedInfos: function() {\r\n\t\t\t\t\t\t\t\tconfigSupported = true;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.getUAInfos().device.type === undefined) {\r\n\t\t\t\t\t\t\t\t\tconsole.log(\"Poste de travail\");\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tconfigSupported = false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().os.name) {\r\n\t\t\t\t\t\t\t\t\tcase 'Windows':\r\n\t\t\t\t\t\t\t\t\tcase 'Mac OS':\r\n\t\t\t\t\t\t\t\t\tcase 'Linux':\r\n\t\t\t\t\t\t\t\t\tcase 'CentOS':\r\n\t\t\t\t\t\t\t\t\tcase 'Ubuntu':\r\n\t\t\t\t\t\t\t\t\tcase 'RedHat':  configSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault: \t\tconfigSupported = configSupported & false;break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().browser.name) {\r\n\t\t\t\t\t\t\t\t\tcase 'IE':\r\n\t\t\t\t\t\t\t\t\tcase 'Safari':\r\n\t\t\t\t\t\t\t\t\tcase 'Edge':\r\n\t\t\t\t\t\t\t\t\tcase 'Chrome':\r\n\t\t\t\t\t\t\t\t\tcase 'Firefox':\tconfigSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault: \t\tconfigSupported = configSupported & false;break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().cpu.architecture) {\r\n\t\t\t\t\t\t\t\t\tcase 'ia32':\r\n\t\t\t\t\t\t\t\t\tcase 'i686':\r\n\t\t\t\t\t\t\t\t\tcase 'amd64': configSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\t\tif (this.getUAInfos().cpu.architecture === undefined)\r\n\t\t\t\t\t\t\t\t\t\t\tconfigSupported = configSupported & true;\r\n\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\tconfigSupported = configSupported & false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.getUAInfos().cpu.architecture == 'amd64')\r\n\t\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Syst&egrave;me d\\'exploitation', this.getUAInfos().os.name + \" \" + this.getUAInfos().os.version + \" (64b)\");\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Syst&egrave;me d\\'exploitation', this.getUAInfos().os.name + \" \" + this.getUAInfos().os.version);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Navigateur', this.getUAInfos().browser.name + \" \" + this.getUAInfos().browser.major);\r\n\t\t\t\t\t\t\t\t// this.addClientDetailedInfos('Compatibilit&eacute; ASIP', '<a href=\"http://integrateurs-cps.asipsante.fr/Lettre_d_information\" target=\"_blanck\">Lettre d\\'information<br/>POSTE DE TRAVAIL & Veille Technologique</a>');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.clientUAInfos.configSupported = configSupported;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\treturn configSupported;\r\n\t\t\t\t\t\t\t},\r\n\tgetClientDetailedInfos: function() {return this.clientDetailedInfos;},\r\n\taddClientDetailedInfos: function(key, value) { this.clientDetailedInfos[key] = value;},\r\n\tresetClientDetailedInfos: function() {this.clientDetailedInfos = {};},\r\n\t\t\r\n\t//==========================\r\n\t// Client SSL Informations\r\n\tclientSSLInfos: null,\r\n\tclientSSLFetchParameters: { mode:'cors', credentials: 'include', cache: 'no-cache'},\r\n\tclientSSLAjaxParameters: { cache: false, timeout: 8000, async: true},\r\n\tisDefineClientSSLInfos: function() {return (this.clientSSLInfos != undefined);},\r\n\tsetClientSSLInfos: function(data) {this.clientSSLInfos = data;},\r\n\tgetClientSSLInfos: function() {return this.clientSSLInfos;},\r\n\tinitClientSSLParameters: function() { $.ajaxSetup(this.clientSSLAjaxParameters);},\r\n\tresetClientSSLInfos: function () {\r\n\t\t\t\t\t\t\tconsole.log('resetClientSSLInfos : Erase SSL Connexion cache for ' + this.getUAInfos().browser.name);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tswitch (this.getUAInfos().browser.name) {\r\n\t\t\t\t\t\t\t\tcase 'Edge': // Works !\r\n\t\t\t\t\t\t\t\tcase 'IE': // Works !\r\n\t\t\t\t\t\t\t\t\tif (document.execCommand) document.execCommand( \"ClearAuthenticationCache\", \"false\");\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 'Firefox':\t// Works !\r\n\t\t\t\t\t\t\t\t\t//location.reload(); // Works !\r\n\t\t\t\t\t\t\t\t\tif (window.crypto) if (window.crypto.logout) window.crypto.logout(); // Works !\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 'Chrome': // Works !\r\n\t\t\t\t\t\t\t\tcase 'Safari': // Not working, restart Browser needed !\r\n\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag'); \r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\treadClientSSLInfos: function() {\r\n\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : SSL Connexion' );\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// Use fetch if exist\r\n\t\t\t\t\t\t\tif (self.fetch) {\r\n\t\t\t\t\t\t\t\t// Try to connect and get CPS informations\r\n\t\t\t\t\t\t\t\tfetch( '/visuel.php', this.clientSSLFetchParameters )\r\n\t\t\t\t\t\t\t\t.then(function(resp) {return resp.json();})\r\n\t\t\t\t\t\t\t\t.then(function(resp_json) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Success with Fetch');\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t// traitement du JSON\r\n\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(resp_json);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('endDiagWithSuccess');\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t// Case of SSL Error\r\n\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Probably SSL Error with fetch (' + error.message + ')');\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(null);\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.accelerateTimer();\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t// Use JQuery\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$.ajax(\t{\r\n\t\t\t\t\t\t\t\t\turl: 'visuel.php'\r\n\t\t\t\t\t\t\t\t\t, success: function(data, textStatus) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Success with Ajax (' + textStatus + ')');\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tif (data === String)\r\n\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(jQuery.parseJSON(data));\r\n\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(data);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('endDiagWithSuccess');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t, error: function(data, textStatus) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Probably SSL Error with Ajax (' + textStatus + ')');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(null);\r\n\t\t\t\t\t\t\t\t\t\t\twizardStateMachine.accelerateTimer();\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n}\r\n\r\n//=====\r\n// Main\r\n//=====\r\n$(function() {\r\n\t// Initialization\r\n\t//---------------\r\n\tdataIHM.initUAInfos(); // User Agent\r\n\t\r\n\tdataIHM.initClientSSLParameters();\r\n\t\r\n\t// Sp�cific parameter with no good solution @29/12/2017\r\n\tswitch (dataIHM.getUAInfos().browser.name) {\r\n\t\tcase 'IE':\r\n\t\t\tconsole.log('=========== Use Ajax =============');\r\n\t\t\tself.fetch = undefined;\r\n\t\t\tbreak;\r\n\t\tcase 'Edge':\r\n\t\tcase 'Firefox':\r\n\t\tcase 'Safari':\r\n\t\tdefault:\r\n\t\t\tconsole.log('=========== Try using fetch. If not available use Ajax =============');\r\n\t\t\tbreak;\r\n\t}\r\n\t\r\n\tdataIHM.initClientDetailedInfos(); // Informations in bottom\r\n\tdataIHM.readServerComponentInfos(); // Get from informations from Web Service\r\n\t\r\n\twizardStateMachine.startWizard(); // Start Wizard\r\n\t\t\r\n\twizardStateMachine.displayInit(dataIHM.getUAInfos().os.name);\r\n});\r\n\n<!-- script : /js/diagcps.js End -->\n\n</script>\n<script type=\"text/javascript\">\n\t// Initialization Javascript from PHP\n\tdataIHM.setComponentName('CryptolibCPS');\n\tdataIHM.setServerComponentURL('download.php');\n</script>\n<!--<div id=\"beta\"></div>-->\n<div id=\"instructions-back\" onclick=\"wizardStateMachine.wizard('exitInstruction');\">\n\t<div id=\"instructions\">\n\t\n\t\t<div class=\"screen\" id=\"preAlert\">\n\t\t\t<div class=\"instruction\"><br/>\n<h1>Assistance en cas de carte CPS non lue</h1>\n\n<h2>Pr&eacute;alablement</h2>\n<p>\nVeuillez v&eacute;rifier que votre carte est bien ins&eacute;r&eacute;e dans votre lecteur de carte ou votre terminal Vitale.<br/>\nPuis v&eacute;rifier que votre lecteur de carte ou votre terminal Vitale est correctement connect&eacute; &agrave; votre ordinateur.<br/>\n<br/>\nLa carte ins&eacute;r&eacute;e dans le lecteur doit &ecirc;tre la derni&egrave;re carte active.\n\n<table >\n\t<tr>\n\t\t<td style=\"border-top:none;\"><img src=\"images/informations32.png\" alt=\"Information :\"/></td>\n\t\t<td style=\"border-top:none;\"><i>La derni&egrave;re carte active pr&eacute;sente la date d'expiration la plus &eacute;loign&eacute;e.</i></td>\n\t</tr>\n</table>\n<br/>\nUne fois cette v&eacute;rification r&eacute;alis&eacute;e, v&eacute;rifiez que la carte est bien lue.<br/>\n</p>\n\n<div id=\"alert1-MacOS\">\n<h2>Votre ordinateur est sous Mac OS</h2>\n<p>\nSur votre syst&egrave;me d'exploitation, nous ne disposons pas de m&eacute;thode particuli&egrave;re pour v&eacute;rifier si votre carte est lue.<br/>\n<br/>\nVeuillez lancer un diagnostic de votre ordinateur et proc&eacute;der &agrave; l'installation des mises &agrave; jour sugg&eacute;r&eacute;es.<br/>\n</p>\n</div>\n\n<div id=\"alert1-Linux\">\n<h2>Votre ordinateur est sous Linux</h2>\n<p>\nSur votre syst&egrave;me d'exploitation, nous ne disposons pas de m&eacute;thode particuli&egrave;re pour v&eacute;rifier si votre carte est lue.<br/>\n<br/>\nVeuillez lancer un diagnostic de votre ordinateur et proc&eacute;der &agrave; l'installation des mises &agrave; jour sugg&eacute;r&eacute;es.<br/>\n</p>\n</div>\n\n<div id=\"alert1-Windows\">\n<h2>Votre ordinateur est sous Windows</h2>\n<b>Dans la barre des t&acirc;ches, une carte lue est signal&eacute;e par <img src=\"images/preHelper/iconeOK.png\" alt=\"Icone vert dans la barre des taches\" /> et une carte non lue par <img src=\"images/preHelper/iconeKO.png\" alt=\"Icone rouge dans la barre des taches\"/>.</b><br/>\n<h3>L'ic&ocirc;ne <img src=\"images/preHelper/iconeOK.png\" alt=\"Icone vert dans la barre des taches\"/> est introuvable</h3>\n<p>\nCliquez avec le clic droit de votre souris sur le bouton &laquo;Afficher les ic&ocirc;nes&raquo; (en bas &agrave; droite de votre &eacute;cran) ou sur la zone heure et date et selectionnez &laquo;Personnaliser les ic&ocirc;nes de notification&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/notificationsBar.png\" alt=\"Barre de notification\"/></div>\n<br/>\n<br/>\nCherchez l'ic&ocirc;ne &laquo;Gestionnaire de certificats CPS&raquo; et s&eacute;lectionnez &laquo;Afficher l'ic&ocirc;ne et les notifications&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/notificationsParameters.png\" alt=\"Parametres de notifications\"/></div>\n<br/>\nUne fois la manipulation r&eacute;alis&eacute;e vous devriez voir apparaitre l'ic&ocirc;ne (en bas &agrave; droite de votre &eacute;cran).<br/>\n<br/>\nSi l'ic&ocirc;ne n'apparait pas dans la liste, lancer le diagnostic de votre ordinateur et installez les mises &agrave; jour propos&eacute;es.<br/>\n<br/>\n</p>\n<h2>L'ic&ocirc;ne <img src=\"images/preHelper/iconeKO.png\" alt=\"Icone rouge dans la barre des taches\" /> est rouge</h2>\n<p>\nSi l'ic&ocirc;ne est encadr&eacute;e de rouge (carte non lue), assurez-vous que votre carte est bien ins&eacute;r&eacute;e dans votre lecteur, rafra&icirc;chissez le lecteur en cliquant sur l'ic&ocirc;ne avec le bouton droit de la souris. Et cliquez sur &laquo;Rafra&icirc;chir&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/rightClickCCM.png\" alt=\"Cliquer droit sur l'icone du CCM\" /></div>\n<br/>\nSi l'encadr&eacute; reste rouge apr&egrave;s la manipulation, red&eacute;marrez votre ordinateur en laissant le lecteur et la CPS connect&eacute;s.<br/>\n<br/>\nApr&egrave;s ces manipulations, si l'ic&ocirc;ne ne passe pas au vert, veuillez nous contacter.\n</p>\n<div align=\"center\"></div>\n</div>\n\n</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"startDiag\" onclick=\"wizardStateMachine.wizard('startDiag');\">Diagnostiquer mon poste</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"notSupported\">\n\t\t\t<div class=\"instruction\">Votre configuration mat&eacute;riel et/ou syst&egrave;me n'est pas support&eacute;e par nos composants logiciels. Nous ne garantissons pas le succès du diagnostic.</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"notSupported\" onclick=\"wizardStateMachine.wizard('preAlert');\">Continuer</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"manualInstallXPI\">\n\t\t\t<div class=\"instruction\" id=\"xpi_instruction\" >L'Extension Firefox n'a pas &eacute;t&eacute; d&eacute;tect&eacute;e. Elle est indispensable sous ce navigateur.<br/>Apr&egrave;s l'installation, veuillez red&eacute;marrer votre navigateur.</div>\n\t\t\t<div class=\"actions\">\n<!--\t\t\t\t<div class=\"action instruction\" id=\"xpi\" onclick=\"wizardStateMachine.wizard('XPI',{URL:'https://diagcps.eservices.esante.gouv.fr/ODI_PS/php/download_asip.php?installeur=url_interne_xpi_installation_pkcs11',IconURL:'https://diagcps.eservices.esante.gouv.fr/ODI_PS/images/asip_sante.png',Hash:'sha256:c23de3812aaf7c3a81d80e9bdf891c3e2b621e01e55e8d308226fd86ab6ef438'});\">Installer<br/>l'Extension Firefox</div>-->\n<div class=\"action instruction\" id=\"xpi\" onclick=\"wizardStateMachine.wizard('XPI',{URL:'/download.php?component=xpi',IconURL:'/images/asip_sante.png',Hash:'sha256:c23de3812aaf7c3a81d80e9bdf891c3e2b621e01e55e8d308226fd86ab6ef438'});\">Installer<br/>l'Extension Firefox</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"restartAlertXPI\">\n\t\t\t<div class=\"instruction\" id=\"restartInstructionXPI\" >Une fois l'installation de l'Extension Cryptolib CPS termin&eacute;e,<br/>veuillez red&eacute;marrer votre navigateur.</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"manualInstallClibCPS\">\n\t\t\t<div class=\"instruction\">Si vous avez ins&eacute;r&eacute; votre CPS dans votre lecteur sans succ&egrave;s, la version de Cryptolib CPS de votre poste de travail n'est peut-&ecirc;tre pas &agrave; jour.</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"cryptolib\" onclick=\"wizardStateMachine.wizard('CryptolibCPS');\">T&eacute;l&eacute;charger<br/>Cryptolib CPS</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"restartAlert\">\n\t\t\t<div class=\"instruction\" id=\"restartInstruction\" >Une fois l'installation de CryptolibCPS_vX.Y.Z termin&eacute;e, veuillez red&eacute;marrer votre navigateur.</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"contactSupport\">\n\t\t\t<div class=\"instruction\">Si vous avez installez le composant propos&eacute; sans succ&eacute;s,<br/> veuillez contacter le Support.</div>\n\t\t</div>\n\t\t\n\t</div>\n</div>\t\n<div id=\"service-direction\" class=\"column\"></div>\n<div id=\"article\">\n\t<div id=\"center\">\n\t\t<div class=\"diagState\" id=\"diagState\"></div>\n\t\t<div>\n\t\t\t<div id=\"cps\" class=\"cpsverso\" onclick=\"wizardStateMachine.wizard('restartDiag');\"><div id=\"spin\"><div id=\"retry\"></div></div></div>\n\t\t</div>\n<!--\t\t\n\t\t<div id=\"results\">\n\t\t\t<div>\n\t\t\t\t<div class=\"sign\" id=\"certificat\"></div>\n\t\t\t\t<div class=\"sign\" id=\"expired\" title=\"expire\"></div>\n\t\t\t\t<div class=\"sign\" id=\"revoc\" title=\"revoque\"></div>\n\t\t\t\t<div class=\"sign\" id=\"class\"></div>\n\t\t\t\t<div class=\"sign\" id=\"rootAC\"></div>\n\t\t\t\t<div class=\"sign\" id=\"cryptolib\" title=\"cryptolib\"></div>\n\t\t\t</div>\n\t\t</div>\n-->\n\t\t<div id=\"cps_infos\">\n\t\t\t<div id=\"infos_cps\">\n\t\t\t\t<div id=\"infos_cps_caption\"><div>Informations d&eacute;taill&eacute;es</div><div class=\"infos_cps_caption_img_expand\" id=\"infos_cps_caption_img\"></div></div>\n\t\t\t\t<table id=\"infos_cps_table\">\n\t\t\t\t\t<tbody id=\"infos_cps_tbody\"></tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n<div id=\"support-direction\" class=\"column\"></div>\n</div>\r\n<div id=\"footer\" style=\"display:flex;flex-direction:row\">\r\n    <div style=\"display:flex;flex-direction:row;width:30vw\">\r\n        <div style=\"margin:20px\">\r\n            <a href=\"https://solidarites-sante.gouv.fr/\" target=\"_blank\">\r\n                <img src=\"./images/logo-ministere.svg\" alt=\"Ministère des Solidarités et de la santé\" width=\"84\" height=\"62\">\r\n            </a>\r\n        </div>\r\n        <div style=\"margin:20px\">\r\n            <a href=\"https://esante.gouv.fr/\" target=\"_blank\">\r\n                <img src=\"./images/logo-ANS.svg\" alt=\"Agence du Numérique en Santé\" width=\"166\" height=\"50\">\r\n            </a>\r\n        </div>\r\n    </div>\r\n    <div style=\"width:60vw\">\r\n        <ul style=\"align-items:end\">\r\n            <li><a href=\"http://esante.gouv.fr/services/mentions-legales\" target=\"_blank\">Mentions l&eacute;gales</a></li>\r\n            <li><a href=\"./copyright.php\" target=\"_blank\" title=\"Copyright [nouvelle fen&ecirc;tre]\">Copyright</a></li>\r\n        </ul>\r\n    </div>\r\n</div>\r\n\r\n</body>\r\n</html>\r\n",
      "ip": "135.125.232.117",
      "timestamp": "2025-03-14T16:26:19.506442379Z",
      "curl-command": "curl -X 'GET' -H 'Accept: */*' -H 'Accept-Language: en' -H 'User-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)' 'https://diagcps.eservices.esante.gouv.fr'",
      "matcher-status": true
    },
    {
      "template": "http/misconfiguration/http-missing-security-headers.yaml",
      "template-url": "https://templates.nuclei.sh/public/http-missing-security-headers",
      "template-id": "http-missing-security-headers",
      "template-path": "/home/runner/nuclei-templates/http/misconfiguration/http-missing-security-headers.yaml",
      "info": {
        "name": "HTTP Missing Security Headers",
        "author": [
          "socketz",
          "geeknik",
          "g4l1t0",
          "convisoappsec",
          "kurohost",
          "dawid-czarnecki",
          "forgedhallpass",
          "jub0bs",
          "userdehghani"
        ],
        "tags": [
          "misconfig",
          "headers",
          "generic"
        ],
        "description": "This template searches for missing HTTP security headers. The impact of these missing headers can vary.\n",
        "severity": "info",
        "metadata": {
          "max-request": 1
        }
      },
      "matcher-name": "cross-origin-resource-policy",
      "type": "http",
      "host": "https://diagcps.eservices.esante.gouv.fr",
      "matched-at": "https://diagcps.eservices.esante.gouv.fr",
      "request": "GET / HTTP/1.1\r\nHost: diagcps.eservices.esante.gouv.fr\r\nUser-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)\r\nConnection: close\r\nAccept: */*\r\nAccept-Language: en\r\nAccept-Encoding: gzip\r\n\r\n",
      "response": "HTTP/1.1 200 OK\r\nConnection: close\r\nTransfer-Encoding: chunked\r\nContent-Type: text/html; charset=UTF-8\r\nDate: Fri, 14 Mar 2025 16:26:19 GMT\r\nServer: Apache/2.4.37 (centos) OpenSSL/1.1.1g\r\nX-Powered-By: PHP/7.2.24\r\n\r\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n\t<title>DiagCPS, Outil de Diagnostic SSL</title>\r\n\t<meta http-equiv=\"Content-type\" content=\"text/html; charset=UTF-8\" />\r\n\t<meta name=\"description\" content=\"DiagCPS est un Outil de Diagnostic de l'authentification en ligne à l'aide d'une Carte de Professionnel de Santé, i.e. CPS. Il est fourni par l'ASIP Santé et remplace ODI.\" />\r\n\t<meta name=\"Publisher\" content=\"ASIP Santé\" />\r\n\t<meta name=\"copyright\" content=\"Tous droits réservés - ASIP Santé\" />\r\n\t<link rel=\"shortcut icon\" href=\"./images/favicon.ico\" type=\"image/x-icon\" />\r\n\t<link rel=\"stylesheet\" href=\"diagcps_css.php\" />\r\n\t<script src=\"./js/jquery-3.2.0.min.js\"></script>\r\n\t<script src=\"./js/ua-parser.min.js\"></script>\r\n</head>\r\n<body>\r\n<div id=\"header\" style=\"display:flex;flex-direction:row\">\r\n    <div style=\"margin:20px\">\r\n        <a href=\"https://solidarites-sante.gouv.fr/\" target=\"_blank\">\r\n            <img src=\"./images/logo-ministere.svg\" alt=\"Ministère des Solidarités et de la santé\" width=\"168\" height=\"104\">\r\n        </a>\r\n    </div>\r\n\t<div id=\"title\">esante.gouv.fr</div>\r\n</div>\r\n<div id=\"section\">\r\n<script type=\"text/javascript\">\n\n<!-- script : /js/wizarddiagcps.js Begin -->\n//==================================\r\n// Global variable used for state machine management \r\n// displayed on screen \r\n// or used by state machine\r\n//==================================\r\nvar wizardStateMachine = {\r\n\tstartState: 'notSupported',\r\n\tlastState: 'notSupported',\r\n\t\r\n\t//=================\r\n\t// Retry Management\r\n\t// Variables\r\n\tnbMaxRetry: 10,\r\n\tnbRetry: 0,\r\n\t\r\n\t// Management\r\n\tinitRetry: function() {this.nbRetry = this.nbMaxRetry;},\r\n\tisMaxRetry: function() {return (this.nbRetry >= this.nbMaxRetry);},\r\n\tisMinRetry: function() {return (this.nbRetry <= 0);},\r\n\tdecRetry: function() {this.nbRetry--;},\r\n\tdisplayRetry: function() {\r\n\t\t\t\t\t\t\t\t//console.log(\"displayRetry : nbRetry = \" + this.nbRetry);\r\n\t\t\t\t\t\t\t\tthis.decRetry();\r\n\t\t\t\t\t\t\t\tthis.stopTimers(); \r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.isMinRetry()\r\n\t\t\t\t\t\t\t\t\t&& \t(this.lastState != 'endDiagWithSuccess')) {\r\n\t\t\t\t\t\t\t\t\tthis.wizard('manualInstallClibCPS');\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tthis.displayWait(true);\r\n\t\t\t\t\t\t\t\t\tthis.startTimers();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\r\n\t//==================\r\n\t// Timers Management\r\n\ttimerTestSSL: null,\r\n\tretryTimeoutKO: 1000,\r\n\tinitTimer: function () {this.retryTimeoutKO = 1000;},\r\n\taccelerateTimer: function () {this.retryTimeoutKO = 250;},\r\n\tstopTimers: function() {\r\n\t\t\t\t\t\t\t\tif (this.timerTestSSL != null)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tclearTimeout(this.timerTestSSL);\r\n\t\t\t\t\t\t\t\t\tthis.timerTestSSL = null;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\tstartTimers: function() {this.timerTestSSL = setTimeout(function(){wizardStateMachine.displayRetry()}, this.retryTimeoutKO);},\r\n\t\r\n\t//=======\r\n\t// Wizard\r\n\tstartWizard: function() {this.wizard(this.startState);},\r\n\twizard: function(step, param) {\r\n\t\t\t\tconsole.log(\"wizard : step = \" + step + \", param = \" + param);\r\n\t\t\t\t\t\r\n\t\t\t\tswitch (step)\r\n\t\t\t\t{\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Pre treatment\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'notSupported':\r\n\t\t\t\t\tcase 'preAlert':\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'start');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif ((dataIHM.getUAInfos().configSupported) || (step == 'preAlert')) this.displayInstruction(true, 'preAlert');\r\n\t\t\t\t\t\telse this.displayInstruction(true, 'notSupported');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Manual Installation XPI\r\n\t\t\t\t\t// Suggestion of installation\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'manualInstallXPI':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'KO');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'manualInstallXPI');\r\n\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// XPI Installation\r\n\t\t\t\t\t// Installation process\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'XPI':\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'restartAlertXPI');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar params = {\r\n\t\t\t\t\t\t\t\t\"Installer l'Extension Cryptolib CPS\": \r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tURL: param.URL,\r\n\t\t\t\t\t\t\t\t\tIconURL: param.IconURL,\r\n\t\t\t\t\t\t\t\t\tHash: param.Hash,\r\n\t\t\t\t\t\t\t\t\ttoString: function () { return this.URL; }\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t};\r\nconsole.log(params);\r\n\t\t\t\t\t\tInstallTrigger.install(params);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// Diagnostic\r\n\t\t\t\t\t// Start\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'startDiag':\r\n\t\t\t\t\t\tthis.initRetry();\r\n\t\t\t\t\t\tthis.initTimer();\r\n\r\n\t\t\t\t\t\tthis.displayWait(true);\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'inProgress');\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tdataIHM.readClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.startTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// Diagnostic\r\n\t\t\t\t\t// Restart\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'restartDiag':\r\n\r\n\t\t\t\t\t\tdataIHM.resetClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\r\n\t\t\t\t\t//==========================\r\n\t\t\t\t\t// Progression\r\n\t\t\t\t\t//--------------------------\r\n\t\t\t\t\tcase 'inProgress':\r\n\t\t\t\t\t\t//dataIHM.readClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// this.displayDiagnosticState(true, 'inProgress');\r\n\t\t\t\t\t\t// this.displayInstruction(false);\r\n\t\t\t\t\t\t// this.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//===================\r\n\t\t\t\t\t// Ends\r\n\t\t\t\t\t//-------------------\r\n\t\t\t\t\tcase 'endDiagWithSuccess':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'OK');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tthis.displaySupport(false);\r\n\t\t\t\t\t\tthis.displayInfosCPS(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Manual Installation Cryptolib CPS\r\n\t\t\t\t\t// Suggestion of installation\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'manualInstallClibCPS':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'KO');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'manualInstallClibCPS');\r\n\t\t\t\t\t\tthis.displaySupport(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//=======================\r\n\t\t\t\t\t// Cryptolib CPS download\r\n\t\t\t\t\t// Installation process\r\n\t\t\t\t\t//-----------------------\r\n\t\t\t\t\tcase 'CryptolibCPS':\r\n\t\t\t\t\t\twindow.location = dataIHM.getServerComponentLink();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// Direct jump to Retry after installation\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'restartAlert');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\t\r\n\t\t\t\t\t//=========================\r\n\t\t\t\t\t// Other\r\n\t\t\t\t\t// Close Instruction screen\r\n\t\t\t\t\t//-------------------------\r\n\t\t\t\t\tcase 'exitInstruction':\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true);\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t// Open Support link\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'openSupport':\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tif (param !== undefined) window.open(param.URL,'_blank');\r\n\t\t\t\t\t\tbreak;\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.lastState = step;\r\n\t\t\t},\r\n\t\r\n\t//==========================\r\n\t// Screen Display Management\r\n\tdisplayElementById: function(id, display) {\r\n\t\t\t\t\t\t\tdocument.getElementById(id).style.display = display;\r\n\t\t\t\t\t\t},\r\n\thideElementById: function(id) {\r\n\t\t\t\t\t\t\tthis.displayElementById(id, \"none\");\r\n\t\t\t\t\t\t},\r\n\tdisplayInit: function(OSName) {\r\n\t\t\t\t\t\t// Events initialization\r\n\t\t\t\t\t\t//----------------------\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"cryptolib\", \t\t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"notSupported\", \t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"startDiag\", \t\t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"instructions-back\", \t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"infos_cps_caption\", \t\"click\", clickExpandCollapse);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// PreAlert initialization\r\n\t\t\t\t\t\t//------------------------\r\n\t\t\t\t\t\tthis.displayPreAlert(OSName);\r\n\t\t\t\t\t},\r\n\tdisplayInfosCPS: function (active) {\r\n\t\t\t\t\t\t\tvar infos_cps_tbody = '';\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar detailedInformations = dataIHM.getClientDetailedInfos();\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tfor (var item in detailedInformations) {\r\n\t\t\t\t\t\t\t\tinfos_cps_tbody += '<tr><td class=\"key\">' + item + '</td><td class=\"val\">' + detailedInformations[item] + '</td></tr>';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cps').className = dataIHM.getClientSSLInfos().div_cps_class;\r\n\r\n\t\t\t\t\t\t\t\tfor (var item in dataIHM.getClientSSLInfos().infos) {\r\n\t\t\t\t\t\t\t\t\tinfos_cps_tbody += '<tr><td class=\"key\">' + item + '</td><td class=\"val\">' + dataIHM.getClientSSLInfos().infos[item] + '</td></tr>';\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cps').className = \"cpsverso\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tdocument.getElementById('infos_cps_tbody').innerHTML = infos_cps_tbody;\r\n\t\t\t\t\t\t},\r\n\r\n\tdisplayWait:function (active) {\r\n\t\t\t\t\tif ( (active)\r\n\t\t\t\t\t\t&& (wizardStateMachine.nbRetry > 0) ) {\r\n\t\t\t\t\t\tthis.displayElementById('spin', \"flex\");\r\n\t\t\t\t\t\tdocument.getElementById('retry').innerHTML = wizardStateMachine.nbRetry;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.hideElementById('spin');\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\tdisplayDiagnosticState:function (active, state) {\r\n\t\t\t\t\t\t\t\tdiagStateContent = {\r\n\t\t\t\t\t\t\t\t\t'start':{content:'Cliquer sur la carte', style:'diagState diagStart'}\r\n\t\t\t\t\t\t\t\t\t, 'inProgress':{content:'Le diagnostic est en cours', style:'diagState diagInProgress'}\r\n\t\t\t\t\t\t\t\t\t, 'KO':{content:'Le diagnostic a &eacute;chou&eacute;', style:'diagState diagKO'}\r\n\t\t\t\t\t\t\t\t\t, 'OK':{content:'Le diagnostic a r&eacute;ussi', style:'diagState diagOK'}\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.hideElementById('diagState');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').style.display = \"block\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif (state !== undefined) {\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').className = diagStateContent[state].style;\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').innerHTML = diagStateContent[state].content;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\r\n\tdisplayInstruction: function (active, step) {\r\n\t\t\t\t\t\t\tthis.hideElementById('instructions-back');\r\n\t\t\t\t\t\t\tthis.hideElementById('instructions');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\tthis.displayElementById('instructions-back', \"flex\");\r\n\t\t\t\t\t\t\t\tthis.displayElementById('instructions', \"block\");\r\n\t\t\t\t\t\t\t\tthis.hideElementById('manualInstallClibCPS');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('manualInstallXPI');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('restartAlert');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('restartAlertXPI');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('preAlert');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('notSupported');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('contactSupport');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (step !== undefined) this.displayElementById(step, \"block\");\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar detailedInformations = dataIHM.getClientDetailedInfos();\r\n\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cryptolib').innerHTML = \"T&eacute;l&eacute;charger<br/>\" + dataIHM.getComponentInstallerName();\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (dataIHM.getUAInfos().os.name == 'Mac OS')\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('restartInstruction').innerHTML = \"Une fois l'installation de \" + dataIHM.getComponentInstallerName() + \" termin&eacute;e,<br/>veuillez red&eacute;marrer votre ordinateur.\";\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('restartInstruction').innerHTML = \"Une fois l'installation de \" + dataIHM.getComponentInstallerName() + \" termin&eacute;e,<br/>veuillez red&eacute;marrer votre navigateur.\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\r\n\tdisplaySupport: function (active) {\r\n\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\tthis.displayElementById('support-direction', \"flex\");\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.hideElementById('support-direction');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\r\n\tdisplayPreAlert: function(OSName) {\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-MacOS');\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-Windows');\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-Linux');\r\n\r\n\t\t\t\t\t\t\tif (OSName == 'Mac OS') this.displayElementById('alert1-MacOS', 'block');\r\n\t\t\t\t\t\t\tif (OSName == 'Windows') this.displayElementById('alert1-Windows', 'block');\r\n\t\t\t\t\t\t\tif (OSName == 'Linux') this.displayElementById('alert1-Linux', 'block');\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\r\n};\r\n\r\n//==================\r\n// Events Management\r\nfunction addEltEventListenerAllBrowser(elt, eventName, handle) {\r\n\tif (elt.addEventListener) { elt.addEventListener(eventName, handle, false);\r\n\t} else { elt.attachEvent(\"on\" + eventName, handle);\r\n\t}\r\n}\r\n\r\nfunction addIdEventListenerAllBrowser(id, eventName, handle) {\r\n\tif (document.getElementById(id)) addEltEventListenerAllBrowser(document.getElementById(id), eventName, handle);\r\n}\r\n\r\nfunction clickExpandCollapse(event) {\r\n\tif (document.getElementById('infos_cps_table').style.display != \"block\") {\r\n\t\tdocument.getElementById('infos_cps_caption_img').className = \"infos_cps_caption_img_collapse\";\r\n\t\tdocument.getElementById('infos_cps_table').style.display = \"block\";\r\n\t} else {\r\n\t\tdocument.getElementById('infos_cps_caption_img').className = \"infos_cps_caption_img_expand\";\r\n\t\tdocument.getElementById('infos_cps_table').style.display = \"none\";\r\n\t}\r\n\tevent.cancelBubble = true;\r\n\t\t\r\n\treturn false;\r\n}\r\n\r\nfunction clickActionNoPropagation(event) {\r\n\t//this.click();\r\n\r\n\tevent.cancelBubble = true;\r\n\r\n\treturn false;\r\n}\r\n\n<!-- script : /js/wizarddiagcps.js End -->\n<!-- script : /js/diagcps.js Begin -->\n//==================================\r\n// Global variable used for all data \r\n// displayed on screen \r\n// or used by state machine\r\n//==================================\r\nvar dataIHM = {\r\n\t//==========================\r\n\t// Root URL\r\n\tlocalURL: '',\r\n\tsetLocalURL: function(URL) {this.localURL = URL;},\r\n\tgetLocalURL: function() {return this.localURL;},\r\n\t\r\n\t//==========================\r\n\t// User Agent\r\n\tclientUAInfos: null,\r\n\ttimerUAInfos: null,\r\n\tinitUAInfos: function() {\r\n\t\t\t\t\t\tvar uaparser = new UAParser();\r\n\t\t\t\t\t\tthis.clientUAInfos = uaparser.getResult();\r\n\t\t\t\t\t\tthis.clientUAInfos.browser.xpi = true;\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tthis.timerUAInfos = setTimeout(function(){dataIHM.isUAInfosCPSWebEx()}, 1000);\r\n\t\t\t\t\t},\r\n\tgetUAInfos: function() {return this.clientUAInfos},\r\n\tisUAInfosCPSWebEx: function() {\r\n\t\t\t\t\tif (window.isCpsWebExAlive) {\r\n\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', window.isCpsWebExAlive());\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (this.getUAInfos().browser.name == 'Firefox') {\r\n\t\t\t\t\t\t\tif (this.getUAInfos().browser.major > 57) {\r\n\t\t\t\t\t\t\t\tthis.clientUAInfos.browser.xpi = false;\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'absente');\r\n\t\t\t\t\t\t\t\twizardStateMachine.wizard('manualInstallXPI');\r\n\t\t\t\t\t\t\t} else if (this.getUAInfos().browser.major == 57) {\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'sur cette version, l\\'installation du p&eacute;riph&eacute;rique de s&eacute;curit&eacute; doit &ecirc;tre <a href=\"http://integrateurs-cps.asipsante.fr/Installation-manuelle-PKCS11-Firefox\" target=\"_blanck\">r&eacute;alis&eacute;e manuellement</a>.');\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'd&eacute;tection impossible sur cette version');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.timerUAInfos = null;\r\n\t\t\t\t},\r\n\t\r\n\t//===============================\r\n\t// Installed Component management\r\n\tcomponentName: \"CryptolibCPS\", // By default\r\n\tsetComponentName: function(name) {this.componentName = name;},\r\n\tgetComponentName: function() {return this.componentName;},\r\n\tcomponentVersion: \"\", // By Default\r\n\tsetcomponentVersion: function(version) {this.componentVersion = version;},\r\n\tgetcomponentVersion: function() {return this.componentVersion;},\r\n\tcomponentInstallerName: \"\",\r\n\tsetComponentInstallerName: function(name) {this.componentInstallerName = name;},\r\n\tgetComponentInstallerName: function() {return this.componentInstallerName;},\r\n\tserverComponentURL: null,\r\n\tsetServerComponentURL: function(URL) {this.serverComponentURL = URL;},\r\n\tgetServerComponentLink: function(version) {\r\n\t\t\t\t\t\t\t\t\tvar componentLink = this.serverComponentURL + \"?\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"component=\" + this.getComponentName();\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&os=\" + this.getUAInfos().os.name;\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&arch=\" + this.getUAInfos().cpu.architecture;\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&version=\" + this.getcomponentVersion();\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\treturn componentLink;\r\n\t\t\t\t\t\t\t\t},\r\n\tserverComponentInfos: null,\r\n\treadServerComponentInfos: function() {\r\n\t\t\t\t\t\t\t\t// XPI 6.0.15 with Firefox < 57\r\n\t\t\t\t\t\t\t\t// ==> Use Cryptolib CPS 5.0.37 instead of last release\r\n\t\t\t\t\t\t\t\tif ((this.getUAInfos().browser.name == 'Firefox') \r\n\t\t\t\t\t\t\t\t\t&& (this.getUAInfos().browser.major < 57)) {\r\n\t\t\t\t\t\t\t\t\tswitch (this.getUAInfos().os.name) {\r\n\t\t\t\t\t\t\t\t\t\tcase 'Windows': this.setcomponentVersion('5.0.37');break;\r\n\t\t\t\t\t\t\t\t\t\tcase 'Mac OS': this.setcomponentVersion('5.0.34');break;\r\n\t\t\t\t\t\t\t\t\t\tcase 'Linux':\r\n\t\t\t\t\t\t\t\t\t\tcase 'CentOS':\r\n\t\t\t\t\t\t\t\t\t\tcase 'Ubuntu':\r\n\t\t\t\t\t\t\t\t\t\tcase 'RedHat':  this.setcomponentVersion('5.0.12');break;\r\n\t\t\t\t\t\t\t\t\t\tdefault:break;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// Use fetch if exist\r\n\t\t\t\t\t\t\t\tif (self.fetch) {\r\n\t\t\t\t\t\t\t\t\tfetch( this.getServerComponentLink() + '&filename=get' )\r\n\t\t\t\t\t\t\t\t\t.then(function(resp) {return resp.json();})\r\n\t\t\t\t\t\t\t\t\t.then(function(response) {\r\n\t\t\t\t\t\t\t\t\t\tfor (var k in response) {\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.setComponentInstallerName(response[k]);\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.addClientDetailedInfos('URL de t&eacute;l&eacute;chargement', '<a href=\"' + dataIHM.getServerComponentLink() + '\">' + dataIHM.getComponentInstallerName() + '</a>');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('readServerComponentInfos : Error with fetch (' + error.message + ')'); \r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t// Use JQuery\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$.ajax(\t{\r\n\t\t\t\t\t\t\t\t\t\turl: this.getServerComponentLink() + '&filename=get'\r\n\t\t\t\t\t\t\t\t\t\t, success: function( data) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar json;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (data === String)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson = jQuery.parseJSON(data);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson = data\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor (var k in json) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setComponentInstallerName(json[k]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.addClientDetailedInfos('URL de t&eacute;l&eacute;chargement', '<a href=\"' + dataIHM.getServerComponentLink() + '\">' + dataIHM.getComponentInstallerName() + '</a>');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t, error: function( data) { return null;}\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\r\n\t//========================================\r\n\t// Support contact informations management\r\n \tmailSupportMailbox: null,\r\n\tmailSupportDomain: null,\r\n\tsetMailSupport: function(mailbox, domain) {this.mailSupportMailbox = mailbox; this.mailSupportDomain = domain;},\r\n\tgetMailSupport: function() {return this.mailSupportMailbox + \"@\" + this.mailSupportDomain;},\r\n \t\t\r\n\t//==========================\r\n\t// Detailed informations\r\n\tclientDetailedInfos: {},\r\n\tinitClientDetailedInfos: function() {\r\n\t\t\t\t\t\t\t\tconfigSupported = true;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.getUAInfos().device.type === undefined) {\r\n\t\t\t\t\t\t\t\t\tconsole.log(\"Poste de travail\");\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tconfigSupported = false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().os.name) {\r\n\t\t\t\t\t\t\t\t\tcase 'Windows':\r\n\t\t\t\t\t\t\t\t\tcase 'Mac OS':\r\n\t\t\t\t\t\t\t\t\tcase 'Linux':\r\n\t\t\t\t\t\t\t\t\tcase 'CentOS':\r\n\t\t\t\t\t\t\t\t\tcase 'Ubuntu':\r\n\t\t\t\t\t\t\t\t\tcase 'RedHat':  configSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault: \t\tconfigSupported = configSupported & false;break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().browser.name) {\r\n\t\t\t\t\t\t\t\t\tcase 'IE':\r\n\t\t\t\t\t\t\t\t\tcase 'Safari':\r\n\t\t\t\t\t\t\t\t\tcase 'Edge':\r\n\t\t\t\t\t\t\t\t\tcase 'Chrome':\r\n\t\t\t\t\t\t\t\t\tcase 'Firefox':\tconfigSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault: \t\tconfigSupported = configSupported & false;break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().cpu.architecture) {\r\n\t\t\t\t\t\t\t\t\tcase 'ia32':\r\n\t\t\t\t\t\t\t\t\tcase 'i686':\r\n\t\t\t\t\t\t\t\t\tcase 'amd64': configSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\t\tif (this.getUAInfos().cpu.architecture === undefined)\r\n\t\t\t\t\t\t\t\t\t\t\tconfigSupported = configSupported & true;\r\n\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\tconfigSupported = configSupported & false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.getUAInfos().cpu.architecture == 'amd64')\r\n\t\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Syst&egrave;me d\\'exploitation', this.getUAInfos().os.name + \" \" + this.getUAInfos().os.version + \" (64b)\");\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Syst&egrave;me d\\'exploitation', this.getUAInfos().os.name + \" \" + this.getUAInfos().os.version);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Navigateur', this.getUAInfos().browser.name + \" \" + this.getUAInfos().browser.major);\r\n\t\t\t\t\t\t\t\t// this.addClientDetailedInfos('Compatibilit&eacute; ASIP', '<a href=\"http://integrateurs-cps.asipsante.fr/Lettre_d_information\" target=\"_blanck\">Lettre d\\'information<br/>POSTE DE TRAVAIL & Veille Technologique</a>');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.clientUAInfos.configSupported = configSupported;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\treturn configSupported;\r\n\t\t\t\t\t\t\t},\r\n\tgetClientDetailedInfos: function() {return this.clientDetailedInfos;},\r\n\taddClientDetailedInfos: function(key, value) { this.clientDetailedInfos[key] = value;},\r\n\tresetClientDetailedInfos: function() {this.clientDetailedInfos = {};},\r\n\t\t\r\n\t//==========================\r\n\t// Client SSL Informations\r\n\tclientSSLInfos: null,\r\n\tclientSSLFetchParameters: { mode:'cors', credentials: 'include', cache: 'no-cache'},\r\n\tclientSSLAjaxParameters: { cache: false, timeout: 8000, async: true},\r\n\tisDefineClientSSLInfos: function() {return (this.clientSSLInfos != undefined);},\r\n\tsetClientSSLInfos: function(data) {this.clientSSLInfos = data;},\r\n\tgetClientSSLInfos: function() {return this.clientSSLInfos;},\r\n\tinitClientSSLParameters: function() { $.ajaxSetup(this.clientSSLAjaxParameters);},\r\n\tresetClientSSLInfos: function () {\r\n\t\t\t\t\t\t\tconsole.log('resetClientSSLInfos : Erase SSL Connexion cache for ' + this.getUAInfos().browser.name);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tswitch (this.getUAInfos().browser.name) {\r\n\t\t\t\t\t\t\t\tcase 'Edge': // Works !\r\n\t\t\t\t\t\t\t\tcase 'IE': // Works !\r\n\t\t\t\t\t\t\t\t\tif (document.execCommand) document.execCommand( \"ClearAuthenticationCache\", \"false\");\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 'Firefox':\t// Works !\r\n\t\t\t\t\t\t\t\t\t//location.reload(); // Works !\r\n\t\t\t\t\t\t\t\t\tif (window.crypto) if (window.crypto.logout) window.crypto.logout(); // Works !\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 'Chrome': // Works !\r\n\t\t\t\t\t\t\t\tcase 'Safari': // Not working, restart Browser needed !\r\n\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag'); \r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\treadClientSSLInfos: function() {\r\n\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : SSL Connexion' );\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// Use fetch if exist\r\n\t\t\t\t\t\t\tif (self.fetch) {\r\n\t\t\t\t\t\t\t\t// Try to connect and get CPS informations\r\n\t\t\t\t\t\t\t\tfetch( '/visuel.php', this.clientSSLFetchParameters )\r\n\t\t\t\t\t\t\t\t.then(function(resp) {return resp.json();})\r\n\t\t\t\t\t\t\t\t.then(function(resp_json) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Success with Fetch');\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t// traitement du JSON\r\n\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(resp_json);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('endDiagWithSuccess');\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t// Case of SSL Error\r\n\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Probably SSL Error with fetch (' + error.message + ')');\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(null);\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.accelerateTimer();\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t// Use JQuery\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$.ajax(\t{\r\n\t\t\t\t\t\t\t\t\turl: 'visuel.php'\r\n\t\t\t\t\t\t\t\t\t, success: function(data, textStatus) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Success with Ajax (' + textStatus + ')');\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tif (data === String)\r\n\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(jQuery.parseJSON(data));\r\n\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(data);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('endDiagWithSuccess');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t, error: function(data, textStatus) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Probably SSL Error with Ajax (' + textStatus + ')');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(null);\r\n\t\t\t\t\t\t\t\t\t\t\twizardStateMachine.accelerateTimer();\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n}\r\n\r\n//=====\r\n// Main\r\n//=====\r\n$(function() {\r\n\t// Initialization\r\n\t//---------------\r\n\tdataIHM.initUAInfos(); // User Agent\r\n\t\r\n\tdataIHM.initClientSSLParameters();\r\n\t\r\n\t// Sp�cific parameter with no good solution @29/12/2017\r\n\tswitch (dataIHM.getUAInfos().browser.name) {\r\n\t\tcase 'IE':\r\n\t\t\tconsole.log('=========== Use Ajax =============');\r\n\t\t\tself.fetch = undefined;\r\n\t\t\tbreak;\r\n\t\tcase 'Edge':\r\n\t\tcase 'Firefox':\r\n\t\tcase 'Safari':\r\n\t\tdefault:\r\n\t\t\tconsole.log('=========== Try using fetch. If not available use Ajax =============');\r\n\t\t\tbreak;\r\n\t}\r\n\t\r\n\tdataIHM.initClientDetailedInfos(); // Informations in bottom\r\n\tdataIHM.readServerComponentInfos(); // Get from informations from Web Service\r\n\t\r\n\twizardStateMachine.startWizard(); // Start Wizard\r\n\t\t\r\n\twizardStateMachine.displayInit(dataIHM.getUAInfos().os.name);\r\n});\r\n\n<!-- script : /js/diagcps.js End -->\n\n</script>\n<script type=\"text/javascript\">\n\t// Initialization Javascript from PHP\n\tdataIHM.setComponentName('CryptolibCPS');\n\tdataIHM.setServerComponentURL('download.php');\n</script>\n<!--<div id=\"beta\"></div>-->\n<div id=\"instructions-back\" onclick=\"wizardStateMachine.wizard('exitInstruction');\">\n\t<div id=\"instructions\">\n\t\n\t\t<div class=\"screen\" id=\"preAlert\">\n\t\t\t<div class=\"instruction\"><br/>\n<h1>Assistance en cas de carte CPS non lue</h1>\n\n<h2>Pr&eacute;alablement</h2>\n<p>\nVeuillez v&eacute;rifier que votre carte est bien ins&eacute;r&eacute;e dans votre lecteur de carte ou votre terminal Vitale.<br/>\nPuis v&eacute;rifier que votre lecteur de carte ou votre terminal Vitale est correctement connect&eacute; &agrave; votre ordinateur.<br/>\n<br/>\nLa carte ins&eacute;r&eacute;e dans le lecteur doit &ecirc;tre la derni&egrave;re carte active.\n\n<table >\n\t<tr>\n\t\t<td style=\"border-top:none;\"><img src=\"images/informations32.png\" alt=\"Information :\"/></td>\n\t\t<td style=\"border-top:none;\"><i>La derni&egrave;re carte active pr&eacute;sente la date d'expiration la plus &eacute;loign&eacute;e.</i></td>\n\t</tr>\n</table>\n<br/>\nUne fois cette v&eacute;rification r&eacute;alis&eacute;e, v&eacute;rifiez que la carte est bien lue.<br/>\n</p>\n\n<div id=\"alert1-MacOS\">\n<h2>Votre ordinateur est sous Mac OS</h2>\n<p>\nSur votre syst&egrave;me d'exploitation, nous ne disposons pas de m&eacute;thode particuli&egrave;re pour v&eacute;rifier si votre carte est lue.<br/>\n<br/>\nVeuillez lancer un diagnostic de votre ordinateur et proc&eacute;der &agrave; l'installation des mises &agrave; jour sugg&eacute;r&eacute;es.<br/>\n</p>\n</div>\n\n<div id=\"alert1-Linux\">\n<h2>Votre ordinateur est sous Linux</h2>\n<p>\nSur votre syst&egrave;me d'exploitation, nous ne disposons pas de m&eacute;thode particuli&egrave;re pour v&eacute;rifier si votre carte est lue.<br/>\n<br/>\nVeuillez lancer un diagnostic de votre ordinateur et proc&eacute;der &agrave; l'installation des mises &agrave; jour sugg&eacute;r&eacute;es.<br/>\n</p>\n</div>\n\n<div id=\"alert1-Windows\">\n<h2>Votre ordinateur est sous Windows</h2>\n<b>Dans la barre des t&acirc;ches, une carte lue est signal&eacute;e par <img src=\"images/preHelper/iconeOK.png\" alt=\"Icone vert dans la barre des taches\" /> et une carte non lue par <img src=\"images/preHelper/iconeKO.png\" alt=\"Icone rouge dans la barre des taches\"/>.</b><br/>\n<h3>L'ic&ocirc;ne <img src=\"images/preHelper/iconeOK.png\" alt=\"Icone vert dans la barre des taches\"/> est introuvable</h3>\n<p>\nCliquez avec le clic droit de votre souris sur le bouton &laquo;Afficher les ic&ocirc;nes&raquo; (en bas &agrave; droite de votre &eacute;cran) ou sur la zone heure et date et selectionnez &laquo;Personnaliser les ic&ocirc;nes de notification&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/notificationsBar.png\" alt=\"Barre de notification\"/></div>\n<br/>\n<br/>\nCherchez l'ic&ocirc;ne &laquo;Gestionnaire de certificats CPS&raquo; et s&eacute;lectionnez &laquo;Afficher l'ic&ocirc;ne et les notifications&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/notificationsParameters.png\" alt=\"Parametres de notifications\"/></div>\n<br/>\nUne fois la manipulation r&eacute;alis&eacute;e vous devriez voir apparaitre l'ic&ocirc;ne (en bas &agrave; droite de votre &eacute;cran).<br/>\n<br/>\nSi l'ic&ocirc;ne n'apparait pas dans la liste, lancer le diagnostic de votre ordinateur et installez les mises &agrave; jour propos&eacute;es.<br/>\n<br/>\n</p>\n<h2>L'ic&ocirc;ne <img src=\"images/preHelper/iconeKO.png\" alt=\"Icone rouge dans la barre des taches\" /> est rouge</h2>\n<p>\nSi l'ic&ocirc;ne est encadr&eacute;e de rouge (carte non lue), assurez-vous que votre carte est bien ins&eacute;r&eacute;e dans votre lecteur, rafra&icirc;chissez le lecteur en cliquant sur l'ic&ocirc;ne avec le bouton droit de la souris. Et cliquez sur &laquo;Rafra&icirc;chir&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/rightClickCCM.png\" alt=\"Cliquer droit sur l'icone du CCM\" /></div>\n<br/>\nSi l'encadr&eacute; reste rouge apr&egrave;s la manipulation, red&eacute;marrez votre ordinateur en laissant le lecteur et la CPS connect&eacute;s.<br/>\n<br/>\nApr&egrave;s ces manipulations, si l'ic&ocirc;ne ne passe pas au vert, veuillez nous contacter.\n</p>\n<div align=\"center\"></div>\n</div>\n\n</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"startDiag\" onclick=\"wizardStateMachine.wizard('startDiag');\">Diagnostiquer mon poste</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"notSupported\">\n\t\t\t<div class=\"instruction\">Votre configuration mat&eacute;riel et/ou syst&egrave;me n'est pas support&eacute;e par nos composants logiciels. Nous ne garantissons pas le succès du diagnostic.</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"notSupported\" onclick=\"wizardStateMachine.wizard('preAlert');\">Continuer</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"manualInstallXPI\">\n\t\t\t<div class=\"instruction\" id=\"xpi_instruction\" >L'Extension Firefox n'a pas &eacute;t&eacute; d&eacute;tect&eacute;e. Elle est indispensable sous ce navigateur.<br/>Apr&egrave;s l'installation, veuillez red&eacute;marrer votre navigateur.</div>\n\t\t\t<div class=\"actions\">\n<!--\t\t\t\t<div class=\"action instruction\" id=\"xpi\" onclick=\"wizardStateMachine.wizard('XPI',{URL:'https://diagcps.eservices.esante.gouv.fr/ODI_PS/php/download_asip.php?installeur=url_interne_xpi_installation_pkcs11',IconURL:'https://diagcps.eservices.esante.gouv.fr/ODI_PS/images/asip_sante.png',Hash:'sha256:c23de3812aaf7c3a81d80e9bdf891c3e2b621e01e55e8d308226fd86ab6ef438'});\">Installer<br/>l'Extension Firefox</div>-->\n<div class=\"action instruction\" id=\"xpi\" onclick=\"wizardStateMachine.wizard('XPI',{URL:'/download.php?component=xpi',IconURL:'/images/asip_sante.png',Hash:'sha256:c23de3812aaf7c3a81d80e9bdf891c3e2b621e01e55e8d308226fd86ab6ef438'});\">Installer<br/>l'Extension Firefox</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"restartAlertXPI\">\n\t\t\t<div class=\"instruction\" id=\"restartInstructionXPI\" >Une fois l'installation de l'Extension Cryptolib CPS termin&eacute;e,<br/>veuillez red&eacute;marrer votre navigateur.</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"manualInstallClibCPS\">\n\t\t\t<div class=\"instruction\">Si vous avez ins&eacute;r&eacute; votre CPS dans votre lecteur sans succ&egrave;s, la version de Cryptolib CPS de votre poste de travail n'est peut-&ecirc;tre pas &agrave; jour.</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"cryptolib\" onclick=\"wizardStateMachine.wizard('CryptolibCPS');\">T&eacute;l&eacute;charger<br/>Cryptolib CPS</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"restartAlert\">\n\t\t\t<div class=\"instruction\" id=\"restartInstruction\" >Une fois l'installation de CryptolibCPS_vX.Y.Z termin&eacute;e, veuillez red&eacute;marrer votre navigateur.</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"contactSupport\">\n\t\t\t<div class=\"instruction\">Si vous avez installez le composant propos&eacute; sans succ&eacute;s,<br/> veuillez contacter le Support.</div>\n\t\t</div>\n\t\t\n\t</div>\n</div>\t\n<div id=\"service-direction\" class=\"column\"></div>\n<div id=\"article\">\n\t<div id=\"center\">\n\t\t<div class=\"diagState\" id=\"diagState\"></div>\n\t\t<div>\n\t\t\t<div id=\"cps\" class=\"cpsverso\" onclick=\"wizardStateMachine.wizard('restartDiag');\"><div id=\"spin\"><div id=\"retry\"></div></div></div>\n\t\t</div>\n<!--\t\t\n\t\t<div id=\"results\">\n\t\t\t<div>\n\t\t\t\t<div class=\"sign\" id=\"certificat\"></div>\n\t\t\t\t<div class=\"sign\" id=\"expired\" title=\"expire\"></div>\n\t\t\t\t<div class=\"sign\" id=\"revoc\" title=\"revoque\"></div>\n\t\t\t\t<div class=\"sign\" id=\"class\"></div>\n\t\t\t\t<div class=\"sign\" id=\"rootAC\"></div>\n\t\t\t\t<div class=\"sign\" id=\"cryptolib\" title=\"cryptolib\"></div>\n\t\t\t</div>\n\t\t</div>\n-->\n\t\t<div id=\"cps_infos\">\n\t\t\t<div id=\"infos_cps\">\n\t\t\t\t<div id=\"infos_cps_caption\"><div>Informations d&eacute;taill&eacute;es</div><div class=\"infos_cps_caption_img_expand\" id=\"infos_cps_caption_img\"></div></div>\n\t\t\t\t<table id=\"infos_cps_table\">\n\t\t\t\t\t<tbody id=\"infos_cps_tbody\"></tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n<div id=\"support-direction\" class=\"column\"></div>\n</div>\r\n<div id=\"footer\" style=\"display:flex;flex-direction:row\">\r\n    <div style=\"display:flex;flex-direction:row;width:30vw\">\r\n        <div style=\"margin:20px\">\r\n            <a href=\"https://solidarites-sante.gouv.fr/\" target=\"_blank\">\r\n                <img src=\"./images/logo-ministere.svg\" alt=\"Ministère des Solidarités et de la santé\" width=\"84\" height=\"62\">\r\n            </a>\r\n        </div>\r\n        <div style=\"margin:20px\">\r\n            <a href=\"https://esante.gouv.fr/\" target=\"_blank\">\r\n                <img src=\"./images/logo-ANS.svg\" alt=\"Agence du Numérique en Santé\" width=\"166\" height=\"50\">\r\n            </a>\r\n        </div>\r\n    </div>\r\n    <div style=\"width:60vw\">\r\n        <ul style=\"align-items:end\">\r\n            <li><a href=\"http://esante.gouv.fr/services/mentions-legales\" target=\"_blank\">Mentions l&eacute;gales</a></li>\r\n            <li><a href=\"./copyright.php\" target=\"_blank\" title=\"Copyright [nouvelle fen&ecirc;tre]\">Copyright</a></li>\r\n        </ul>\r\n    </div>\r\n</div>\r\n\r\n</body>\r\n</html>\r\n",
      "ip": "135.125.232.117",
      "timestamp": "2025-03-14T16:26:19.506455053Z",
      "curl-command": "curl -X 'GET' -H 'Accept: */*' -H 'Accept-Language: en' -H 'User-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)' 'https://diagcps.eservices.esante.gouv.fr'",
      "matcher-status": true
    },
    {
      "template": "http/misconfiguration/http-missing-security-headers.yaml",
      "template-url": "https://templates.nuclei.sh/public/http-missing-security-headers",
      "template-id": "http-missing-security-headers",
      "template-path": "/home/runner/nuclei-templates/http/misconfiguration/http-missing-security-headers.yaml",
      "info": {
        "name": "HTTP Missing Security Headers",
        "author": [
          "socketz",
          "geeknik",
          "g4l1t0",
          "convisoappsec",
          "kurohost",
          "dawid-czarnecki",
          "forgedhallpass",
          "jub0bs",
          "userdehghani"
        ],
        "tags": [
          "misconfig",
          "headers",
          "generic"
        ],
        "description": "This template searches for missing HTTP security headers. The impact of these missing headers can vary.\n",
        "severity": "info",
        "metadata": {
          "max-request": 1
        }
      },
      "matcher-name": "strict-transport-security",
      "type": "http",
      "host": "https://diagcps.eservices.esante.gouv.fr",
      "matched-at": "https://diagcps.eservices.esante.gouv.fr",
      "request": "GET / HTTP/1.1\r\nHost: diagcps.eservices.esante.gouv.fr\r\nUser-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)\r\nConnection: close\r\nAccept: */*\r\nAccept-Language: en\r\nAccept-Encoding: gzip\r\n\r\n",
      "response": "HTTP/1.1 200 OK\r\nConnection: close\r\nTransfer-Encoding: chunked\r\nContent-Type: text/html; charset=UTF-8\r\nDate: Fri, 14 Mar 2025 16:26:19 GMT\r\nServer: Apache/2.4.37 (centos) OpenSSL/1.1.1g\r\nX-Powered-By: PHP/7.2.24\r\n\r\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n\t<title>DiagCPS, Outil de Diagnostic SSL</title>\r\n\t<meta http-equiv=\"Content-type\" content=\"text/html; charset=UTF-8\" />\r\n\t<meta name=\"description\" content=\"DiagCPS est un Outil de Diagnostic de l'authentification en ligne à l'aide d'une Carte de Professionnel de Santé, i.e. CPS. Il est fourni par l'ASIP Santé et remplace ODI.\" />\r\n\t<meta name=\"Publisher\" content=\"ASIP Santé\" />\r\n\t<meta name=\"copyright\" content=\"Tous droits réservés - ASIP Santé\" />\r\n\t<link rel=\"shortcut icon\" href=\"./images/favicon.ico\" type=\"image/x-icon\" />\r\n\t<link rel=\"stylesheet\" href=\"diagcps_css.php\" />\r\n\t<script src=\"./js/jquery-3.2.0.min.js\"></script>\r\n\t<script src=\"./js/ua-parser.min.js\"></script>\r\n</head>\r\n<body>\r\n<div id=\"header\" style=\"display:flex;flex-direction:row\">\r\n    <div style=\"margin:20px\">\r\n        <a href=\"https://solidarites-sante.gouv.fr/\" target=\"_blank\">\r\n            <img src=\"./images/logo-ministere.svg\" alt=\"Ministère des Solidarités et de la santé\" width=\"168\" height=\"104\">\r\n        </a>\r\n    </div>\r\n\t<div id=\"title\">esante.gouv.fr</div>\r\n</div>\r\n<div id=\"section\">\r\n<script type=\"text/javascript\">\n\n<!-- script : /js/wizarddiagcps.js Begin -->\n//==================================\r\n// Global variable used for state machine management \r\n// displayed on screen \r\n// or used by state machine\r\n//==================================\r\nvar wizardStateMachine = {\r\n\tstartState: 'notSupported',\r\n\tlastState: 'notSupported',\r\n\t\r\n\t//=================\r\n\t// Retry Management\r\n\t// Variables\r\n\tnbMaxRetry: 10,\r\n\tnbRetry: 0,\r\n\t\r\n\t// Management\r\n\tinitRetry: function() {this.nbRetry = this.nbMaxRetry;},\r\n\tisMaxRetry: function() {return (this.nbRetry >= this.nbMaxRetry);},\r\n\tisMinRetry: function() {return (this.nbRetry <= 0);},\r\n\tdecRetry: function() {this.nbRetry--;},\r\n\tdisplayRetry: function() {\r\n\t\t\t\t\t\t\t\t//console.log(\"displayRetry : nbRetry = \" + this.nbRetry);\r\n\t\t\t\t\t\t\t\tthis.decRetry();\r\n\t\t\t\t\t\t\t\tthis.stopTimers(); \r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.isMinRetry()\r\n\t\t\t\t\t\t\t\t\t&& \t(this.lastState != 'endDiagWithSuccess')) {\r\n\t\t\t\t\t\t\t\t\tthis.wizard('manualInstallClibCPS');\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tthis.displayWait(true);\r\n\t\t\t\t\t\t\t\t\tthis.startTimers();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\r\n\t//==================\r\n\t// Timers Management\r\n\ttimerTestSSL: null,\r\n\tretryTimeoutKO: 1000,\r\n\tinitTimer: function () {this.retryTimeoutKO = 1000;},\r\n\taccelerateTimer: function () {this.retryTimeoutKO = 250;},\r\n\tstopTimers: function() {\r\n\t\t\t\t\t\t\t\tif (this.timerTestSSL != null)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tclearTimeout(this.timerTestSSL);\r\n\t\t\t\t\t\t\t\t\tthis.timerTestSSL = null;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\tstartTimers: function() {this.timerTestSSL = setTimeout(function(){wizardStateMachine.displayRetry()}, this.retryTimeoutKO);},\r\n\t\r\n\t//=======\r\n\t// Wizard\r\n\tstartWizard: function() {this.wizard(this.startState);},\r\n\twizard: function(step, param) {\r\n\t\t\t\tconsole.log(\"wizard : step = \" + step + \", param = \" + param);\r\n\t\t\t\t\t\r\n\t\t\t\tswitch (step)\r\n\t\t\t\t{\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Pre treatment\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'notSupported':\r\n\t\t\t\t\tcase 'preAlert':\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'start');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif ((dataIHM.getUAInfos().configSupported) || (step == 'preAlert')) this.displayInstruction(true, 'preAlert');\r\n\t\t\t\t\t\telse this.displayInstruction(true, 'notSupported');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Manual Installation XPI\r\n\t\t\t\t\t// Suggestion of installation\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'manualInstallXPI':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'KO');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'manualInstallXPI');\r\n\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// XPI Installation\r\n\t\t\t\t\t// Installation process\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'XPI':\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'restartAlertXPI');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar params = {\r\n\t\t\t\t\t\t\t\t\"Installer l'Extension Cryptolib CPS\": \r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tURL: param.URL,\r\n\t\t\t\t\t\t\t\t\tIconURL: param.IconURL,\r\n\t\t\t\t\t\t\t\t\tHash: param.Hash,\r\n\t\t\t\t\t\t\t\t\ttoString: function () { return this.URL; }\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t};\r\nconsole.log(params);\r\n\t\t\t\t\t\tInstallTrigger.install(params);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// Diagnostic\r\n\t\t\t\t\t// Start\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'startDiag':\r\n\t\t\t\t\t\tthis.initRetry();\r\n\t\t\t\t\t\tthis.initTimer();\r\n\r\n\t\t\t\t\t\tthis.displayWait(true);\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'inProgress');\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tdataIHM.readClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.startTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// Diagnostic\r\n\t\t\t\t\t// Restart\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'restartDiag':\r\n\r\n\t\t\t\t\t\tdataIHM.resetClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\r\n\t\t\t\t\t//==========================\r\n\t\t\t\t\t// Progression\r\n\t\t\t\t\t//--------------------------\r\n\t\t\t\t\tcase 'inProgress':\r\n\t\t\t\t\t\t//dataIHM.readClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// this.displayDiagnosticState(true, 'inProgress');\r\n\t\t\t\t\t\t// this.displayInstruction(false);\r\n\t\t\t\t\t\t// this.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//===================\r\n\t\t\t\t\t// Ends\r\n\t\t\t\t\t//-------------------\r\n\t\t\t\t\tcase 'endDiagWithSuccess':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'OK');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tthis.displaySupport(false);\r\n\t\t\t\t\t\tthis.displayInfosCPS(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Manual Installation Cryptolib CPS\r\n\t\t\t\t\t// Suggestion of installation\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'manualInstallClibCPS':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'KO');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'manualInstallClibCPS');\r\n\t\t\t\t\t\tthis.displaySupport(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//=======================\r\n\t\t\t\t\t// Cryptolib CPS download\r\n\t\t\t\t\t// Installation process\r\n\t\t\t\t\t//-----------------------\r\n\t\t\t\t\tcase 'CryptolibCPS':\r\n\t\t\t\t\t\twindow.location = dataIHM.getServerComponentLink();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// Direct jump to Retry after installation\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'restartAlert');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\t\r\n\t\t\t\t\t//=========================\r\n\t\t\t\t\t// Other\r\n\t\t\t\t\t// Close Instruction screen\r\n\t\t\t\t\t//-------------------------\r\n\t\t\t\t\tcase 'exitInstruction':\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true);\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t// Open Support link\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'openSupport':\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tif (param !== undefined) window.open(param.URL,'_blank');\r\n\t\t\t\t\t\tbreak;\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.lastState = step;\r\n\t\t\t},\r\n\t\r\n\t//==========================\r\n\t// Screen Display Management\r\n\tdisplayElementById: function(id, display) {\r\n\t\t\t\t\t\t\tdocument.getElementById(id).style.display = display;\r\n\t\t\t\t\t\t},\r\n\thideElementById: function(id) {\r\n\t\t\t\t\t\t\tthis.displayElementById(id, \"none\");\r\n\t\t\t\t\t\t},\r\n\tdisplayInit: function(OSName) {\r\n\t\t\t\t\t\t// Events initialization\r\n\t\t\t\t\t\t//----------------------\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"cryptolib\", \t\t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"notSupported\", \t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"startDiag\", \t\t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"instructions-back\", \t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"infos_cps_caption\", \t\"click\", clickExpandCollapse);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// PreAlert initialization\r\n\t\t\t\t\t\t//------------------------\r\n\t\t\t\t\t\tthis.displayPreAlert(OSName);\r\n\t\t\t\t\t},\r\n\tdisplayInfosCPS: function (active) {\r\n\t\t\t\t\t\t\tvar infos_cps_tbody = '';\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar detailedInformations = dataIHM.getClientDetailedInfos();\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tfor (var item in detailedInformations) {\r\n\t\t\t\t\t\t\t\tinfos_cps_tbody += '<tr><td class=\"key\">' + item + '</td><td class=\"val\">' + detailedInformations[item] + '</td></tr>';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cps').className = dataIHM.getClientSSLInfos().div_cps_class;\r\n\r\n\t\t\t\t\t\t\t\tfor (var item in dataIHM.getClientSSLInfos().infos) {\r\n\t\t\t\t\t\t\t\t\tinfos_cps_tbody += '<tr><td class=\"key\">' + item + '</td><td class=\"val\">' + dataIHM.getClientSSLInfos().infos[item] + '</td></tr>';\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cps').className = \"cpsverso\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tdocument.getElementById('infos_cps_tbody').innerHTML = infos_cps_tbody;\r\n\t\t\t\t\t\t},\r\n\r\n\tdisplayWait:function (active) {\r\n\t\t\t\t\tif ( (active)\r\n\t\t\t\t\t\t&& (wizardStateMachine.nbRetry > 0) ) {\r\n\t\t\t\t\t\tthis.displayElementById('spin', \"flex\");\r\n\t\t\t\t\t\tdocument.getElementById('retry').innerHTML = wizardStateMachine.nbRetry;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.hideElementById('spin');\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\tdisplayDiagnosticState:function (active, state) {\r\n\t\t\t\t\t\t\t\tdiagStateContent = {\r\n\t\t\t\t\t\t\t\t\t'start':{content:'Cliquer sur la carte', style:'diagState diagStart'}\r\n\t\t\t\t\t\t\t\t\t, 'inProgress':{content:'Le diagnostic est en cours', style:'diagState diagInProgress'}\r\n\t\t\t\t\t\t\t\t\t, 'KO':{content:'Le diagnostic a &eacute;chou&eacute;', style:'diagState diagKO'}\r\n\t\t\t\t\t\t\t\t\t, 'OK':{content:'Le diagnostic a r&eacute;ussi', style:'diagState diagOK'}\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.hideElementById('diagState');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').style.display = \"block\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif (state !== undefined) {\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').className = diagStateContent[state].style;\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').innerHTML = diagStateContent[state].content;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\r\n\tdisplayInstruction: function (active, step) {\r\n\t\t\t\t\t\t\tthis.hideElementById('instructions-back');\r\n\t\t\t\t\t\t\tthis.hideElementById('instructions');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\tthis.displayElementById('instructions-back', \"flex\");\r\n\t\t\t\t\t\t\t\tthis.displayElementById('instructions', \"block\");\r\n\t\t\t\t\t\t\t\tthis.hideElementById('manualInstallClibCPS');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('manualInstallXPI');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('restartAlert');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('restartAlertXPI');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('preAlert');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('notSupported');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('contactSupport');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (step !== undefined) this.displayElementById(step, \"block\");\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar detailedInformations = dataIHM.getClientDetailedInfos();\r\n\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cryptolib').innerHTML = \"T&eacute;l&eacute;charger<br/>\" + dataIHM.getComponentInstallerName();\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (dataIHM.getUAInfos().os.name == 'Mac OS')\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('restartInstruction').innerHTML = \"Une fois l'installation de \" + dataIHM.getComponentInstallerName() + \" termin&eacute;e,<br/>veuillez red&eacute;marrer votre ordinateur.\";\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('restartInstruction').innerHTML = \"Une fois l'installation de \" + dataIHM.getComponentInstallerName() + \" termin&eacute;e,<br/>veuillez red&eacute;marrer votre navigateur.\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\r\n\tdisplaySupport: function (active) {\r\n\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\tthis.displayElementById('support-direction', \"flex\");\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.hideElementById('support-direction');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\r\n\tdisplayPreAlert: function(OSName) {\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-MacOS');\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-Windows');\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-Linux');\r\n\r\n\t\t\t\t\t\t\tif (OSName == 'Mac OS') this.displayElementById('alert1-MacOS', 'block');\r\n\t\t\t\t\t\t\tif (OSName == 'Windows') this.displayElementById('alert1-Windows', 'block');\r\n\t\t\t\t\t\t\tif (OSName == 'Linux') this.displayElementById('alert1-Linux', 'block');\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\r\n};\r\n\r\n//==================\r\n// Events Management\r\nfunction addEltEventListenerAllBrowser(elt, eventName, handle) {\r\n\tif (elt.addEventListener) { elt.addEventListener(eventName, handle, false);\r\n\t} else { elt.attachEvent(\"on\" + eventName, handle);\r\n\t}\r\n}\r\n\r\nfunction addIdEventListenerAllBrowser(id, eventName, handle) {\r\n\tif (document.getElementById(id)) addEltEventListenerAllBrowser(document.getElementById(id), eventName, handle);\r\n}\r\n\r\nfunction clickExpandCollapse(event) {\r\n\tif (document.getElementById('infos_cps_table').style.display != \"block\") {\r\n\t\tdocument.getElementById('infos_cps_caption_img').className = \"infos_cps_caption_img_collapse\";\r\n\t\tdocument.getElementById('infos_cps_table').style.display = \"block\";\r\n\t} else {\r\n\t\tdocument.getElementById('infos_cps_caption_img').className = \"infos_cps_caption_img_expand\";\r\n\t\tdocument.getElementById('infos_cps_table').style.display = \"none\";\r\n\t}\r\n\tevent.cancelBubble = true;\r\n\t\t\r\n\treturn false;\r\n}\r\n\r\nfunction clickActionNoPropagation(event) {\r\n\t//this.click();\r\n\r\n\tevent.cancelBubble = true;\r\n\r\n\treturn false;\r\n}\r\n\n<!-- script : /js/wizarddiagcps.js End -->\n<!-- script : /js/diagcps.js Begin -->\n//==================================\r\n// Global variable used for all data \r\n// displayed on screen \r\n// or used by state machine\r\n//==================================\r\nvar dataIHM = {\r\n\t//==========================\r\n\t// Root URL\r\n\tlocalURL: '',\r\n\tsetLocalURL: function(URL) {this.localURL = URL;},\r\n\tgetLocalURL: function() {return this.localURL;},\r\n\t\r\n\t//==========================\r\n\t// User Agent\r\n\tclientUAInfos: null,\r\n\ttimerUAInfos: null,\r\n\tinitUAInfos: function() {\r\n\t\t\t\t\t\tvar uaparser = new UAParser();\r\n\t\t\t\t\t\tthis.clientUAInfos = uaparser.getResult();\r\n\t\t\t\t\t\tthis.clientUAInfos.browser.xpi = true;\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tthis.timerUAInfos = setTimeout(function(){dataIHM.isUAInfosCPSWebEx()}, 1000);\r\n\t\t\t\t\t},\r\n\tgetUAInfos: function() {return this.clientUAInfos},\r\n\tisUAInfosCPSWebEx: function() {\r\n\t\t\t\t\tif (window.isCpsWebExAlive) {\r\n\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', window.isCpsWebExAlive());\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (this.getUAInfos().browser.name == 'Firefox') {\r\n\t\t\t\t\t\t\tif (this.getUAInfos().browser.major > 57) {\r\n\t\t\t\t\t\t\t\tthis.clientUAInfos.browser.xpi = false;\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'absente');\r\n\t\t\t\t\t\t\t\twizardStateMachine.wizard('manualInstallXPI');\r\n\t\t\t\t\t\t\t} else if (this.getUAInfos().browser.major == 57) {\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'sur cette version, l\\'installation du p&eacute;riph&eacute;rique de s&eacute;curit&eacute; doit &ecirc;tre <a href=\"http://integrateurs-cps.asipsante.fr/Installation-manuelle-PKCS11-Firefox\" target=\"_blanck\">r&eacute;alis&eacute;e manuellement</a>.');\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'd&eacute;tection impossible sur cette version');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.timerUAInfos = null;\r\n\t\t\t\t},\r\n\t\r\n\t//===============================\r\n\t// Installed Component management\r\n\tcomponentName: \"CryptolibCPS\", // By default\r\n\tsetComponentName: function(name) {this.componentName = name;},\r\n\tgetComponentName: function() {return this.componentName;},\r\n\tcomponentVersion: \"\", // By Default\r\n\tsetcomponentVersion: function(version) {this.componentVersion = version;},\r\n\tgetcomponentVersion: function() {return this.componentVersion;},\r\n\tcomponentInstallerName: \"\",\r\n\tsetComponentInstallerName: function(name) {this.componentInstallerName = name;},\r\n\tgetComponentInstallerName: function() {return this.componentInstallerName;},\r\n\tserverComponentURL: null,\r\n\tsetServerComponentURL: function(URL) {this.serverComponentURL = URL;},\r\n\tgetServerComponentLink: function(version) {\r\n\t\t\t\t\t\t\t\t\tvar componentLink = this.serverComponentURL + \"?\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"component=\" + this.getComponentName();\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&os=\" + this.getUAInfos().os.name;\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&arch=\" + this.getUAInfos().cpu.architecture;\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&version=\" + this.getcomponentVersion();\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\treturn componentLink;\r\n\t\t\t\t\t\t\t\t},\r\n\tserverComponentInfos: null,\r\n\treadServerComponentInfos: function() {\r\n\t\t\t\t\t\t\t\t// XPI 6.0.15 with Firefox < 57\r\n\t\t\t\t\t\t\t\t// ==> Use Cryptolib CPS 5.0.37 instead of last release\r\n\t\t\t\t\t\t\t\tif ((this.getUAInfos().browser.name == 'Firefox') \r\n\t\t\t\t\t\t\t\t\t&& (this.getUAInfos().browser.major < 57)) {\r\n\t\t\t\t\t\t\t\t\tswitch (this.getUAInfos().os.name) {\r\n\t\t\t\t\t\t\t\t\t\tcase 'Windows': this.setcomponentVersion('5.0.37');break;\r\n\t\t\t\t\t\t\t\t\t\tcase 'Mac OS': this.setcomponentVersion('5.0.34');break;\r\n\t\t\t\t\t\t\t\t\t\tcase 'Linux':\r\n\t\t\t\t\t\t\t\t\t\tcase 'CentOS':\r\n\t\t\t\t\t\t\t\t\t\tcase 'Ubuntu':\r\n\t\t\t\t\t\t\t\t\t\tcase 'RedHat':  this.setcomponentVersion('5.0.12');break;\r\n\t\t\t\t\t\t\t\t\t\tdefault:break;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// Use fetch if exist\r\n\t\t\t\t\t\t\t\tif (self.fetch) {\r\n\t\t\t\t\t\t\t\t\tfetch( this.getServerComponentLink() + '&filename=get' )\r\n\t\t\t\t\t\t\t\t\t.then(function(resp) {return resp.json();})\r\n\t\t\t\t\t\t\t\t\t.then(function(response) {\r\n\t\t\t\t\t\t\t\t\t\tfor (var k in response) {\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.setComponentInstallerName(response[k]);\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.addClientDetailedInfos('URL de t&eacute;l&eacute;chargement', '<a href=\"' + dataIHM.getServerComponentLink() + '\">' + dataIHM.getComponentInstallerName() + '</a>');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('readServerComponentInfos : Error with fetch (' + error.message + ')'); \r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t// Use JQuery\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$.ajax(\t{\r\n\t\t\t\t\t\t\t\t\t\turl: this.getServerComponentLink() + '&filename=get'\r\n\t\t\t\t\t\t\t\t\t\t, success: function( data) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar json;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (data === String)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson = jQuery.parseJSON(data);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson = data\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor (var k in json) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setComponentInstallerName(json[k]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.addClientDetailedInfos('URL de t&eacute;l&eacute;chargement', '<a href=\"' + dataIHM.getServerComponentLink() + '\">' + dataIHM.getComponentInstallerName() + '</a>');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t, error: function( data) { return null;}\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\r\n\t//========================================\r\n\t// Support contact informations management\r\n \tmailSupportMailbox: null,\r\n\tmailSupportDomain: null,\r\n\tsetMailSupport: function(mailbox, domain) {this.mailSupportMailbox = mailbox; this.mailSupportDomain = domain;},\r\n\tgetMailSupport: function() {return this.mailSupportMailbox + \"@\" + this.mailSupportDomain;},\r\n \t\t\r\n\t//==========================\r\n\t// Detailed informations\r\n\tclientDetailedInfos: {},\r\n\tinitClientDetailedInfos: function() {\r\n\t\t\t\t\t\t\t\tconfigSupported = true;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.getUAInfos().device.type === undefined) {\r\n\t\t\t\t\t\t\t\t\tconsole.log(\"Poste de travail\");\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tconfigSupported = false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().os.name) {\r\n\t\t\t\t\t\t\t\t\tcase 'Windows':\r\n\t\t\t\t\t\t\t\t\tcase 'Mac OS':\r\n\t\t\t\t\t\t\t\t\tcase 'Linux':\r\n\t\t\t\t\t\t\t\t\tcase 'CentOS':\r\n\t\t\t\t\t\t\t\t\tcase 'Ubuntu':\r\n\t\t\t\t\t\t\t\t\tcase 'RedHat':  configSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault: \t\tconfigSupported = configSupported & false;break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().browser.name) {\r\n\t\t\t\t\t\t\t\t\tcase 'IE':\r\n\t\t\t\t\t\t\t\t\tcase 'Safari':\r\n\t\t\t\t\t\t\t\t\tcase 'Edge':\r\n\t\t\t\t\t\t\t\t\tcase 'Chrome':\r\n\t\t\t\t\t\t\t\t\tcase 'Firefox':\tconfigSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault: \t\tconfigSupported = configSupported & false;break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().cpu.architecture) {\r\n\t\t\t\t\t\t\t\t\tcase 'ia32':\r\n\t\t\t\t\t\t\t\t\tcase 'i686':\r\n\t\t\t\t\t\t\t\t\tcase 'amd64': configSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\t\tif (this.getUAInfos().cpu.architecture === undefined)\r\n\t\t\t\t\t\t\t\t\t\t\tconfigSupported = configSupported & true;\r\n\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\tconfigSupported = configSupported & false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.getUAInfos().cpu.architecture == 'amd64')\r\n\t\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Syst&egrave;me d\\'exploitation', this.getUAInfos().os.name + \" \" + this.getUAInfos().os.version + \" (64b)\");\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Syst&egrave;me d\\'exploitation', this.getUAInfos().os.name + \" \" + this.getUAInfos().os.version);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Navigateur', this.getUAInfos().browser.name + \" \" + this.getUAInfos().browser.major);\r\n\t\t\t\t\t\t\t\t// this.addClientDetailedInfos('Compatibilit&eacute; ASIP', '<a href=\"http://integrateurs-cps.asipsante.fr/Lettre_d_information\" target=\"_blanck\">Lettre d\\'information<br/>POSTE DE TRAVAIL & Veille Technologique</a>');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.clientUAInfos.configSupported = configSupported;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\treturn configSupported;\r\n\t\t\t\t\t\t\t},\r\n\tgetClientDetailedInfos: function() {return this.clientDetailedInfos;},\r\n\taddClientDetailedInfos: function(key, value) { this.clientDetailedInfos[key] = value;},\r\n\tresetClientDetailedInfos: function() {this.clientDetailedInfos = {};},\r\n\t\t\r\n\t//==========================\r\n\t// Client SSL Informations\r\n\tclientSSLInfos: null,\r\n\tclientSSLFetchParameters: { mode:'cors', credentials: 'include', cache: 'no-cache'},\r\n\tclientSSLAjaxParameters: { cache: false, timeout: 8000, async: true},\r\n\tisDefineClientSSLInfos: function() {return (this.clientSSLInfos != undefined);},\r\n\tsetClientSSLInfos: function(data) {this.clientSSLInfos = data;},\r\n\tgetClientSSLInfos: function() {return this.clientSSLInfos;},\r\n\tinitClientSSLParameters: function() { $.ajaxSetup(this.clientSSLAjaxParameters);},\r\n\tresetClientSSLInfos: function () {\r\n\t\t\t\t\t\t\tconsole.log('resetClientSSLInfos : Erase SSL Connexion cache for ' + this.getUAInfos().browser.name);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tswitch (this.getUAInfos().browser.name) {\r\n\t\t\t\t\t\t\t\tcase 'Edge': // Works !\r\n\t\t\t\t\t\t\t\tcase 'IE': // Works !\r\n\t\t\t\t\t\t\t\t\tif (document.execCommand) document.execCommand( \"ClearAuthenticationCache\", \"false\");\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 'Firefox':\t// Works !\r\n\t\t\t\t\t\t\t\t\t//location.reload(); // Works !\r\n\t\t\t\t\t\t\t\t\tif (window.crypto) if (window.crypto.logout) window.crypto.logout(); // Works !\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 'Chrome': // Works !\r\n\t\t\t\t\t\t\t\tcase 'Safari': // Not working, restart Browser needed !\r\n\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag'); \r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\treadClientSSLInfos: function() {\r\n\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : SSL Connexion' );\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// Use fetch if exist\r\n\t\t\t\t\t\t\tif (self.fetch) {\r\n\t\t\t\t\t\t\t\t// Try to connect and get CPS informations\r\n\t\t\t\t\t\t\t\tfetch( '/visuel.php', this.clientSSLFetchParameters )\r\n\t\t\t\t\t\t\t\t.then(function(resp) {return resp.json();})\r\n\t\t\t\t\t\t\t\t.then(function(resp_json) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Success with Fetch');\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t// traitement du JSON\r\n\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(resp_json);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('endDiagWithSuccess');\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t// Case of SSL Error\r\n\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Probably SSL Error with fetch (' + error.message + ')');\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(null);\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.accelerateTimer();\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t// Use JQuery\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$.ajax(\t{\r\n\t\t\t\t\t\t\t\t\turl: 'visuel.php'\r\n\t\t\t\t\t\t\t\t\t, success: function(data, textStatus) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Success with Ajax (' + textStatus + ')');\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tif (data === String)\r\n\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(jQuery.parseJSON(data));\r\n\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(data);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('endDiagWithSuccess');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t, error: function(data, textStatus) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Probably SSL Error with Ajax (' + textStatus + ')');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(null);\r\n\t\t\t\t\t\t\t\t\t\t\twizardStateMachine.accelerateTimer();\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n}\r\n\r\n//=====\r\n// Main\r\n//=====\r\n$(function() {\r\n\t// Initialization\r\n\t//---------------\r\n\tdataIHM.initUAInfos(); // User Agent\r\n\t\r\n\tdataIHM.initClientSSLParameters();\r\n\t\r\n\t// Sp�cific parameter with no good solution @29/12/2017\r\n\tswitch (dataIHM.getUAInfos().browser.name) {\r\n\t\tcase 'IE':\r\n\t\t\tconsole.log('=========== Use Ajax =============');\r\n\t\t\tself.fetch = undefined;\r\n\t\t\tbreak;\r\n\t\tcase 'Edge':\r\n\t\tcase 'Firefox':\r\n\t\tcase 'Safari':\r\n\t\tdefault:\r\n\t\t\tconsole.log('=========== Try using fetch. If not available use Ajax =============');\r\n\t\t\tbreak;\r\n\t}\r\n\t\r\n\tdataIHM.initClientDetailedInfos(); // Informations in bottom\r\n\tdataIHM.readServerComponentInfos(); // Get from informations from Web Service\r\n\t\r\n\twizardStateMachine.startWizard(); // Start Wizard\r\n\t\t\r\n\twizardStateMachine.displayInit(dataIHM.getUAInfos().os.name);\r\n});\r\n\n<!-- script : /js/diagcps.js End -->\n\n</script>\n<script type=\"text/javascript\">\n\t// Initialization Javascript from PHP\n\tdataIHM.setComponentName('CryptolibCPS');\n\tdataIHM.setServerComponentURL('download.php');\n</script>\n<!--<div id=\"beta\"></div>-->\n<div id=\"instructions-back\" onclick=\"wizardStateMachine.wizard('exitInstruction');\">\n\t<div id=\"instructions\">\n\t\n\t\t<div class=\"screen\" id=\"preAlert\">\n\t\t\t<div class=\"instruction\"><br/>\n<h1>Assistance en cas de carte CPS non lue</h1>\n\n<h2>Pr&eacute;alablement</h2>\n<p>\nVeuillez v&eacute;rifier que votre carte est bien ins&eacute;r&eacute;e dans votre lecteur de carte ou votre terminal Vitale.<br/>\nPuis v&eacute;rifier que votre lecteur de carte ou votre terminal Vitale est correctement connect&eacute; &agrave; votre ordinateur.<br/>\n<br/>\nLa carte ins&eacute;r&eacute;e dans le lecteur doit &ecirc;tre la derni&egrave;re carte active.\n\n<table >\n\t<tr>\n\t\t<td style=\"border-top:none;\"><img src=\"images/informations32.png\" alt=\"Information :\"/></td>\n\t\t<td style=\"border-top:none;\"><i>La derni&egrave;re carte active pr&eacute;sente la date d'expiration la plus &eacute;loign&eacute;e.</i></td>\n\t</tr>\n</table>\n<br/>\nUne fois cette v&eacute;rification r&eacute;alis&eacute;e, v&eacute;rifiez que la carte est bien lue.<br/>\n</p>\n\n<div id=\"alert1-MacOS\">\n<h2>Votre ordinateur est sous Mac OS</h2>\n<p>\nSur votre syst&egrave;me d'exploitation, nous ne disposons pas de m&eacute;thode particuli&egrave;re pour v&eacute;rifier si votre carte est lue.<br/>\n<br/>\nVeuillez lancer un diagnostic de votre ordinateur et proc&eacute;der &agrave; l'installation des mises &agrave; jour sugg&eacute;r&eacute;es.<br/>\n</p>\n</div>\n\n<div id=\"alert1-Linux\">\n<h2>Votre ordinateur est sous Linux</h2>\n<p>\nSur votre syst&egrave;me d'exploitation, nous ne disposons pas de m&eacute;thode particuli&egrave;re pour v&eacute;rifier si votre carte est lue.<br/>\n<br/>\nVeuillez lancer un diagnostic de votre ordinateur et proc&eacute;der &agrave; l'installation des mises &agrave; jour sugg&eacute;r&eacute;es.<br/>\n</p>\n</div>\n\n<div id=\"alert1-Windows\">\n<h2>Votre ordinateur est sous Windows</h2>\n<b>Dans la barre des t&acirc;ches, une carte lue est signal&eacute;e par <img src=\"images/preHelper/iconeOK.png\" alt=\"Icone vert dans la barre des taches\" /> et une carte non lue par <img src=\"images/preHelper/iconeKO.png\" alt=\"Icone rouge dans la barre des taches\"/>.</b><br/>\n<h3>L'ic&ocirc;ne <img src=\"images/preHelper/iconeOK.png\" alt=\"Icone vert dans la barre des taches\"/> est introuvable</h3>\n<p>\nCliquez avec le clic droit de votre souris sur le bouton &laquo;Afficher les ic&ocirc;nes&raquo; (en bas &agrave; droite de votre &eacute;cran) ou sur la zone heure et date et selectionnez &laquo;Personnaliser les ic&ocirc;nes de notification&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/notificationsBar.png\" alt=\"Barre de notification\"/></div>\n<br/>\n<br/>\nCherchez l'ic&ocirc;ne &laquo;Gestionnaire de certificats CPS&raquo; et s&eacute;lectionnez &laquo;Afficher l'ic&ocirc;ne et les notifications&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/notificationsParameters.png\" alt=\"Parametres de notifications\"/></div>\n<br/>\nUne fois la manipulation r&eacute;alis&eacute;e vous devriez voir apparaitre l'ic&ocirc;ne (en bas &agrave; droite de votre &eacute;cran).<br/>\n<br/>\nSi l'ic&ocirc;ne n'apparait pas dans la liste, lancer le diagnostic de votre ordinateur et installez les mises &agrave; jour propos&eacute;es.<br/>\n<br/>\n</p>\n<h2>L'ic&ocirc;ne <img src=\"images/preHelper/iconeKO.png\" alt=\"Icone rouge dans la barre des taches\" /> est rouge</h2>\n<p>\nSi l'ic&ocirc;ne est encadr&eacute;e de rouge (carte non lue), assurez-vous que votre carte est bien ins&eacute;r&eacute;e dans votre lecteur, rafra&icirc;chissez le lecteur en cliquant sur l'ic&ocirc;ne avec le bouton droit de la souris. Et cliquez sur &laquo;Rafra&icirc;chir&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/rightClickCCM.png\" alt=\"Cliquer droit sur l'icone du CCM\" /></div>\n<br/>\nSi l'encadr&eacute; reste rouge apr&egrave;s la manipulation, red&eacute;marrez votre ordinateur en laissant le lecteur et la CPS connect&eacute;s.<br/>\n<br/>\nApr&egrave;s ces manipulations, si l'ic&ocirc;ne ne passe pas au vert, veuillez nous contacter.\n</p>\n<div align=\"center\"></div>\n</div>\n\n</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"startDiag\" onclick=\"wizardStateMachine.wizard('startDiag');\">Diagnostiquer mon poste</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"notSupported\">\n\t\t\t<div class=\"instruction\">Votre configuration mat&eacute;riel et/ou syst&egrave;me n'est pas support&eacute;e par nos composants logiciels. Nous ne garantissons pas le succès du diagnostic.</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"notSupported\" onclick=\"wizardStateMachine.wizard('preAlert');\">Continuer</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"manualInstallXPI\">\n\t\t\t<div class=\"instruction\" id=\"xpi_instruction\" >L'Extension Firefox n'a pas &eacute;t&eacute; d&eacute;tect&eacute;e. Elle est indispensable sous ce navigateur.<br/>Apr&egrave;s l'installation, veuillez red&eacute;marrer votre navigateur.</div>\n\t\t\t<div class=\"actions\">\n<!--\t\t\t\t<div class=\"action instruction\" id=\"xpi\" onclick=\"wizardStateMachine.wizard('XPI',{URL:'https://diagcps.eservices.esante.gouv.fr/ODI_PS/php/download_asip.php?installeur=url_interne_xpi_installation_pkcs11',IconURL:'https://diagcps.eservices.esante.gouv.fr/ODI_PS/images/asip_sante.png',Hash:'sha256:c23de3812aaf7c3a81d80e9bdf891c3e2b621e01e55e8d308226fd86ab6ef438'});\">Installer<br/>l'Extension Firefox</div>-->\n<div class=\"action instruction\" id=\"xpi\" onclick=\"wizardStateMachine.wizard('XPI',{URL:'/download.php?component=xpi',IconURL:'/images/asip_sante.png',Hash:'sha256:c23de3812aaf7c3a81d80e9bdf891c3e2b621e01e55e8d308226fd86ab6ef438'});\">Installer<br/>l'Extension Firefox</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"restartAlertXPI\">\n\t\t\t<div class=\"instruction\" id=\"restartInstructionXPI\" >Une fois l'installation de l'Extension Cryptolib CPS termin&eacute;e,<br/>veuillez red&eacute;marrer votre navigateur.</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"manualInstallClibCPS\">\n\t\t\t<div class=\"instruction\">Si vous avez ins&eacute;r&eacute; votre CPS dans votre lecteur sans succ&egrave;s, la version de Cryptolib CPS de votre poste de travail n'est peut-&ecirc;tre pas &agrave; jour.</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"cryptolib\" onclick=\"wizardStateMachine.wizard('CryptolibCPS');\">T&eacute;l&eacute;charger<br/>Cryptolib CPS</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"restartAlert\">\n\t\t\t<div class=\"instruction\" id=\"restartInstruction\" >Une fois l'installation de CryptolibCPS_vX.Y.Z termin&eacute;e, veuillez red&eacute;marrer votre navigateur.</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"contactSupport\">\n\t\t\t<div class=\"instruction\">Si vous avez installez le composant propos&eacute; sans succ&eacute;s,<br/> veuillez contacter le Support.</div>\n\t\t</div>\n\t\t\n\t</div>\n</div>\t\n<div id=\"service-direction\" class=\"column\"></div>\n<div id=\"article\">\n\t<div id=\"center\">\n\t\t<div class=\"diagState\" id=\"diagState\"></div>\n\t\t<div>\n\t\t\t<div id=\"cps\" class=\"cpsverso\" onclick=\"wizardStateMachine.wizard('restartDiag');\"><div id=\"spin\"><div id=\"retry\"></div></div></div>\n\t\t</div>\n<!--\t\t\n\t\t<div id=\"results\">\n\t\t\t<div>\n\t\t\t\t<div class=\"sign\" id=\"certificat\"></div>\n\t\t\t\t<div class=\"sign\" id=\"expired\" title=\"expire\"></div>\n\t\t\t\t<div class=\"sign\" id=\"revoc\" title=\"revoque\"></div>\n\t\t\t\t<div class=\"sign\" id=\"class\"></div>\n\t\t\t\t<div class=\"sign\" id=\"rootAC\"></div>\n\t\t\t\t<div class=\"sign\" id=\"cryptolib\" title=\"cryptolib\"></div>\n\t\t\t</div>\n\t\t</div>\n-->\n\t\t<div id=\"cps_infos\">\n\t\t\t<div id=\"infos_cps\">\n\t\t\t\t<div id=\"infos_cps_caption\"><div>Informations d&eacute;taill&eacute;es</div><div class=\"infos_cps_caption_img_expand\" id=\"infos_cps_caption_img\"></div></div>\n\t\t\t\t<table id=\"infos_cps_table\">\n\t\t\t\t\t<tbody id=\"infos_cps_tbody\"></tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n<div id=\"support-direction\" class=\"column\"></div>\n</div>\r\n<div id=\"footer\" style=\"display:flex;flex-direction:row\">\r\n    <div style=\"display:flex;flex-direction:row;width:30vw\">\r\n        <div style=\"margin:20px\">\r\n            <a href=\"https://solidarites-sante.gouv.fr/\" target=\"_blank\">\r\n                <img src=\"./images/logo-ministere.svg\" alt=\"Ministère des Solidarités et de la santé\" width=\"84\" height=\"62\">\r\n            </a>\r\n        </div>\r\n        <div style=\"margin:20px\">\r\n            <a href=\"https://esante.gouv.fr/\" target=\"_blank\">\r\n                <img src=\"./images/logo-ANS.svg\" alt=\"Agence du Numérique en Santé\" width=\"166\" height=\"50\">\r\n            </a>\r\n        </div>\r\n    </div>\r\n    <div style=\"width:60vw\">\r\n        <ul style=\"align-items:end\">\r\n            <li><a href=\"http://esante.gouv.fr/services/mentions-legales\" target=\"_blank\">Mentions l&eacute;gales</a></li>\r\n            <li><a href=\"./copyright.php\" target=\"_blank\" title=\"Copyright [nouvelle fen&ecirc;tre]\">Copyright</a></li>\r\n        </ul>\r\n    </div>\r\n</div>\r\n\r\n</body>\r\n</html>\r\n",
      "ip": "135.125.232.117",
      "timestamp": "2025-03-14T16:26:19.506468308Z",
      "curl-command": "curl -X 'GET' -H 'Accept: */*' -H 'Accept-Language: en' -H 'User-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)' 'https://diagcps.eservices.esante.gouv.fr'",
      "matcher-status": true
    },
    {
      "template": "http/misconfiguration/http-missing-security-headers.yaml",
      "template-url": "https://templates.nuclei.sh/public/http-missing-security-headers",
      "template-id": "http-missing-security-headers",
      "template-path": "/home/runner/nuclei-templates/http/misconfiguration/http-missing-security-headers.yaml",
      "info": {
        "name": "HTTP Missing Security Headers",
        "author": [
          "socketz",
          "geeknik",
          "g4l1t0",
          "convisoappsec",
          "kurohost",
          "dawid-czarnecki",
          "forgedhallpass",
          "jub0bs",
          "userdehghani"
        ],
        "tags": [
          "misconfig",
          "headers",
          "generic"
        ],
        "description": "This template searches for missing HTTP security headers. The impact of these missing headers can vary.\n",
        "severity": "info",
        "metadata": {
          "max-request": 1
        }
      },
      "matcher-name": "content-security-policy",
      "type": "http",
      "host": "https://diagcps.eservices.esante.gouv.fr",
      "matched-at": "https://diagcps.eservices.esante.gouv.fr",
      "request": "GET / HTTP/1.1\r\nHost: diagcps.eservices.esante.gouv.fr\r\nUser-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)\r\nConnection: close\r\nAccept: */*\r\nAccept-Language: en\r\nAccept-Encoding: gzip\r\n\r\n",
      "response": "HTTP/1.1 200 OK\r\nConnection: close\r\nTransfer-Encoding: chunked\r\nContent-Type: text/html; charset=UTF-8\r\nDate: Fri, 14 Mar 2025 16:26:19 GMT\r\nServer: Apache/2.4.37 (centos) OpenSSL/1.1.1g\r\nX-Powered-By: PHP/7.2.24\r\n\r\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n\t<title>DiagCPS, Outil de Diagnostic SSL</title>\r\n\t<meta http-equiv=\"Content-type\" content=\"text/html; charset=UTF-8\" />\r\n\t<meta name=\"description\" content=\"DiagCPS est un Outil de Diagnostic de l'authentification en ligne à l'aide d'une Carte de Professionnel de Santé, i.e. CPS. Il est fourni par l'ASIP Santé et remplace ODI.\" />\r\n\t<meta name=\"Publisher\" content=\"ASIP Santé\" />\r\n\t<meta name=\"copyright\" content=\"Tous droits réservés - ASIP Santé\" />\r\n\t<link rel=\"shortcut icon\" href=\"./images/favicon.ico\" type=\"image/x-icon\" />\r\n\t<link rel=\"stylesheet\" href=\"diagcps_css.php\" />\r\n\t<script src=\"./js/jquery-3.2.0.min.js\"></script>\r\n\t<script src=\"./js/ua-parser.min.js\"></script>\r\n</head>\r\n<body>\r\n<div id=\"header\" style=\"display:flex;flex-direction:row\">\r\n    <div style=\"margin:20px\">\r\n        <a href=\"https://solidarites-sante.gouv.fr/\" target=\"_blank\">\r\n            <img src=\"./images/logo-ministere.svg\" alt=\"Ministère des Solidarités et de la santé\" width=\"168\" height=\"104\">\r\n        </a>\r\n    </div>\r\n\t<div id=\"title\">esante.gouv.fr</div>\r\n</div>\r\n<div id=\"section\">\r\n<script type=\"text/javascript\">\n\n<!-- script : /js/wizarddiagcps.js Begin -->\n//==================================\r\n// Global variable used for state machine management \r\n// displayed on screen \r\n// or used by state machine\r\n//==================================\r\nvar wizardStateMachine = {\r\n\tstartState: 'notSupported',\r\n\tlastState: 'notSupported',\r\n\t\r\n\t//=================\r\n\t// Retry Management\r\n\t// Variables\r\n\tnbMaxRetry: 10,\r\n\tnbRetry: 0,\r\n\t\r\n\t// Management\r\n\tinitRetry: function() {this.nbRetry = this.nbMaxRetry;},\r\n\tisMaxRetry: function() {return (this.nbRetry >= this.nbMaxRetry);},\r\n\tisMinRetry: function() {return (this.nbRetry <= 0);},\r\n\tdecRetry: function() {this.nbRetry--;},\r\n\tdisplayRetry: function() {\r\n\t\t\t\t\t\t\t\t//console.log(\"displayRetry : nbRetry = \" + this.nbRetry);\r\n\t\t\t\t\t\t\t\tthis.decRetry();\r\n\t\t\t\t\t\t\t\tthis.stopTimers(); \r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.isMinRetry()\r\n\t\t\t\t\t\t\t\t\t&& \t(this.lastState != 'endDiagWithSuccess')) {\r\n\t\t\t\t\t\t\t\t\tthis.wizard('manualInstallClibCPS');\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tthis.displayWait(true);\r\n\t\t\t\t\t\t\t\t\tthis.startTimers();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\r\n\t//==================\r\n\t// Timers Management\r\n\ttimerTestSSL: null,\r\n\tretryTimeoutKO: 1000,\r\n\tinitTimer: function () {this.retryTimeoutKO = 1000;},\r\n\taccelerateTimer: function () {this.retryTimeoutKO = 250;},\r\n\tstopTimers: function() {\r\n\t\t\t\t\t\t\t\tif (this.timerTestSSL != null)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tclearTimeout(this.timerTestSSL);\r\n\t\t\t\t\t\t\t\t\tthis.timerTestSSL = null;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\tstartTimers: function() {this.timerTestSSL = setTimeout(function(){wizardStateMachine.displayRetry()}, this.retryTimeoutKO);},\r\n\t\r\n\t//=======\r\n\t// Wizard\r\n\tstartWizard: function() {this.wizard(this.startState);},\r\n\twizard: function(step, param) {\r\n\t\t\t\tconsole.log(\"wizard : step = \" + step + \", param = \" + param);\r\n\t\t\t\t\t\r\n\t\t\t\tswitch (step)\r\n\t\t\t\t{\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Pre treatment\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'notSupported':\r\n\t\t\t\t\tcase 'preAlert':\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'start');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif ((dataIHM.getUAInfos().configSupported) || (step == 'preAlert')) this.displayInstruction(true, 'preAlert');\r\n\t\t\t\t\t\telse this.displayInstruction(true, 'notSupported');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Manual Installation XPI\r\n\t\t\t\t\t// Suggestion of installation\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'manualInstallXPI':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'KO');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'manualInstallXPI');\r\n\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// XPI Installation\r\n\t\t\t\t\t// Installation process\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'XPI':\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'restartAlertXPI');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar params = {\r\n\t\t\t\t\t\t\t\t\"Installer l'Extension Cryptolib CPS\": \r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tURL: param.URL,\r\n\t\t\t\t\t\t\t\t\tIconURL: param.IconURL,\r\n\t\t\t\t\t\t\t\t\tHash: param.Hash,\r\n\t\t\t\t\t\t\t\t\ttoString: function () { return this.URL; }\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t};\r\nconsole.log(params);\r\n\t\t\t\t\t\tInstallTrigger.install(params);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// Diagnostic\r\n\t\t\t\t\t// Start\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'startDiag':\r\n\t\t\t\t\t\tthis.initRetry();\r\n\t\t\t\t\t\tthis.initTimer();\r\n\r\n\t\t\t\t\t\tthis.displayWait(true);\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'inProgress');\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tdataIHM.readClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.startTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// Diagnostic\r\n\t\t\t\t\t// Restart\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'restartDiag':\r\n\r\n\t\t\t\t\t\tdataIHM.resetClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\r\n\t\t\t\t\t//==========================\r\n\t\t\t\t\t// Progression\r\n\t\t\t\t\t//--------------------------\r\n\t\t\t\t\tcase 'inProgress':\r\n\t\t\t\t\t\t//dataIHM.readClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// this.displayDiagnosticState(true, 'inProgress');\r\n\t\t\t\t\t\t// this.displayInstruction(false);\r\n\t\t\t\t\t\t// this.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//===================\r\n\t\t\t\t\t// Ends\r\n\t\t\t\t\t//-------------------\r\n\t\t\t\t\tcase 'endDiagWithSuccess':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'OK');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tthis.displaySupport(false);\r\n\t\t\t\t\t\tthis.displayInfosCPS(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Manual Installation Cryptolib CPS\r\n\t\t\t\t\t// Suggestion of installation\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'manualInstallClibCPS':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'KO');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'manualInstallClibCPS');\r\n\t\t\t\t\t\tthis.displaySupport(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//=======================\r\n\t\t\t\t\t// Cryptolib CPS download\r\n\t\t\t\t\t// Installation process\r\n\t\t\t\t\t//-----------------------\r\n\t\t\t\t\tcase 'CryptolibCPS':\r\n\t\t\t\t\t\twindow.location = dataIHM.getServerComponentLink();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// Direct jump to Retry after installation\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'restartAlert');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\t\r\n\t\t\t\t\t//=========================\r\n\t\t\t\t\t// Other\r\n\t\t\t\t\t// Close Instruction screen\r\n\t\t\t\t\t//-------------------------\r\n\t\t\t\t\tcase 'exitInstruction':\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true);\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t// Open Support link\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'openSupport':\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tif (param !== undefined) window.open(param.URL,'_blank');\r\n\t\t\t\t\t\tbreak;\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.lastState = step;\r\n\t\t\t},\r\n\t\r\n\t//==========================\r\n\t// Screen Display Management\r\n\tdisplayElementById: function(id, display) {\r\n\t\t\t\t\t\t\tdocument.getElementById(id).style.display = display;\r\n\t\t\t\t\t\t},\r\n\thideElementById: function(id) {\r\n\t\t\t\t\t\t\tthis.displayElementById(id, \"none\");\r\n\t\t\t\t\t\t},\r\n\tdisplayInit: function(OSName) {\r\n\t\t\t\t\t\t// Events initialization\r\n\t\t\t\t\t\t//----------------------\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"cryptolib\", \t\t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"notSupported\", \t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"startDiag\", \t\t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"instructions-back\", \t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"infos_cps_caption\", \t\"click\", clickExpandCollapse);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// PreAlert initialization\r\n\t\t\t\t\t\t//------------------------\r\n\t\t\t\t\t\tthis.displayPreAlert(OSName);\r\n\t\t\t\t\t},\r\n\tdisplayInfosCPS: function (active) {\r\n\t\t\t\t\t\t\tvar infos_cps_tbody = '';\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar detailedInformations = dataIHM.getClientDetailedInfos();\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tfor (var item in detailedInformations) {\r\n\t\t\t\t\t\t\t\tinfos_cps_tbody += '<tr><td class=\"key\">' + item + '</td><td class=\"val\">' + detailedInformations[item] + '</td></tr>';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cps').className = dataIHM.getClientSSLInfos().div_cps_class;\r\n\r\n\t\t\t\t\t\t\t\tfor (var item in dataIHM.getClientSSLInfos().infos) {\r\n\t\t\t\t\t\t\t\t\tinfos_cps_tbody += '<tr><td class=\"key\">' + item + '</td><td class=\"val\">' + dataIHM.getClientSSLInfos().infos[item] + '</td></tr>';\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cps').className = \"cpsverso\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tdocument.getElementById('infos_cps_tbody').innerHTML = infos_cps_tbody;\r\n\t\t\t\t\t\t},\r\n\r\n\tdisplayWait:function (active) {\r\n\t\t\t\t\tif ( (active)\r\n\t\t\t\t\t\t&& (wizardStateMachine.nbRetry > 0) ) {\r\n\t\t\t\t\t\tthis.displayElementById('spin', \"flex\");\r\n\t\t\t\t\t\tdocument.getElementById('retry').innerHTML = wizardStateMachine.nbRetry;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.hideElementById('spin');\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\tdisplayDiagnosticState:function (active, state) {\r\n\t\t\t\t\t\t\t\tdiagStateContent = {\r\n\t\t\t\t\t\t\t\t\t'start':{content:'Cliquer sur la carte', style:'diagState diagStart'}\r\n\t\t\t\t\t\t\t\t\t, 'inProgress':{content:'Le diagnostic est en cours', style:'diagState diagInProgress'}\r\n\t\t\t\t\t\t\t\t\t, 'KO':{content:'Le diagnostic a &eacute;chou&eacute;', style:'diagState diagKO'}\r\n\t\t\t\t\t\t\t\t\t, 'OK':{content:'Le diagnostic a r&eacute;ussi', style:'diagState diagOK'}\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.hideElementById('diagState');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').style.display = \"block\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif (state !== undefined) {\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').className = diagStateContent[state].style;\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').innerHTML = diagStateContent[state].content;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\r\n\tdisplayInstruction: function (active, step) {\r\n\t\t\t\t\t\t\tthis.hideElementById('instructions-back');\r\n\t\t\t\t\t\t\tthis.hideElementById('instructions');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\tthis.displayElementById('instructions-back', \"flex\");\r\n\t\t\t\t\t\t\t\tthis.displayElementById('instructions', \"block\");\r\n\t\t\t\t\t\t\t\tthis.hideElementById('manualInstallClibCPS');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('manualInstallXPI');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('restartAlert');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('restartAlertXPI');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('preAlert');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('notSupported');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('contactSupport');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (step !== undefined) this.displayElementById(step, \"block\");\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar detailedInformations = dataIHM.getClientDetailedInfos();\r\n\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cryptolib').innerHTML = \"T&eacute;l&eacute;charger<br/>\" + dataIHM.getComponentInstallerName();\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (dataIHM.getUAInfos().os.name == 'Mac OS')\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('restartInstruction').innerHTML = \"Une fois l'installation de \" + dataIHM.getComponentInstallerName() + \" termin&eacute;e,<br/>veuillez red&eacute;marrer votre ordinateur.\";\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('restartInstruction').innerHTML = \"Une fois l'installation de \" + dataIHM.getComponentInstallerName() + \" termin&eacute;e,<br/>veuillez red&eacute;marrer votre navigateur.\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\r\n\tdisplaySupport: function (active) {\r\n\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\tthis.displayElementById('support-direction', \"flex\");\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.hideElementById('support-direction');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\r\n\tdisplayPreAlert: function(OSName) {\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-MacOS');\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-Windows');\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-Linux');\r\n\r\n\t\t\t\t\t\t\tif (OSName == 'Mac OS') this.displayElementById('alert1-MacOS', 'block');\r\n\t\t\t\t\t\t\tif (OSName == 'Windows') this.displayElementById('alert1-Windows', 'block');\r\n\t\t\t\t\t\t\tif (OSName == 'Linux') this.displayElementById('alert1-Linux', 'block');\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\r\n};\r\n\r\n//==================\r\n// Events Management\r\nfunction addEltEventListenerAllBrowser(elt, eventName, handle) {\r\n\tif (elt.addEventListener) { elt.addEventListener(eventName, handle, false);\r\n\t} else { elt.attachEvent(\"on\" + eventName, handle);\r\n\t}\r\n}\r\n\r\nfunction addIdEventListenerAllBrowser(id, eventName, handle) {\r\n\tif (document.getElementById(id)) addEltEventListenerAllBrowser(document.getElementById(id), eventName, handle);\r\n}\r\n\r\nfunction clickExpandCollapse(event) {\r\n\tif (document.getElementById('infos_cps_table').style.display != \"block\") {\r\n\t\tdocument.getElementById('infos_cps_caption_img').className = \"infos_cps_caption_img_collapse\";\r\n\t\tdocument.getElementById('infos_cps_table').style.display = \"block\";\r\n\t} else {\r\n\t\tdocument.getElementById('infos_cps_caption_img').className = \"infos_cps_caption_img_expand\";\r\n\t\tdocument.getElementById('infos_cps_table').style.display = \"none\";\r\n\t}\r\n\tevent.cancelBubble = true;\r\n\t\t\r\n\treturn false;\r\n}\r\n\r\nfunction clickActionNoPropagation(event) {\r\n\t//this.click();\r\n\r\n\tevent.cancelBubble = true;\r\n\r\n\treturn false;\r\n}\r\n\n<!-- script : /js/wizarddiagcps.js End -->\n<!-- script : /js/diagcps.js Begin -->\n//==================================\r\n// Global variable used for all data \r\n// displayed on screen \r\n// or used by state machine\r\n//==================================\r\nvar dataIHM = {\r\n\t//==========================\r\n\t// Root URL\r\n\tlocalURL: '',\r\n\tsetLocalURL: function(URL) {this.localURL = URL;},\r\n\tgetLocalURL: function() {return this.localURL;},\r\n\t\r\n\t//==========================\r\n\t// User Agent\r\n\tclientUAInfos: null,\r\n\ttimerUAInfos: null,\r\n\tinitUAInfos: function() {\r\n\t\t\t\t\t\tvar uaparser = new UAParser();\r\n\t\t\t\t\t\tthis.clientUAInfos = uaparser.getResult();\r\n\t\t\t\t\t\tthis.clientUAInfos.browser.xpi = true;\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tthis.timerUAInfos = setTimeout(function(){dataIHM.isUAInfosCPSWebEx()}, 1000);\r\n\t\t\t\t\t},\r\n\tgetUAInfos: function() {return this.clientUAInfos},\r\n\tisUAInfosCPSWebEx: function() {\r\n\t\t\t\t\tif (window.isCpsWebExAlive) {\r\n\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', window.isCpsWebExAlive());\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (this.getUAInfos().browser.name == 'Firefox') {\r\n\t\t\t\t\t\t\tif (this.getUAInfos().browser.major > 57) {\r\n\t\t\t\t\t\t\t\tthis.clientUAInfos.browser.xpi = false;\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'absente');\r\n\t\t\t\t\t\t\t\twizardStateMachine.wizard('manualInstallXPI');\r\n\t\t\t\t\t\t\t} else if (this.getUAInfos().browser.major == 57) {\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'sur cette version, l\\'installation du p&eacute;riph&eacute;rique de s&eacute;curit&eacute; doit &ecirc;tre <a href=\"http://integrateurs-cps.asipsante.fr/Installation-manuelle-PKCS11-Firefox\" target=\"_blanck\">r&eacute;alis&eacute;e manuellement</a>.');\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'd&eacute;tection impossible sur cette version');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.timerUAInfos = null;\r\n\t\t\t\t},\r\n\t\r\n\t//===============================\r\n\t// Installed Component management\r\n\tcomponentName: \"CryptolibCPS\", // By default\r\n\tsetComponentName: function(name) {this.componentName = name;},\r\n\tgetComponentName: function() {return this.componentName;},\r\n\tcomponentVersion: \"\", // By Default\r\n\tsetcomponentVersion: function(version) {this.componentVersion = version;},\r\n\tgetcomponentVersion: function() {return this.componentVersion;},\r\n\tcomponentInstallerName: \"\",\r\n\tsetComponentInstallerName: function(name) {this.componentInstallerName = name;},\r\n\tgetComponentInstallerName: function() {return this.componentInstallerName;},\r\n\tserverComponentURL: null,\r\n\tsetServerComponentURL: function(URL) {this.serverComponentURL = URL;},\r\n\tgetServerComponentLink: function(version) {\r\n\t\t\t\t\t\t\t\t\tvar componentLink = this.serverComponentURL + \"?\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"component=\" + this.getComponentName();\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&os=\" + this.getUAInfos().os.name;\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&arch=\" + this.getUAInfos().cpu.architecture;\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&version=\" + this.getcomponentVersion();\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\treturn componentLink;\r\n\t\t\t\t\t\t\t\t},\r\n\tserverComponentInfos: null,\r\n\treadServerComponentInfos: function() {\r\n\t\t\t\t\t\t\t\t// XPI 6.0.15 with Firefox < 57\r\n\t\t\t\t\t\t\t\t// ==> Use Cryptolib CPS 5.0.37 instead of last release\r\n\t\t\t\t\t\t\t\tif ((this.getUAInfos().browser.name == 'Firefox') \r\n\t\t\t\t\t\t\t\t\t&& (this.getUAInfos().browser.major < 57)) {\r\n\t\t\t\t\t\t\t\t\tswitch (this.getUAInfos().os.name) {\r\n\t\t\t\t\t\t\t\t\t\tcase 'Windows': this.setcomponentVersion('5.0.37');break;\r\n\t\t\t\t\t\t\t\t\t\tcase 'Mac OS': this.setcomponentVersion('5.0.34');break;\r\n\t\t\t\t\t\t\t\t\t\tcase 'Linux':\r\n\t\t\t\t\t\t\t\t\t\tcase 'CentOS':\r\n\t\t\t\t\t\t\t\t\t\tcase 'Ubuntu':\r\n\t\t\t\t\t\t\t\t\t\tcase 'RedHat':  this.setcomponentVersion('5.0.12');break;\r\n\t\t\t\t\t\t\t\t\t\tdefault:break;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// Use fetch if exist\r\n\t\t\t\t\t\t\t\tif (self.fetch) {\r\n\t\t\t\t\t\t\t\t\tfetch( this.getServerComponentLink() + '&filename=get' )\r\n\t\t\t\t\t\t\t\t\t.then(function(resp) {return resp.json();})\r\n\t\t\t\t\t\t\t\t\t.then(function(response) {\r\n\t\t\t\t\t\t\t\t\t\tfor (var k in response) {\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.setComponentInstallerName(response[k]);\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.addClientDetailedInfos('URL de t&eacute;l&eacute;chargement', '<a href=\"' + dataIHM.getServerComponentLink() + '\">' + dataIHM.getComponentInstallerName() + '</a>');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('readServerComponentInfos : Error with fetch (' + error.message + ')'); \r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t// Use JQuery\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$.ajax(\t{\r\n\t\t\t\t\t\t\t\t\t\turl: this.getServerComponentLink() + '&filename=get'\r\n\t\t\t\t\t\t\t\t\t\t, success: function( data) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar json;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (data === String)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson = jQuery.parseJSON(data);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson = data\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor (var k in json) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setComponentInstallerName(json[k]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.addClientDetailedInfos('URL de t&eacute;l&eacute;chargement', '<a href=\"' + dataIHM.getServerComponentLink() + '\">' + dataIHM.getComponentInstallerName() + '</a>');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t, error: function( data) { return null;}\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\r\n\t//========================================\r\n\t// Support contact informations management\r\n \tmailSupportMailbox: null,\r\n\tmailSupportDomain: null,\r\n\tsetMailSupport: function(mailbox, domain) {this.mailSupportMailbox = mailbox; this.mailSupportDomain = domain;},\r\n\tgetMailSupport: function() {return this.mailSupportMailbox + \"@\" + this.mailSupportDomain;},\r\n \t\t\r\n\t//==========================\r\n\t// Detailed informations\r\n\tclientDetailedInfos: {},\r\n\tinitClientDetailedInfos: function() {\r\n\t\t\t\t\t\t\t\tconfigSupported = true;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.getUAInfos().device.type === undefined) {\r\n\t\t\t\t\t\t\t\t\tconsole.log(\"Poste de travail\");\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tconfigSupported = false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().os.name) {\r\n\t\t\t\t\t\t\t\t\tcase 'Windows':\r\n\t\t\t\t\t\t\t\t\tcase 'Mac OS':\r\n\t\t\t\t\t\t\t\t\tcase 'Linux':\r\n\t\t\t\t\t\t\t\t\tcase 'CentOS':\r\n\t\t\t\t\t\t\t\t\tcase 'Ubuntu':\r\n\t\t\t\t\t\t\t\t\tcase 'RedHat':  configSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault: \t\tconfigSupported = configSupported & false;break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().browser.name) {\r\n\t\t\t\t\t\t\t\t\tcase 'IE':\r\n\t\t\t\t\t\t\t\t\tcase 'Safari':\r\n\t\t\t\t\t\t\t\t\tcase 'Edge':\r\n\t\t\t\t\t\t\t\t\tcase 'Chrome':\r\n\t\t\t\t\t\t\t\t\tcase 'Firefox':\tconfigSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault: \t\tconfigSupported = configSupported & false;break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().cpu.architecture) {\r\n\t\t\t\t\t\t\t\t\tcase 'ia32':\r\n\t\t\t\t\t\t\t\t\tcase 'i686':\r\n\t\t\t\t\t\t\t\t\tcase 'amd64': configSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\t\tif (this.getUAInfos().cpu.architecture === undefined)\r\n\t\t\t\t\t\t\t\t\t\t\tconfigSupported = configSupported & true;\r\n\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\tconfigSupported = configSupported & false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.getUAInfos().cpu.architecture == 'amd64')\r\n\t\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Syst&egrave;me d\\'exploitation', this.getUAInfos().os.name + \" \" + this.getUAInfos().os.version + \" (64b)\");\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Syst&egrave;me d\\'exploitation', this.getUAInfos().os.name + \" \" + this.getUAInfos().os.version);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Navigateur', this.getUAInfos().browser.name + \" \" + this.getUAInfos().browser.major);\r\n\t\t\t\t\t\t\t\t// this.addClientDetailedInfos('Compatibilit&eacute; ASIP', '<a href=\"http://integrateurs-cps.asipsante.fr/Lettre_d_information\" target=\"_blanck\">Lettre d\\'information<br/>POSTE DE TRAVAIL & Veille Technologique</a>');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.clientUAInfos.configSupported = configSupported;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\treturn configSupported;\r\n\t\t\t\t\t\t\t},\r\n\tgetClientDetailedInfos: function() {return this.clientDetailedInfos;},\r\n\taddClientDetailedInfos: function(key, value) { this.clientDetailedInfos[key] = value;},\r\n\tresetClientDetailedInfos: function() {this.clientDetailedInfos = {};},\r\n\t\t\r\n\t//==========================\r\n\t// Client SSL Informations\r\n\tclientSSLInfos: null,\r\n\tclientSSLFetchParameters: { mode:'cors', credentials: 'include', cache: 'no-cache'},\r\n\tclientSSLAjaxParameters: { cache: false, timeout: 8000, async: true},\r\n\tisDefineClientSSLInfos: function() {return (this.clientSSLInfos != undefined);},\r\n\tsetClientSSLInfos: function(data) {this.clientSSLInfos = data;},\r\n\tgetClientSSLInfos: function() {return this.clientSSLInfos;},\r\n\tinitClientSSLParameters: function() { $.ajaxSetup(this.clientSSLAjaxParameters);},\r\n\tresetClientSSLInfos: function () {\r\n\t\t\t\t\t\t\tconsole.log('resetClientSSLInfos : Erase SSL Connexion cache for ' + this.getUAInfos().browser.name);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tswitch (this.getUAInfos().browser.name) {\r\n\t\t\t\t\t\t\t\tcase 'Edge': // Works !\r\n\t\t\t\t\t\t\t\tcase 'IE': // Works !\r\n\t\t\t\t\t\t\t\t\tif (document.execCommand) document.execCommand( \"ClearAuthenticationCache\", \"false\");\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 'Firefox':\t// Works !\r\n\t\t\t\t\t\t\t\t\t//location.reload(); // Works !\r\n\t\t\t\t\t\t\t\t\tif (window.crypto) if (window.crypto.logout) window.crypto.logout(); // Works !\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 'Chrome': // Works !\r\n\t\t\t\t\t\t\t\tcase 'Safari': // Not working, restart Browser needed !\r\n\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag'); \r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\treadClientSSLInfos: function() {\r\n\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : SSL Connexion' );\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// Use fetch if exist\r\n\t\t\t\t\t\t\tif (self.fetch) {\r\n\t\t\t\t\t\t\t\t// Try to connect and get CPS informations\r\n\t\t\t\t\t\t\t\tfetch( '/visuel.php', this.clientSSLFetchParameters )\r\n\t\t\t\t\t\t\t\t.then(function(resp) {return resp.json();})\r\n\t\t\t\t\t\t\t\t.then(function(resp_json) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Success with Fetch');\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t// traitement du JSON\r\n\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(resp_json);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('endDiagWithSuccess');\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t// Case of SSL Error\r\n\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Probably SSL Error with fetch (' + error.message + ')');\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(null);\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.accelerateTimer();\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t// Use JQuery\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$.ajax(\t{\r\n\t\t\t\t\t\t\t\t\turl: 'visuel.php'\r\n\t\t\t\t\t\t\t\t\t, success: function(data, textStatus) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Success with Ajax (' + textStatus + ')');\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tif (data === String)\r\n\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(jQuery.parseJSON(data));\r\n\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(data);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('endDiagWithSuccess');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t, error: function(data, textStatus) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Probably SSL Error with Ajax (' + textStatus + ')');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(null);\r\n\t\t\t\t\t\t\t\t\t\t\twizardStateMachine.accelerateTimer();\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n}\r\n\r\n//=====\r\n// Main\r\n//=====\r\n$(function() {\r\n\t// Initialization\r\n\t//---------------\r\n\tdataIHM.initUAInfos(); // User Agent\r\n\t\r\n\tdataIHM.initClientSSLParameters();\r\n\t\r\n\t// Sp�cific parameter with no good solution @29/12/2017\r\n\tswitch (dataIHM.getUAInfos().browser.name) {\r\n\t\tcase 'IE':\r\n\t\t\tconsole.log('=========== Use Ajax =============');\r\n\t\t\tself.fetch = undefined;\r\n\t\t\tbreak;\r\n\t\tcase 'Edge':\r\n\t\tcase 'Firefox':\r\n\t\tcase 'Safari':\r\n\t\tdefault:\r\n\t\t\tconsole.log('=========== Try using fetch. If not available use Ajax =============');\r\n\t\t\tbreak;\r\n\t}\r\n\t\r\n\tdataIHM.initClientDetailedInfos(); // Informations in bottom\r\n\tdataIHM.readServerComponentInfos(); // Get from informations from Web Service\r\n\t\r\n\twizardStateMachine.startWizard(); // Start Wizard\r\n\t\t\r\n\twizardStateMachine.displayInit(dataIHM.getUAInfos().os.name);\r\n});\r\n\n<!-- script : /js/diagcps.js End -->\n\n</script>\n<script type=\"text/javascript\">\n\t// Initialization Javascript from PHP\n\tdataIHM.setComponentName('CryptolibCPS');\n\tdataIHM.setServerComponentURL('download.php');\n</script>\n<!--<div id=\"beta\"></div>-->\n<div id=\"instructions-back\" onclick=\"wizardStateMachine.wizard('exitInstruction');\">\n\t<div id=\"instructions\">\n\t\n\t\t<div class=\"screen\" id=\"preAlert\">\n\t\t\t<div class=\"instruction\"><br/>\n<h1>Assistance en cas de carte CPS non lue</h1>\n\n<h2>Pr&eacute;alablement</h2>\n<p>\nVeuillez v&eacute;rifier que votre carte est bien ins&eacute;r&eacute;e dans votre lecteur de carte ou votre terminal Vitale.<br/>\nPuis v&eacute;rifier que votre lecteur de carte ou votre terminal Vitale est correctement connect&eacute; &agrave; votre ordinateur.<br/>\n<br/>\nLa carte ins&eacute;r&eacute;e dans le lecteur doit &ecirc;tre la derni&egrave;re carte active.\n\n<table >\n\t<tr>\n\t\t<td style=\"border-top:none;\"><img src=\"images/informations32.png\" alt=\"Information :\"/></td>\n\t\t<td style=\"border-top:none;\"><i>La derni&egrave;re carte active pr&eacute;sente la date d'expiration la plus &eacute;loign&eacute;e.</i></td>\n\t</tr>\n</table>\n<br/>\nUne fois cette v&eacute;rification r&eacute;alis&eacute;e, v&eacute;rifiez que la carte est bien lue.<br/>\n</p>\n\n<div id=\"alert1-MacOS\">\n<h2>Votre ordinateur est sous Mac OS</h2>\n<p>\nSur votre syst&egrave;me d'exploitation, nous ne disposons pas de m&eacute;thode particuli&egrave;re pour v&eacute;rifier si votre carte est lue.<br/>\n<br/>\nVeuillez lancer un diagnostic de votre ordinateur et proc&eacute;der &agrave; l'installation des mises &agrave; jour sugg&eacute;r&eacute;es.<br/>\n</p>\n</div>\n\n<div id=\"alert1-Linux\">\n<h2>Votre ordinateur est sous Linux</h2>\n<p>\nSur votre syst&egrave;me d'exploitation, nous ne disposons pas de m&eacute;thode particuli&egrave;re pour v&eacute;rifier si votre carte est lue.<br/>\n<br/>\nVeuillez lancer un diagnostic de votre ordinateur et proc&eacute;der &agrave; l'installation des mises &agrave; jour sugg&eacute;r&eacute;es.<br/>\n</p>\n</div>\n\n<div id=\"alert1-Windows\">\n<h2>Votre ordinateur est sous Windows</h2>\n<b>Dans la barre des t&acirc;ches, une carte lue est signal&eacute;e par <img src=\"images/preHelper/iconeOK.png\" alt=\"Icone vert dans la barre des taches\" /> et une carte non lue par <img src=\"images/preHelper/iconeKO.png\" alt=\"Icone rouge dans la barre des taches\"/>.</b><br/>\n<h3>L'ic&ocirc;ne <img src=\"images/preHelper/iconeOK.png\" alt=\"Icone vert dans la barre des taches\"/> est introuvable</h3>\n<p>\nCliquez avec le clic droit de votre souris sur le bouton &laquo;Afficher les ic&ocirc;nes&raquo; (en bas &agrave; droite de votre &eacute;cran) ou sur la zone heure et date et selectionnez &laquo;Personnaliser les ic&ocirc;nes de notification&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/notificationsBar.png\" alt=\"Barre de notification\"/></div>\n<br/>\n<br/>\nCherchez l'ic&ocirc;ne &laquo;Gestionnaire de certificats CPS&raquo; et s&eacute;lectionnez &laquo;Afficher l'ic&ocirc;ne et les notifications&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/notificationsParameters.png\" alt=\"Parametres de notifications\"/></div>\n<br/>\nUne fois la manipulation r&eacute;alis&eacute;e vous devriez voir apparaitre l'ic&ocirc;ne (en bas &agrave; droite de votre &eacute;cran).<br/>\n<br/>\nSi l'ic&ocirc;ne n'apparait pas dans la liste, lancer le diagnostic de votre ordinateur et installez les mises &agrave; jour propos&eacute;es.<br/>\n<br/>\n</p>\n<h2>L'ic&ocirc;ne <img src=\"images/preHelper/iconeKO.png\" alt=\"Icone rouge dans la barre des taches\" /> est rouge</h2>\n<p>\nSi l'ic&ocirc;ne est encadr&eacute;e de rouge (carte non lue), assurez-vous que votre carte est bien ins&eacute;r&eacute;e dans votre lecteur, rafra&icirc;chissez le lecteur en cliquant sur l'ic&ocirc;ne avec le bouton droit de la souris. Et cliquez sur &laquo;Rafra&icirc;chir&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/rightClickCCM.png\" alt=\"Cliquer droit sur l'icone du CCM\" /></div>\n<br/>\nSi l'encadr&eacute; reste rouge apr&egrave;s la manipulation, red&eacute;marrez votre ordinateur en laissant le lecteur et la CPS connect&eacute;s.<br/>\n<br/>\nApr&egrave;s ces manipulations, si l'ic&ocirc;ne ne passe pas au vert, veuillez nous contacter.\n</p>\n<div align=\"center\"></div>\n</div>\n\n</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"startDiag\" onclick=\"wizardStateMachine.wizard('startDiag');\">Diagnostiquer mon poste</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"notSupported\">\n\t\t\t<div class=\"instruction\">Votre configuration mat&eacute;riel et/ou syst&egrave;me n'est pas support&eacute;e par nos composants logiciels. Nous ne garantissons pas le succès du diagnostic.</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"notSupported\" onclick=\"wizardStateMachine.wizard('preAlert');\">Continuer</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"manualInstallXPI\">\n\t\t\t<div class=\"instruction\" id=\"xpi_instruction\" >L'Extension Firefox n'a pas &eacute;t&eacute; d&eacute;tect&eacute;e. Elle est indispensable sous ce navigateur.<br/>Apr&egrave;s l'installation, veuillez red&eacute;marrer votre navigateur.</div>\n\t\t\t<div class=\"actions\">\n<!--\t\t\t\t<div class=\"action instruction\" id=\"xpi\" onclick=\"wizardStateMachine.wizard('XPI',{URL:'https://diagcps.eservices.esante.gouv.fr/ODI_PS/php/download_asip.php?installeur=url_interne_xpi_installation_pkcs11',IconURL:'https://diagcps.eservices.esante.gouv.fr/ODI_PS/images/asip_sante.png',Hash:'sha256:c23de3812aaf7c3a81d80e9bdf891c3e2b621e01e55e8d308226fd86ab6ef438'});\">Installer<br/>l'Extension Firefox</div>-->\n<div class=\"action instruction\" id=\"xpi\" onclick=\"wizardStateMachine.wizard('XPI',{URL:'/download.php?component=xpi',IconURL:'/images/asip_sante.png',Hash:'sha256:c23de3812aaf7c3a81d80e9bdf891c3e2b621e01e55e8d308226fd86ab6ef438'});\">Installer<br/>l'Extension Firefox</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"restartAlertXPI\">\n\t\t\t<div class=\"instruction\" id=\"restartInstructionXPI\" >Une fois l'installation de l'Extension Cryptolib CPS termin&eacute;e,<br/>veuillez red&eacute;marrer votre navigateur.</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"manualInstallClibCPS\">\n\t\t\t<div class=\"instruction\">Si vous avez ins&eacute;r&eacute; votre CPS dans votre lecteur sans succ&egrave;s, la version de Cryptolib CPS de votre poste de travail n'est peut-&ecirc;tre pas &agrave; jour.</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"cryptolib\" onclick=\"wizardStateMachine.wizard('CryptolibCPS');\">T&eacute;l&eacute;charger<br/>Cryptolib CPS</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"restartAlert\">\n\t\t\t<div class=\"instruction\" id=\"restartInstruction\" >Une fois l'installation de CryptolibCPS_vX.Y.Z termin&eacute;e, veuillez red&eacute;marrer votre navigateur.</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"contactSupport\">\n\t\t\t<div class=\"instruction\">Si vous avez installez le composant propos&eacute; sans succ&eacute;s,<br/> veuillez contacter le Support.</div>\n\t\t</div>\n\t\t\n\t</div>\n</div>\t\n<div id=\"service-direction\" class=\"column\"></div>\n<div id=\"article\">\n\t<div id=\"center\">\n\t\t<div class=\"diagState\" id=\"diagState\"></div>\n\t\t<div>\n\t\t\t<div id=\"cps\" class=\"cpsverso\" onclick=\"wizardStateMachine.wizard('restartDiag');\"><div id=\"spin\"><div id=\"retry\"></div></div></div>\n\t\t</div>\n<!--\t\t\n\t\t<div id=\"results\">\n\t\t\t<div>\n\t\t\t\t<div class=\"sign\" id=\"certificat\"></div>\n\t\t\t\t<div class=\"sign\" id=\"expired\" title=\"expire\"></div>\n\t\t\t\t<div class=\"sign\" id=\"revoc\" title=\"revoque\"></div>\n\t\t\t\t<div class=\"sign\" id=\"class\"></div>\n\t\t\t\t<div class=\"sign\" id=\"rootAC\"></div>\n\t\t\t\t<div class=\"sign\" id=\"cryptolib\" title=\"cryptolib\"></div>\n\t\t\t</div>\n\t\t</div>\n-->\n\t\t<div id=\"cps_infos\">\n\t\t\t<div id=\"infos_cps\">\n\t\t\t\t<div id=\"infos_cps_caption\"><div>Informations d&eacute;taill&eacute;es</div><div class=\"infos_cps_caption_img_expand\" id=\"infos_cps_caption_img\"></div></div>\n\t\t\t\t<table id=\"infos_cps_table\">\n\t\t\t\t\t<tbody id=\"infos_cps_tbody\"></tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n<div id=\"support-direction\" class=\"column\"></div>\n</div>\r\n<div id=\"footer\" style=\"display:flex;flex-direction:row\">\r\n    <div style=\"display:flex;flex-direction:row;width:30vw\">\r\n        <div style=\"margin:20px\">\r\n            <a href=\"https://solidarites-sante.gouv.fr/\" target=\"_blank\">\r\n                <img src=\"./images/logo-ministere.svg\" alt=\"Ministère des Solidarités et de la santé\" width=\"84\" height=\"62\">\r\n            </a>\r\n        </div>\r\n        <div style=\"margin:20px\">\r\n            <a href=\"https://esante.gouv.fr/\" target=\"_blank\">\r\n                <img src=\"./images/logo-ANS.svg\" alt=\"Agence du Numérique en Santé\" width=\"166\" height=\"50\">\r\n            </a>\r\n        </div>\r\n    </div>\r\n    <div style=\"width:60vw\">\r\n        <ul style=\"align-items:end\">\r\n            <li><a href=\"http://esante.gouv.fr/services/mentions-legales\" target=\"_blank\">Mentions l&eacute;gales</a></li>\r\n            <li><a href=\"./copyright.php\" target=\"_blank\" title=\"Copyright [nouvelle fen&ecirc;tre]\">Copyright</a></li>\r\n        </ul>\r\n    </div>\r\n</div>\r\n\r\n</body>\r\n</html>\r\n",
      "ip": "135.125.232.117",
      "timestamp": "2025-03-14T16:26:19.50648044Z",
      "curl-command": "curl -X 'GET' -H 'Accept: */*' -H 'Accept-Language: en' -H 'User-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)' 'https://diagcps.eservices.esante.gouv.fr'",
      "matcher-status": true
    },
    {
      "template": "http/misconfiguration/http-missing-security-headers.yaml",
      "template-url": "https://templates.nuclei.sh/public/http-missing-security-headers",
      "template-id": "http-missing-security-headers",
      "template-path": "/home/runner/nuclei-templates/http/misconfiguration/http-missing-security-headers.yaml",
      "info": {
        "name": "HTTP Missing Security Headers",
        "author": [
          "socketz",
          "geeknik",
          "g4l1t0",
          "convisoappsec",
          "kurohost",
          "dawid-czarnecki",
          "forgedhallpass",
          "jub0bs",
          "userdehghani"
        ],
        "tags": [
          "misconfig",
          "headers",
          "generic"
        ],
        "description": "This template searches for missing HTTP security headers. The impact of these missing headers can vary.\n",
        "severity": "info",
        "metadata": {
          "max-request": 1
        }
      },
      "matcher-name": "permissions-policy",
      "type": "http",
      "host": "https://diagcps.eservices.esante.gouv.fr",
      "matched-at": "https://diagcps.eservices.esante.gouv.fr",
      "request": "GET / HTTP/1.1\r\nHost: diagcps.eservices.esante.gouv.fr\r\nUser-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)\r\nConnection: close\r\nAccept: */*\r\nAccept-Language: en\r\nAccept-Encoding: gzip\r\n\r\n",
      "response": "HTTP/1.1 200 OK\r\nConnection: close\r\nTransfer-Encoding: chunked\r\nContent-Type: text/html; charset=UTF-8\r\nDate: Fri, 14 Mar 2025 16:26:19 GMT\r\nServer: Apache/2.4.37 (centos) OpenSSL/1.1.1g\r\nX-Powered-By: PHP/7.2.24\r\n\r\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n\t<title>DiagCPS, Outil de Diagnostic SSL</title>\r\n\t<meta http-equiv=\"Content-type\" content=\"text/html; charset=UTF-8\" />\r\n\t<meta name=\"description\" content=\"DiagCPS est un Outil de Diagnostic de l'authentification en ligne à l'aide d'une Carte de Professionnel de Santé, i.e. CPS. Il est fourni par l'ASIP Santé et remplace ODI.\" />\r\n\t<meta name=\"Publisher\" content=\"ASIP Santé\" />\r\n\t<meta name=\"copyright\" content=\"Tous droits réservés - ASIP Santé\" />\r\n\t<link rel=\"shortcut icon\" href=\"./images/favicon.ico\" type=\"image/x-icon\" />\r\n\t<link rel=\"stylesheet\" href=\"diagcps_css.php\" />\r\n\t<script src=\"./js/jquery-3.2.0.min.js\"></script>\r\n\t<script src=\"./js/ua-parser.min.js\"></script>\r\n</head>\r\n<body>\r\n<div id=\"header\" style=\"display:flex;flex-direction:row\">\r\n    <div style=\"margin:20px\">\r\n        <a href=\"https://solidarites-sante.gouv.fr/\" target=\"_blank\">\r\n            <img src=\"./images/logo-ministere.svg\" alt=\"Ministère des Solidarités et de la santé\" width=\"168\" height=\"104\">\r\n        </a>\r\n    </div>\r\n\t<div id=\"title\">esante.gouv.fr</div>\r\n</div>\r\n<div id=\"section\">\r\n<script type=\"text/javascript\">\n\n<!-- script : /js/wizarddiagcps.js Begin -->\n//==================================\r\n// Global variable used for state machine management \r\n// displayed on screen \r\n// or used by state machine\r\n//==================================\r\nvar wizardStateMachine = {\r\n\tstartState: 'notSupported',\r\n\tlastState: 'notSupported',\r\n\t\r\n\t//=================\r\n\t// Retry Management\r\n\t// Variables\r\n\tnbMaxRetry: 10,\r\n\tnbRetry: 0,\r\n\t\r\n\t// Management\r\n\tinitRetry: function() {this.nbRetry = this.nbMaxRetry;},\r\n\tisMaxRetry: function() {return (this.nbRetry >= this.nbMaxRetry);},\r\n\tisMinRetry: function() {return (this.nbRetry <= 0);},\r\n\tdecRetry: function() {this.nbRetry--;},\r\n\tdisplayRetry: function() {\r\n\t\t\t\t\t\t\t\t//console.log(\"displayRetry : nbRetry = \" + this.nbRetry);\r\n\t\t\t\t\t\t\t\tthis.decRetry();\r\n\t\t\t\t\t\t\t\tthis.stopTimers(); \r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.isMinRetry()\r\n\t\t\t\t\t\t\t\t\t&& \t(this.lastState != 'endDiagWithSuccess')) {\r\n\t\t\t\t\t\t\t\t\tthis.wizard('manualInstallClibCPS');\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tthis.displayWait(true);\r\n\t\t\t\t\t\t\t\t\tthis.startTimers();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\r\n\t//==================\r\n\t// Timers Management\r\n\ttimerTestSSL: null,\r\n\tretryTimeoutKO: 1000,\r\n\tinitTimer: function () {this.retryTimeoutKO = 1000;},\r\n\taccelerateTimer: function () {this.retryTimeoutKO = 250;},\r\n\tstopTimers: function() {\r\n\t\t\t\t\t\t\t\tif (this.timerTestSSL != null)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tclearTimeout(this.timerTestSSL);\r\n\t\t\t\t\t\t\t\t\tthis.timerTestSSL = null;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\tstartTimers: function() {this.timerTestSSL = setTimeout(function(){wizardStateMachine.displayRetry()}, this.retryTimeoutKO);},\r\n\t\r\n\t//=======\r\n\t// Wizard\r\n\tstartWizard: function() {this.wizard(this.startState);},\r\n\twizard: function(step, param) {\r\n\t\t\t\tconsole.log(\"wizard : step = \" + step + \", param = \" + param);\r\n\t\t\t\t\t\r\n\t\t\t\tswitch (step)\r\n\t\t\t\t{\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Pre treatment\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'notSupported':\r\n\t\t\t\t\tcase 'preAlert':\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'start');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif ((dataIHM.getUAInfos().configSupported) || (step == 'preAlert')) this.displayInstruction(true, 'preAlert');\r\n\t\t\t\t\t\telse this.displayInstruction(true, 'notSupported');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Manual Installation XPI\r\n\t\t\t\t\t// Suggestion of installation\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'manualInstallXPI':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'KO');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'manualInstallXPI');\r\n\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// XPI Installation\r\n\t\t\t\t\t// Installation process\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'XPI':\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'restartAlertXPI');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar params = {\r\n\t\t\t\t\t\t\t\t\"Installer l'Extension Cryptolib CPS\": \r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tURL: param.URL,\r\n\t\t\t\t\t\t\t\t\tIconURL: param.IconURL,\r\n\t\t\t\t\t\t\t\t\tHash: param.Hash,\r\n\t\t\t\t\t\t\t\t\ttoString: function () { return this.URL; }\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t};\r\nconsole.log(params);\r\n\t\t\t\t\t\tInstallTrigger.install(params);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// Diagnostic\r\n\t\t\t\t\t// Start\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'startDiag':\r\n\t\t\t\t\t\tthis.initRetry();\r\n\t\t\t\t\t\tthis.initTimer();\r\n\r\n\t\t\t\t\t\tthis.displayWait(true);\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'inProgress');\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tdataIHM.readClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.startTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// Diagnostic\r\n\t\t\t\t\t// Restart\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'restartDiag':\r\n\r\n\t\t\t\t\t\tdataIHM.resetClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\r\n\t\t\t\t\t//==========================\r\n\t\t\t\t\t// Progression\r\n\t\t\t\t\t//--------------------------\r\n\t\t\t\t\tcase 'inProgress':\r\n\t\t\t\t\t\t//dataIHM.readClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// this.displayDiagnosticState(true, 'inProgress');\r\n\t\t\t\t\t\t// this.displayInstruction(false);\r\n\t\t\t\t\t\t// this.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//===================\r\n\t\t\t\t\t// Ends\r\n\t\t\t\t\t//-------------------\r\n\t\t\t\t\tcase 'endDiagWithSuccess':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'OK');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tthis.displaySupport(false);\r\n\t\t\t\t\t\tthis.displayInfosCPS(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Manual Installation Cryptolib CPS\r\n\t\t\t\t\t// Suggestion of installation\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'manualInstallClibCPS':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'KO');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'manualInstallClibCPS');\r\n\t\t\t\t\t\tthis.displaySupport(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//=======================\r\n\t\t\t\t\t// Cryptolib CPS download\r\n\t\t\t\t\t// Installation process\r\n\t\t\t\t\t//-----------------------\r\n\t\t\t\t\tcase 'CryptolibCPS':\r\n\t\t\t\t\t\twindow.location = dataIHM.getServerComponentLink();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// Direct jump to Retry after installation\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'restartAlert');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\t\r\n\t\t\t\t\t//=========================\r\n\t\t\t\t\t// Other\r\n\t\t\t\t\t// Close Instruction screen\r\n\t\t\t\t\t//-------------------------\r\n\t\t\t\t\tcase 'exitInstruction':\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true);\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t// Open Support link\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'openSupport':\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tif (param !== undefined) window.open(param.URL,'_blank');\r\n\t\t\t\t\t\tbreak;\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.lastState = step;\r\n\t\t\t},\r\n\t\r\n\t//==========================\r\n\t// Screen Display Management\r\n\tdisplayElementById: function(id, display) {\r\n\t\t\t\t\t\t\tdocument.getElementById(id).style.display = display;\r\n\t\t\t\t\t\t},\r\n\thideElementById: function(id) {\r\n\t\t\t\t\t\t\tthis.displayElementById(id, \"none\");\r\n\t\t\t\t\t\t},\r\n\tdisplayInit: function(OSName) {\r\n\t\t\t\t\t\t// Events initialization\r\n\t\t\t\t\t\t//----------------------\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"cryptolib\", \t\t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"notSupported\", \t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"startDiag\", \t\t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"instructions-back\", \t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"infos_cps_caption\", \t\"click\", clickExpandCollapse);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// PreAlert initialization\r\n\t\t\t\t\t\t//------------------------\r\n\t\t\t\t\t\tthis.displayPreAlert(OSName);\r\n\t\t\t\t\t},\r\n\tdisplayInfosCPS: function (active) {\r\n\t\t\t\t\t\t\tvar infos_cps_tbody = '';\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar detailedInformations = dataIHM.getClientDetailedInfos();\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tfor (var item in detailedInformations) {\r\n\t\t\t\t\t\t\t\tinfos_cps_tbody += '<tr><td class=\"key\">' + item + '</td><td class=\"val\">' + detailedInformations[item] + '</td></tr>';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cps').className = dataIHM.getClientSSLInfos().div_cps_class;\r\n\r\n\t\t\t\t\t\t\t\tfor (var item in dataIHM.getClientSSLInfos().infos) {\r\n\t\t\t\t\t\t\t\t\tinfos_cps_tbody += '<tr><td class=\"key\">' + item + '</td><td class=\"val\">' + dataIHM.getClientSSLInfos().infos[item] + '</td></tr>';\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cps').className = \"cpsverso\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tdocument.getElementById('infos_cps_tbody').innerHTML = infos_cps_tbody;\r\n\t\t\t\t\t\t},\r\n\r\n\tdisplayWait:function (active) {\r\n\t\t\t\t\tif ( (active)\r\n\t\t\t\t\t\t&& (wizardStateMachine.nbRetry > 0) ) {\r\n\t\t\t\t\t\tthis.displayElementById('spin', \"flex\");\r\n\t\t\t\t\t\tdocument.getElementById('retry').innerHTML = wizardStateMachine.nbRetry;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.hideElementById('spin');\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\tdisplayDiagnosticState:function (active, state) {\r\n\t\t\t\t\t\t\t\tdiagStateContent = {\r\n\t\t\t\t\t\t\t\t\t'start':{content:'Cliquer sur la carte', style:'diagState diagStart'}\r\n\t\t\t\t\t\t\t\t\t, 'inProgress':{content:'Le diagnostic est en cours', style:'diagState diagInProgress'}\r\n\t\t\t\t\t\t\t\t\t, 'KO':{content:'Le diagnostic a &eacute;chou&eacute;', style:'diagState diagKO'}\r\n\t\t\t\t\t\t\t\t\t, 'OK':{content:'Le diagnostic a r&eacute;ussi', style:'diagState diagOK'}\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.hideElementById('diagState');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').style.display = \"block\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif (state !== undefined) {\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').className = diagStateContent[state].style;\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').innerHTML = diagStateContent[state].content;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\r\n\tdisplayInstruction: function (active, step) {\r\n\t\t\t\t\t\t\tthis.hideElementById('instructions-back');\r\n\t\t\t\t\t\t\tthis.hideElementById('instructions');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\tthis.displayElementById('instructions-back', \"flex\");\r\n\t\t\t\t\t\t\t\tthis.displayElementById('instructions', \"block\");\r\n\t\t\t\t\t\t\t\tthis.hideElementById('manualInstallClibCPS');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('manualInstallXPI');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('restartAlert');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('restartAlertXPI');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('preAlert');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('notSupported');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('contactSupport');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (step !== undefined) this.displayElementById(step, \"block\");\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar detailedInformations = dataIHM.getClientDetailedInfos();\r\n\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cryptolib').innerHTML = \"T&eacute;l&eacute;charger<br/>\" + dataIHM.getComponentInstallerName();\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (dataIHM.getUAInfos().os.name == 'Mac OS')\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('restartInstruction').innerHTML = \"Une fois l'installation de \" + dataIHM.getComponentInstallerName() + \" termin&eacute;e,<br/>veuillez red&eacute;marrer votre ordinateur.\";\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('restartInstruction').innerHTML = \"Une fois l'installation de \" + dataIHM.getComponentInstallerName() + \" termin&eacute;e,<br/>veuillez red&eacute;marrer votre navigateur.\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\r\n\tdisplaySupport: function (active) {\r\n\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\tthis.displayElementById('support-direction', \"flex\");\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.hideElementById('support-direction');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\r\n\tdisplayPreAlert: function(OSName) {\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-MacOS');\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-Windows');\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-Linux');\r\n\r\n\t\t\t\t\t\t\tif (OSName == 'Mac OS') this.displayElementById('alert1-MacOS', 'block');\r\n\t\t\t\t\t\t\tif (OSName == 'Windows') this.displayElementById('alert1-Windows', 'block');\r\n\t\t\t\t\t\t\tif (OSName == 'Linux') this.displayElementById('alert1-Linux', 'block');\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\r\n};\r\n\r\n//==================\r\n// Events Management\r\nfunction addEltEventListenerAllBrowser(elt, eventName, handle) {\r\n\tif (elt.addEventListener) { elt.addEventListener(eventName, handle, false);\r\n\t} else { elt.attachEvent(\"on\" + eventName, handle);\r\n\t}\r\n}\r\n\r\nfunction addIdEventListenerAllBrowser(id, eventName, handle) {\r\n\tif (document.getElementById(id)) addEltEventListenerAllBrowser(document.getElementById(id), eventName, handle);\r\n}\r\n\r\nfunction clickExpandCollapse(event) {\r\n\tif (document.getElementById('infos_cps_table').style.display != \"block\") {\r\n\t\tdocument.getElementById('infos_cps_caption_img').className = \"infos_cps_caption_img_collapse\";\r\n\t\tdocument.getElementById('infos_cps_table').style.display = \"block\";\r\n\t} else {\r\n\t\tdocument.getElementById('infos_cps_caption_img').className = \"infos_cps_caption_img_expand\";\r\n\t\tdocument.getElementById('infos_cps_table').style.display = \"none\";\r\n\t}\r\n\tevent.cancelBubble = true;\r\n\t\t\r\n\treturn false;\r\n}\r\n\r\nfunction clickActionNoPropagation(event) {\r\n\t//this.click();\r\n\r\n\tevent.cancelBubble = true;\r\n\r\n\treturn false;\r\n}\r\n\n<!-- script : /js/wizarddiagcps.js End -->\n<!-- script : /js/diagcps.js Begin -->\n//==================================\r\n// Global variable used for all data \r\n// displayed on screen \r\n// or used by state machine\r\n//==================================\r\nvar dataIHM = {\r\n\t//==========================\r\n\t// Root URL\r\n\tlocalURL: '',\r\n\tsetLocalURL: function(URL) {this.localURL = URL;},\r\n\tgetLocalURL: function() {return this.localURL;},\r\n\t\r\n\t//==========================\r\n\t// User Agent\r\n\tclientUAInfos: null,\r\n\ttimerUAInfos: null,\r\n\tinitUAInfos: function() {\r\n\t\t\t\t\t\tvar uaparser = new UAParser();\r\n\t\t\t\t\t\tthis.clientUAInfos = uaparser.getResult();\r\n\t\t\t\t\t\tthis.clientUAInfos.browser.xpi = true;\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tthis.timerUAInfos = setTimeout(function(){dataIHM.isUAInfosCPSWebEx()}, 1000);\r\n\t\t\t\t\t},\r\n\tgetUAInfos: function() {return this.clientUAInfos},\r\n\tisUAInfosCPSWebEx: function() {\r\n\t\t\t\t\tif (window.isCpsWebExAlive) {\r\n\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', window.isCpsWebExAlive());\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (this.getUAInfos().browser.name == 'Firefox') {\r\n\t\t\t\t\t\t\tif (this.getUAInfos().browser.major > 57) {\r\n\t\t\t\t\t\t\t\tthis.clientUAInfos.browser.xpi = false;\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'absente');\r\n\t\t\t\t\t\t\t\twizardStateMachine.wizard('manualInstallXPI');\r\n\t\t\t\t\t\t\t} else if (this.getUAInfos().browser.major == 57) {\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'sur cette version, l\\'installation du p&eacute;riph&eacute;rique de s&eacute;curit&eacute; doit &ecirc;tre <a href=\"http://integrateurs-cps.asipsante.fr/Installation-manuelle-PKCS11-Firefox\" target=\"_blanck\">r&eacute;alis&eacute;e manuellement</a>.');\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'd&eacute;tection impossible sur cette version');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.timerUAInfos = null;\r\n\t\t\t\t},\r\n\t\r\n\t//===============================\r\n\t// Installed Component management\r\n\tcomponentName: \"CryptolibCPS\", // By default\r\n\tsetComponentName: function(name) {this.componentName = name;},\r\n\tgetComponentName: function() {return this.componentName;},\r\n\tcomponentVersion: \"\", // By Default\r\n\tsetcomponentVersion: function(version) {this.componentVersion = version;},\r\n\tgetcomponentVersion: function() {return this.componentVersion;},\r\n\tcomponentInstallerName: \"\",\r\n\tsetComponentInstallerName: function(name) {this.componentInstallerName = name;},\r\n\tgetComponentInstallerName: function() {return this.componentInstallerName;},\r\n\tserverComponentURL: null,\r\n\tsetServerComponentURL: function(URL) {this.serverComponentURL = URL;},\r\n\tgetServerComponentLink: function(version) {\r\n\t\t\t\t\t\t\t\t\tvar componentLink = this.serverComponentURL + \"?\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"component=\" + this.getComponentName();\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&os=\" + this.getUAInfos().os.name;\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&arch=\" + this.getUAInfos().cpu.architecture;\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&version=\" + this.getcomponentVersion();\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\treturn componentLink;\r\n\t\t\t\t\t\t\t\t},\r\n\tserverComponentInfos: null,\r\n\treadServerComponentInfos: function() {\r\n\t\t\t\t\t\t\t\t// XPI 6.0.15 with Firefox < 57\r\n\t\t\t\t\t\t\t\t// ==> Use Cryptolib CPS 5.0.37 instead of last release\r\n\t\t\t\t\t\t\t\tif ((this.getUAInfos().browser.name == 'Firefox') \r\n\t\t\t\t\t\t\t\t\t&& (this.getUAInfos().browser.major < 57)) {\r\n\t\t\t\t\t\t\t\t\tswitch (this.getUAInfos().os.name) {\r\n\t\t\t\t\t\t\t\t\t\tcase 'Windows': this.setcomponentVersion('5.0.37');break;\r\n\t\t\t\t\t\t\t\t\t\tcase 'Mac OS': this.setcomponentVersion('5.0.34');break;\r\n\t\t\t\t\t\t\t\t\t\tcase 'Linux':\r\n\t\t\t\t\t\t\t\t\t\tcase 'CentOS':\r\n\t\t\t\t\t\t\t\t\t\tcase 'Ubuntu':\r\n\t\t\t\t\t\t\t\t\t\tcase 'RedHat':  this.setcomponentVersion('5.0.12');break;\r\n\t\t\t\t\t\t\t\t\t\tdefault:break;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// Use fetch if exist\r\n\t\t\t\t\t\t\t\tif (self.fetch) {\r\n\t\t\t\t\t\t\t\t\tfetch( this.getServerComponentLink() + '&filename=get' )\r\n\t\t\t\t\t\t\t\t\t.then(function(resp) {return resp.json();})\r\n\t\t\t\t\t\t\t\t\t.then(function(response) {\r\n\t\t\t\t\t\t\t\t\t\tfor (var k in response) {\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.setComponentInstallerName(response[k]);\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.addClientDetailedInfos('URL de t&eacute;l&eacute;chargement', '<a href=\"' + dataIHM.getServerComponentLink() + '\">' + dataIHM.getComponentInstallerName() + '</a>');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('readServerComponentInfos : Error with fetch (' + error.message + ')'); \r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t// Use JQuery\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$.ajax(\t{\r\n\t\t\t\t\t\t\t\t\t\turl: this.getServerComponentLink() + '&filename=get'\r\n\t\t\t\t\t\t\t\t\t\t, success: function( data) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar json;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (data === String)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson = jQuery.parseJSON(data);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson = data\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor (var k in json) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setComponentInstallerName(json[k]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.addClientDetailedInfos('URL de t&eacute;l&eacute;chargement', '<a href=\"' + dataIHM.getServerComponentLink() + '\">' + dataIHM.getComponentInstallerName() + '</a>');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t, error: function( data) { return null;}\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\r\n\t//========================================\r\n\t// Support contact informations management\r\n \tmailSupportMailbox: null,\r\n\tmailSupportDomain: null,\r\n\tsetMailSupport: function(mailbox, domain) {this.mailSupportMailbox = mailbox; this.mailSupportDomain = domain;},\r\n\tgetMailSupport: function() {return this.mailSupportMailbox + \"@\" + this.mailSupportDomain;},\r\n \t\t\r\n\t//==========================\r\n\t// Detailed informations\r\n\tclientDetailedInfos: {},\r\n\tinitClientDetailedInfos: function() {\r\n\t\t\t\t\t\t\t\tconfigSupported = true;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.getUAInfos().device.type === undefined) {\r\n\t\t\t\t\t\t\t\t\tconsole.log(\"Poste de travail\");\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tconfigSupported = false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().os.name) {\r\n\t\t\t\t\t\t\t\t\tcase 'Windows':\r\n\t\t\t\t\t\t\t\t\tcase 'Mac OS':\r\n\t\t\t\t\t\t\t\t\tcase 'Linux':\r\n\t\t\t\t\t\t\t\t\tcase 'CentOS':\r\n\t\t\t\t\t\t\t\t\tcase 'Ubuntu':\r\n\t\t\t\t\t\t\t\t\tcase 'RedHat':  configSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault: \t\tconfigSupported = configSupported & false;break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().browser.name) {\r\n\t\t\t\t\t\t\t\t\tcase 'IE':\r\n\t\t\t\t\t\t\t\t\tcase 'Safari':\r\n\t\t\t\t\t\t\t\t\tcase 'Edge':\r\n\t\t\t\t\t\t\t\t\tcase 'Chrome':\r\n\t\t\t\t\t\t\t\t\tcase 'Firefox':\tconfigSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault: \t\tconfigSupported = configSupported & false;break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().cpu.architecture) {\r\n\t\t\t\t\t\t\t\t\tcase 'ia32':\r\n\t\t\t\t\t\t\t\t\tcase 'i686':\r\n\t\t\t\t\t\t\t\t\tcase 'amd64': configSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\t\tif (this.getUAInfos().cpu.architecture === undefined)\r\n\t\t\t\t\t\t\t\t\t\t\tconfigSupported = configSupported & true;\r\n\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\tconfigSupported = configSupported & false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.getUAInfos().cpu.architecture == 'amd64')\r\n\t\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Syst&egrave;me d\\'exploitation', this.getUAInfos().os.name + \" \" + this.getUAInfos().os.version + \" (64b)\");\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Syst&egrave;me d\\'exploitation', this.getUAInfos().os.name + \" \" + this.getUAInfos().os.version);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Navigateur', this.getUAInfos().browser.name + \" \" + this.getUAInfos().browser.major);\r\n\t\t\t\t\t\t\t\t// this.addClientDetailedInfos('Compatibilit&eacute; ASIP', '<a href=\"http://integrateurs-cps.asipsante.fr/Lettre_d_information\" target=\"_blanck\">Lettre d\\'information<br/>POSTE DE TRAVAIL & Veille Technologique</a>');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.clientUAInfos.configSupported = configSupported;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\treturn configSupported;\r\n\t\t\t\t\t\t\t},\r\n\tgetClientDetailedInfos: function() {return this.clientDetailedInfos;},\r\n\taddClientDetailedInfos: function(key, value) { this.clientDetailedInfos[key] = value;},\r\n\tresetClientDetailedInfos: function() {this.clientDetailedInfos = {};},\r\n\t\t\r\n\t//==========================\r\n\t// Client SSL Informations\r\n\tclientSSLInfos: null,\r\n\tclientSSLFetchParameters: { mode:'cors', credentials: 'include', cache: 'no-cache'},\r\n\tclientSSLAjaxParameters: { cache: false, timeout: 8000, async: true},\r\n\tisDefineClientSSLInfos: function() {return (this.clientSSLInfos != undefined);},\r\n\tsetClientSSLInfos: function(data) {this.clientSSLInfos = data;},\r\n\tgetClientSSLInfos: function() {return this.clientSSLInfos;},\r\n\tinitClientSSLParameters: function() { $.ajaxSetup(this.clientSSLAjaxParameters);},\r\n\tresetClientSSLInfos: function () {\r\n\t\t\t\t\t\t\tconsole.log('resetClientSSLInfos : Erase SSL Connexion cache for ' + this.getUAInfos().browser.name);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tswitch (this.getUAInfos().browser.name) {\r\n\t\t\t\t\t\t\t\tcase 'Edge': // Works !\r\n\t\t\t\t\t\t\t\tcase 'IE': // Works !\r\n\t\t\t\t\t\t\t\t\tif (document.execCommand) document.execCommand( \"ClearAuthenticationCache\", \"false\");\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 'Firefox':\t// Works !\r\n\t\t\t\t\t\t\t\t\t//location.reload(); // Works !\r\n\t\t\t\t\t\t\t\t\tif (window.crypto) if (window.crypto.logout) window.crypto.logout(); // Works !\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 'Chrome': // Works !\r\n\t\t\t\t\t\t\t\tcase 'Safari': // Not working, restart Browser needed !\r\n\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag'); \r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\treadClientSSLInfos: function() {\r\n\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : SSL Connexion' );\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// Use fetch if exist\r\n\t\t\t\t\t\t\tif (self.fetch) {\r\n\t\t\t\t\t\t\t\t// Try to connect and get CPS informations\r\n\t\t\t\t\t\t\t\tfetch( '/visuel.php', this.clientSSLFetchParameters )\r\n\t\t\t\t\t\t\t\t.then(function(resp) {return resp.json();})\r\n\t\t\t\t\t\t\t\t.then(function(resp_json) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Success with Fetch');\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t// traitement du JSON\r\n\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(resp_json);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('endDiagWithSuccess');\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t// Case of SSL Error\r\n\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Probably SSL Error with fetch (' + error.message + ')');\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(null);\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.accelerateTimer();\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t// Use JQuery\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$.ajax(\t{\r\n\t\t\t\t\t\t\t\t\turl: 'visuel.php'\r\n\t\t\t\t\t\t\t\t\t, success: function(data, textStatus) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Success with Ajax (' + textStatus + ')');\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tif (data === String)\r\n\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(jQuery.parseJSON(data));\r\n\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(data);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('endDiagWithSuccess');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t, error: function(data, textStatus) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Probably SSL Error with Ajax (' + textStatus + ')');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(null);\r\n\t\t\t\t\t\t\t\t\t\t\twizardStateMachine.accelerateTimer();\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n}\r\n\r\n//=====\r\n// Main\r\n//=====\r\n$(function() {\r\n\t// Initialization\r\n\t//---------------\r\n\tdataIHM.initUAInfos(); // User Agent\r\n\t\r\n\tdataIHM.initClientSSLParameters();\r\n\t\r\n\t// Sp�cific parameter with no good solution @29/12/2017\r\n\tswitch (dataIHM.getUAInfos().browser.name) {\r\n\t\tcase 'IE':\r\n\t\t\tconsole.log('=========== Use Ajax =============');\r\n\t\t\tself.fetch = undefined;\r\n\t\t\tbreak;\r\n\t\tcase 'Edge':\r\n\t\tcase 'Firefox':\r\n\t\tcase 'Safari':\r\n\t\tdefault:\r\n\t\t\tconsole.log('=========== Try using fetch. If not available use Ajax =============');\r\n\t\t\tbreak;\r\n\t}\r\n\t\r\n\tdataIHM.initClientDetailedInfos(); // Informations in bottom\r\n\tdataIHM.readServerComponentInfos(); // Get from informations from Web Service\r\n\t\r\n\twizardStateMachine.startWizard(); // Start Wizard\r\n\t\t\r\n\twizardStateMachine.displayInit(dataIHM.getUAInfos().os.name);\r\n});\r\n\n<!-- script : /js/diagcps.js End -->\n\n</script>\n<script type=\"text/javascript\">\n\t// Initialization Javascript from PHP\n\tdataIHM.setComponentName('CryptolibCPS');\n\tdataIHM.setServerComponentURL('download.php');\n</script>\n<!--<div id=\"beta\"></div>-->\n<div id=\"instructions-back\" onclick=\"wizardStateMachine.wizard('exitInstruction');\">\n\t<div id=\"instructions\">\n\t\n\t\t<div class=\"screen\" id=\"preAlert\">\n\t\t\t<div class=\"instruction\"><br/>\n<h1>Assistance en cas de carte CPS non lue</h1>\n\n<h2>Pr&eacute;alablement</h2>\n<p>\nVeuillez v&eacute;rifier que votre carte est bien ins&eacute;r&eacute;e dans votre lecteur de carte ou votre terminal Vitale.<br/>\nPuis v&eacute;rifier que votre lecteur de carte ou votre terminal Vitale est correctement connect&eacute; &agrave; votre ordinateur.<br/>\n<br/>\nLa carte ins&eacute;r&eacute;e dans le lecteur doit &ecirc;tre la derni&egrave;re carte active.\n\n<table >\n\t<tr>\n\t\t<td style=\"border-top:none;\"><img src=\"images/informations32.png\" alt=\"Information :\"/></td>\n\t\t<td style=\"border-top:none;\"><i>La derni&egrave;re carte active pr&eacute;sente la date d'expiration la plus &eacute;loign&eacute;e.</i></td>\n\t</tr>\n</table>\n<br/>\nUne fois cette v&eacute;rification r&eacute;alis&eacute;e, v&eacute;rifiez que la carte est bien lue.<br/>\n</p>\n\n<div id=\"alert1-MacOS\">\n<h2>Votre ordinateur est sous Mac OS</h2>\n<p>\nSur votre syst&egrave;me d'exploitation, nous ne disposons pas de m&eacute;thode particuli&egrave;re pour v&eacute;rifier si votre carte est lue.<br/>\n<br/>\nVeuillez lancer un diagnostic de votre ordinateur et proc&eacute;der &agrave; l'installation des mises &agrave; jour sugg&eacute;r&eacute;es.<br/>\n</p>\n</div>\n\n<div id=\"alert1-Linux\">\n<h2>Votre ordinateur est sous Linux</h2>\n<p>\nSur votre syst&egrave;me d'exploitation, nous ne disposons pas de m&eacute;thode particuli&egrave;re pour v&eacute;rifier si votre carte est lue.<br/>\n<br/>\nVeuillez lancer un diagnostic de votre ordinateur et proc&eacute;der &agrave; l'installation des mises &agrave; jour sugg&eacute;r&eacute;es.<br/>\n</p>\n</div>\n\n<div id=\"alert1-Windows\">\n<h2>Votre ordinateur est sous Windows</h2>\n<b>Dans la barre des t&acirc;ches, une carte lue est signal&eacute;e par <img src=\"images/preHelper/iconeOK.png\" alt=\"Icone vert dans la barre des taches\" /> et une carte non lue par <img src=\"images/preHelper/iconeKO.png\" alt=\"Icone rouge dans la barre des taches\"/>.</b><br/>\n<h3>L'ic&ocirc;ne <img src=\"images/preHelper/iconeOK.png\" alt=\"Icone vert dans la barre des taches\"/> est introuvable</h3>\n<p>\nCliquez avec le clic droit de votre souris sur le bouton &laquo;Afficher les ic&ocirc;nes&raquo; (en bas &agrave; droite de votre &eacute;cran) ou sur la zone heure et date et selectionnez &laquo;Personnaliser les ic&ocirc;nes de notification&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/notificationsBar.png\" alt=\"Barre de notification\"/></div>\n<br/>\n<br/>\nCherchez l'ic&ocirc;ne &laquo;Gestionnaire de certificats CPS&raquo; et s&eacute;lectionnez &laquo;Afficher l'ic&ocirc;ne et les notifications&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/notificationsParameters.png\" alt=\"Parametres de notifications\"/></div>\n<br/>\nUne fois la manipulation r&eacute;alis&eacute;e vous devriez voir apparaitre l'ic&ocirc;ne (en bas &agrave; droite de votre &eacute;cran).<br/>\n<br/>\nSi l'ic&ocirc;ne n'apparait pas dans la liste, lancer le diagnostic de votre ordinateur et installez les mises &agrave; jour propos&eacute;es.<br/>\n<br/>\n</p>\n<h2>L'ic&ocirc;ne <img src=\"images/preHelper/iconeKO.png\" alt=\"Icone rouge dans la barre des taches\" /> est rouge</h2>\n<p>\nSi l'ic&ocirc;ne est encadr&eacute;e de rouge (carte non lue), assurez-vous que votre carte est bien ins&eacute;r&eacute;e dans votre lecteur, rafra&icirc;chissez le lecteur en cliquant sur l'ic&ocirc;ne avec le bouton droit de la souris. Et cliquez sur &laquo;Rafra&icirc;chir&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/rightClickCCM.png\" alt=\"Cliquer droit sur l'icone du CCM\" /></div>\n<br/>\nSi l'encadr&eacute; reste rouge apr&egrave;s la manipulation, red&eacute;marrez votre ordinateur en laissant le lecteur et la CPS connect&eacute;s.<br/>\n<br/>\nApr&egrave;s ces manipulations, si l'ic&ocirc;ne ne passe pas au vert, veuillez nous contacter.\n</p>\n<div align=\"center\"></div>\n</div>\n\n</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"startDiag\" onclick=\"wizardStateMachine.wizard('startDiag');\">Diagnostiquer mon poste</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"notSupported\">\n\t\t\t<div class=\"instruction\">Votre configuration mat&eacute;riel et/ou syst&egrave;me n'est pas support&eacute;e par nos composants logiciels. Nous ne garantissons pas le succès du diagnostic.</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"notSupported\" onclick=\"wizardStateMachine.wizard('preAlert');\">Continuer</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"manualInstallXPI\">\n\t\t\t<div class=\"instruction\" id=\"xpi_instruction\" >L'Extension Firefox n'a pas &eacute;t&eacute; d&eacute;tect&eacute;e. Elle est indispensable sous ce navigateur.<br/>Apr&egrave;s l'installation, veuillez red&eacute;marrer votre navigateur.</div>\n\t\t\t<div class=\"actions\">\n<!--\t\t\t\t<div class=\"action instruction\" id=\"xpi\" onclick=\"wizardStateMachine.wizard('XPI',{URL:'https://diagcps.eservices.esante.gouv.fr/ODI_PS/php/download_asip.php?installeur=url_interne_xpi_installation_pkcs11',IconURL:'https://diagcps.eservices.esante.gouv.fr/ODI_PS/images/asip_sante.png',Hash:'sha256:c23de3812aaf7c3a81d80e9bdf891c3e2b621e01e55e8d308226fd86ab6ef438'});\">Installer<br/>l'Extension Firefox</div>-->\n<div class=\"action instruction\" id=\"xpi\" onclick=\"wizardStateMachine.wizard('XPI',{URL:'/download.php?component=xpi',IconURL:'/images/asip_sante.png',Hash:'sha256:c23de3812aaf7c3a81d80e9bdf891c3e2b621e01e55e8d308226fd86ab6ef438'});\">Installer<br/>l'Extension Firefox</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"restartAlertXPI\">\n\t\t\t<div class=\"instruction\" id=\"restartInstructionXPI\" >Une fois l'installation de l'Extension Cryptolib CPS termin&eacute;e,<br/>veuillez red&eacute;marrer votre navigateur.</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"manualInstallClibCPS\">\n\t\t\t<div class=\"instruction\">Si vous avez ins&eacute;r&eacute; votre CPS dans votre lecteur sans succ&egrave;s, la version de Cryptolib CPS de votre poste de travail n'est peut-&ecirc;tre pas &agrave; jour.</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"cryptolib\" onclick=\"wizardStateMachine.wizard('CryptolibCPS');\">T&eacute;l&eacute;charger<br/>Cryptolib CPS</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"restartAlert\">\n\t\t\t<div class=\"instruction\" id=\"restartInstruction\" >Une fois l'installation de CryptolibCPS_vX.Y.Z termin&eacute;e, veuillez red&eacute;marrer votre navigateur.</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"contactSupport\">\n\t\t\t<div class=\"instruction\">Si vous avez installez le composant propos&eacute; sans succ&eacute;s,<br/> veuillez contacter le Support.</div>\n\t\t</div>\n\t\t\n\t</div>\n</div>\t\n<div id=\"service-direction\" class=\"column\"></div>\n<div id=\"article\">\n\t<div id=\"center\">\n\t\t<div class=\"diagState\" id=\"diagState\"></div>\n\t\t<div>\n\t\t\t<div id=\"cps\" class=\"cpsverso\" onclick=\"wizardStateMachine.wizard('restartDiag');\"><div id=\"spin\"><div id=\"retry\"></div></div></div>\n\t\t</div>\n<!--\t\t\n\t\t<div id=\"results\">\n\t\t\t<div>\n\t\t\t\t<div class=\"sign\" id=\"certificat\"></div>\n\t\t\t\t<div class=\"sign\" id=\"expired\" title=\"expire\"></div>\n\t\t\t\t<div class=\"sign\" id=\"revoc\" title=\"revoque\"></div>\n\t\t\t\t<div class=\"sign\" id=\"class\"></div>\n\t\t\t\t<div class=\"sign\" id=\"rootAC\"></div>\n\t\t\t\t<div class=\"sign\" id=\"cryptolib\" title=\"cryptolib\"></div>\n\t\t\t</div>\n\t\t</div>\n-->\n\t\t<div id=\"cps_infos\">\n\t\t\t<div id=\"infos_cps\">\n\t\t\t\t<div id=\"infos_cps_caption\"><div>Informations d&eacute;taill&eacute;es</div><div class=\"infos_cps_caption_img_expand\" id=\"infos_cps_caption_img\"></div></div>\n\t\t\t\t<table id=\"infos_cps_table\">\n\t\t\t\t\t<tbody id=\"infos_cps_tbody\"></tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n<div id=\"support-direction\" class=\"column\"></div>\n</div>\r\n<div id=\"footer\" style=\"display:flex;flex-direction:row\">\r\n    <div style=\"display:flex;flex-direction:row;width:30vw\">\r\n        <div style=\"margin:20px\">\r\n            <a href=\"https://solidarites-sante.gouv.fr/\" target=\"_blank\">\r\n                <img src=\"./images/logo-ministere.svg\" alt=\"Ministère des Solidarités et de la santé\" width=\"84\" height=\"62\">\r\n            </a>\r\n        </div>\r\n        <div style=\"margin:20px\">\r\n            <a href=\"https://esante.gouv.fr/\" target=\"_blank\">\r\n                <img src=\"./images/logo-ANS.svg\" alt=\"Agence du Numérique en Santé\" width=\"166\" height=\"50\">\r\n            </a>\r\n        </div>\r\n    </div>\r\n    <div style=\"width:60vw\">\r\n        <ul style=\"align-items:end\">\r\n            <li><a href=\"http://esante.gouv.fr/services/mentions-legales\" target=\"_blank\">Mentions l&eacute;gales</a></li>\r\n            <li><a href=\"./copyright.php\" target=\"_blank\" title=\"Copyright [nouvelle fen&ecirc;tre]\">Copyright</a></li>\r\n        </ul>\r\n    </div>\r\n</div>\r\n\r\n</body>\r\n</html>\r\n",
      "ip": "135.125.232.117",
      "timestamp": "2025-03-14T16:26:19.506497161Z",
      "curl-command": "curl -X 'GET' -H 'Accept: */*' -H 'Accept-Language: en' -H 'User-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)' 'https://diagcps.eservices.esante.gouv.fr'",
      "matcher-status": true
    },
    {
      "template": "http/miscellaneous/http-trace.yaml",
      "template-url": "https://templates.nuclei.sh/public/http-trace",
      "template-id": "http-trace",
      "template-path": "/home/runner/nuclei-templates/http/miscellaneous/http-trace.yaml",
      "info": {
        "name": "HTTP TRACE method enabled",
        "author": [
          "nodauf"
        ],
        "tags": [
          "miscellaneous",
          "misc",
          "generic"
        ],
        "reference": [
          "https://www.blackhillsinfosec.com/three-minutes-with-the-http-trace-method/"
        ],
        "severity": "info",
        "metadata": {
          "max-request": 2
        }
      },
      "matcher-name": "trace-request",
      "type": "http",
      "host": "https://diagcps.eservices.esante.gouv.fr",
      "matched-at": "https://diagcps.eservices.esante.gouv.fr",
      "request": "TRACE / HTTP/1.1\r\nHost: diagcps.eservices.esante.gouv.fr\r\nUser-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)\r\nConnection: close\r\nAccept: */*\r\nAccept-Language: en\r\nAccept-Encoding: gzip\r\n\r\n",
      "response": "HTTP/1.1 200 OK\r\nConnection: close\r\nTransfer-Encoding: chunked\r\nContent-Type: message/http\r\nDate: Fri, 14 Mar 2025 16:26:34 GMT\r\nServer: Apache/2.4.37 (centos) OpenSSL/1.1.1g\r\n\r\nTRACE / HTTP/1.1\r\nHost: diagcps.eservices.esante.gouv.fr\r\nUser-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)\r\nConnection: close\r\nAccept: */*\r\nAccept-Language: en\r\nAccept-Encoding: gzip\r\n\r\n",
      "ip": "135.125.232.117",
      "timestamp": "2025-03-14T16:26:34.818653317Z",
      "curl-command": "curl -X 'TRACE' -H 'Accept: */*' -H 'Accept-Language: en' -H 'User-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)' 'https://diagcps.eservices.esante.gouv.fr'",
      "matcher-status": true
    },
    {
      "template": "http/miscellaneous/robots-txt-endpoint.yaml",
      "template-url": "https://templates.nuclei.sh/public/robots-txt-endpoint",
      "template-id": "robots-txt-endpoint",
      "template-path": "/home/runner/nuclei-templates/http/miscellaneous/robots-txt-endpoint.yaml",
      "info": {
        "name": "robots.txt endpoint prober",
        "author": [
          "caspergn",
          "pdteam"
        ],
        "tags": [
          "miscellaneous",
          "misc",
          "generic"
        ],
        "severity": "info",
        "metadata": {
          "max-request": 2
        }
      },
      "type": "http",
      "host": "https://diagcps.eservices.esante.gouv.fr",
      "matched-at": "https://diagcps.eservices.esante.gouv.fr/robots.txt",
      "request": "GET /robots.txt HTTP/1.1\r\nHost: diagcps.eservices.esante.gouv.fr\r\nUser-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)\r\nConnection: close\r\nAccept: */*\r\nAccept-Language: en\r\nAccept-Encoding: gzip\r\n\r\n",
      "response": "HTTP/1.1 200 OK\r\nConnection: close\r\nContent-Length: 359\r\nAccept-Ranges: bytes\r\nContent-Type: text/plain; charset=UTF-8\r\nDate: Fri, 14 Mar 2025 16:26:34 GMT\r\nEtag: \"167-5dc9cd1f422c0\"\r\nLast-Modified: Thu, 14 Apr 2022 12:56:19 GMT\r\nServer: Apache/2.4.37 (centos) OpenSSL/1.1.1g\r\n\r\n# Production Server\r\nUser-agent: *\r\n\r\n# New ASIP diagnostic tool\r\nAllow: /DIAGCPS/\r\n# Disallow: /DIAGCPS/\r\n\r\n# Old location of new ASIP diagnostic tool\r\nDisallow: /TESTSSL/\r\n\r\n# Useless\r\nDisallow: /index.php\r\nDisallow: /copyright.php\r\n\r\n# Old ASIP diagnostic tool : no more maintenance\r\nDisallow: /DMP/\r\nDisallow: /ASIP/\r\nDisallow: /MSS/\r\nDisallow: /oa_cps/\r\n",
      "ip": "135.125.232.117",
      "timestamp": "2025-03-14T16:26:34.917245219Z",
      "curl-command": "curl -X 'GET' -H 'Accept: */*' -H 'Accept-Language: en' -H 'User-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)' 'https://diagcps.eservices.esante.gouv.fr/robots.txt'",
      "matcher-status": true
    },
    {
      "template": "http/miscellaneous/robots-txt.yaml",
      "template-url": "https://templates.nuclei.sh/public/robots-txt",
      "template-id": "robots-txt",
      "template-path": "/home/runner/nuclei-templates/http/miscellaneous/robots-txt.yaml",
      "info": {
        "name": "robots.txt file",
        "author": [
          "caspergn",
          "thezakman"
        ],
        "tags": [
          "miscellaneous",
          "misc",
          "generic"
        ],
        "severity": "info",
        "metadata": {
          "max-request": 1
        }
      },
      "type": "http",
      "host": "https://diagcps.eservices.esante.gouv.fr",
      "matched-at": "https://diagcps.eservices.esante.gouv.fr/robots.txt",
      "request": "GET /robots.txt HTTP/1.1\r\nHost: diagcps.eservices.esante.gouv.fr\r\nUser-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)\r\nConnection: close\r\nAccept: */*\r\nAccept-Language: en\r\nAccept-Encoding: gzip\r\n\r\n",
      "response": "HTTP/1.1 200 OK\r\nConnection: close\r\nContent-Length: 359\r\nAccept-Ranges: bytes\r\nContent-Type: text/plain; charset=UTF-8\r\nDate: Fri, 14 Mar 2025 16:26:34 GMT\r\nEtag: \"167-5dc9cd1f422c0\"\r\nLast-Modified: Thu, 14 Apr 2022 12:56:19 GMT\r\nServer: Apache/2.4.37 (centos) OpenSSL/1.1.1g\r\n\r\n# Production Server\r\nUser-agent: *\r\n\r\n# New ASIP diagnostic tool\r\nAllow: /DIAGCPS/\r\n# Disallow: /DIAGCPS/\r\n\r\n# Old location of new ASIP diagnostic tool\r\nDisallow: /TESTSSL/\r\n\r\n# Useless\r\nDisallow: /index.php\r\nDisallow: /copyright.php\r\n\r\n# Old ASIP diagnostic tool : no more maintenance\r\nDisallow: /DMP/\r\nDisallow: /ASIP/\r\nDisallow: /MSS/\r\nDisallow: /oa_cps/\r\n",
      "ip": "135.125.232.117",
      "timestamp": "2025-03-14T16:26:34.986194062Z",
      "curl-command": "curl -X 'GET' -H 'Accept: */*' -H 'Accept-Language: en' -H 'User-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)' 'https://diagcps.eservices.esante.gouv.fr/robots.txt'",
      "matcher-status": true
    },
    {
      "template": "http/technologies/waf-detect.yaml",
      "template-url": "https://templates.nuclei.sh/public/waf-detect",
      "template-id": "waf-detect",
      "template-path": "/home/runner/nuclei-templates/http/technologies/waf-detect.yaml",
      "info": {
        "name": "WAF Detection",
        "author": [
          "dwisiswant0",
          "lu4nx"
        ],
        "tags": [
          "waf",
          "tech",
          "misc"
        ],
        "description": "A web application firewall was detected.",
        "reference": [
          "https://github.com/ekultek/whatwaf"
        ],
        "severity": "info",
        "metadata": {
          "max-request": 1
        },
        "classification": {
          "cve-id": null,
          "cwe-id": [
            "cwe-200"
          ]
        }
      },
      "matcher-name": "apachegeneric",
      "type": "http",
      "host": "https://diagcps.eservices.esante.gouv.fr",
      "matched-at": "https://diagcps.eservices.esante.gouv.fr/",
      "request": "POST / HTTP/1.1\r\nHost: diagcps.eservices.esante.gouv.fr\r\nUser-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)\r\nConnection: close\r\nContent-Length: 27\r\nContent-Type: application/x-www-form-urlencoded\r\nAccept-Encoding: gzip\r\n\r\n_=<script>alert(1)</script>",
      "response": "HTTP/1.1 200 OK\r\nConnection: close\r\nTransfer-Encoding: chunked\r\nContent-Type: text/html; charset=UTF-8\r\nDate: Fri, 14 Mar 2025 16:26:55 GMT\r\nServer: Apache/2.4.37 (centos) OpenSSL/1.1.1g\r\nX-Powered-By: PHP/7.2.24\r\n\r\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n\t<title>DiagCPS, Outil de Diagnostic SSL</title>\r\n\t<meta http-equiv=\"Content-type\" content=\"text/html; charset=UTF-8\" />\r\n\t<meta name=\"description\" content=\"DiagCPS est un Outil de Diagnostic de l'authentification en ligne à l'aide d'une Carte de Professionnel de Santé, i.e. CPS. Il est fourni par l'ASIP Santé et remplace ODI.\" />\r\n\t<meta name=\"Publisher\" content=\"ASIP Santé\" />\r\n\t<meta name=\"copyright\" content=\"Tous droits réservés - ASIP Santé\" />\r\n\t<link rel=\"shortcut icon\" href=\"./images/favicon.ico\" type=\"image/x-icon\" />\r\n\t<link rel=\"stylesheet\" href=\"diagcps_css.php\" />\r\n\t<script src=\"./js/jquery-3.2.0.min.js\"></script>\r\n\t<script src=\"./js/ua-parser.min.js\"></script>\r\n</head>\r\n<body>\r\n<div id=\"header\" style=\"display:flex;flex-direction:row\">\r\n    <div style=\"margin:20px\">\r\n        <a href=\"https://solidarites-sante.gouv.fr/\" target=\"_blank\">\r\n            <img src=\"./images/logo-ministere.svg\" alt=\"Ministère des Solidarités et de la santé\" width=\"168\" height=\"104\">\r\n        </a>\r\n    </div>\r\n\t<div id=\"title\">esante.gouv.fr</div>\r\n</div>\r\n<div id=\"section\">\r\n<script type=\"text/javascript\">\n\n<!-- script : /js/wizarddiagcps.js Begin -->\n//==================================\r\n// Global variable used for state machine management \r\n// displayed on screen \r\n// or used by state machine\r\n//==================================\r\nvar wizardStateMachine = {\r\n\tstartState: 'notSupported',\r\n\tlastState: 'notSupported',\r\n\t\r\n\t//=================\r\n\t// Retry Management\r\n\t// Variables\r\n\tnbMaxRetry: 10,\r\n\tnbRetry: 0,\r\n\t\r\n\t// Management\r\n\tinitRetry: function() {this.nbRetry = this.nbMaxRetry;},\r\n\tisMaxRetry: function() {return (this.nbRetry >= this.nbMaxRetry);},\r\n\tisMinRetry: function() {return (this.nbRetry <= 0);},\r\n\tdecRetry: function() {this.nbRetry--;},\r\n\tdisplayRetry: function() {\r\n\t\t\t\t\t\t\t\t//console.log(\"displayRetry : nbRetry = \" + this.nbRetry);\r\n\t\t\t\t\t\t\t\tthis.decRetry();\r\n\t\t\t\t\t\t\t\tthis.stopTimers(); \r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.isMinRetry()\r\n\t\t\t\t\t\t\t\t\t&& \t(this.lastState != 'endDiagWithSuccess')) {\r\n\t\t\t\t\t\t\t\t\tthis.wizard('manualInstallClibCPS');\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tthis.displayWait(true);\r\n\t\t\t\t\t\t\t\t\tthis.startTimers();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\r\n\t//==================\r\n\t// Timers Management\r\n\ttimerTestSSL: null,\r\n\tretryTimeoutKO: 1000,\r\n\tinitTimer: function () {this.retryTimeoutKO = 1000;},\r\n\taccelerateTimer: function () {this.retryTimeoutKO = 250;},\r\n\tstopTimers: function() {\r\n\t\t\t\t\t\t\t\tif (this.timerTestSSL != null)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tclearTimeout(this.timerTestSSL);\r\n\t\t\t\t\t\t\t\t\tthis.timerTestSSL = null;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\tstartTimers: function() {this.timerTestSSL = setTimeout(function(){wizardStateMachine.displayRetry()}, this.retryTimeoutKO);},\r\n\t\r\n\t//=======\r\n\t// Wizard\r\n\tstartWizard: function() {this.wizard(this.startState);},\r\n\twizard: function(step, param) {\r\n\t\t\t\tconsole.log(\"wizard : step = \" + step + \", param = \" + param);\r\n\t\t\t\t\t\r\n\t\t\t\tswitch (step)\r\n\t\t\t\t{\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Pre treatment\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'notSupported':\r\n\t\t\t\t\tcase 'preAlert':\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'start');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif ((dataIHM.getUAInfos().configSupported) || (step == 'preAlert')) this.displayInstruction(true, 'preAlert');\r\n\t\t\t\t\t\telse this.displayInstruction(true, 'notSupported');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Manual Installation XPI\r\n\t\t\t\t\t// Suggestion of installation\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'manualInstallXPI':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'KO');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'manualInstallXPI');\r\n\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// XPI Installation\r\n\t\t\t\t\t// Installation process\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'XPI':\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'restartAlertXPI');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar params = {\r\n\t\t\t\t\t\t\t\t\"Installer l'Extension Cryptolib CPS\": \r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tURL: param.URL,\r\n\t\t\t\t\t\t\t\t\tIconURL: param.IconURL,\r\n\t\t\t\t\t\t\t\t\tHash: param.Hash,\r\n\t\t\t\t\t\t\t\t\ttoString: function () { return this.URL; }\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t};\r\nconsole.log(params);\r\n\t\t\t\t\t\tInstallTrigger.install(params);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// Diagnostic\r\n\t\t\t\t\t// Start\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'startDiag':\r\n\t\t\t\t\t\tthis.initRetry();\r\n\t\t\t\t\t\tthis.initTimer();\r\n\r\n\t\t\t\t\t\tthis.displayWait(true);\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'inProgress');\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tdataIHM.readClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.startTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//====================\r\n\t\t\t\t\t// Diagnostic\r\n\t\t\t\t\t// Restart\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'restartDiag':\r\n\r\n\t\t\t\t\t\tdataIHM.resetClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\r\n\t\t\t\t\t//==========================\r\n\t\t\t\t\t// Progression\r\n\t\t\t\t\t//--------------------------\r\n\t\t\t\t\tcase 'inProgress':\r\n\t\t\t\t\t\t//dataIHM.readClientSSLInfos();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// this.displayDiagnosticState(true, 'inProgress');\r\n\t\t\t\t\t\t// this.displayInstruction(false);\r\n\t\t\t\t\t\t// this.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//===================\r\n\t\t\t\t\t// Ends\r\n\t\t\t\t\t//-------------------\r\n\t\t\t\t\tcase 'endDiagWithSuccess':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'OK');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tthis.displaySupport(false);\r\n\t\t\t\t\t\tthis.displayInfosCPS(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//==================================\r\n\t\t\t\t\t// Manual Installation Cryptolib CPS\r\n\t\t\t\t\t// Suggestion of installation\r\n\t\t\t\t\t//----------------------------------\r\n\t\t\t\t\tcase 'manualInstallClibCPS':\r\n\t\t\t\t\t\tthis.stopTimers();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true, 'KO');\r\n\t\t\t\t\t\tthis.displayWait(false);\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'manualInstallClibCPS');\r\n\t\t\t\t\t\tthis.displaySupport(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t//=======================\r\n\t\t\t\t\t// Cryptolib CPS download\r\n\t\t\t\t\t// Installation process\r\n\t\t\t\t\t//-----------------------\r\n\t\t\t\t\tcase 'CryptolibCPS':\r\n\t\t\t\t\t\twindow.location = dataIHM.getServerComponentLink();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// Direct jump to Retry after installation\r\n\t\t\t\t\t\tthis.displayInstruction(true, 'restartAlert');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbreak;\t\t\t\t\t\t\r\n\t\t\t\t\t//=========================\r\n\t\t\t\t\t// Other\r\n\t\t\t\t\t// Close Instruction screen\r\n\t\t\t\t\t//-------------------------\r\n\t\t\t\t\tcase 'exitInstruction':\r\n\t\t\t\t\t\tthis.displayDiagnosticState(true);\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t// Open Support link\r\n\t\t\t\t\t//--------------------\r\n\t\t\t\t\tcase 'openSupport':\r\n\t\t\t\t\t\tthis.displayInstruction(false);\r\n\t\t\t\t\t\tif (param !== undefined) window.open(param.URL,'_blank');\r\n\t\t\t\t\t\tbreak;\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.lastState = step;\r\n\t\t\t},\r\n\t\r\n\t//==========================\r\n\t// Screen Display Management\r\n\tdisplayElementById: function(id, display) {\r\n\t\t\t\t\t\t\tdocument.getElementById(id).style.display = display;\r\n\t\t\t\t\t\t},\r\n\thideElementById: function(id) {\r\n\t\t\t\t\t\t\tthis.displayElementById(id, \"none\");\r\n\t\t\t\t\t\t},\r\n\tdisplayInit: function(OSName) {\r\n\t\t\t\t\t\t// Events initialization\r\n\t\t\t\t\t\t//----------------------\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"cryptolib\", \t\t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"notSupported\", \t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"startDiag\", \t\t\t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"instructions-back\", \t\"click\", clickActionNoPropagation);\r\n\t\t\t\t\t\taddIdEventListenerAllBrowser(\"infos_cps_caption\", \t\"click\", clickExpandCollapse);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.displayInfosCPS(false);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// PreAlert initialization\r\n\t\t\t\t\t\t//------------------------\r\n\t\t\t\t\t\tthis.displayPreAlert(OSName);\r\n\t\t\t\t\t},\r\n\tdisplayInfosCPS: function (active) {\r\n\t\t\t\t\t\t\tvar infos_cps_tbody = '';\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar detailedInformations = dataIHM.getClientDetailedInfos();\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tfor (var item in detailedInformations) {\r\n\t\t\t\t\t\t\t\tinfos_cps_tbody += '<tr><td class=\"key\">' + item + '</td><td class=\"val\">' + detailedInformations[item] + '</td></tr>';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cps').className = dataIHM.getClientSSLInfos().div_cps_class;\r\n\r\n\t\t\t\t\t\t\t\tfor (var item in dataIHM.getClientSSLInfos().infos) {\r\n\t\t\t\t\t\t\t\t\tinfos_cps_tbody += '<tr><td class=\"key\">' + item + '</td><td class=\"val\">' + dataIHM.getClientSSLInfos().infos[item] + '</td></tr>';\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cps').className = \"cpsverso\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tdocument.getElementById('infos_cps_tbody').innerHTML = infos_cps_tbody;\r\n\t\t\t\t\t\t},\r\n\r\n\tdisplayWait:function (active) {\r\n\t\t\t\t\tif ( (active)\r\n\t\t\t\t\t\t&& (wizardStateMachine.nbRetry > 0) ) {\r\n\t\t\t\t\t\tthis.displayElementById('spin', \"flex\");\r\n\t\t\t\t\t\tdocument.getElementById('retry').innerHTML = wizardStateMachine.nbRetry;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.hideElementById('spin');\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\tdisplayDiagnosticState:function (active, state) {\r\n\t\t\t\t\t\t\t\tdiagStateContent = {\r\n\t\t\t\t\t\t\t\t\t'start':{content:'Cliquer sur la carte', style:'diagState diagStart'}\r\n\t\t\t\t\t\t\t\t\t, 'inProgress':{content:'Le diagnostic est en cours', style:'diagState diagInProgress'}\r\n\t\t\t\t\t\t\t\t\t, 'KO':{content:'Le diagnostic a &eacute;chou&eacute;', style:'diagState diagKO'}\r\n\t\t\t\t\t\t\t\t\t, 'OK':{content:'Le diagnostic a r&eacute;ussi', style:'diagState diagOK'}\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.hideElementById('diagState');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').style.display = \"block\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif (state !== undefined) {\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').className = diagStateContent[state].style;\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('diagState').innerHTML = diagStateContent[state].content;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\r\n\tdisplayInstruction: function (active, step) {\r\n\t\t\t\t\t\t\tthis.hideElementById('instructions-back');\r\n\t\t\t\t\t\t\tthis.hideElementById('instructions');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\t\tthis.displayElementById('instructions-back', \"flex\");\r\n\t\t\t\t\t\t\t\tthis.displayElementById('instructions', \"block\");\r\n\t\t\t\t\t\t\t\tthis.hideElementById('manualInstallClibCPS');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('manualInstallXPI');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('restartAlert');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('restartAlertXPI');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('preAlert');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('notSupported');\r\n\t\t\t\t\t\t\t\tthis.hideElementById('contactSupport');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (step !== undefined) this.displayElementById(step, \"block\");\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar detailedInformations = dataIHM.getClientDetailedInfos();\r\n\r\n\t\t\t\t\t\t\t\tdocument.getElementById('cryptolib').innerHTML = \"T&eacute;l&eacute;charger<br/>\" + dataIHM.getComponentInstallerName();\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (dataIHM.getUAInfos().os.name == 'Mac OS')\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('restartInstruction').innerHTML = \"Une fois l'installation de \" + dataIHM.getComponentInstallerName() + \" termin&eacute;e,<br/>veuillez red&eacute;marrer votre ordinateur.\";\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById('restartInstruction').innerHTML = \"Une fois l'installation de \" + dataIHM.getComponentInstallerName() + \" termin&eacute;e,<br/>veuillez red&eacute;marrer votre navigateur.\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\r\n\tdisplaySupport: function (active) {\r\n\t\t\t\t\t\tif (active) {\r\n\t\t\t\t\t\t\tthis.displayElementById('support-direction', \"flex\");\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.hideElementById('support-direction');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\r\n\tdisplayPreAlert: function(OSName) {\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-MacOS');\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-Windows');\r\n\t\t\t\t\t\t\tthis.hideElementById('alert1-Linux');\r\n\r\n\t\t\t\t\t\t\tif (OSName == 'Mac OS') this.displayElementById('alert1-MacOS', 'block');\r\n\t\t\t\t\t\t\tif (OSName == 'Windows') this.displayElementById('alert1-Windows', 'block');\r\n\t\t\t\t\t\t\tif (OSName == 'Linux') this.displayElementById('alert1-Linux', 'block');\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\r\n};\r\n\r\n//==================\r\n// Events Management\r\nfunction addEltEventListenerAllBrowser(elt, eventName, handle) {\r\n\tif (elt.addEventListener) { elt.addEventListener(eventName, handle, false);\r\n\t} else { elt.attachEvent(\"on\" + eventName, handle);\r\n\t}\r\n}\r\n\r\nfunction addIdEventListenerAllBrowser(id, eventName, handle) {\r\n\tif (document.getElementById(id)) addEltEventListenerAllBrowser(document.getElementById(id), eventName, handle);\r\n}\r\n\r\nfunction clickExpandCollapse(event) {\r\n\tif (document.getElementById('infos_cps_table').style.display != \"block\") {\r\n\t\tdocument.getElementById('infos_cps_caption_img').className = \"infos_cps_caption_img_collapse\";\r\n\t\tdocument.getElementById('infos_cps_table').style.display = \"block\";\r\n\t} else {\r\n\t\tdocument.getElementById('infos_cps_caption_img').className = \"infos_cps_caption_img_expand\";\r\n\t\tdocument.getElementById('infos_cps_table').style.display = \"none\";\r\n\t}\r\n\tevent.cancelBubble = true;\r\n\t\t\r\n\treturn false;\r\n}\r\n\r\nfunction clickActionNoPropagation(event) {\r\n\t//this.click();\r\n\r\n\tevent.cancelBubble = true;\r\n\r\n\treturn false;\r\n}\r\n\n<!-- script : /js/wizarddiagcps.js End -->\n<!-- script : /js/diagcps.js Begin -->\n//==================================\r\n// Global variable used for all data \r\n// displayed on screen \r\n// or used by state machine\r\n//==================================\r\nvar dataIHM = {\r\n\t//==========================\r\n\t// Root URL\r\n\tlocalURL: '',\r\n\tsetLocalURL: function(URL) {this.localURL = URL;},\r\n\tgetLocalURL: function() {return this.localURL;},\r\n\t\r\n\t//==========================\r\n\t// User Agent\r\n\tclientUAInfos: null,\r\n\ttimerUAInfos: null,\r\n\tinitUAInfos: function() {\r\n\t\t\t\t\t\tvar uaparser = new UAParser();\r\n\t\t\t\t\t\tthis.clientUAInfos = uaparser.getResult();\r\n\t\t\t\t\t\tthis.clientUAInfos.browser.xpi = true;\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tthis.timerUAInfos = setTimeout(function(){dataIHM.isUAInfosCPSWebEx()}, 1000);\r\n\t\t\t\t\t},\r\n\tgetUAInfos: function() {return this.clientUAInfos},\r\n\tisUAInfosCPSWebEx: function() {\r\n\t\t\t\t\tif (window.isCpsWebExAlive) {\r\n\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', window.isCpsWebExAlive());\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (this.getUAInfos().browser.name == 'Firefox') {\r\n\t\t\t\t\t\t\tif (this.getUAInfos().browser.major > 57) {\r\n\t\t\t\t\t\t\t\tthis.clientUAInfos.browser.xpi = false;\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'absente');\r\n\t\t\t\t\t\t\t\twizardStateMachine.wizard('manualInstallXPI');\r\n\t\t\t\t\t\t\t} else if (this.getUAInfos().browser.major == 57) {\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'sur cette version, l\\'installation du p&eacute;riph&eacute;rique de s&eacute;curit&eacute; doit &ecirc;tre <a href=\"http://integrateurs-cps.asipsante.fr/Installation-manuelle-PKCS11-Firefox\" target=\"_blanck\">r&eacute;alis&eacute;e manuellement</a>.');\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('CPS Extension', 'd&eacute;tection impossible sur cette version');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.timerUAInfos = null;\r\n\t\t\t\t},\r\n\t\r\n\t//===============================\r\n\t// Installed Component management\r\n\tcomponentName: \"CryptolibCPS\", // By default\r\n\tsetComponentName: function(name) {this.componentName = name;},\r\n\tgetComponentName: function() {return this.componentName;},\r\n\tcomponentVersion: \"\", // By Default\r\n\tsetcomponentVersion: function(version) {this.componentVersion = version;},\r\n\tgetcomponentVersion: function() {return this.componentVersion;},\r\n\tcomponentInstallerName: \"\",\r\n\tsetComponentInstallerName: function(name) {this.componentInstallerName = name;},\r\n\tgetComponentInstallerName: function() {return this.componentInstallerName;},\r\n\tserverComponentURL: null,\r\n\tsetServerComponentURL: function(URL) {this.serverComponentURL = URL;},\r\n\tgetServerComponentLink: function(version) {\r\n\t\t\t\t\t\t\t\t\tvar componentLink = this.serverComponentURL + \"?\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"component=\" + this.getComponentName();\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&os=\" + this.getUAInfos().os.name;\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&arch=\" + this.getUAInfos().cpu.architecture;\r\n\t\t\t\t\t\t\t\t\tcomponentLink += \"&version=\" + this.getcomponentVersion();\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\treturn componentLink;\r\n\t\t\t\t\t\t\t\t},\r\n\tserverComponentInfos: null,\r\n\treadServerComponentInfos: function() {\r\n\t\t\t\t\t\t\t\t// XPI 6.0.15 with Firefox < 57\r\n\t\t\t\t\t\t\t\t// ==> Use Cryptolib CPS 5.0.37 instead of last release\r\n\t\t\t\t\t\t\t\tif ((this.getUAInfos().browser.name == 'Firefox') \r\n\t\t\t\t\t\t\t\t\t&& (this.getUAInfos().browser.major < 57)) {\r\n\t\t\t\t\t\t\t\t\tswitch (this.getUAInfos().os.name) {\r\n\t\t\t\t\t\t\t\t\t\tcase 'Windows': this.setcomponentVersion('5.0.37');break;\r\n\t\t\t\t\t\t\t\t\t\tcase 'Mac OS': this.setcomponentVersion('5.0.34');break;\r\n\t\t\t\t\t\t\t\t\t\tcase 'Linux':\r\n\t\t\t\t\t\t\t\t\t\tcase 'CentOS':\r\n\t\t\t\t\t\t\t\t\t\tcase 'Ubuntu':\r\n\t\t\t\t\t\t\t\t\t\tcase 'RedHat':  this.setcomponentVersion('5.0.12');break;\r\n\t\t\t\t\t\t\t\t\t\tdefault:break;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// Use fetch if exist\r\n\t\t\t\t\t\t\t\tif (self.fetch) {\r\n\t\t\t\t\t\t\t\t\tfetch( this.getServerComponentLink() + '&filename=get' )\r\n\t\t\t\t\t\t\t\t\t.then(function(resp) {return resp.json();})\r\n\t\t\t\t\t\t\t\t\t.then(function(response) {\r\n\t\t\t\t\t\t\t\t\t\tfor (var k in response) {\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.setComponentInstallerName(response[k]);\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.addClientDetailedInfos('URL de t&eacute;l&eacute;chargement', '<a href=\"' + dataIHM.getServerComponentLink() + '\">' + dataIHM.getComponentInstallerName() + '</a>');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('readServerComponentInfos : Error with fetch (' + error.message + ')'); \r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t// Use JQuery\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$.ajax(\t{\r\n\t\t\t\t\t\t\t\t\t\turl: this.getServerComponentLink() + '&filename=get'\r\n\t\t\t\t\t\t\t\t\t\t, success: function( data) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar json;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (data === String)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson = jQuery.parseJSON(data);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson = data\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor (var k in json) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setComponentInstallerName(json[k]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.addClientDetailedInfos('URL de t&eacute;l&eacute;chargement', '<a href=\"' + dataIHM.getServerComponentLink() + '\">' + dataIHM.getComponentInstallerName() + '</a>');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t, error: function( data) { return null;}\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\r\n\t//========================================\r\n\t// Support contact informations management\r\n \tmailSupportMailbox: null,\r\n\tmailSupportDomain: null,\r\n\tsetMailSupport: function(mailbox, domain) {this.mailSupportMailbox = mailbox; this.mailSupportDomain = domain;},\r\n\tgetMailSupport: function() {return this.mailSupportMailbox + \"@\" + this.mailSupportDomain;},\r\n \t\t\r\n\t//==========================\r\n\t// Detailed informations\r\n\tclientDetailedInfos: {},\r\n\tinitClientDetailedInfos: function() {\r\n\t\t\t\t\t\t\t\tconfigSupported = true;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.getUAInfos().device.type === undefined) {\r\n\t\t\t\t\t\t\t\t\tconsole.log(\"Poste de travail\");\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tconfigSupported = false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().os.name) {\r\n\t\t\t\t\t\t\t\t\tcase 'Windows':\r\n\t\t\t\t\t\t\t\t\tcase 'Mac OS':\r\n\t\t\t\t\t\t\t\t\tcase 'Linux':\r\n\t\t\t\t\t\t\t\t\tcase 'CentOS':\r\n\t\t\t\t\t\t\t\t\tcase 'Ubuntu':\r\n\t\t\t\t\t\t\t\t\tcase 'RedHat':  configSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault: \t\tconfigSupported = configSupported & false;break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().browser.name) {\r\n\t\t\t\t\t\t\t\t\tcase 'IE':\r\n\t\t\t\t\t\t\t\t\tcase 'Safari':\r\n\t\t\t\t\t\t\t\t\tcase 'Edge':\r\n\t\t\t\t\t\t\t\t\tcase 'Chrome':\r\n\t\t\t\t\t\t\t\t\tcase 'Firefox':\tconfigSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault: \t\tconfigSupported = configSupported & false;break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tswitch (this.getUAInfos().cpu.architecture) {\r\n\t\t\t\t\t\t\t\t\tcase 'ia32':\r\n\t\t\t\t\t\t\t\t\tcase 'i686':\r\n\t\t\t\t\t\t\t\t\tcase 'amd64': configSupported = configSupported & true;break;\r\n\t\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\t\tif (this.getUAInfos().cpu.architecture === undefined)\r\n\t\t\t\t\t\t\t\t\t\t\tconfigSupported = configSupported & true;\r\n\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\tconfigSupported = configSupported & false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (this.getUAInfos().cpu.architecture == 'amd64')\r\n\t\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Syst&egrave;me d\\'exploitation', this.getUAInfos().os.name + \" \" + this.getUAInfos().os.version + \" (64b)\");\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Syst&egrave;me d\\'exploitation', this.getUAInfos().os.name + \" \" + this.getUAInfos().os.version);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.addClientDetailedInfos('Navigateur', this.getUAInfos().browser.name + \" \" + this.getUAInfos().browser.major);\r\n\t\t\t\t\t\t\t\t// this.addClientDetailedInfos('Compatibilit&eacute; ASIP', '<a href=\"http://integrateurs-cps.asipsante.fr/Lettre_d_information\" target=\"_blanck\">Lettre d\\'information<br/>POSTE DE TRAVAIL & Veille Technologique</a>');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthis.clientUAInfos.configSupported = configSupported;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\treturn configSupported;\r\n\t\t\t\t\t\t\t},\r\n\tgetClientDetailedInfos: function() {return this.clientDetailedInfos;},\r\n\taddClientDetailedInfos: function(key, value) { this.clientDetailedInfos[key] = value;},\r\n\tresetClientDetailedInfos: function() {this.clientDetailedInfos = {};},\r\n\t\t\r\n\t//==========================\r\n\t// Client SSL Informations\r\n\tclientSSLInfos: null,\r\n\tclientSSLFetchParameters: { mode:'cors', credentials: 'include', cache: 'no-cache'},\r\n\tclientSSLAjaxParameters: { cache: false, timeout: 8000, async: true},\r\n\tisDefineClientSSLInfos: function() {return (this.clientSSLInfos != undefined);},\r\n\tsetClientSSLInfos: function(data) {this.clientSSLInfos = data;},\r\n\tgetClientSSLInfos: function() {return this.clientSSLInfos;},\r\n\tinitClientSSLParameters: function() { $.ajaxSetup(this.clientSSLAjaxParameters);},\r\n\tresetClientSSLInfos: function () {\r\n\t\t\t\t\t\t\tconsole.log('resetClientSSLInfos : Erase SSL Connexion cache for ' + this.getUAInfos().browser.name);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tswitch (this.getUAInfos().browser.name) {\r\n\t\t\t\t\t\t\t\tcase 'Edge': // Works !\r\n\t\t\t\t\t\t\t\tcase 'IE': // Works !\r\n\t\t\t\t\t\t\t\t\tif (document.execCommand) document.execCommand( \"ClearAuthenticationCache\", \"false\");\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 'Firefox':\t// Works !\r\n\t\t\t\t\t\t\t\t\t//location.reload(); // Works !\r\n\t\t\t\t\t\t\t\t\tif (window.crypto) if (window.crypto.logout) window.crypto.logout(); // Works !\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag');\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase 'Chrome': // Works !\r\n\t\t\t\t\t\t\t\tcase 'Safari': // Not working, restart Browser needed !\r\n\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('startDiag'); \r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\treadClientSSLInfos: function() {\r\n\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : SSL Connexion' );\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// Use fetch if exist\r\n\t\t\t\t\t\t\tif (self.fetch) {\r\n\t\t\t\t\t\t\t\t// Try to connect and get CPS informations\r\n\t\t\t\t\t\t\t\tfetch( '/visuel.php', this.clientSSLFetchParameters )\r\n\t\t\t\t\t\t\t\t.then(function(resp) {return resp.json();})\r\n\t\t\t\t\t\t\t\t.then(function(resp_json) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Success with Fetch');\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t// traitement du JSON\r\n\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(resp_json);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('endDiagWithSuccess');\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t// Case of SSL Error\r\n\t\t\t\t\t\t\t\t.catch(function(error) {\r\n\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Probably SSL Error with fetch (' + error.message + ')');\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(null);\r\n\t\t\t\t\t\t\t\t\twizardStateMachine.accelerateTimer();\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t// Use JQuery\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$.ajax(\t{\r\n\t\t\t\t\t\t\t\t\turl: 'visuel.php'\r\n\t\t\t\t\t\t\t\t\t, success: function(data, textStatus) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Success with Ajax (' + textStatus + ')');\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tif (data === String)\r\n\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(jQuery.parseJSON(data));\r\n\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(data);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\twizardStateMachine.wizard('endDiagWithSuccess');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t, error: function(data, textStatus) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('readClientSSLInfos : Probably SSL Error with Ajax (' + textStatus + ')');\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tdataIHM.setClientSSLInfos(null);\r\n\t\t\t\t\t\t\t\t\t\t\twizardStateMachine.accelerateTimer();\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n}\r\n\r\n//=====\r\n// Main\r\n//=====\r\n$(function() {\r\n\t// Initialization\r\n\t//---------------\r\n\tdataIHM.initUAInfos(); // User Agent\r\n\t\r\n\tdataIHM.initClientSSLParameters();\r\n\t\r\n\t// Sp�cific parameter with no good solution @29/12/2017\r\n\tswitch (dataIHM.getUAInfos().browser.name) {\r\n\t\tcase 'IE':\r\n\t\t\tconsole.log('=========== Use Ajax =============');\r\n\t\t\tself.fetch = undefined;\r\n\t\t\tbreak;\r\n\t\tcase 'Edge':\r\n\t\tcase 'Firefox':\r\n\t\tcase 'Safari':\r\n\t\tdefault:\r\n\t\t\tconsole.log('=========== Try using fetch. If not available use Ajax =============');\r\n\t\t\tbreak;\r\n\t}\r\n\t\r\n\tdataIHM.initClientDetailedInfos(); // Informations in bottom\r\n\tdataIHM.readServerComponentInfos(); // Get from informations from Web Service\r\n\t\r\n\twizardStateMachine.startWizard(); // Start Wizard\r\n\t\t\r\n\twizardStateMachine.displayInit(dataIHM.getUAInfos().os.name);\r\n});\r\n\n<!-- script : /js/diagcps.js End -->\n\n</script>\n<script type=\"text/javascript\">\n\t// Initialization Javascript from PHP\n\tdataIHM.setComponentName('CryptolibCPS');\n\tdataIHM.setServerComponentURL('download.php');\n</script>\n<!--<div id=\"beta\"></div>-->\n<div id=\"instructions-back\" onclick=\"wizardStateMachine.wizard('exitInstruction');\">\n\t<div id=\"instructions\">\n\t\n\t\t<div class=\"screen\" id=\"preAlert\">\n\t\t\t<div class=\"instruction\"><br/>\n<h1>Assistance en cas de carte CPS non lue</h1>\n\n<h2>Pr&eacute;alablement</h2>\n<p>\nVeuillez v&eacute;rifier que votre carte est bien ins&eacute;r&eacute;e dans votre lecteur de carte ou votre terminal Vitale.<br/>\nPuis v&eacute;rifier que votre lecteur de carte ou votre terminal Vitale est correctement connect&eacute; &agrave; votre ordinateur.<br/>\n<br/>\nLa carte ins&eacute;r&eacute;e dans le lecteur doit &ecirc;tre la derni&egrave;re carte active.\n\n<table >\n\t<tr>\n\t\t<td style=\"border-top:none;\"><img src=\"images/informations32.png\" alt=\"Information :\"/></td>\n\t\t<td style=\"border-top:none;\"><i>La derni&egrave;re carte active pr&eacute;sente la date d'expiration la plus &eacute;loign&eacute;e.</i></td>\n\t</tr>\n</table>\n<br/>\nUne fois cette v&eacute;rification r&eacute;alis&eacute;e, v&eacute;rifiez que la carte est bien lue.<br/>\n</p>\n\n<div id=\"alert1-MacOS\">\n<h2>Votre ordinateur est sous Mac OS</h2>\n<p>\nSur votre syst&egrave;me d'exploitation, nous ne disposons pas de m&eacute;thode particuli&egrave;re pour v&eacute;rifier si votre carte est lue.<br/>\n<br/>\nVeuillez lancer un diagnostic de votre ordinateur et proc&eacute;der &agrave; l'installation des mises &agrave; jour sugg&eacute;r&eacute;es.<br/>\n</p>\n</div>\n\n<div id=\"alert1-Linux\">\n<h2>Votre ordinateur est sous Linux</h2>\n<p>\nSur votre syst&egrave;me d'exploitation, nous ne disposons pas de m&eacute;thode particuli&egrave;re pour v&eacute;rifier si votre carte est lue.<br/>\n<br/>\nVeuillez lancer un diagnostic de votre ordinateur et proc&eacute;der &agrave; l'installation des mises &agrave; jour sugg&eacute;r&eacute;es.<br/>\n</p>\n</div>\n\n<div id=\"alert1-Windows\">\n<h2>Votre ordinateur est sous Windows</h2>\n<b>Dans la barre des t&acirc;ches, une carte lue est signal&eacute;e par <img src=\"images/preHelper/iconeOK.png\" alt=\"Icone vert dans la barre des taches\" /> et une carte non lue par <img src=\"images/preHelper/iconeKO.png\" alt=\"Icone rouge dans la barre des taches\"/>.</b><br/>\n<h3>L'ic&ocirc;ne <img src=\"images/preHelper/iconeOK.png\" alt=\"Icone vert dans la barre des taches\"/> est introuvable</h3>\n<p>\nCliquez avec le clic droit de votre souris sur le bouton &laquo;Afficher les ic&ocirc;nes&raquo; (en bas &agrave; droite de votre &eacute;cran) ou sur la zone heure et date et selectionnez &laquo;Personnaliser les ic&ocirc;nes de notification&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/notificationsBar.png\" alt=\"Barre de notification\"/></div>\n<br/>\n<br/>\nCherchez l'ic&ocirc;ne &laquo;Gestionnaire de certificats CPS&raquo; et s&eacute;lectionnez &laquo;Afficher l'ic&ocirc;ne et les notifications&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/notificationsParameters.png\" alt=\"Parametres de notifications\"/></div>\n<br/>\nUne fois la manipulation r&eacute;alis&eacute;e vous devriez voir apparaitre l'ic&ocirc;ne (en bas &agrave; droite de votre &eacute;cran).<br/>\n<br/>\nSi l'ic&ocirc;ne n'apparait pas dans la liste, lancer le diagnostic de votre ordinateur et installez les mises &agrave; jour propos&eacute;es.<br/>\n<br/>\n</p>\n<h2>L'ic&ocirc;ne <img src=\"images/preHelper/iconeKO.png\" alt=\"Icone rouge dans la barre des taches\" /> est rouge</h2>\n<p>\nSi l'ic&ocirc;ne est encadr&eacute;e de rouge (carte non lue), assurez-vous que votre carte est bien ins&eacute;r&eacute;e dans votre lecteur, rafra&icirc;chissez le lecteur en cliquant sur l'ic&ocirc;ne avec le bouton droit de la souris. Et cliquez sur &laquo;Rafra&icirc;chir&raquo;.<br/>\n<br/>\n<div align=\"center\"><img src=\"images/preHelper/rightClickCCM.png\" alt=\"Cliquer droit sur l'icone du CCM\" /></div>\n<br/>\nSi l'encadr&eacute; reste rouge apr&egrave;s la manipulation, red&eacute;marrez votre ordinateur en laissant le lecteur et la CPS connect&eacute;s.<br/>\n<br/>\nApr&egrave;s ces manipulations, si l'ic&ocirc;ne ne passe pas au vert, veuillez nous contacter.\n</p>\n<div align=\"center\"></div>\n</div>\n\n</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"startDiag\" onclick=\"wizardStateMachine.wizard('startDiag');\">Diagnostiquer mon poste</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"notSupported\">\n\t\t\t<div class=\"instruction\">Votre configuration mat&eacute;riel et/ou syst&egrave;me n'est pas support&eacute;e par nos composants logiciels. Nous ne garantissons pas le succès du diagnostic.</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"notSupported\" onclick=\"wizardStateMachine.wizard('preAlert');\">Continuer</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"manualInstallXPI\">\n\t\t\t<div class=\"instruction\" id=\"xpi_instruction\" >L'Extension Firefox n'a pas &eacute;t&eacute; d&eacute;tect&eacute;e. Elle est indispensable sous ce navigateur.<br/>Apr&egrave;s l'installation, veuillez red&eacute;marrer votre navigateur.</div>\n\t\t\t<div class=\"actions\">\n<!--\t\t\t\t<div class=\"action instruction\" id=\"xpi\" onclick=\"wizardStateMachine.wizard('XPI',{URL:'https://diagcps.eservices.esante.gouv.fr/ODI_PS/php/download_asip.php?installeur=url_interne_xpi_installation_pkcs11',IconURL:'https://diagcps.eservices.esante.gouv.fr/ODI_PS/images/asip_sante.png',Hash:'sha256:c23de3812aaf7c3a81d80e9bdf891c3e2b621e01e55e8d308226fd86ab6ef438'});\">Installer<br/>l'Extension Firefox</div>-->\n<div class=\"action instruction\" id=\"xpi\" onclick=\"wizardStateMachine.wizard('XPI',{URL:'/download.php?component=xpi',IconURL:'/images/asip_sante.png',Hash:'sha256:c23de3812aaf7c3a81d80e9bdf891c3e2b621e01e55e8d308226fd86ab6ef438'});\">Installer<br/>l'Extension Firefox</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"restartAlertXPI\">\n\t\t\t<div class=\"instruction\" id=\"restartInstructionXPI\" >Une fois l'installation de l'Extension Cryptolib CPS termin&eacute;e,<br/>veuillez red&eacute;marrer votre navigateur.</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"manualInstallClibCPS\">\n\t\t\t<div class=\"instruction\">Si vous avez ins&eacute;r&eacute; votre CPS dans votre lecteur sans succ&egrave;s, la version de Cryptolib CPS de votre poste de travail n'est peut-&ecirc;tre pas &agrave; jour.</div>\n\t\t\t<div class=\"actions\">\n\t\t\t\t<div class=\"action instruction\" id=\"cryptolib\" onclick=\"wizardStateMachine.wizard('CryptolibCPS');\">T&eacute;l&eacute;charger<br/>Cryptolib CPS</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"restartAlert\">\n\t\t\t<div class=\"instruction\" id=\"restartInstruction\" >Une fois l'installation de CryptolibCPS_vX.Y.Z termin&eacute;e, veuillez red&eacute;marrer votre navigateur.</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"screen\" id=\"contactSupport\">\n\t\t\t<div class=\"instruction\">Si vous avez installez le composant propos&eacute; sans succ&eacute;s,<br/> veuillez contacter le Support.</div>\n\t\t</div>\n\t\t\n\t</div>\n</div>\t\n<div id=\"service-direction\" class=\"column\"></div>\n<div id=\"article\">\n\t<div id=\"center\">\n\t\t<div class=\"diagState\" id=\"diagState\"></div>\n\t\t<div>\n\t\t\t<div id=\"cps\" class=\"cpsverso\" onclick=\"wizardStateMachine.wizard('restartDiag');\"><div id=\"spin\"><div id=\"retry\"></div></div></div>\n\t\t</div>\n<!--\t\t\n\t\t<div id=\"results\">\n\t\t\t<div>\n\t\t\t\t<div class=\"sign\" id=\"certificat\"></div>\n\t\t\t\t<div class=\"sign\" id=\"expired\" title=\"expire\"></div>\n\t\t\t\t<div class=\"sign\" id=\"revoc\" title=\"revoque\"></div>\n\t\t\t\t<div class=\"sign\" id=\"class\"></div>\n\t\t\t\t<div class=\"sign\" id=\"rootAC\"></div>\n\t\t\t\t<div class=\"sign\" id=\"cryptolib\" title=\"cryptolib\"></div>\n\t\t\t</div>\n\t\t</div>\n-->\n\t\t<div id=\"cps_infos\">\n\t\t\t<div id=\"infos_cps\">\n\t\t\t\t<div id=\"infos_cps_caption\"><div>Informations d&eacute;taill&eacute;es</div><div class=\"infos_cps_caption_img_expand\" id=\"infos_cps_caption_img\"></div></div>\n\t\t\t\t<table id=\"infos_cps_table\">\n\t\t\t\t\t<tbody id=\"infos_cps_tbody\"></tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n<div id=\"support-direction\" class=\"column\"></div>\n</div>\r\n<div id=\"footer\" style=\"display:flex;flex-direction:row\">\r\n    <div style=\"display:flex;flex-direction:row;width:30vw\">\r\n        <div style=\"margin:20px\">\r\n            <a href=\"https://solidarites-sante.gouv.fr/\" target=\"_blank\">\r\n                <img src=\"./images/logo-ministere.svg\" alt=\"Ministère des Solidarités et de la santé\" width=\"84\" height=\"62\">\r\n            </a>\r\n        </div>\r\n        <div style=\"margin:20px\">\r\n            <a href=\"https://esante.gouv.fr/\" target=\"_blank\">\r\n                <img src=\"./images/logo-ANS.svg\" alt=\"Agence du Numérique en Santé\" width=\"166\" height=\"50\">\r\n            </a>\r\n        </div>\r\n    </div>\r\n    <div style=\"width:60vw\">\r\n        <ul style=\"align-items:end\">\r\n            <li><a href=\"http://esante.gouv.fr/services/mentions-legales\" target=\"_blank\">Mentions l&eacute;gales</a></li>\r\n            <li><a href=\"./copyright.php\" target=\"_blank\" title=\"Copyright [nouvelle fen&ecirc;tre]\">Copyright</a></li>\r\n        </ul>\r\n    </div>\r\n</div>\r\n\r\n</body>\r\n</html>\r\n",
      "ip": "135.125.232.117",
      "timestamp": "2025-03-14T16:26:55.913589728Z",
      "curl-command": "curl -X 'POST' -d '_=<script>alert(1)</script>' -H 'Content-Type: application/x-www-form-urlencoded' -H 'Host: diagcps.eservices.esante.gouv.fr' -H 'User-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)' 'https://diagcps.eservices.esante.gouv.fr/'",
      "matcher-status": true
    },
    {
      "template": "network/detection/openssh-detect.yaml",
      "template-url": "https://templates.nuclei.sh/public/openssh-detect",
      "template-id": "openssh-detect",
      "template-path": "/home/runner/nuclei-templates/network/detection/openssh-detect.yaml",
      "info": {
        "name": "OpenSSH Service - Detect",
        "author": [
          "r3dg33k",
          "daffainfo",
          "iamthefrogy"
        ],
        "tags": [
          "seclists",
          "network",
          "ssh",
          "openssh",
          "detect",
          "detection",
          "tcp"
        ],
        "description": "OpenSSH service was detected.\n",
        "reference": [
          "http://www.openwall.com/lists/oss-security/2016/08/01/2",
          "http://www.openwall.com/lists/oss-security/2018/08/15/5",
          "http://seclists.org/fulldisclosure/2016/jul/51",
          "https://nvd.nist.gov/vuln/detail/cve-2016-6210",
          "https://nvd.nist.gov/vuln/detail/cve-2018-15473"
        ],
        "severity": "info",
        "metadata": {
          "max-request": 1
        },
        "classification": {
          "cve-id": null,
          "cwe-id": [
            "cwe-200"
          ],
          "cvss-metrics": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:N"
        }
      },
      "type": "tcp",
      "host": "diagcps.eservices.esante.gouv.fr:22",
      "matched-at": "diagcps.eservices.esante.gouv.fr:22",
      "extracted-results": [
        "SSH-2.0-OpenSSH_8.0"
      ],
      "response": "SSH-2.0-OpenSSH_8.0\r\n",
      "ip": "135.125.232.117",
      "timestamp": "2025-03-14T16:27:56.603830371Z",
      "matcher-status": true
    },
    {
      "template": "ssl/detect-ssl-issuer.yaml",
      "template-url": "https://templates.nuclei.sh/public/ssl-issuer",
      "template-id": "ssl-issuer",
      "template-path": "/home/runner/nuclei-templates/ssl/detect-ssl-issuer.yaml",
      "info": {
        "name": "Detect SSL Certificate Issuer",
        "author": [
          "lingtren"
        ],
        "tags": [
          "ssl",
          "tls"
        ],
        "description": "Extract the issuer's organization from the target's certificate. Issuers are entities which sign and distribute certificates.\n",
        "severity": "info",
        "metadata": {
          "max-request": 1
        }
      },
      "type": "ssl",
      "host": "diagcps.eservices.esante.gouv.fr",
      "matched-at": "diagcps.eservices.esante.gouv.fr:443",
      "extracted-results": [
        "Let's Encrypt"
      ],
      "ip": "135.125.232.117",
      "timestamp": "2025-03-14T16:28:47.310971225Z",
      "matcher-status": true
    },
    {
      "template": "ssl/ssl-dns-names.yaml",
      "template-url": "https://templates.nuclei.sh/public/ssl-dns-names",
      "template-id": "ssl-dns-names",
      "template-path": "/home/runner/nuclei-templates/ssl/ssl-dns-names.yaml",
      "info": {
        "name": "SSL DNS Names",
        "author": [
          "pdteam"
        ],
        "tags": [
          "ssl",
          "tls"
        ],
        "description": "Extract the Subject Alternative Name (SAN) from the target's certificate. SAN facilitates the usage of additional hostnames with the same certificate.\n",
        "severity": "info",
        "metadata": {
          "max-request": 1
        }
      },
      "type": "ssl",
      "host": "diagcps.eservices.esante.gouv.fr",
      "matched-at": "diagcps.eservices.esante.gouv.fr:443",
      "extracted-results": [
        "diagcps.eservices.esante.gouv.fr",
        "essaietaecps.eservices.esante.gouv.fr",
        "testssl.asipsante.fr",
        "testssl.eservices.esante.gouv.fr",
        "tryecps.show.asipsante.fr",
        "demo-enreg.show.asipsante.fr"
      ],
      "ip": "135.125.232.117",
      "timestamp": "2025-03-14T16:28:47.311152492Z",
      "matcher-status": true
    },
    {
      "template": "ssl/tls-version.yaml",
      "template-url": "https://templates.nuclei.sh/public/tls-version",
      "template-id": "tls-version",
      "template-path": "/home/runner/nuclei-templates/ssl/tls-version.yaml",
      "info": {
        "name": "TLS Version - Detect",
        "author": [
          "pdteam",
          "pussycat0x"
        ],
        "tags": [
          "ssl",
          "tls"
        ],
        "description": "TLS version detection is a security process used to determine the version of the Transport Layer Security (TLS) protocol used by a computer or server.\nIt is important to detect the TLS version in order to ensure secure communication between two computers or servers.\n",
        "severity": "info",
        "metadata": {
          "max-request": 4
        }
      },
      "type": "ssl",
      "host": "diagcps.eservices.esante.gouv.fr",
      "matched-at": "diagcps.eservices.esante.gouv.fr:443",
      "extracted-results": [
        "tls12"
      ],
      "ip": "135.125.232.117",
      "timestamp": "2025-03-14T16:28:48.630081606Z",
      "matcher-status": true
    }
  ]
]
